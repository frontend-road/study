{"id":489409,"title":"31ï½œnewå’ŒdeleteèƒŒåï¼šåˆ†é…å‡½æ•°å’Œé‡Šæ”¾å‡½æ•°","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å´å’ç‚œã€‚</p><p>æœ‰ä¸€ä¸ªæˆ‘ä¹‹å‰æ²¡è®²ã€ä½†æŒºæœ‰æ„æ€çš„è¯é¢˜æ˜¯ <code>new</code> å’Œ <code>delete</code> è¡Œä¸ºçš„å®šåˆ¶ã€‚è¿™ä»¶äº‹æƒ…æˆ‘å¾ˆä¹…å¾ˆä¹…ä»¥å‰å°±åšè¿‡ <span class=\"orange\">[1]</span>ï¼Œæ²¡å¾€ä¸“æ é‡Œå†™çš„æœ€ä¸»è¦åŸå› æ˜¯ï¼Œè¿™å®é™…æ˜¯ C++98 å°±æœ‰çš„é«˜çº§æŠ€å·§ï¼Œä¸å±äºç°ä»£ C++ã€‚ä¸è¿‡ï¼Œåœ¨ç›®å‰ç»­å†™çš„å†…å®¹é‡Œï¼Œæˆ‘å°±ä¸å†æ‹˜æ³¥å¿…é¡»æ–°äº†ï¼Œæ—¢ç„¶è¿™æ˜¯ C++ é‡Œç°åœ¨ä»ç„¶éœ€è¦çš„æŠ€å·§ï¼Œé‚£å°±è¿˜æ˜¯ä»‹ç»ä¸€ä¸‹ã€‚ä½•å†µï¼Œè¿™éƒ¨åˆ†åœ¨ç°ä»£ C++ é‡Œè¿˜æ˜¯æœ‰ç‚¹æ–°å†…å®¹çš„ã€‚</p><h2>æœ€å¸¸ç”¨çš„åˆ†é…å’Œé‡Šæ”¾å‡½æ•°</h2><p>åœ¨<a href=\"https://time.geekbang.org/column/article/169225\">ç¬¬ 1 è®²</a>ï¼Œæˆ‘æåˆ°è¿‡ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ <code>new</code> å’Œ <code>delete</code> æ¥åˆ›å»ºå’Œé”€æ¯å¯¹è±¡æ—¶ï¼Œå®é™…å‘ç”Ÿçš„äº‹æƒ…è¿˜æ˜¯æ¯”è¾ƒå¤šçš„ï¼ˆå¦‚æœå¿˜äº†çš„è¯ï¼Œå¯ä»¥å»å¤ä¹ ä¸€ä¸‹ï¼‰ã€‚å…¶ä¸­ï¼Œåˆ†é…å†…å­˜å’Œé‡Šæ”¾å†…å­˜çš„æ“ä½œæ˜¯é€šè¿‡ <code>operator new</code> å’Œ <code>operator delete</code> å‡½æ•°å®Œæˆçš„ã€‚åœ¨æœ€ç®€å•çš„ <code>new</code> å’Œ <code>delete</code> å½¢å¼é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ä»¥ä¸‹ä¸¤ä¸ªå‡½æ•°ï¼š</p><pre><code class=\"language-cpp\">void* operator new(size_t size);\nvoid operator delete(void* ptr) noexcept;\n</code></pre><p><code>operator new</code> å’Œ <code>operator delete</code> å‡½æ•°é€šå¸¸å°±è¢«ç§°ä¸ºåˆ†é…å‡½æ•°ï¼ˆallocation functionï¼‰å’Œé‡Šæ”¾å‡½æ•°ï¼ˆdeallocation functionï¼‰ã€‚</p><p>éœ€è¦æ³¨æ„ <code>operator new</code> æ˜¯å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„ï¼Œè€Œ <code>operator delete</code> åˆ™ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè¢«æ ‡ä¸º noexceptã€‚è¿™å’Œæˆ‘ä»¬é€šå¸¸ä¸å…è®¸åœ¨ææ„å‡½æ•°ä¸­æŠ›å‡ºå¼‚å¸¸æ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚</p><!-- [[[read_end]]] --><p>ä½†è¿™è¿œä¸æ˜¯è¿™ä¸¤ä¸ªå‡½æ•°çš„æ‰€æœ‰å½¢å¼ã€‚æœ€å…¸å‹æƒ…å†µï¼Œæˆ‘ä»¬å¯¹äºæ•°ç»„å½¢å¼çš„åˆ†é…ï¼ˆå¦‚ <code>pArray = new Obj[42]</code>ï¼‰å’Œé‡Šæ”¾ï¼ˆå¦‚ <code>delete[] pArray</code>ï¼‰ï¼Œæœ‰ä¸“é—¨çš„åˆ†é…å’Œé‡Šæ”¾å‡½æ•°ï¼š</p><pre><code class=\"language-cpp\">void* operator new[](size_t size);\nvoid operator delete[](void* ptr) noexcept;\n</code></pre><p>è¿™äº›å‡½æ•°çš„é»˜è®¤å®ç°éƒ½å¾ˆç®€å•ï¼Œå¤§è‡´ç›¸å½“äºï¼š</p><pre><code class=\"language-cpp\">void* operator new(size_t size)\n{\n  void* ptr = malloc(size);\n  if (ptr == nullptr) {\n    throw bad_alloc();\n  }\n  return ptr;\n}\n\nvoid operator delete(void* ptr) noexcept\n{\n  free(ptr);\n}\n\nvoid* operator new[](size_t size)\n{\n  return operator new(size);\n}\n\nvoid operator delete[](void* ptr) noexcept\n{\n  operator delete(ptr);\n}\n</code></pre><p>å³ï¼Œè¿™äº›å‡½æ•°æœ€åä¼šè½¬åˆ° C æ ‡å‡†åº“é‡Œçš„ <code>malloc</code> å’Œ <code>free</code> ä¸Šï¼Œä½†æ˜¯ï¼Œåˆ†é…å‡½æ•°åœ¨å†…å­˜åˆ†é…å¤±è´¥æ—¶çš„é»˜è®¤è¡Œä¸ºæ˜¯æŠ›å¼‚å¸¸ï¼Œè€Œéè¿”å›ç©ºæŒ‡é’ˆã€‚</p><p>ä½ å¯èƒ½ä¼šæƒ³ï¼Œä¸ºä»€ä¹ˆè¦è¿™ä¹ˆä¸­è½¬ä¸€æ¬¡å‘¢ï¼Œç›´æ¥è°ƒç”¨ <code>malloc</code> å’Œ <code>free</code> ä¸è¡Œå—ï¼ŸåŸå› ä¹Ÿå¾ˆç®€å•ï¼Œè¿™æ ·ä¸€ä¸ªä¸­é—´å±‚å°±æ˜¯ä¸€ä¸ªå®šåˆ¶ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æä¾›è‡ªå·±çš„ <code>operator new</code> å’Œ <code>operator delete</code> å‡½æ•°æ¥ä¿®æ”¹å†…å­˜çš„åˆ†é…å’Œé‡Šæ”¾è¡Œä¸ºï¼Œè€Œéç›´æ¥è°ƒç”¨ <code>malloc</code> å’Œ <code>free</code>ã€‚å½“ç”¨æˆ·ä¸æä¾› <code>operator new</code> å’Œ <code>operator delete</code> å‡½æ•°æ—¶ï¼Œ<code>new</code> å’Œ <code>delete</code> å°±ä¼šè°ƒç”¨æ ‡å‡†åº“æä¾›çš„ç‰ˆæœ¬ï¼›å¦åˆ™ï¼Œç”¨æˆ·æä¾›çš„ <code>operator new</code> å’Œ <code>operator delete</code> å‡½æ•°å°±ä¼šè¢«ä½¿ç”¨ã€‚</p><p>å…·ä½“çš„å®ç°æœºåˆ¶æ ¹æ®å¹³å°ä¸åŒè€Œä¸åŒã€‚æ¯”å¦‚ï¼Œåœ¨ Linux ä¸Šæ ‡å‡†åº“çš„åˆ†é…å’Œé‡Šæ”¾å‡½æ•°ç”± libstdc++.so å…±äº«åº“æä¾›ï¼Œåªè¦é“¾æ¥è¿‡ç¨‹ä¸­åœ¨ <code>-lstdc++</code> ä¹‹å‰çš„ç›®æ ‡æ–‡ä»¶æˆ–åº“æ–‡ä»¶é‡Œæœ‰åˆ†é…å’Œé‡Šæ”¾å‡½æ•°å‡ºç°ï¼Œå®ƒä»¬å°±ä¼šæ¯”æ ‡å‡†åº“çš„åˆ†é…å’Œé‡Šæ”¾å‡½æ•°æœ‰æ›´é«˜çš„ä¼˜å…ˆæƒï¼Œä¼šè¢«æ‰€æœ‰ç”¨åˆ°åˆ†é…å’Œé‡Šæ”¾å‡½æ•°çš„åœ°æ–¹è°ƒç”¨ï¼ŒåŒ…æ‹¬ libstdc++ è‡ªèº«ã€‚</p><p>ä¸è¿‡ï¼Œéœ€è¦ç•™æ„çš„æ˜¯ï¼Œç”¨æˆ·æä¾›çš„åˆ†é…å’Œé‡Šæ”¾å‡½æ•°ä»éœ€è·Ÿæ ‡å‡†çš„åˆ†é…å’Œé‡Šæ”¾å‡½æ•°æœ‰åŒæ ·çš„æ¥å£ï¼ŒåŒ…æ‹¬å½¢å¼å’Œè¯­ä¹‰ã€‚ç‰¹åˆ«æ˜¯ï¼š</p><ul>\n<li>åˆ†é…å‡½æ•°ä¸åº”è¿”å›ç©ºæŒ‡é’ˆï¼Œè€Œåº”ä½¿ç”¨ <code>std::bad_alloc</code> å¼‚å¸¸è¡¨ç¤ºå†…å­˜åˆ†é…å¤±è´¥</li>\n<li>é‡Šæ”¾å‡½æ•°ä¸å…è®¸æŠ›å‡ºå¼‚å¸¸</li>\n</ul><p>ä¸¾ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼Œ<code>make_shared</code> å‡½æ•°ä¼šè°ƒç”¨ <code>operator new</code>ï¼Œå¹¶æœŸå¾…å†…å­˜åˆ†é…å¤±è´¥æ—¶ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚å¦‚æœä½ è‡ªå·±æä¾›çš„ <code>operator new</code> æ›¿æ¢ç‰ˆæœ¬æŠ›å‡ºäº†å¼‚å¸¸ï¼Œé‚£ <code>make_shared</code> ä¹Ÿä¼šæœ‰æ­£å¸¸çš„å¤±è´¥è¡Œä¸ºï¼›è€Œå¦‚æœä½ æä¾›çš„ <code>operator new</code> æ›¿æ¢ç‰ˆæœ¬è¿”å›äº†ç©ºæŒ‡é’ˆï¼Œé‚£ç¨‹åºä¸€èˆ¬å°±ä¼šå› ä¸ºè®¿é—®ç©ºæŒ‡é’ˆè€Œå´©æºƒäº†â€”â€”è™½ç„¶æˆ‘ä¸èƒ½æ‹…ä¿æ‰€æœ‰æ ‡å‡†åº“çš„è¡Œä¸ºéƒ½æ˜¯è¿™æ ·ï¼Œä½†è¿™æ ·çš„è¡Œä¸ºè‡³å°‘æ˜¯å®Œå…¨ç¬¦åˆ C++ æ ‡å‡†çš„ã€‚</p><h2>å¸ƒç½®åˆ†é…å’Œé‡Šæ”¾å‡½æ•°</h2><p>ä¸ºäº†åº”å¯¹ä¸€äº›æ›´åŠ çµæ´»çš„å†…å­˜åˆ†é…å’Œé‡Šæ”¾åœºæ™¯ï¼Œç‰¹åˆ«æ˜¯è€ƒè™‘åˆ°æœ‰äº›ç¯å¢ƒå®Œå…¨ä¸å…è®¸ä½¿ç”¨å¼‚å¸¸ï¼ŒC++ é‡Œæœ‰æ‰€è°“çš„å¸ƒç½®ï¼ˆplacementï¼‰<code>new</code> å’Œå¯¹åº”çš„åˆ†é…å’Œé‡Šæ”¾å‡½æ•°ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ <code>new</code> æ—¶ä¼ é€’é¢å¤–çš„ç‰¹æ®Šå‚æ•°ï¼Œç¼–è¯‘å™¨åˆ™ä¼šæŠŠè¿™äº›é¢å¤–å‚æ•°ä¼ ç»™ <code>operator new</code>ï¼Œå¹¶åˆ©ç”¨é‡è½½æœºåˆ¶æ‰¾åˆ°æ­£ç¡®çš„åˆ†é…å‡½æ•° <span class=\"orange\">[2]</span>ã€‚</p><p>å®ƒçš„æœ€å¸¸è§å½¢å¼åœ¨æ ‡å‡†åº“çš„å¤´æ–‡ä»¶ <new> ä¸­å·²ç»å®šä¹‰äº†ï¼š</new></p><pre><code class=\"language-cpp\">struct nothrow_t {\n  explicit nothrow_t() = default;\n};\n\nextern const nothrow_t nothrow;\n\nvoid* operator new(\n  size_t size,\n  const nothrow_t&amp;) noexcept;\nvoid* operator new[](\n  size_t size,\n  const nothrow_t&amp;) noexcept;\n</code></pre><p>è¿™æ ·ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ <code>new(std::nothrow) Obj</code> è¿™æ ·çš„å½¢å¼æ—¶ï¼Œç¼–è¯‘å™¨ä¼šäº§ç”Ÿå¯¹ <code>operator new(size_t, const nothrow_t&amp;)</code> çš„è°ƒç”¨ï¼Œè€Œè¿™ä¸ªå‡½æ•°å°±ä¸ä¼šæŠ›å‡ºå¼‚å¸¸äº†â€”â€”å®ƒä¼šè·Ÿ <code>malloc</code> ä¸€æ ·ï¼Œåœ¨å†…å­˜åˆ†é…å¤±è´¥æ—¶è¿”å›ç©ºæŒ‡é’ˆã€‚</p><p>è®²åˆ°è¿™é‡Œï¼Œä½ å¯èƒ½ä¼šç–‘æƒ‘äº†ï¼šæˆ‘è¯´åˆ°äº†å¸ƒç½®åˆ†é…å‡½æ•°å’Œé‡Šæ”¾å‡½æ•°ï¼Œä½†ä¼¼ä¹æˆ‘ä»¬å¹¶ä¸éœ€è¦å¸ƒç½®é‡Šæ”¾å‡½æ•°å•Šâ€”â€”ç¡®å® C++ é‡Œä¹Ÿæ²¡æœ‰ <code>delete(nothrow) ptr</code> è¿™æ ·çš„è¯­æ³•ã€‚å•å•å¯¹äºæ— å¼‚å¸¸ç¼–ç¨‹çš„åœºæ™¯ï¼Œå¸ƒç½®é‡Šæ”¾å‡½æ•°ç¡®å®æ„ä¹‰ä¸å¤§ã€‚ä½†ä½œä¸ºä¸€ç§é€šç”¨æœºåˆ¶ï¼ŒC++ çš„è®¾è®¡è€…éœ€è¦è€ƒè™‘å…¶ä»–çš„åº”ç”¨åœºæ™¯ï¼›ç‰¹åˆ«æ˜¯ï¼Œå½“å¸ƒç½®åˆ†é…å‡½æ•°æˆåŠŸè€Œæ„é€ å‡½æ•°å¤±è´¥çš„æƒ…å†µã€‚å›æƒ³æˆ‘ä»¬è®²è¿‡çš„ <code>new Circle(â€¦)</code> çš„è¿‡ç¨‹ï¼š</p><pre><code class=\"language-cpp\">{\n  void* temp = operator new(sizeof(circle));\n  try {\n    circle* ptr =\n      static_cast&lt;circle*&gt;(temp);\n    ptr-&gt;circle(â€¦);\n    return ptr;\n  }\n  catch (...) {\n    operator delete(ptr);\n    throw;\n  }\n}\n</code></pre><p>å¯¹äºæ™®é€šçš„ <code>new Obj</code>ï¼Œåœ¨æ„é€ å‡½æ•°å‘ç”Ÿå¼‚å¸¸æ—¶ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨è°ƒç”¨ <code>operator delete(void*)</code>ã€‚é‚£å¯¹äº <code>new(placementTag) Obj</code> å‘¢ï¼Ÿ</p><p>æˆ‘æƒ³ä½ åº”è¯¥å·²ç»çŒœåˆ°äº†ï¼Œç¼–è¯‘å™¨ä¼šäº§ç”Ÿä¸€ä¸ªå¯¹ <code>operator delete(ptr, placementTag)</code> çš„è°ƒç”¨ã€‚å¦‚æœå¯¹åº”çš„ <code>operator delete</code> é‡è½½ä¸å­˜åœ¨ï¼Œé‚£ç¼–è¯‘å™¨åˆ™ä¸ä¼šäº§ç”Ÿå¯¹ <code>operator delete</code> çš„è°ƒç”¨ã€‚æ­¤æ—¶ï¼Œå¦‚æœç›¸åº”çš„ <code>operator new</code> ç¡®å®åˆ†é…äº†å†…å­˜çš„è¯ï¼Œæˆ‘ä»¬å°±æœ‰äº†å†…å­˜æ³„æ¼ã€‚æ‰€ä»¥ï¼Œé€šå¸¸æˆ‘ä»¬æä¾›å¸ƒç½®åˆ†é…å‡½æ•°æ—¶ï¼Œéƒ½éœ€è¦æä¾›å¯¹åº”çš„å¸ƒç½®é‡Šæ”¾å‡½æ•°ï¼Œæ¥åº”å¯¹è¿™ç§æƒ…å†µã€‚</p><p>äº‹å®ä¸Šï¼Œæ ‡å‡†åº“å¯¹å¸ƒç½®åˆ†é…å‡½æ•°éƒ½æä¾›äº†å¯¹åº”çš„å¸ƒç½®é‡Šæ”¾å‡½æ•°ï¼Œå³ä½¿åœ¨å¸ƒç½®é‡Šæ”¾å‡½æ•°ä»€ä¹ˆäº‹éƒ½ä¸éœ€è¦åšçš„æ—¶å€™ã€‚è€Œç¼–è¯‘å™¨é€šå¸¸ä¹Ÿä¼šå¯¹ç”¨æˆ·åªæä¾›å¸ƒç½®åˆ†é…å‡½æ•°è€Œæ²¡æœ‰æä¾›å¸ƒç½®é‡Šæ”¾å‡½æ•°çš„æƒ…å†µè¿›è¡Œå‘Šè­¦ã€‚</p><h3>ä¸åˆ†é…å†…å­˜çš„å¸ƒç½®åˆ†é…å’Œé‡Šæ”¾å‡½æ•°</h3><p>é™¤äº† <code>nothrow</code> ä¹‹å¤–ï¼Œå¦å¤–ä¸€ç§å¸¸è§çš„å¸ƒç½®åˆ†é…å’Œé‡Šæ”¾å‡½æ•°çš„å®šä¹‰å¦‚ä¸‹ï¼ˆç®€æ´èµ·è§ï¼Œæˆ‘ç•¥å»äº†æ•°ç»„ç‰ˆæœ¬ï¼‰ï¼š</p><pre><code class=\"language-cpp\">inline void*\noperator new(size_t,\n             void* ptr) noexcept\n{ return ptr; }\n\ninline void\noperator delete(void*,\n                void*) noexcept\n{}\n</code></pre><p>æ ¹æ®è¿™ç§å½¢å¼ï¼Œæˆ‘ä»¬å¯ä»¥å†™å‡ºä¸‹é¢è¿™æ ·çš„ä»£ç ï¼ŒæŠŠå¯¹è±¡æ„é€ åœ¨ä¸€ä¸ªå·²ç»å­˜åœ¨çš„ç¼“å†²åŒºä¸Šï¼š</p><pre><code class=\"language-cpp\">shape* create_shape(void* buffer,\n                    size_t size,\n                    shape_type type)\n{\n  â€¦\n  switch (type) {\n  case shape_type::circle:\n    assert(size &gt;= sizeof(circle));\n    return new(buffer) circle();\n  case shape_type::triangle:\n    assert(size &gt;= sizeof(triangle));\n    return new(buffer) triangle();\n  case shape_type::rectangle:\n    assert(size &gt;= sizeof(rectangle));\n    return new(buffer) rectangle();\n  â€¦\n  }\n}\n\nshape_type type = â€¦;\nchar buffer[200];\nauto ptr = create_shape(\n  buffer, sizeof buffer, type);\n// ä½¿ç”¨ ptr\nptr-&gt;~shape();\n</code></pre><p>åœ¨è¿™ä¸ª <code>create_shape</code> çš„å®ç°é‡Œï¼Œæˆ‘ä»¬ä¸åœ¨å †ä¸Šåˆ›å»ºå¯¹è±¡ï¼Œè€Œæ˜¯åœ¨ä¸€ä¸ªç°æœ‰çš„ç¼“å†²åŒºä¸Šåˆ›å»ºå¯¹è±¡ã€‚è¿™æ—¶å€™ <code>operator new(size_t, void*)</code> è¿™ä¸ªé‡è½½å°±èƒ½ç”¨å¾—ä¸Šäº†ï¼Œè™½ç„¶å®ƒåªæ˜¯ç®€å•åœ°è¿”å›ç¼“å†²åŒºçš„åœ°å€ã€‚æ˜¾ç„¶ï¼Œé‡Šæ”¾å‡½æ•°ç¡®å®ä¸éœ€è¦åšä»»ä½•äº‹æƒ…ï¼›ä½†æ˜¯ï¼Œæˆ‘ä»¬ä»éœ€ç”¨ <code>ptr-&gt;~shape()</code> è¿™æ ·çš„å½¢å¼æ˜¾å¼åœ°åœ¨ç¼“å†²åŒºå¤±æ•ˆå‰å¯¹å¯¹è±¡è¿›è¡Œææ„ã€‚</p><p>å¦å¤–æ³¨æ„ï¼Œè·Ÿå¤§éƒ¨åˆ†å…¶ä»–åˆ†é…å‡½æ•°å’Œé‡Šæ”¾å‡½æ•°ä¸åŒï¼Œè¿™äº›å‡½æ•°æ˜¯ä¸èƒ½è¢«ç”¨æˆ·æä¾›çš„ç‰ˆæœ¬æ›¿æ¢çš„ã€‚</p><h2>å†…å­˜å¯¹é½çš„åˆ†é…å’Œé‡Šæ”¾å‡½æ•°</h2><p>åœ¨ C++11 ä¹‹å‰ï¼ŒC++ è¦äº§ç”Ÿç‰¹æ®Šçš„å¯¹è±¡å¯¹é½ï¼Œåªèƒ½ä½¿ç”¨ç¼–è¯‘å™¨å‚å•†æä¾›çš„ç‰¹æ®Šè¯´æ˜ç¬¦ã€‚æ¯”å¦‚ï¼Œè¦æŠŠä¸€ä¸ªç»“æ„ä½“æŒ‰ 32 å­—èŠ‚å¯¹é½ï¼Œåœ¨ GCC ä¸‹æˆ‘ä»¬éœ€è¦è¿™æ ·å†™ï¼š</p><pre><code class=\"language-cpp\">struct S {\n  float v[8];\n} __attribute__((aligned(32)));\n</code></pre><p>åˆ°äº† MSVCï¼Œæˆ‘ä»¬å°±å¾—å†™æˆï¼š</p><pre><code class=\"language-cpp\">__declspec(align(32)) struct S {\n  float v[8];\n};\n</code></pre><p>è¿™å½“ç„¶ä¸é‚£ä¹ˆä»¤äººæ»¡æ„ã€‚æ‰€å¹¸ï¼Œè¿™ä¸ªé—®é¢˜åˆ°äº† C++11 å°±æœ‰äº†å¾ˆå¤§çš„ç¼“è§£ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>alignas</code> å…³é”®å­—æ¥è·¨å¹³å°åœ°å¤„ç†è¿™ä¸ªé—®é¢˜äº†ï¼š</p><pre><code class=\"language-cpp\">struct alignas(32) S {\n  float v[8];\n};\n</code></pre><p>ä½†åœ¨ C++17 ä¹‹å‰ï¼Œè¿™æ ·çš„ç»“æ„ä½“ç¢°åˆ° <code>new</code> å’Œ <code>delete</code> ä¾ç„¶ä¼šæœ‰é—®é¢˜ï¼Œå› ä¸º <code>new</code> å’Œ <code>delete</code> æ²¡æœ‰ä»»ä½•æœºåˆ¶æ¥å¤„ç†å†…å­˜å¯¹é½é—®é¢˜ã€‚å¦‚æœä½ ç”¨äº† <code>new S</code> è¿™æ ·çš„è¡¨è¾¾å¼ï¼Œç»“æœçš„å¯¹é½ä»ç„¶ä¸ä¼šè€ƒè™‘ç»“æ„ä½“çš„å¯¹é½è¦æ±‚ï¼Œè€Œåªæ˜¯å®ç°é‡Œçš„é»˜è®¤å¯¹é½å€¼ï¼Œé€šå¸¸æ˜¯ 8 æˆ– 16â€”â€”ä½ æ²¡æœ‰ä¸€ç§é€šç”¨çš„åŠæ³•æ¥è¿›è¡Œæ§åˆ¶ã€‚</p><p>C++17 å¯¹æ­¤çš„è§£å†³æ–¹å¼æ˜¯å¼•å…¥äº†ä¸€å †æ–°çš„ä½¿ç”¨ <code>std::align_val_t</code> çš„åˆ†é…å’Œé‡Šæ”¾å‡½æ•°ã€‚<code>align_val_t</code> æ˜¯ä¸€ä¸ªæšä¸¾ç±»ï¼Œç›®çš„æ˜¯ç»™å¯¹é½å€¼ä¸€ä¸ªå¼ºç±»å‹ã€‚æ ‡å‡†åº“æä¾›çš„ç›¸å…³åˆ†é…å’Œé‡Šæ”¾å‡½æ•°æœ‰ä»¥ä¸‹è¿™äº›ï¼ˆ<span class=\"orange\">[3] å’Œ [4]</span>ï¼‰ï¼š</p><pre><code class=\"language-cpp\">void* operator new(\n  size_t size, align_val_t al);\nvoid* operator new[](\n  size_t size, align_val_t al);\nvoid* operator new(\n  size_t size, align_val_t al,\n  const nothrow_t&amp;) noexcept;\nvoid* operator new[](\n  size_t size, align_val_t al,\n  const nothrow_t&amp;) noexcept;\nvoid operator delete(\n  void* ptr,\n  align_val_t al) noexcept;\nvoid operator delete[](\n  void* ptr,\n  align_val_t al) noexcept;\nvoid operator delete(\n  void* ptr, align_val_t al,\n  const nothrow_t&amp;) noexcept;\nvoid operator delete[](\n  void* ptr, align_val_t al,\n  const nothrow_t&amp;) noexcept;\n</code></pre><p>å¦‚æœæˆ‘ä»¬å†™å‡º <code>new S</code> è¿™æ ·çš„è¡¨è¾¾å¼ï¼Œåœ¨ C++17 é‡Œå°±ä¼šè‡ªåŠ¨äº§ç”Ÿä¸€ä¸ª <code>operator new(sizeof(S), std::align_val_t{32})</code> è¿™æ ·çš„è°ƒç”¨ã€‚ç³»ç»Ÿçš„é»˜è®¤å®ç°ï¼Œæˆ–è€…ç”¨æˆ·æä¾›çš„æ›¿æ¢å®ç°ï¼Œéƒ½å¿…é¡»æä¾›ç›¸åº”çš„å¯¹é½ä¿è¯ï¼Œå¯¹äº <code>new S</code> å¯ä»¥ä¿è¯è¿”å›çš„æŒ‡é’ˆçš„äºŒè¿›åˆ¶è¡¨ç¤ºçš„æœ€ä½ 5 ä½ä¸º 0ã€‚</p><p>å‚è€ƒèµ„æ–™ <span class=\"orange\">[6]</span> é‡Œå±•ç¤ºäº†ä¸€ä¸ªå¯ä»¥ç›´æ¥è¢«åˆ†é…å‡½æ•°å’Œé‡Šæ”¾å‡½æ•°è°ƒç”¨çš„å‡½æ•°å®ç°ï¼ˆC++17 æä¾›çš„ <code>aligned_alloc</code> ç›®å‰åœ¨ MSVC ä¸‹æ²¡æœ‰å®ç°ï¼Œå› ä¸º Windows ä¸‹æ— æ³•æä¾›å†…å­˜å¯¹é½çš„é«˜æ•ˆ <code>free</code> å®ç° <span class=\"orange\">[5]</span>ï¼‰ã€‚</p><h2>æ›¿æ¢åˆ†é…å’Œé‡Šæ”¾å‡½æ•°</h2><p>æˆ‘å‰é¢å·²ç»æè¿‡ï¼Œç”¨æˆ·å¯ä»¥æ›¿æ¢æ ‡å‡†åº“æä¾›çš„å¤§éƒ¨åˆ†åˆ†é…å’Œé‡Šæ”¾å‡½æ•°ã€‚ä½œä¸ºä¸€ç§å¯ä»¥é€‚ç”¨å¤šç§åœºæ™¯ã€å¯çµæ´»æ‰©å±•çš„è¯­è¨€ï¼Œæˆ‘ä»¬å¯èƒ½å‡ºäºä»¥ä¸‹çš„ç†ç”±æ¥æ›¿æ¢åˆ†é…å’Œé‡Šæ”¾å‡½æ•°ï¼š</p><ul>\n<li>ç”¨æ¥é€‚é…ç‰¹å®šå¹³å°æˆ–ç¯å¢ƒçš„å†…å­˜ç®¡ç†å™¨</li>\n<li>ç”¨æ¥å¯¹å†…å­˜è¿›è¡Œè·Ÿè¸ªå’Œæ’é”™</li>\n<li>ç”¨æ¥å®ç°å†…å­˜æ± </li>\n<li>â€¦â€¦</li>\n</ul><p>ç¬¬ä¸€ç§æƒ…å†µè¦æ ¹æ®ç‰¹å®šçš„ç¯å¢ƒæ¥è€ƒè™‘ï¼Œè¿™é‡Œæ²¡æ³•å±•å¼€ã€‚å…¶ä»–ä¸¤ç§æƒ…å†µï¼Œæˆ‘ä»¬åç»­ä¼šè¿›è¡Œè®¨è®ºã€‚å‚è€ƒèµ„æ–™ <span class=\"orange\">[7]</span> é‡Œæä¾›äº†ä¸€ä¸ªæˆ‘ä» 2004 å¹´å¼€å§‹å†™çš„å†…å­˜æ³„æ¼æ£€æµ‹å™¨ï¼Œåªè¦æŠŠè¿™ä¸ªæ–‡ä»¶é“¾æ¥åˆ°ä½ çš„é¡¹ç›®ä¸­ï¼Œç¨‹åºå³å¯åœ¨é€€å‡ºæ—¶æ£€æŸ¥æ˜¯å¦å‘ç”Ÿäº† <code>new</code>/<code>delete</code> ä¸åŒ¹é…å¯¼è‡´çš„å†…å­˜æ³„æ¼ã€‚å®ƒçš„åŸç†åœ¨ <span class=\"orange\">[1]</span> ä¸­è¿›è¡Œäº†è®¨è®ºã€‚æˆ‘ä»¬åé¢ä¹Ÿä¼šè®¨è®ºä¸€ä¸ªæ›´æ–°çš„å†…å­˜æ³„æ¼æ£€æµ‹å™¨çš„å®ç°ã€‚</p><p>åœ¨æ›¿æ¢åˆ†é…å’Œé‡Šæ”¾å‡½æ•°æ—¶ï¼Œæœ‰ä¸€ä¸ªå°ç»†èŠ‚éœ€è¦æ³¨æ„ä¸€ä¸‹ã€‚å¯¹äºæœ€æ™®é€šçš„ <code>operator new(size_t)</code>ï¼Œæˆ‘ä»¬ä¸€èˆ¬åº”è€ƒè™‘åŒæ—¶æä¾› <code>operator delete(void*)</code> å’Œ <code>operator delete(void*, size_t)</code>ã€‚å¦‚æœä¸æä¾›çš„è¯ï¼Œè‡³å°‘ GCC ä¼šå¯¹æ­¤è¿›è¡ŒæŠ¥è­¦ï¼ˆå½“ä½¿ç”¨äº† <code>-Wextra</code> å‘Šè­¦é€‰é¡¹æ—¶ï¼‰ã€‚</p><p>C++ æ ‡å‡†é‡Œè§„å®šï¼Œå¦‚æœåŒæ—¶æä¾›äº†è¿™ä¸¤ä¸ªé‡Šæ”¾å‡½æ•°çš„è¯ï¼Œç¼–è¯‘å™¨ä¼šä¼˜å…ˆé€‰æ‹©å¸¦ <code>size_t</code> å‚æ•°çš„é‡è½½â€”â€”ä»ç†è®ºä¸Šè®²ï¼Œåˆ©ç”¨ <code>size_t</code> å¤§å°å‚æ•°å¯ä»¥è·å¾—æ›´é«˜çš„æ€§èƒ½ã€‚Andrei Alexandrescu æ›´æ˜¯äº‰è¾©åªç”¨æŒ‡é’ˆçš„é‡Šæ”¾å‡½æ•°æ˜¯ä¸€ä¸ªè®¾è®¡é”™è¯¯ã€‚ä¸è¿‡ï¼Œä¸šç•Œçš„æƒ¯æ€§æ˜¯å·¨å¤§çš„ã€‚ç”±äº Unix å’Œ C çš„å†…å­˜ç®¡ç†åŸºæœ¬ä¸Šæ˜¯åŸºäº <code>malloc</code>/<code>free</code> çš„æ¨¡å¼ï¼Œç›®å‰å¯¹ <code>operator delete(void*, size_t)</code> çš„å®ç°ï¼ˆåŒ…æ‹¬æ ‡å‡†åº“é‡Œçš„å®ç°ï¼‰ä¹ŸåŸºæœ¬ä¸Šåªæ˜¯è½¬å‘åˆ° <code>operator delete(void*)</code> è€Œå·²ã€‚</p><h3>ç±»ç‰¹å®šçš„åˆ†é…å’Œé‡Šæ”¾å‡½æ•°</h3><p>åˆ†é…å’Œé‡Šæ”¾å‡½æ•°å¹¶ä¸ä¸€å®šåªèƒ½è¿›è¡Œå…¨å±€çš„æ›¿æ¢ã€‚æˆ‘ä»¬å®Œå…¨å¯ä»¥åªå¯¹æŸä¸€ä¸ªç±»ï¼ˆå¦‚ <code>Obj</code>ï¼‰æ›¿æ¢å®ƒçš„åˆ†é…å’Œé‡Šæ”¾å‡½æ•°ï¼Œè¿™æ ·ï¼Œåªæœ‰ <code>new Obj</code> å’Œ <code>delete pObj</code> è¿™æ ·çš„è¡¨è¾¾å¼æ‰ä¼šä½¿ç”¨å¯¹åº”çš„åˆ†é…å’Œé‡Šæ”¾å‡½æ•°ã€‚ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code class=\"language-cpp\">class Obj {\npublic:\n  â€¦\n  static void* operator new(size_t);\n  static void operator delete(\n    void* ptr) noexcept;\n};\n</code></pre><p>ä½ å¯èƒ½æƒ³ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥ç”¨ç±»ç‰¹å®šçš„åˆ†é…å’Œé‡Šæ”¾å‡½æ•°æ¥å®ç°ä¸€ä¸ªå†…å­˜æ± å‘¢ï¼Ÿæ¯•ç«Ÿï¼Œä¸€ä¸ªç±»çš„åˆ†é…å¤§å°æ˜¯å›ºå®šçš„ï¼Œåº”è¯¥ä¼šæä¾›å¾ˆå¤šä¾¿åˆ©æ€§ã€‚å›ç­”æ˜¯ï¼šä¹Ÿå¯¹ï¼Œä¹Ÿä¸å¯¹ã€‚</p><p>å¯¹çš„åŸå› æ˜¯ï¼Œä»¥ä¸Šæ¨ç†æœ¬èº«æ²¡æœ‰é—®é¢˜ã€‚äº‹å®ä¸Šï¼Œæˆ‘åœ¨åå‡ å¹´å‰å°±å°è¯•è¿‡è¿™æ ·çš„å®ç° <span class=\"orange\">[8]</span>ã€‚</p><p>ä¸å¯¹çš„åŸå› æ˜¯ï¼Œç›®å‰å¤§éƒ¨åˆ†ä»£ç é‡Œå·²ç»ä¸å†ç›´æ¥ä½¿ç”¨ <code>new</code> å’Œ <code>delete</code> æ¥åˆ›å»ºå’Œé”€æ¯å¯¹è±¡äº†ã€‚<code>make_shared</code> å‡½æ•°ä¼šä¸€æ¬¡æ€§åˆ†é…å¯¹è±¡å’Œå¼•ç”¨è®¡æ•°çš„ç©ºé—´ï¼Œå‡å°‘å†…å­˜åˆ†é…å’Œé‡Šæ”¾çš„æ¬¡æ•°ï¼Œå› è€Œç±»ç‰¹å®šçš„ <code>operator new</code> å’Œ <code>operator delete</code> ä¸ä¼šè¢«ä½¿ç”¨ã€‚<code>list</code> å’Œ <code>map</code> è¿™æ ·çš„å®¹å™¨ä¼šæŠŠå¯¹è±¡æ‰€éœ€çš„ç©ºé—´å’Œç»“ç‚¹ç›¸å…³çš„å…¶ä»–ä¿¡æ¯ä¸€èµ·åˆ†é…ï¼Œå› è€Œç±»ç‰¹å®šçš„ <code>operator new</code> å’Œ <code>operator delete</code> ä¹Ÿä¸ä¼šè¢«ä½¿ç”¨ã€‚è€Œ <code>vector</code> è¿™æ ·çš„å®¹å™¨ä¼šä¸€æ¬¡æ€§åˆ†é…å¤šä¸ªå¯¹è±¡æ‰€éœ€çš„ç©ºé—´ï¼ŒåŒæ ·ä¸ä¼šä½¿ç”¨ç±»ç‰¹å®šçš„ <code>operator new</code> å’Œ <code>operator delete</code>ã€‚</p><p>å› æ­¤ï¼Œæ€»ä½“æ¥è¯´ï¼Œç±»ç‰¹å®šçš„åˆ†é…å’Œé‡Šæ”¾å‡½æ•°åœ¨ç°ä»£ C++ é‡Œå·²ç»æˆäº†ä¸€ä¸ªæ¯”è¾ƒé¸¡è‚‹çš„åŠŸèƒ½ã€‚æˆ‘ä»¬ä¹Ÿå°±ä¸å¤šå±•å¼€è®¨è®ºäº†ã€‚</p><p>å½“ç„¶ï¼Œæˆ‘ä»¬éœ€è¦å®šåˆ¶å†…å­˜åˆ†é…å’Œé‡Šæ”¾è¡Œä¸ºçš„éœ€æ±‚ä»ç„¶åœ¨ã€‚å¯¹äºå®¹å™¨ï¼Œæˆ‘ä»¬æ˜¯æœ‰åŠæ³•çš„ï¼Œå› ä¸ºå®¹å™¨çš„åˆ†é…å™¨å‚æ•°ï¼ˆ<code>Allocator</code>ï¼‰å°±æ˜¯ç”¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜çš„ã€‚è¿™ä¸ªæˆ‘ä»¬æ”¾åœ¨ä¸‹ä¸€è®²è¿›è¡Œè®¨è®ºã€‚</p><h2>å†…å®¹å°ç»“</h2><p>ä»Šå¤©æˆ‘ä»¬è®¨è®ºäº† <code>new</code> å’Œ <code>delete</code> èƒŒåçš„ä¸€ä¸ªç»†èŠ‚ï¼Œåˆ†é…å‡½æ•°å’Œé‡Šæ”¾å‡½æ•°ã€‚æ ‡å‡†åº“é‡Œå®ç°äº†è¿™äº›å‡½æ•°ï¼ŒåŒæ—¶ä¹Ÿå…è®¸ç”¨æˆ·å¯¹å…¶è¿›è¡Œæ›¿æ¢ï¼Œæ¥å®šåˆ¶ç¨‹åºçš„è¡Œä¸ºã€‚</p><h2>è¯¾åæ€è€ƒ</h2><p>è€ƒè™‘ä¸€ä¸‹ï¼Œç”¨æˆ·é€šè¿‡ <code>new Obj</code> å¾—åˆ°çš„æŒ‡é’ˆå’Œ <code>operator new</code> è¿”å›çš„æŒ‡é’ˆç›¸åŒå—ï¼Ÿé€šè¿‡ <code>new Obj[n]</code> å¾—åˆ°çš„æŒ‡é’ˆå’Œ <code>operator new[]</code> è¿”å›çš„æŒ‡é’ˆå‘¢ï¼Ÿ</p><p>æ¬¢è¿ç•™è¨€å’Œæˆ‘åˆ†äº«ä½ çš„è§‚ç‚¹ã€‚</p><h2><span class=\"reference\">å‚è€ƒèµ„æ–™</span></h2><p><span class=\"reference\">[1] å´å’ç‚œ, â€œA cross-platform memory leak detectorâ€. <a href=\"http://wyw.dcweb.cn/leakage.htm\">http://wyw.dcweb.cn/leakage.htm</a></span></p><p><span class=\"reference\">[2] cppreference.com, â€œnew expressionâ€. <a href=\"https://en.cppreference.com/w/cpp/language/new\">https://en.cppreference.com/w/cpp/language/new</a></span></p><p><span class=\"reference\">[2a] cppreference.com, â€œnew è¡¨è¾¾å¼â€. <a href=\"https://zh.cppreference.com/w/cpp/language/new\">https://zh.cppreference.com/w/cpp/language/new</a></span></p><p><span class=\"reference\">[3] cppreference.com, â€œoperator new, operator new[]â€. <a href=\"https://en.cppreference.com/w/cpp/memory/new/operator_new\">https://en.cppreference.com/w/cpp/memory/new/operator_new</a></span></p><p><span class=\"reference\">[3a] cppreference.com, â€œoperator new, operator new[]â€. <a href=\"https://zh.cppreference.com/w/cpp/memory/new/operator_new\">https://zh.cppreference.com/w/cpp/memory/new/operator_new</a></span></p><p><span class=\"reference\">[4] cppreference.com, â€œoperator delete, operator delete[]â€. <a href=\"https://en.cppreference.com/w/cpp/memory/new/operator_delete\">https://en.cppreference.com/w/cpp/memory/new/operator_delete</a></span></p><p><span class=\"reference\">[4a] cppreference.com, â€œoperator delete, operator delete[]â€. <a href=\"https://zh.cppreference.com/w/cpp/memory/new/operator_delete\">https://zh.cppreference.com/w/cpp/memory/new/operator_delete</a></span></p><p><span class=\"reference\">[5] Microsoft, â€œ&lt;cstdlib&gt;â€. <a href=\"https://docs.microsoft.com/en-us/cpp/standard-library/cstdlib\">https://docs.microsoft.com/en-us/cpp/standard-library/cstdlib</a></span></p><p><span class=\"reference\">[6] å´å’ç‚œ, â€œaligned_memory.cppâ€. <a href=\"https://github.com/adah1972/nvwa/blob/master/nvwa/aligned_memory.cpp\">https://github.com/adah1972/nvwa/blob/master/nvwa/aligned_memory.cpp</a></span></p><p><span class=\"reference\">[7] å´å’ç‚œ, â€œdebug_new.cppâ€. <a href=\"https://github.com/adah1972/nvwa/blob/master/nvwa/debug_new.cpp\">https://github.com/adah1972/nvwa/blob/master/nvwa/debug_new.cpp</a></span></p><p><span class=\"reference\">[8] å´å’ç‚œ, â€œDesign and implementation of a static memory poolâ€. <a href=\"http://wyw.dcweb.cn/static_mem_pool.htm\">http://wyw.dcweb.cn/static_mem_pool.htm</a></span></p>","comments":[{"had_liked":false,"id":335833,"user_name":"ç½— ä¹¾ æ—","can_delete":false,"product_type":"c1","uid":1188222,"ip_address":"","ucode":"D0406F95176ABA","user_header":"https://static001.geekbang.org/account/avatar/00/12/21/7e/fb725950.jpg","comment_is_top":false,"comment_ctime":1645709418,"is_pvip":false,"replies":[{"id":122761,"content":"è¨€ç®€æ„èµ…ğŸ‘ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1645639,"ctime":1645767804,"ip_address":"","comment_id":335833,"utype":1}],"discussion_count":5,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"å‰ä¸€ä¸ªç›¸åŒï¼Œåä¸€ä¸ªä¸åŒï¼ˆé™¤å¼€PODï¼‰ã€‚æ•°ç»„ä¼šåœ¨å¤´éƒ¨å­˜æ”¾å¯¹è±¡çš„å¤§å°ï¼Œè¿™æ ·æ‰èƒ½ä¾æ¬¡æ‰¾åˆ°æ•°ç»„ä¸­çš„æ¯ä¸ªå¯¹è±¡åœ°å€ï¼Œè°ƒç”¨ææ„å‡½æ•°","like_count":11},{"had_liked":false,"id":335731,"user_name":"tang_ming_wu","can_delete":false,"product_type":"c1","uid":2566054,"ip_address":"","ucode":"98E5847CEF8B84","user_header":"https://static001.geekbang.org/account/avatar/00/27/27/a6/32e9479b.jpg","comment_is_top":false,"comment_ctime":1645667497,"is_pvip":false,"replies":[{"id":122699,"content":"æ˜¯ã€‚\n\nä½†è¿™ä¸æ˜¯æˆ‘é—®çš„é—®é¢˜ã€‚æˆ‘é—®çš„æ˜¯è¿™ä¸¤ä¸ªæŒ‡é’ˆçš„å€¼æ˜¯ä¸æ˜¯ç›¸åŒã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1645639,"ctime":1645704782,"ip_address":"","comment_id":335731,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"new Objè¿”å›çš„æ˜¯è°ƒç”¨æ„é€ å‡½æ•°åˆå§‹åŒ–å®Œæˆçš„å¯¹è±¡æŒ‡é’ˆï¼›\noperator new è¿”å›çš„åªæ˜¯ä¸€å—è¶³å¤Ÿå®¹çº³è¿™ä¸ªå¯¹è±¡å¤§å°çš„ç©ºç™½çš„å†…å­˜ç©ºé—´ã€‚\nä¸çŸ¥é“æˆ‘çš„ç†è§£å‡†ä¸å‡†ç¡®ã€‚","like_count":1,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":553206,"discussion_content":"è¨€ç®€æ„èµ…ğŸ‘ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645767804,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":4,"child_discussions":[{"author":{"id":2975212,"avatar":"https://static001.geekbang.org/account/avatar/00/2d/65/ec/9d218806.jpg","nickname":"ä»Šå¤©åŠ›æ‰£äº†å˜›ğŸ’»","note":"","ucode":"C88B5F8E3DA4F3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":563224,"discussion_content":"å¯¹äºå†…ç½®ç±»å‹ï¼Œç”¨deleteè€Œä¸æ˜¯delete[]é‡Šæ”¾newå‡ºæ¥çš„æ•°ç»„ä¸ä¼šäº§ç”Ÿå†…å­˜æ³„éœ²æ˜¯å˜›ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649951278,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":553206,"ip_address":"","group_id":0},"score":563224,"extra":""},{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":2975212,"avatar":"https://static001.geekbang.org/account/avatar/00/2d/65/ec/9d218806.jpg","nickname":"ä»Šå¤©åŠ›æ‰£äº†å˜›ğŸ’»","note":"","ucode":"C88B5F8E3DA4F3","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":564550,"discussion_content":"ä¸ä¼šå†…å­˜æ³„æ¼ã€‚ä½†è¿™ä»ç„¶æ˜¯æœªå®šä¹‰è¡Œä¸ºã€‚\n\næˆ‘å†™çš„å†…å­˜æ³„æ¼æ£€æµ‹å™¨ï¼ˆ[1]ã€[7]ï¼‰ä¼šåœ¨è¿™ç§æƒ…å†µä¸‹æŠ¥é”™å´©æºƒã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650276921,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":563224,"ip_address":"","group_id":0},"score":564550,"extra":""},{"author":{"id":1439748,"avatar":"https://static001.geekbang.org/account/avatar/00/15/f8/04/03aaf2dd.jpg","nickname":"æèªç£Š","note":"","ucode":"5FB1E5BEE08270","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":602535,"discussion_content":"æ—¢ç„¶ä¸ä¼šå‘ç”Ÿå†…å­˜æ³„éœ²ï¼Œé‚£ä¸ºä»€ä¹ˆä¼šæ˜¯æœªå®šä¹‰è¡Œä¸ºå‘¢ï¼Œä¸æ˜¯å¾ˆç†è§£ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1675820986,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":564550,"ip_address":"åŒ—äº¬","group_id":0},"score":602535,"extra":""}]}]},{"had_liked":false,"id":359955,"user_name":"è®°äº‹æœ¬","can_delete":false,"product_type":"c1","uid":1362659,"ip_address":"ä¸Šæµ·","ucode":"76F2CAFA309437","user_header":"https://static001.geekbang.org/account/avatar/00/14/ca/e3/447aff89.jpg","comment_is_top":false,"comment_ctime":1666088780,"is_pvip":false,"replies":[{"id":130942,"content":"åå¤å¤šçœ‹å‡ éï¼ŒåŠ çœ‹æ–‡æœ«çš„å‚è€ƒèµ„æ–™å’Œé‡Œé¢çš„ä»£ç ã€‚è¿™ä¸€è®²è®²è§£åŸç†ï¼Œæœ¬èº«æ²¡æœ‰ç‹¬ç«‹çš„ç¤ºä¾‹ä»£ç ã€‚[7] é‡Œæœ‰å…¨å±€æ›¿æ¢å†…å­˜å‡½æ•°çš„ä¾‹å­ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1645639,"ctime":1666156483,"ip_address":"ä¸Šæµ·","comment_id":359955,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"çœ‹ä¸æ‡‚ æ€ä¹ˆæ•´ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":553067,"discussion_content":"æ˜¯ã€‚\n\nä½†è¿™ä¸æ˜¯æˆ‘é—®çš„é—®é¢˜ã€‚æˆ‘é—®çš„æ˜¯è¿™ä¸¤ä¸ªæŒ‡é’ˆçš„å€¼æ˜¯ä¸æ˜¯ç›¸åŒã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645704782,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":343111,"user_name":"ç¦¾æ¡ƒ","can_delete":false,"product_type":"c1","uid":1477855,"ip_address":"","ucode":"9FE85C34A9E9E0","user_header":"https://static001.geekbang.org/account/avatar/00/16/8c/df/77acb793.jpg","comment_is_top":false,"comment_ctime":1650632059,"is_pvip":false,"replies":[{"id":125508,"content":"éƒ¨åˆ†å°±æ˜¯æˆ‘é—®çš„é—®é¢˜äº†ğŸ¤­ã€‚new æ˜¯ä¼šå»è°ƒç”¨ operator new(size_t) æ¥åˆ†é…å†…å­˜çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1645639,"ctime":1651069360,"ip_address":"","comment_id":343111,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"éº»çƒ¦é—®ä¸‹ï¼Œ\n\nnew Obj å¯¹åº”çš„è¡¨è¾¾å¼æ˜¯ auto ptr = new Obj;\noperator newå¯¹åº”çš„è¡¨è¾¾å¼æ˜¯ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":568132,"discussion_content":"éƒ¨åˆ†å°±æ˜¯æˆ‘é—®çš„é—®é¢˜äº†ğŸ¤­ã€‚new æ˜¯ä¼šå»è°ƒç”¨ operator new(size_t) æ¥åˆ†é…å†…å­˜çš„ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1651069360,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":340040,"user_name":"é«˜ä¼¸","can_delete":false,"product_type":"c1","uid":2421921,"ip_address":"","ucode":"63F615237C2E17","user_header":"https://static001.geekbang.org/account/avatar/00/24/f4/a1/51e99a88.jpg","comment_is_top":false,"comment_ctime":1648550873,"is_pvip":false,"replies":[{"id":124390,"content":"çœ‹ä¸‹ä¸€è®²â€œå®¹å™¨é‡Œçš„å†…å­˜ç®¡ç†ï¼šåˆ†é…å™¨â€å§ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1645639,"ctime":1648638895,"ip_address":"","comment_id":340040,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"å´è€å¸ˆæœ‰ä¸ªé—®é¢˜æƒ³è¯·æ•™ä¸‹ï¼Œåœ¨æŸ¥é˜…gcc4.9ä¸­stlæºç æ—¶ï¼Œå‘ç°allocatorç”³è¯·å†…å­˜æ—¶ç›´æ¥è°ƒç”¨::operator newï¼Œä¸ºä»€ä¹ˆæ²¡æœ‰å¦‚ä»¥å‰ä¸€æ ·é‡‡ç”¨äºŒçº§ç¼“å­˜pool_allocatorçš„æ–¹å¼å‘¢","like_count":0,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":559181,"discussion_content":"çœ‹ä¸‹ä¸€è®²â€œå®¹å™¨é‡Œçš„å†…å­˜ç®¡ç†ï¼šåˆ†é…å™¨â€å§ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648638895,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":335772,"user_name":"æ€ªå…½","can_delete":false,"product_type":"c1","uid":1324007,"ip_address":"","ucode":"3342C55CB83B08","user_header":"https://static001.geekbang.org/account/avatar/00/14/33/e7/145be2f9.jpg","comment_is_top":false,"comment_ctime":1645684806,"is_pvip":false,"replies":[{"id":122763,"content":"å—¯å—¯ï¼Œåº”è¯¥å†™â€œè¿™äº›å‡½æ•°â€ã€‚ğŸ˜‚","user_name":"ä½œè€…å›å¤","user_name_real":"ä½œè€…","uid":1645639,"ctime":1645767931,"ip_address":"","comment_id":335772,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"åœ¨&quot;ä¸åˆ†é…å†…å­˜çš„å¸ƒç½®åˆ†é…å’Œé‡Šæ”¾å‡½æ•°&quot;å°èŠ‚é‡Œï¼Œè€å¸ˆæœ‰æåˆ°&quot;å¦å¤–æ³¨æ„ï¼Œè·Ÿå¤§éƒ¨åˆ†å…¶ä»–åˆ†é…å‡½æ•°å’Œé‡Šæ”¾å‡½æ•°ä¸åŒï¼Œè¿™ä¸ªå‡½æ•°æ˜¯ä¸èƒ½è¢«ç”¨æˆ·æä¾›çš„ç‰ˆæœ¬æ›¿æ¢çš„&quot;ã€‚è¿™é‡Œè¯´çš„&quot;è¿™ä¸ªå‡½æ•°&quot;æ˜¯æŒ‡è¿™ä¸¤ä¸ªå‡½æ•°å—ï¼Ÿ\ninline void* operator new(size_t, void* ptr) noexcept\n{ return ptr; }\n\ninline void operator delete(void*, void*) noexcept\n{}","like_count":0,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":553208,"discussion_content":"å—¯å—¯ï¼Œåº”è¯¥å†™â€œè¿™äº›å‡½æ•°â€ã€‚ğŸ˜‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645767931,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":335713,"user_name":"å†œæ°‘å›­ä¸","can_delete":false,"product_type":"c1","uid":1155913,"ip_address":"","ucode":"6A91EBBC9DCE6C","user_header":"https://static001.geekbang.org/account/avatar/00/11/a3/49/4a488f4c.jpg","comment_is_top":false,"comment_ctime":1645660822,"is_pvip":false,"replies":[{"id":122698,"content":"ğŸ˜","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1645639,"ctime":1645704701,"ip_address":"","comment_id":335713,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"å±…ç„¶è¿˜æœ‰31ï¼Œå¤ªå€¼äº†ï¼","like_count":0,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":553066,"discussion_content":"ğŸ˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645704701,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":335833,"user_name":"ç½— ä¹¾ æ—","can_delete":false,"product_type":"c1","uid":1188222,"ip_address":"","ucode":"D0406F95176ABA","user_header":"https://static001.geekbang.org/account/avatar/00/12/21/7e/fb725950.jpg","comment_is_top":false,"comment_ctime":1645709418,"is_pvip":false,"replies":[{"id":122761,"content":"è¨€ç®€æ„èµ…ğŸ‘ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1645639,"ctime":1645767804,"ip_address":"","comment_id":335833,"utype":1}],"discussion_count":5,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"å‰ä¸€ä¸ªç›¸åŒï¼Œåä¸€ä¸ªä¸åŒï¼ˆé™¤å¼€PODï¼‰ã€‚æ•°ç»„ä¼šåœ¨å¤´éƒ¨å­˜æ”¾å¯¹è±¡çš„å¤§å°ï¼Œè¿™æ ·æ‰èƒ½ä¾æ¬¡æ‰¾åˆ°æ•°ç»„ä¸­çš„æ¯ä¸ªå¯¹è±¡åœ°å€ï¼Œè°ƒç”¨ææ„å‡½æ•°","like_count":11,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":553206,"discussion_content":"è¨€ç®€æ„èµ…ğŸ‘ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645767804,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":4,"child_discussions":[{"author":{"id":2975212,"avatar":"https://static001.geekbang.org/account/avatar/00/2d/65/ec/9d218806.jpg","nickname":"ä»Šå¤©åŠ›æ‰£äº†å˜›ğŸ’»","note":"","ucode":"C88B5F8E3DA4F3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":563224,"discussion_content":"å¯¹äºå†…ç½®ç±»å‹ï¼Œç”¨deleteè€Œä¸æ˜¯delete[]é‡Šæ”¾newå‡ºæ¥çš„æ•°ç»„ä¸ä¼šäº§ç”Ÿå†…å­˜æ³„éœ²æ˜¯å˜›ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649951278,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":553206,"ip_address":"","group_id":0},"score":563224,"extra":""},{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":2975212,"avatar":"https://static001.geekbang.org/account/avatar/00/2d/65/ec/9d218806.jpg","nickname":"ä»Šå¤©åŠ›æ‰£äº†å˜›ğŸ’»","note":"","ucode":"C88B5F8E3DA4F3","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":564550,"discussion_content":"ä¸ä¼šå†…å­˜æ³„æ¼ã€‚ä½†è¿™ä»ç„¶æ˜¯æœªå®šä¹‰è¡Œä¸ºã€‚\n\næˆ‘å†™çš„å†…å­˜æ³„æ¼æ£€æµ‹å™¨ï¼ˆ[1]ã€[7]ï¼‰ä¼šåœ¨è¿™ç§æƒ…å†µä¸‹æŠ¥é”™å´©æºƒã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650276921,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":563224,"ip_address":"","group_id":0},"score":564550,"extra":""},{"author":{"id":1439748,"avatar":"https://static001.geekbang.org/account/avatar/00/15/f8/04/03aaf2dd.jpg","nickname":"æèªç£Š","note":"","ucode":"5FB1E5BEE08270","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":602535,"discussion_content":"æ—¢ç„¶ä¸ä¼šå‘ç”Ÿå†…å­˜æ³„éœ²ï¼Œé‚£ä¸ºä»€ä¹ˆä¼šæ˜¯æœªå®šä¹‰è¡Œä¸ºå‘¢ï¼Œä¸æ˜¯å¾ˆç†è§£ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1675820986,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":564550,"ip_address":"åŒ—äº¬","group_id":0},"score":602535,"extra":""}]}]},{"had_liked":false,"id":335731,"user_name":"tang_ming_wu","can_delete":false,"product_type":"c1","uid":2566054,"ip_address":"","ucode":"98E5847CEF8B84","user_header":"https://static001.geekbang.org/account/avatar/00/27/27/a6/32e9479b.jpg","comment_is_top":false,"comment_ctime":1645667497,"is_pvip":false,"replies":[{"id":122699,"content":"æ˜¯ã€‚\n\nä½†è¿™ä¸æ˜¯æˆ‘é—®çš„é—®é¢˜ã€‚æˆ‘é—®çš„æ˜¯è¿™ä¸¤ä¸ªæŒ‡é’ˆçš„å€¼æ˜¯ä¸æ˜¯ç›¸åŒã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1645639,"ctime":1645704782,"ip_address":"","comment_id":335731,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"new Objè¿”å›çš„æ˜¯è°ƒç”¨æ„é€ å‡½æ•°åˆå§‹åŒ–å®Œæˆçš„å¯¹è±¡æŒ‡é’ˆï¼›\noperator new è¿”å›çš„åªæ˜¯ä¸€å—è¶³å¤Ÿå®¹çº³è¿™ä¸ªå¯¹è±¡å¤§å°çš„ç©ºç™½çš„å†…å­˜ç©ºé—´ã€‚\nä¸çŸ¥é“æˆ‘çš„ç†è§£å‡†ä¸å‡†ç¡®ã€‚","like_count":1,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":553067,"discussion_content":"æ˜¯ã€‚\n\nä½†è¿™ä¸æ˜¯æˆ‘é—®çš„é—®é¢˜ã€‚æˆ‘é—®çš„æ˜¯è¿™ä¸¤ä¸ªæŒ‡é’ˆçš„å€¼æ˜¯ä¸æ˜¯ç›¸åŒã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645704782,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":359955,"user_name":"è®°äº‹æœ¬","can_delete":false,"product_type":"c1","uid":1362659,"ip_address":"ä¸Šæµ·","ucode":"76F2CAFA309437","user_header":"https://static001.geekbang.org/account/avatar/00/14/ca/e3/447aff89.jpg","comment_is_top":false,"comment_ctime":1666088780,"is_pvip":false,"replies":[{"id":130942,"content":"åå¤å¤šçœ‹å‡ éï¼ŒåŠ çœ‹æ–‡æœ«çš„å‚è€ƒèµ„æ–™å’Œé‡Œé¢çš„ä»£ç ã€‚è¿™ä¸€è®²è®²è§£åŸç†ï¼Œæœ¬èº«æ²¡æœ‰ç‹¬ç«‹çš„ç¤ºä¾‹ä»£ç ã€‚[7] é‡Œæœ‰å…¨å±€æ›¿æ¢å†…å­˜å‡½æ•°çš„ä¾‹å­ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1645639,"ctime":1666156483,"ip_address":"ä¸Šæµ·","comment_id":359955,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"çœ‹ä¸æ‡‚ æ€ä¹ˆæ•´ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590897,"discussion_content":"åå¤å¤šçœ‹å‡ éï¼ŒåŠ çœ‹æ–‡æœ«çš„å‚è€ƒèµ„æ–™å’Œé‡Œé¢çš„ä»£ç ã€‚è¿™ä¸€è®²è®²è§£åŸç†ï¼Œæœ¬èº«æ²¡æœ‰ç‹¬ç«‹çš„ç¤ºä¾‹ä»£ç ã€‚[7] é‡Œæœ‰å…¨å±€æ›¿æ¢å†…å­˜å‡½æ•°çš„ä¾‹å­ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666156483,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":343111,"user_name":"ç¦¾æ¡ƒ","can_delete":false,"product_type":"c1","uid":1477855,"ip_address":"","ucode":"9FE85C34A9E9E0","user_header":"https://static001.geekbang.org/account/avatar/00/16/8c/df/77acb793.jpg","comment_is_top":false,"comment_ctime":1650632059,"is_pvip":false,"replies":[{"id":125508,"content":"éƒ¨åˆ†å°±æ˜¯æˆ‘é—®çš„é—®é¢˜äº†ğŸ¤­ã€‚new æ˜¯ä¼šå»è°ƒç”¨ operator new(size_t) æ¥åˆ†é…å†…å­˜çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1645639,"ctime":1651069360,"ip_address":"","comment_id":343111,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"éº»çƒ¦é—®ä¸‹ï¼Œ\n\nnew Obj å¯¹åº”çš„è¡¨è¾¾å¼æ˜¯ auto ptr = new Obj;\noperator newå¯¹åº”çš„è¡¨è¾¾å¼æ˜¯ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590897,"discussion_content":"åå¤å¤šçœ‹å‡ éï¼ŒåŠ çœ‹æ–‡æœ«çš„å‚è€ƒèµ„æ–™å’Œé‡Œé¢çš„ä»£ç ã€‚è¿™ä¸€è®²è®²è§£åŸç†ï¼Œæœ¬èº«æ²¡æœ‰ç‹¬ç«‹çš„ç¤ºä¾‹ä»£ç ã€‚[7] é‡Œæœ‰å…¨å±€æ›¿æ¢å†…å­˜å‡½æ•°çš„ä¾‹å­ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666156483,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":340040,"user_name":"é«˜ä¼¸","can_delete":false,"product_type":"c1","uid":2421921,"ip_address":"","ucode":"63F615237C2E17","user_header":"https://static001.geekbang.org/account/avatar/00/24/f4/a1/51e99a88.jpg","comment_is_top":false,"comment_ctime":1648550873,"is_pvip":false,"replies":[{"id":124390,"content":"çœ‹ä¸‹ä¸€è®²â€œå®¹å™¨é‡Œçš„å†…å­˜ç®¡ç†ï¼šåˆ†é…å™¨â€å§ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1645639,"ctime":1648638895,"ip_address":"","comment_id":340040,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"å´è€å¸ˆæœ‰ä¸ªé—®é¢˜æƒ³è¯·æ•™ä¸‹ï¼Œåœ¨æŸ¥é˜…gcc4.9ä¸­stlæºç æ—¶ï¼Œå‘ç°allocatorç”³è¯·å†…å­˜æ—¶ç›´æ¥è°ƒç”¨::operator newï¼Œä¸ºä»€ä¹ˆæ²¡æœ‰å¦‚ä»¥å‰ä¸€æ ·é‡‡ç”¨äºŒçº§ç¼“å­˜pool_allocatorçš„æ–¹å¼å‘¢","like_count":0,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":568132,"discussion_content":"éƒ¨åˆ†å°±æ˜¯æˆ‘é—®çš„é—®é¢˜äº†ğŸ¤­ã€‚new æ˜¯ä¼šå»è°ƒç”¨ operator new(size_t) æ¥åˆ†é…å†…å­˜çš„ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1651069360,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":335772,"user_name":"æ€ªå…½","can_delete":false,"product_type":"c1","uid":1324007,"ip_address":"","ucode":"3342C55CB83B08","user_header":"https://static001.geekbang.org/account/avatar/00/14/33/e7/145be2f9.jpg","comment_is_top":false,"comment_ctime":1645684806,"is_pvip":false,"replies":[{"id":122763,"content":"å—¯å—¯ï¼Œåº”è¯¥å†™â€œè¿™äº›å‡½æ•°â€ã€‚ğŸ˜‚","user_name":"ä½œè€…å›å¤","user_name_real":"ä½œè€…","uid":1645639,"ctime":1645767931,"ip_address":"","comment_id":335772,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"åœ¨&quot;ä¸åˆ†é…å†…å­˜çš„å¸ƒç½®åˆ†é…å’Œé‡Šæ”¾å‡½æ•°&quot;å°èŠ‚é‡Œï¼Œè€å¸ˆæœ‰æåˆ°&quot;å¦å¤–æ³¨æ„ï¼Œè·Ÿå¤§éƒ¨åˆ†å…¶ä»–åˆ†é…å‡½æ•°å’Œé‡Šæ”¾å‡½æ•°ä¸åŒï¼Œè¿™ä¸ªå‡½æ•°æ˜¯ä¸èƒ½è¢«ç”¨æˆ·æä¾›çš„ç‰ˆæœ¬æ›¿æ¢çš„&quot;ã€‚è¿™é‡Œè¯´çš„&quot;è¿™ä¸ªå‡½æ•°&quot;æ˜¯æŒ‡è¿™ä¸¤ä¸ªå‡½æ•°å—ï¼Ÿ\ninline void* operator new(size_t, void* ptr) noexcept\n{ return ptr; }\n\ninline void operator delete(void*, void*) noexcept\n{}","like_count":0,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":559181,"discussion_content":"çœ‹ä¸‹ä¸€è®²â€œå®¹å™¨é‡Œçš„å†…å­˜ç®¡ç†ï¼šåˆ†é…å™¨â€å§ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648638895,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":335713,"user_name":"å†œæ°‘å›­ä¸","can_delete":false,"product_type":"c1","uid":1155913,"ip_address":"","ucode":"6A91EBBC9DCE6C","user_header":"https://static001.geekbang.org/account/avatar/00/11/a3/49/4a488f4c.jpg","comment_is_top":false,"comment_ctime":1645660822,"is_pvip":false,"replies":[{"id":122698,"content":"ğŸ˜","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1645639,"ctime":1645704701,"ip_address":"","comment_id":335713,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"å±…ç„¶è¿˜æœ‰31ï¼Œå¤ªå€¼äº†ï¼","like_count":0,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":553208,"discussion_content":"å—¯å—¯ï¼Œåº”è¯¥å†™â€œè¿™äº›å‡½æ•°â€ã€‚ğŸ˜‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645767931,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}