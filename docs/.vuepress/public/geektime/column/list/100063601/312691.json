{"id":312691,"title":"08 | MQTT：在实践中掌握一个通信协议","content":"<p>你好，我是郭朝斌。</p><p>在基础篇的<a href=\"https://time.geekbang.org/column/article/307518\">第 3 讲</a>中，我介绍了几种物联网系统中常用的网络协议。它们是物联网设备之间沟通的“语言”，使用同一种语言，双方才能通信成功。</p><p>那么，在这么多网络协议当中，最流行的是哪一种呢？毫无疑问，是MQTT协议，它甚至已经成为物联网系统事实上的网络协议标准。如果你想从事物联网开发，就一定要掌握MQTT。</p><p>所以这一讲，我就会带你了解MQTT，在实践中熟悉它的特性。</p><h2>体验MQTT</h2><p>为了让你对MQTT有一个直观的印象，我先带你体验一下它的通信过程，</p><p>第一步是安装 hbmqtt，它是一个开源的基于Python语言的 MQTT Broker  软件，正好包括我们需要使用一些工具。跟其他选择相比，这个软件安装起来非常方便，因为它在 Python 的 PYPI 软件仓库中就有，所以你通过 pip 命令就可以安装。这也是选择使用它的主要原因。</p><p>不过要注意的是，hbmqtt 是基于Python3实现的，因此这里使用的是 pip3 工具。</p><pre><code>pip3 install hbmqtt\n</code></pre><p>安装完成后，我们就可以使用 hbmqtt 中提供的  hbmqtt_sub 和 hbmqtt_pub 这两个命令行工具了。通过名字，你应该也可以看出 hbmqtt_sub 可以充当<strong>订阅者</strong>的角色；hbmqtt_pub 可以作为消息的<strong>发布者</strong>。</p><!-- [[[read_end]]] --><p>至于订阅者和发布者之间的经纪人，也就是 MQTT Broker，我们使用  Eclipse 免费开放的在线 <a href=\"https://mosquitto.org/\">Broker 服务</a>。打开链接，你可以看到关于端口的介绍信息，加密和非加密方式都支持，而且还有基于 Websocket 的实现，这对基于前端网页的应用来说是非常有利的。</p><p>我们先使用 1883端口的非加密方式，然后为消息传输确定一个主题（Topic）。主题确定了消息的类别，用于消息过滤。比如我们待会儿要测试的消息，属于极客时间平台的物联网课程，所以主题可以设为“/geektime/iot”。</p><pre><code>/geektime/iot\n</code></pre><p>接着，我们在电脑的终端界面输入下面的命令，就可以订阅这个主题消息：</p><pre><code>hbmqtt_sub --url mqtt://mqtt.eclipse.org:1883 -t /geektime/iot\n</code></pre><p>如果你想了解一些命令的执行细节，可以在上面的命令中加上 “-d” 参数。</p><p>现在，我们启动另外一个终端界面，通过 hbmqtt_pub 发布一个 “/geektime/iot” 主题的消息：</p><pre><code>hbmqtt_pub --url mqtt://mqtt.eclipse.org:1883 -t /geektime/iot -m Hello,World!\n</code></pre><p>通过 Eclipse 的开放 Broker 作为“经纪人”，消息被传输到了我们通过 hbmqtt_sub 运行的订阅者那里。下图是我的终端界面上运行的结果，一个完整的消息传输过程就这样完成了。</p><p><img src=\"https://static001.geekbang.org/resource/image/9a/ef/9a4fe3966ac303d5defde1bd8b7yy4ef.png?wh=1544*214\" alt=\"\"></p><h2>MQTT 的生态很完善</h2><p>初步体验之后，不知道你是不是有这样的感觉：原来使用MQTT也没有那么难啊？</p><p>确实不难，甚至可以说很简单，这主要得益于MQTT 协议出现的时间很久远。当然，时间久远本身不是优势，能力强才是。这些长期的使用和积淀使得 MQTT 的生态非常完善，而生态是技术标准能够主导行业的关键。所以你在使用MQTT的时候会觉得很方便，可供挑选的方案有很多。</p><p>比如在上面的体验中，你要安装 MQTT，可以直接找到 <a href=\"https://github.com/beerfactory/hbmqtt\">hbmqtt</a> 这样的项目拿来用。它的背后有 Eclipse 基金会的支持。</p><p>类似的 MQTT Broker  软件，你还可以选择基于C语言的<a href=\"http://mosquitto.org/\">Mosquitto</a>，基于Erlang语言的<a href=\"https://vernemq.com/\">VerneMQ</a>等。</p><p>至于 MQTT 的客户端（Client）实现，也有成熟的 Python、C、Java 和 JavaScript 等各种编程语言的开源实现，供你参考、使用，比如<a href=\"http://www.eclipse.org/paho/\">Eclipse Paho项目</a>。</p><p>而且，还有很多商业公司在持续运营功能更丰富、支持更完备的商业版 Broker 实现，比如提供高并发能力的集群特性、方便拓展的插件机制等。这些会大大提高我们技术开发者的工作效率。比如中国一个团队开发、维护的 <a href=\"https://www.emqx.io/\">EMQ X</a>，它已经完整地支持 MQTT5.0协议。</p><p>另外，生态完善还有一个好处，那就是作为开发者，当你遇到难题时，可以很方便地找到很多相关的资料；就算资料解决不了问题，你还可以去社区中提问，寻求高手的帮助。这在实际工作中非常有用。顺便提一下，除了老牌的Stack Overflow，你还可以关注一下 GitHub 的 Issues 模块，因为在那里可以找到很多专家。</p><h2>MQTT自身的“基因”很强大</h2><p>当然，阿里云、华为云、腾讯云和微软 Azure 这些大厂，之所以不约而同地选择 MQTT 协议作为物联网设备的“第一语言”，不仅是因为MQTT的生态完善，MQTT协议本身的优秀设计也是重要的因素。</p><p>它在设计上的优点体现在哪呢？我想主要有五个方面：</p><ol>\n<li>契合物联网大部分应用场景的<strong>发布-订阅模式</strong>。</li>\n<li>能够满足物联网中资源受限设备需要的<strong>轻量级特性</strong>。</li>\n<li>时刻关注物联网设备<strong>低功耗需求的优化设计</strong>。</li>\n<li>针对物联网中多变的网络环境提供的<strong>多种服务质量等级</strong>。</li>\n<li>支持在物联网应用中越来越被重视的<strong>数据安全</strong>。</li>\n</ol><p>接下来，我分别为你剖析一下。</p><h3>发布-订阅模式</h3><p>刚才我们体验的通信过程，是一个发布者和一个订阅者的情况。在这之后，你可以再打开一个终端界面，重复和之前一样的命令，再启动一个订阅者。</p><pre><code>hbmqtt_sub --url mqtt://mqtt.eclipse.org:1883 -t /geektime/iot\n</code></pre><p>现在，这两个订阅者都订阅了“/geektime/iot” 主题的消息。</p><p>然后，你再次使用 hbmqtt_pub 发送消息，就可以看到两个订阅者都收到了同样的消息，这是<strong>发布-订阅模式</strong>的典型特征。</p><p>因为采用了发布-订阅模式，MQTT协议具有很多优点，比如能让一个传感器数据触发一系列动作；网络不稳定造成的临时离线不会影响工作；方便根据需求动态调整系统规模等。这使得它能满足绝大部分物联网场景的需求。</p><h3>轻量级协议：减少传输数据量</h3><p>MQTT 是一个<strong>轻量级</strong>的网络协议，这一点也是它在物联网系统中流行的重要原因。毕竟物联网中大量的都是计算资源有限、网络带宽低的设备。</p><p>这种“轻量级”体现在两个方面。一方面，MQTT 消息采用<strong>二进制的编码格式</strong>，而不是 HTTP 协议那样的文本的表述方式。</p><p>这有什么好处呢？那就是可以充分利用字节位，协议头可以很紧凑，从而尽量<strong>减少需要通过网络传输的数据量</strong>。</p><p>比如，我们分析 HTTP 的一个请求抓包，它的消息内容是下面这样的（注意：空格和回车、换行符都是消息的组成部分）：</p><pre><code>GET /account HTTP/1.1    &lt;--注释：HTTP请求行\nHost: time.geekbang.com  &lt;--注释：以下为HTTP请求头部\nUpgrade-Insecure-Requests: 1\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:81.0) Gecko/20100101 Firefox/81.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\nAccept-Encoding: gzip, deflate, sdch\nAccept-Language: zh-CN,zh;q=0.8,en;q=0.6\n                         &lt;--注释：这个空行是必须的，即使下面的请求体是空的\n</code></pre><p>在HTTP协议传输的这段文本中，每个字符都要占用  1 个字节。而如果使用MQTT协议，一个字节就可以表示很多内容。下面的图片展示了 MQTT 的固定头的格式，这个固定头只有2个字节：</p><p><img src=\"https://static001.geekbang.org/resource/image/e0/03/e03f1b94406b4cf33d55c9361925e203.jpg?wh=2700*582\" alt=\"\"></p><p>你可以看到，第一个字节分成了高 4 位（4～7）和低 4 位（0～3）；低  4  位是数据包标识位，其中的每一比特位又可以表示不同的含义；高4位是不同数据包类型的标识位。</p><p>第二个字节表示数据包头部和消息体的字节共个数，其中最高位表示有没有第三字节存在，来和第二个字节一起表示字节共个数。</p><p>如果有第三个字节，那它的最高位表示是否有第四个字节，来和第二个字节、第三个字节一起表示字节总个数。依此类推，还可能有第四个字节、第五个字节，不过这个表示可变头部和消息体的字节个数的部分，最多也只能到第五个字节，所以可以表示的最大数据包长度有256MB。</p><p>比如，一个请求建立连接的 CONNECT 类型数据包，头部需要14个字节；发布消息的 PUBLISH 类型数据包头部只有2～4个字节。</p><p>轻量级的另一方面，体现在消息的具体<strong>交互流程设计非常简单</strong>，所以MQTT的交互消息类型也非常少。为了方便后面的讲解，我在这里整理了一个表格，总结了 MQTT 不同的数据包类型的功能和发消息的流向。</p><p>从表格可以看出，MQTT 3.1.1 版本一共定义了14种数据包的类型，在第一个字节的高 4 位中分别对应从 1 到 14 的数值。</p><p><img src=\"https://static001.geekbang.org/resource/image/5d/e4/5d22e10c5b00a10177d76055db93f3e4.jpg?wh=2700*1519\" alt=\"\"></p><h3>低功耗优化：节约电量和网络资源</h3><p>除了让协议足够轻量，MQTT协议还很注重<strong>低功耗</strong>的优化设计，这主要体现在对能耗和通信次数的优化。</p><p>比如，MQTT 协议有一个 <strong>Keepalive 机制</strong>。它的作用是，在 Client 和 Broker 的连接中断时，让双方能及时发现，并重新建立 MQTT 连接，保证主题消息的可靠传输。</p><p>这个机制工作的原理是：Client 和 Broker 都基于 Keepalive 确定的时间长度，来判断一段时间内是否有消息在双方之间传输。这个  Keepalive 时间长度是在Client建立连接时设置的，如果超出这个时间长度，双方没有收到新的数据包，那么就判定连接断开。</p><p>虽然Keepalive要求一段时间内必须有数据包传输，但实际情况是，Client 和 Broker 不可能时时刻刻都在传输主题消息，这要怎么办呢？</p><p>MQTT 协议的解决方案是，定义了 PINGREQ 和 PINGRESP 这两种消息类型。它们都没有可变头部和消息体，也就是说都只有  2  个字节大小。Client 和 Broker 通过分别发送 PINGREQ 和 PINGRESP 消息，就能够满足 Keepalive 机制的要求。</p><p>我猜你也想到了，如果要一直这样“傻傻地”定期发送消息，那也太浪费电量和网络资源了。所以，如果在 Keepalive 时间长度内，Client 和 Broker 之间有数据传输，那么 Keepalive 机制也会将其计算在内，这样就不需要再通过发送 PINGREQ 和 PINGRESP 消息来判断了。</p><p>除了 Keepalive 机制，MQTT 5.0 中的<strong>重复主题特性</strong>也能帮助我们节省网络资源。</p><p>Client 在重复发送一个主题的消息时，可以从第二次开始，将主题名长度设置为 0，这样 Broker  会自动按照上次的主题来处理消息。这种情况对传感器设备来说十分常见，所以这个特性在工作中很有实际意义。</p><h3>3种QoS级别：可靠通信</h3><p>除了计算资源有限、网络带宽低，物联网设备还经常遇到网络环境不稳定的问题，尤其是在移动通信、卫星通信这样的场景下。比如共享单车，如果用户已经锁车的这个消息，不能可靠地上传到服务器，那么计费就会出现错误，结果引起用户的抱怨。这样怎么应对呢？</p><p>这个问题产生的背景就是不稳定的通信条件，所以 MQTT 协议设计了  3 种不同的 QoS  （Quality of Service，服务质量）级别。你可以根据场景灵活选择，在不同环境下保证通信是可靠的。</p><p>这 3 种级别分别是：</p><ol>\n<li>QoS 0，表示消息<strong>最多</strong>收到一次，即消息可能丢失，但是不会重复。</li>\n<li>QoS 1，表示消息<strong>至少</strong>收到一次，即消息保证送达，但是可能重复。</li>\n<li>QoS 2，表示消息<strong>只会</strong>收到一次，即消息有且只有一次。</li>\n</ol><p><img src=\"https://static001.geekbang.org/resource/image/63/d1/63ced1e04d756yy9ae89c3c81c8ac9d1.jpg?wh=2700*1375\" alt=\"\"></p><p>我用一张图展示了它们各自的特点。可以看到，QoS 0 和 QoS 1 的流程相对比较简单；而 QoS 2 为了保证有且只有一次的可靠传输，流程相对复杂些。</p><p>正常情况下，QoS 2有PUBLISH、PUBREC、PUBREL 和 PUBCOMP 4 次交互。</p><p>至于“不正常的情况”，发送方就需要重复发送消息。比如一段时间内没有收到 PUBREC 消息，就需要再次发送PUBLISH消息。不过要注意，这时要把消息中的 “重复”标识设置为1，以便接收方能正确处理。同样地，如果没有收到 PUBCOMP 消息，发送方就需要再次发送PUBREL消息。</p><p>剖析到这里，MQTT协议本身的主要特性我就介绍完了，我们已经为在实战篇编写 MQTT 的相关通信代码做好了准备。但是，我还想跟你补充一个跟生产环境有关的知识点，那就是<strong>数据安全传输</strong>。</p><h3>安全传输</h3><p>说到安全传输，首先我们需要验证Client是否有权限接入MQTT Broker。为了控制Client的接入，MQTT 提供了<strong>用户名/密码</strong>的机制。在建立连接过程中，它可以通过判断用户名和密码的正确性，来筛选有效连接请求。</p><p>但是光靠这个机制，还不能保证网络通信过程中的数据安全。因为在明文传输的方式下，不止设备数据，甚至用户名和密码都可能被其他人从网络上截获而导致泄漏，于是其他人就可以伪装成合法的设备发送数据。所以，我们还需要通信加密技术的支持。</p><p>MQTT 协议支持 <strong>SSL/TLS</strong> 加密通信方式。采用SSL/TLS加密之后，MQTT将转换为 MQTTS。这有点类似于 HTTP 和 HTTPS 的关系。</p><p>我们只要将前面测试的命令修改一下，将 “mqtt://” 改为 “mqtts://”，端口改为 8883，就可以用SSL/TLS 加密通信方式连接到 Eclipse 提供的开放 Broker。但是我最近发现，它的SSL证书已经过期了，因此连接会失败。（你在学习这一讲的时候，可以再试试，万一又更新了呢？）</p><p>所以，我再提供另一个方式，供你测试使用。</p><p>我们输入“mqtts://test.mosquitto.org:8883”，把开放 Broker 切换到<a href=\"https://test.mosquitto.org/\">这个链接</a>，从链接中下载一个<a href=\"https://test.mosquitto.org/ssl/mosquitto.org.crt\">客户端证书</a>，然后通过下面的命令订阅主题消息：</p><pre><code>hbmqtt_sub --url mqtts://test.mosquitto.org:8883 -t /geektime/iot --ca-file ~/Downloads/mosquitto.org.crt\n</code></pre><p>接着，我们再通过下面的命令测试发布消息：</p><pre><code>hbmqtt_pub --url mqtts://test.mosquitto.org:8883 -t /geektime/iot -m Hello,World! --ca-file ~/Downloads/mosquitto.org.crt\n</code></pre><p>最后在运行hbmqtt_sub命令的终端，就可以看到 Hello,World! 的消息：</p><p><img src=\"https://static001.geekbang.org/resource/image/b0/30/b04f873277f9dba5bfb7e9ff85d17630.png?wh=1400*262\" alt=\"\"></p><h2>小结</h2><p>总结一下，在这一讲中，我带你体验了使用MQTT协议的通信过程，同时也为你介绍了 MQTT 协议的几个特点。</p><ol>\n<li>MQTT协议的生态很好。比如，MQTT 协议的代码实现非常丰富，C 语言的有 Mosquitto，Python 语言有 Eclipse hbmqtt，而且有商业公司在运营相关软件解决方案。这表明 MQTT 协议很成熟。</li>\n<li>MQTT协议采用了适合物联网应用场景的发布-订阅模式。当然，我也提到了MQTT 5.0  中同样增加了请求-响应模式，便于部分场景中的开发使用。</li>\n<li>MQTT 协议采用二进制的消息内容编码格式，协议很精简，协议交互也简单，这些特点保证了网络传输流量很小。所以客户端（包括发布者和订阅者角色）的代码实现可以短小精悍，比如 C 语言的实现大概只占30KB 的存储空间，Java 语言也只需要 100KB 左右大小的代码体积。</li>\n<li>MQTT 协议在设计上考虑了很多物联网设备的低功耗需求，比如Keepalive机制中精简的PINGREQ 和 PINGRESP 这两种消息类型，还有 MQTT 5.0  中新增加的重复主题特性。这也再次印证了MQTT的定位非常明确，那就是专注于物联网场景。</li>\n<li>MQTT 在消息的可靠传输和安全性上，也有完整的支持，可以说“简约而不简单”。</li>\n</ol><p>因此，在你为物联网系统选择网络协议时，MQTT可以作为重点考察对象。在实战篇的动手实验中，我们将使用MQTT协议传输设备数据，相信你已经做好了准备。</p><h2>思考题</h2><p>最后，我想给你留一个实践作业和一道思考题。</p><p>在介绍 QoS 等级的时候，我没有结合网络抓包来说明消息的交互过程。所以，我想请你在课后使用 Wireshark 工具，实际分析一下各个 QoS 级别的数据包类型。</p><p>同时，也请你思考一下，如果Client 发布消息时选择的 QoS 等级是1 ，而订阅者在订阅这个主题消息时选择的QoS等级是2 ，这种情况下 Broker会怎么处理呢？</p><p>欢迎你在留言区写一写你的实践和思考的结果，也欢迎你将这一讲分享给你的朋友一起交流学习。</p>","comments":[{"had_liked":false,"id":295452,"user_name":"Justone","can_delete":false,"product_type":"c1","uid":1231299,"ip_address":"","ucode":"BB4C294E82764E","user_header":"https://static001.geekbang.org/account/avatar/00/12/c9/c3/18fce18c.jpg","comment_is_top":false,"comment_ctime":1622436338,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"74636880370","product_id":100063601,"comment_content":"1.  pip install hbmqtt 后运行 hbmqtt_sub 或 hbmqtt_pub 命令，抛出了 ModuleNotFoundError: No module named &#39;websockets.protocol&#39;<br>2.  抛出异常的代码是 from websockets.protocol import, no module 可能是相应的 protocol.py 文件缺失<br>3.  这时可以根据命令行提示的错误路径，ls 一下 websockets 文件夹有什么东西，会发现没有 protocol.py 文件<br>4.  在网上检索 websockets，发现它源码在 github 中，这个 repo 用 tag 区别不同版本，通过对比可以发现，在 websockets 9.0 之后去除了 protocol.py 文件，在 8.1 以前还保留着 protocol.py<br>5.  解决思路有两个：<br>a.  修改 hbmqtt 库的 adapters.py 代码（可能还有其它地方要改）<br>b.  降低 websockets 版本（pip uninstall websockets; pip install websockets==8.1; 问题解决)","like_count":18,"discussions":[{"author":{"id":2674368,"avatar":"https://static001.geekbang.org/account/avatar/00/28/ce/c0/cf67c443.jpg","nickname":"林圣斌","note":"","ucode":"B7510F7BB89EC5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394289,"discussion_content":"hbmqtt性能如何 有测试过么","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631808355,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2305512,"avatar":"","nickname":"wo","note":"","ucode":"927DA4E1F4F355","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388207,"discussion_content":"太感谢了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628652861,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2674368,"avatar":"https://static001.geekbang.org/account/avatar/00/28/ce/c0/cf67c443.jpg","nickname":"林圣斌","note":"","ucode":"B7510F7BB89EC5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2305512,"avatar":"","nickname":"wo","note":"","ucode":"927DA4E1F4F355","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394288,"discussion_content":"兄弟，也是在研究hbmqtt吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631808324,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":388207,"ip_address":""},"score":394288,"extra":""}]}]},{"had_liked":false,"id":268605,"user_name":"莹","can_delete":false,"product_type":"c1","uid":1020356,"ip_address":"","ucode":"395C6C4191B091","user_header":"https://static001.geekbang.org/account/avatar/00/0f/91/c4/40609b81.jpg","comment_is_top":false,"comment_ctime":1608270550,"is_pvip":false,"replies":[{"id":"99473","content":"对，也可以尝试用mosquitto的地址","user_name":"作者回复","user_name_real":"郭朝斌","uid":"2302171","ctime":1610864518,"ip_address":"","comment_id":268605,"utype":1}],"discussion_count":5,"race_medal":0,"score":"48852910806","product_id":100063601,"comment_content":"老师，我试了一下你给的代码<br>hbmqtt_sub --url mqtt:&#47;&#47;mqtt.eclipse.org:1883 -t &#47;geektime&#47;iot，这个URL有问题mqtt.eclipse.org我怎么也连不上；但是换成它页面上给的mqtt.eclipseprojects.io就没有问题。还有python 3.9 似乎重写了一些关于lock的代码，hbmqtt会有问题，Python 3.8就没问题。","like_count":11,"discussions":[{"author":{"id":2302171,"avatar":"https://static001.geekbang.org/account/avatar/00/23/20/db/b04f43dc.jpg","nickname":"郭朝斌","note":"","ucode":"2969986E1B3851","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":511986,"discussion_content":"对，也可以尝试用mosquitto的地址","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610864518,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1704988,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/04/1c/15c00997.jpg","nickname":"9ambition","note":"","ucode":"E6463C18E8CF0B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":349838,"discussion_content":"这个同学说的很对，mqtt的接口网址一定要打老师推荐的io，不要直接复制老师的代码用，听这个同学做的就没问题了。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1613572258,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2413319,"avatar":"","nickname":"Geek_7dd590","note":"","ucode":"B70579B53EAEA5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":342148,"discussion_content":"是的，碰到同样问题了，3.9下怎么解决啊？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610598065,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1020356,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/91/c4/40609b81.jpg","nickname":"莹","note":"","ucode":"395C6C4191B091","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2413319,"avatar":"","nickname":"Geek_7dd590","note":"","ucode":"B70579B53EAEA5","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":342657,"discussion_content":"我重新安装了3.8","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610767015,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":342148,"ip_address":""},"score":342657,"extra":""},{"author":{"id":1130122,"avatar":"https://static001.geekbang.org/account/avatar/00/11/3e/8a/891b0e58.jpg","nickname":"wnz27","note":"","ucode":"BC9ACB6B7C6FD9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2413319,"avatar":"","nickname":"Geek_7dd590","note":"","ucode":"B70579B53EAEA5","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":413988,"discussion_content":"不兼容3.9 github上有个issue说了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636629470,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":342148,"ip_address":""},"score":413988,"extra":""}]}]},{"had_liked":false,"id":269349,"user_name":"like_wind","can_delete":false,"product_type":"c1","uid":1755021,"ip_address":"","ucode":"2733C299AE56AE","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eolBabicK5OTVJJJlUA4wwRtwCohCb75ahtbiaopsicnG3HRQTBOVEUrRY1KYCRZH78cDweQllh0Jzeg/132","comment_is_top":false,"comment_ctime":1608619422,"is_pvip":false,"replies":[{"id":"99456","content":"👍","user_name":"作者回复","user_name_real":"郭朝斌","uid":"2302171","ctime":1610860467,"ip_address":"","comment_id":269349,"utype":1}],"discussion_count":1,"race_medal":0,"score":"35968357790","product_id":100063601,"comment_content":"自己用EMQ X搭建了一个broker服务器，收发消息成功，支持国产软件，不过EMQ文档真的很全。附上文档链接：https:&#47;&#47;docs.emqx.cn&#47;cn&#47;broker&#47;latest&#47;getting-started&#47;install.html","like_count":9,"discussions":[{"author":{"id":2302171,"avatar":"https://static001.geekbang.org/account/avatar/00/23/20/db/b04f43dc.jpg","nickname":"郭朝斌","note":"","ucode":"2969986E1B3851","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":512245,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610860467,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":288231,"user_name":"曙光","can_delete":false,"product_type":"c1","uid":1476450,"ip_address":"","ucode":"04D65BF7F19845","user_header":"https://static001.geekbang.org/account/avatar/00/16/87/62/f99b5b05.jpg","comment_is_top":false,"comment_ctime":1618373250,"is_pvip":false,"replies":[{"id":"106675","content":"赞👍","user_name":"作者回复","user_name_real":"郭朝斌","uid":"2302171","ctime":1621757376,"ip_address":"","comment_id":288231,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14503275138","product_id":100063601,"comment_content":"测试了，如果pub和sub都是2，就是2组4次交互。如果只有pub为2，一组4次交互。但如果pub是1，sub为2，则测试结果和sub，pub都为1的情况一样，sub和broker之间不是4次交互。","like_count":4,"discussions":[{"author":{"id":2302171,"avatar":"https://static001.geekbang.org/account/avatar/00/23/20/db/b04f43dc.jpg","nickname":"郭朝斌","note":"","ucode":"2969986E1B3851","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518556,"discussion_content":"赞👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621757376,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":268810,"user_name":"莹","can_delete":false,"product_type":"c1","uid":1020356,"ip_address":"","ucode":"395C6C4191B091","user_header":"https://static001.geekbang.org/account/avatar/00/0f/91/c4/40609b81.jpg","comment_is_top":false,"comment_ctime":1608358449,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"14493260337","product_id":100063601,"comment_content":"老师给的思考题，用wireshark试了一下，第一次用，不太确定理解完全正确——我感到都是按照publisher的QoS等级走的：<br><br>如果 Publisher QoS 1 (at least once)，subsciber QoS 2（exactly once），我看到的是有两次Publish Message，然后两次Publish Ack。<br><br>如果反过来，Publisher QoS 2（exactly once），subsciber QoS 1 (at least once)，我看到的情况是会有publish确认，看到这几个连续动作Publish Message, Publish Received, Publish Release, Publish Complete, Publish Ack","like_count":3,"discussions":[{"author":{"id":1704988,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/04/1c/15c00997.jpg","nickname":"9ambition","note":"","ucode":"E6463C18E8CF0B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":349837,"discussion_content":"问一下，你怎么用wireshark做qos的尝试的？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1613571936,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1020356,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/91/c4/40609b81.jpg","nickname":"莹","note":"","ucode":"395C6C4191B091","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1704988,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/04/1c/15c00997.jpg","nickname":"9ambition","note":"","ucode":"E6463C18E8CF0B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":355845,"discussion_content":"不太懂这个问题，就是wireshark的基本用法而已","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615480125,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":349837,"ip_address":""},"score":355845,"extra":""},{"author":{"id":1272580,"avatar":"https://static001.geekbang.org/account/avatar/00/13/6b/04/cea8eb77.jpg","nickname":"RG","note":"","ucode":"F9ADC5F2B23654","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1704988,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/04/1c/15c00997.jpg","nickname":"9ambition","note":"","ucode":"E6463C18E8CF0B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578716,"discussion_content":"还是用hbmqtt尝试的，wireshark可以拦截数据包，可以看到hbmqtt具体发送了什么","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656987359,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":349837,"ip_address":""},"score":578716,"extra":""}]}]},{"had_liked":false,"id":264448,"user_name":"YueShi","can_delete":false,"product_type":"c1","uid":1625530,"ip_address":"","ucode":"8F7AFAE4641A7D","user_header":"https://static001.geekbang.org/account/avatar/00/18/cd/ba/3a348f2d.jpg","comment_is_top":false,"comment_ctime":1606469178,"is_pvip":true,"replies":[{"id":"95931","content":"比如发生是主题是“&#47;geektime&#47;iot”，第一次需要在信息体中包含这个主题的字符，第二次就可以省掉这个主题名字了。","user_name":"作者回复","user_name_real":"郭朝斌","uid":"2302171","ctime":1606567902,"ip_address":"","comment_id":264448,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14491371066","product_id":100063601,"comment_content":"Client 在重复发送一个主题的消息时，可以从第二次开始，将主题名长度设置为 0，这样 Broker 会自动按照上次的主题来处理消息。这种情况对传感器设备来说十分常见，所以这个特性在工作中很有实际意义。<br><br>这段没有太懂, 有老哥给提示一下吗? 多谢了","like_count":3,"discussions":[{"author":{"id":2302171,"avatar":"https://static001.geekbang.org/account/avatar/00/23/20/db/b04f43dc.jpg","nickname":"郭朝斌","note":"","ucode":"2969986E1B3851","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":510568,"discussion_content":"比如发生是主题是“/geektime/iot”，第一次需要在信息体中包含这个主题的字符，第二次就可以省掉这个主题名字了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606567902,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":263795,"user_name":"ACK","can_delete":false,"product_type":"c1","uid":1922378,"ip_address":"","ucode":"C5D09B18DEF151","user_header":"https://static001.geekbang.org/account/avatar/00/1d/55/4a/8a841200.jpg","comment_is_top":false,"comment_ctime":1606268758,"is_pvip":false,"replies":[{"id":"95948","content":"谢谢你的留言：）<br>","user_name":"作者回复","user_name_real":"郭朝斌","uid":"2302171","ctime":1606570414,"ip_address":"","comment_id":263795,"utype":1}],"discussion_count":2,"race_medal":0,"score":"14491170646","product_id":100063601,"comment_content":"作为智能锁嵌入式开发者，觉得老师讲的东西很受用😃","like_count":3,"discussions":[{"author":{"id":2302171,"avatar":"https://static001.geekbang.org/account/avatar/00/23/20/db/b04f43dc.jpg","nickname":"郭朝斌","note":"","ucode":"2969986E1B3851","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":510307,"discussion_content":"谢谢你的留言：）\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606570414,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1922378,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/55/4a/8a841200.jpg","nickname":"ACK","note":"","ucode":"C5D09B18DEF151","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":328897,"discussion_content":"特别是开发 WiFi 联网智能锁时","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606268902,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":330113,"user_name":"予歌","can_delete":false,"product_type":"c1","uid":2864780,"ip_address":"","ucode":"B9006EA4BBED20","user_header":"https://static001.geekbang.org/account/avatar/00/2b/b6/8c/d5019728.jpg","comment_is_top":false,"comment_ctime":1641801943,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5936769239","product_id":100063601,"comment_content":"抛出了 ModuleNotFoundError: No module named &#39;websockets.protocol&#39;<br>可以用<br>pip install &quot;websockets==8.1&quot;<br>解决","like_count":1},{"had_liked":false,"id":279051,"user_name":"9ambition","can_delete":false,"product_type":"c1","uid":1704988,"ip_address":"","ucode":"E6463C18E8CF0B","user_header":"https://static001.geekbang.org/account/avatar/00/1a/04/1c/15c00997.jpg","comment_is_top":false,"comment_ctime":1613571906,"is_pvip":false,"replies":[{"id":"102058","content":"需要实际实验一下，测试过程不太复杂","user_name":"作者回复","user_name_real":"郭朝斌","uid":"2302171","ctime":1614579837,"ip_address":"","comment_id":279051,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5908539202","product_id":100063601,"comment_content":"针对思考题，我的回答是这样子的：<br>对于发布者（pub），采用QoS = 1，也就意味着就算broker已经收到此发布者发送的数据，发布者还是会重复一样的数字，对于发布者本身来说就是不想自己发出的每一条信息被遗漏。<br>对于订阅者（sub），采用QoS = 2, 说明sub在面对订阅主题时，每一次从broker获得数据前都会经过publish, pubreck, pubrel, pubcomp这四步后才能从订阅主题处获得一次数据。<br>所以broker的行为只需要从pub-broker和broker-sub两步看就可以：<br>对于pub-broker的部分，broker只需要进行puback来确认broker已经收到pub发送的数据了。<br>对于broker-sub的部分，broker一定要先确认自己执行了从pub获得的数据发出去的行为，也就是publish，接着确认收到sub的回复：pubrec来说明broker确实成功把数据发出去了；接着确认broker确实把数据发出去了，也就是pubrel；最后让sub回复pubcomp来说明sub确实收到broker发出的数据了。就相当于publish和pubrec是确认broker发数据的行为，pubrel和pubcomp是确认broker的数据内容已经被发送和被sub接收。","like_count":1,"discussions":[{"author":{"id":2302171,"avatar":"https://static001.geekbang.org/account/avatar/00/23/20/db/b04f43dc.jpg","nickname":"郭朝斌","note":"","ucode":"2969986E1B3851","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":515610,"discussion_content":"需要实际实验一下，测试过程不太复杂","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614579837,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":264274,"user_name":"InfoQ_Albert","can_delete":false,"product_type":"c1","uid":1290413,"ip_address":"","ucode":"B4C16362EDC7A9","user_header":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIVlib8n4JZhIomleMIyJTrbhn81kXG39DhJzrFMwmwxFsHCkicsC4CmY5Ft8icmzibWzmvibsDKDP3ORQ/132","comment_is_top":false,"comment_ctime":1606401076,"is_pvip":false,"replies":[{"id":"95938","content":"great！感谢你的留言","user_name":"作者回复","user_name_real":"郭朝斌","uid":"2302171","ctime":1606568936,"ip_address":"","comment_id":264274,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5901368372","product_id":100063601,"comment_content":"经实践SSL 证书已经可用，利用mqtts发布和订阅消息成功。","like_count":1,"discussions":[{"author":{"id":2302171,"avatar":"https://static001.geekbang.org/account/avatar/00/23/20/db/b04f43dc.jpg","nickname":"郭朝斌","note":"","ucode":"2969986E1B3851","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":510490,"discussion_content":"great！感谢你的留言","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606568936,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2674368,"avatar":"https://static001.geekbang.org/account/avatar/00/28/ce/c0/cf67c443.jpg","nickname":"林圣斌","note":"","ucode":"B7510F7BB89EC5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394285,"discussion_content":"您好，你测试的是hbmqtt么","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631808151,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":350180,"user_name":"Geek_bobo","can_delete":false,"product_type":"c1","uid":1600334,"ip_address":"","ucode":"41088553477784","user_header":"","comment_is_top":false,"comment_ctime":1656640242,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1656640242","product_id":100063601,"comment_content":"老师您好<br> <br>python3.10.0，websockets==8.1，订阅主题时报错：<br>TypeError: As of 3.10, the *loop* parameter was removed from Event() since it is no longer necessary<br><br>这个该如何解决，我若将websockets升高又会报“TypeError: As of 3.10, the *loop* parameter was removed from Event() since it is no longer necessary”","like_count":0},{"had_liked":false,"id":343467,"user_name":"Geek_58fcf2","can_delete":false,"product_type":"c1","uid":2918421,"ip_address":"","ucode":"3B052EBC012E8B","user_header":"","comment_is_top":false,"comment_ctime":1650862906,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1650862906","product_id":100063601,"comment_content":"学习总结：<br>mqtt协议<br>1.生态丰富<br>2.二进制传输<br>3.适合物联网的模式，发布与订阅<br>3.低功耗<br>4.安全","like_count":0},{"had_liked":false,"id":338170,"user_name":"icekiller","can_delete":false,"product_type":"c1","uid":1306801,"ip_address":"","ucode":"2EE80711505527","user_header":"https://static001.geekbang.org/account/avatar/00/13/f0/b1/2ec47baa.jpg","comment_is_top":false,"comment_ctime":1647334173,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1647334173","product_id":100063601,"comment_content":"客户端c,服务器s<br>(pub0,sub0)(pub0,sub1)(pub0,sub2) 一发一回共2条消息<br><br>(pub1,sub1)(pub1,sub2) c(Publish Message)-&gt;s(Publish Ack)-&gt;s(Publish Message)-&gt;c(Publish Ack)共4条消息<br>(pub1,sub0) c(Publish Message)-&gt;s(Publish Ack)-&gt;s(Publish Message) 共3条消息<br><br>(pub2,sub2) c(Publish Message)-&gt;s(Publish Received)-&gt;s(Publish Message)-&gt;c(Publish Release)-&gt;s(Publish Complete)-&gt;c(Publish Received)-&gt;s(Publish Release)-&gt;c(Pubish Complete) 两组共8条消息<br>(pub2,sub1) c(Publish Message)-&gt;s(Publish Received)-&gt;s(Publish Message)-&gt;c(Publish Release)-&gt;s(Publish Complete)-&gt;c(Publish Ack)共6条消息<br>(pub2,sub0) c(Publish Message)-&gt;s(Publish Received)-&gt;s(Publish Message)-&gt;c(Publish Release)-&gt;s(Publish Complete)共5条消息<br>","like_count":0},{"had_liked":false,"id":335593,"user_name":"阿甘","can_delete":false,"product_type":"c1","uid":1057843,"ip_address":"","ucode":"BC93175B70E05D","user_header":"https://static001.geekbang.org/account/avatar/00/10/24/33/bcf37f50.jpg","comment_is_top":false,"comment_ctime":1645599191,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1645599191","product_id":100063601,"comment_content":"我看老师的整个课程所有的设备交互都是基于MQTT，但是MQTT本质上是一个订阅发布模式，老师会用MQTT来做一些需要返回值（比如查询命令，或者修改命令但是需要知道执行成功与否）的命令下发吗？","like_count":0},{"had_liked":false,"id":330929,"user_name":"新味道","can_delete":false,"product_type":"c1","uid":2227527,"ip_address":"","ucode":"979E3574082CE7","user_header":"https://static001.geekbang.org/account/avatar/00/21/fd/47/499339d1.jpg","comment_is_top":false,"comment_ctime":1642304528,"is_pvip":false,"replies":[{"id":"120883","content":"https:&#47;&#47;mosquitto.org&#47;","user_name":"编辑回复","user_name_real":"编辑","uid":"1000473","ctime":1642383492,"ip_address":"","comment_id":330929,"utype":2}],"discussion_count":1,"race_medal":0,"score":"1642304528","product_id":100063601,"comment_content":"https:&#47;&#47;mqtt.eclipse.org&#47; 打不开。","like_count":0,"discussions":[{"author":{"id":1000473,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/44/19/17fadc62.jpg","nickname":"郭蕾","note":"","ucode":"34F4C07D1C5FE8","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":546643,"discussion_content":"https://mosquitto.org/","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642383493,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":8}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":330928,"user_name":"新味道","can_delete":false,"product_type":"c1","uid":2227527,"ip_address":"","ucode":"979E3574082CE7","user_header":"https://static001.geekbang.org/account/avatar/00/21/fd/47/499339d1.jpg","comment_is_top":false,"comment_ctime":1642304305,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1642304305","product_id":100063601,"comment_content":"MQTT的客户端和broker之间的通信是长连接吗？ 如果客户端断开连接，从broker发给客户端的消息怎么到达客户端？ ","like_count":0},{"had_liked":false,"id":321040,"user_name":"wnz27","can_delete":false,"product_type":"c1","uid":1130122,"ip_address":"","ucode":"BC9ACB6B7C6FD9","user_header":"https://static001.geekbang.org/account/avatar/00/11/3e/8a/891b0e58.jpg","comment_is_top":false,"comment_ctime":1636629524,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1636629524","product_id":100063601,"comment_content":"一个请求建立连接的 CONNECT 类型数据包，头部需要 14 个字节；发布消息的 PUBLISH 类型数据包头部只有 2～4 个字节。 <br>这个咋算的啊老师~~~~","like_count":0},{"had_liked":false,"id":320500,"user_name":"开心点朋友们，人间不值得","can_delete":false,"product_type":"c1","uid":1337568,"ip_address":"","ucode":"4C863AE8B75B2C","user_header":"https://static001.geekbang.org/account/avatar/00/14/68/e0/27d3cafe.jpg","comment_is_top":false,"comment_ctime":1636354731,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1636354731","product_id":100063601,"comment_content":"有个疑问，对于实际情况来说，mqtt的服务是要发布者和订阅者都能访问吗？是不是要暴露在公网上","like_count":0},{"had_liked":false,"id":312460,"user_name":"林圣斌","can_delete":false,"product_type":"c1","uid":2674368,"ip_address":"","ucode":"B7510F7BB89EC5","user_header":"https://static001.geekbang.org/account/avatar/00/28/ce/c0/cf67c443.jpg","comment_is_top":false,"comment_ctime":1631807557,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1631807557","product_id":100063601,"comment_content":"python mqtt broker，就一种hbmqtt么？我测试，发现broker占用的内存越来越大，这个怎么处理？","like_count":0},{"had_liked":false,"id":311536,"user_name":"好好学习","can_delete":false,"product_type":"c1","uid":2762093,"ip_address":"","ucode":"FD34284E7B3556","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/wVt8rC9tr0qg3kM6FZViba1jAlyfYc8tGL4OmOEcaC6FRj6ewrgZjKg92iaxylVDvJziaQ8ia3bSXD95kNITKdvKvg/132","comment_is_top":false,"comment_ctime":1631272137,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1631272137","product_id":100063601,"comment_content":"完全看不懂，物联网工程没学过怎么办(⊙o⊙)！","like_count":0},{"had_liked":false,"id":299066,"user_name":"Theodore","can_delete":false,"product_type":"c1","uid":1055049,"ip_address":"","ucode":"0735C2A64295FC","user_header":"https://static001.geekbang.org/account/avatar/00/10/19/49/9452b2fd.jpg","comment_is_top":false,"comment_ctime":1624446873,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1624446873","product_id":100063601,"comment_content":"既然底层用的是ws协议，那就可以用charles抓包","like_count":0},{"had_liked":false,"id":293069,"user_name":"多襄丸","can_delete":false,"product_type":"c1","uid":1074310,"ip_address":"","ucode":"1AA1497C5A293C","user_header":"https://static001.geekbang.org/account/avatar/00/10/64/86/f5a9403a.jpg","comment_is_top":false,"comment_ctime":1621181413,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1621181413","product_id":100063601,"comment_content":"—非物联网开发者，试着猜一下第二题—<br><br>这种情况下：<br>broker 会根据 publisher 中发送消息的重复标记位 与 subscriber 使用的 qos2 协议进行比较判断，从而确保只发送一次当前消息直至成功；从 pub 方收到的重复消息，不会再尝试重复发送。","like_count":0},{"had_liked":false,"id":290017,"user_name":"假行僧","can_delete":false,"product_type":"c1","uid":1689188,"ip_address":"","ucode":"65461C8705ECDC","user_header":"https://static001.geekbang.org/account/avatar/00/19/c6/64/a8e09695.jpg","comment_is_top":false,"comment_ctime":1619322716,"is_pvip":false,"replies":[{"id":"106705","content":"连接服务器的错误。有更详细的信息吗？","user_name":"作者回复","user_name_real":"郭朝斌","uid":"2302171","ctime":1621760817,"ip_address":"","comment_id":290017,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1619322716","product_id":100063601,"comment_content":"老师，遇到错误MOSQ_ERR_EAI代表什么意思？","like_count":0,"discussions":[{"author":{"id":2302171,"avatar":"https://static001.geekbang.org/account/avatar/00/23/20/db/b04f43dc.jpg","nickname":"郭朝斌","note":"","ucode":"2969986E1B3851","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519089,"discussion_content":"连接服务器的错误。有更详细的信息吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621760817,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":279779,"user_name":"夜吾夜","can_delete":false,"product_type":"c1","uid":1293142,"ip_address":"","ucode":"FC8729883EAD62","user_header":"https://static001.geekbang.org/account/avatar/00/13/bb/56/41cbcda2.jpg","comment_is_top":false,"comment_ctime":1613961798,"is_pvip":false,"replies":[{"id":"102051","content":"2的28次方是多少呢？","user_name":"作者回复","user_name_real":"郭朝斌","uid":"2302171","ctime":1614578665,"ip_address":"","comment_id":279779,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1613961798","product_id":100063601,"comment_content":"如果有第三个字节，那它的最高位表示是否有第四个字节，来和第二个字节、第三个字节一起表示字节总个数。依此类推，还可能有第四个字节、第五个字节，不过这个表示可变头部和消息体的字节个数的部分，最多也只能到第五个字节，所以可以表示的最大数据包长度有 256MB。 这个256MB是怎么计算出来的呢？我不太懂","like_count":0,"discussions":[{"author":{"id":2302171,"avatar":"https://static001.geekbang.org/account/avatar/00/23/20/db/b04f43dc.jpg","nickname":"郭朝斌","note":"","ucode":"2969986E1B3851","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":515868,"discussion_content":"2的28次方是多少呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614578665,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2302541,"avatar":"https://static001.geekbang.org/account/avatar/00/23/22/4d/695c48fb.jpg","nickname":"初相识","note":"","ucode":"5F6CE62CE6D60F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":352741,"discussion_content":"哈哈哈，我当时看到的时候就自己算了一下，2^28","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1614836600,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":279768,"user_name":"大王叫我来巡山","can_delete":false,"product_type":"c1","uid":1323223,"ip_address":"","ucode":"DC23F4F0444F4F","user_header":"https://static001.geekbang.org/account/avatar/00/14/30/d7/4999e677.jpg","comment_is_top":false,"comment_ctime":1613960385,"is_pvip":false,"replies":[{"id":"102052","content":"根据发展阶段来，我们还没有到需要自己开发的阶段","user_name":"作者回复","user_name_real":"郭朝斌","uid":"2302171","ctime":1614578734,"ip_address":"","comment_id":279768,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1613960385","product_id":100063601,"comment_content":"老师,你们公司在现实环境中mqtt broker 是使用类似emq这类成熟的软件么   还是自己开发?","like_count":0,"discussions":[{"author":{"id":2302171,"avatar":"https://static001.geekbang.org/account/avatar/00/23/20/db/b04f43dc.jpg","nickname":"郭朝斌","note":"","ucode":"2969986E1B3851","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":515864,"discussion_content":"根据发展阶段来，我们还没有到需要自己开发的阶段","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614578734,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":278909,"user_name":"天得一以清","can_delete":false,"product_type":"c1","uid":1139453,"ip_address":"","ucode":"5D64EFB882951A","user_header":"https://static001.geekbang.org/account/avatar/00/11/62/fd/711df44c.jpg","comment_is_top":false,"comment_ctime":1613456235,"is_pvip":true,"replies":[{"id":"102063","content":"只要是同一个mqtt协议版本就行","user_name":"作者回复","user_name_real":"郭朝斌","uid":"2302171","ctime":1614580101,"ip_address":"","comment_id":278909,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1613456235","product_id":100063601,"comment_content":"不同版本的client broker能同时做行吗？","like_count":0,"discussions":[{"author":{"id":2302171,"avatar":"https://static001.geekbang.org/account/avatar/00/23/20/db/b04f43dc.jpg","nickname":"郭朝斌","note":"","ucode":"2969986E1B3851","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":515555,"discussion_content":"只要是同一个mqtt协议版本就行","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614580101,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":273001,"user_name":"九三","can_delete":false,"product_type":"c1","uid":1454691,"ip_address":"","ucode":"7D093ED7273CBE","user_header":"https://static001.geekbang.org/account/avatar/00/16/32/63/fa24f92e.jpg","comment_is_top":false,"comment_ctime":1610407417,"is_pvip":false,"replies":[{"id":"99219","content":"在一对多上有相似之处，但不是一个领域的概念","user_name":"作者回复","user_name_real":"郭朝斌","uid":"2302171","ctime":1610777722,"ip_address":"","comment_id":273001,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1610407417","product_id":100063601,"comment_content":"发布 订阅模式可以理解为 观察者或者通知设计模式吗。，都是一对多的关系。","like_count":0,"discussions":[{"author":{"id":2302171,"avatar":"https://static001.geekbang.org/account/avatar/00/23/20/db/b04f43dc.jpg","nickname":"郭朝斌","note":"","ucode":"2969986E1B3851","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":513454,"discussion_content":"在一对多上有相似之处，但不是一个领域的概念","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610777722,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":268411,"user_name":"莹","can_delete":false,"product_type":"c1","uid":1020356,"ip_address":"","ucode":"395C6C4191B091","user_header":"https://static001.geekbang.org/account/avatar/00/0f/91/c4/40609b81.jpg","comment_is_top":false,"comment_ctime":1608184580,"is_pvip":false,"replies":[{"id":"99475","content":"尝试一下mosquitto的URL","user_name":"作者回复","user_name_real":"郭朝斌","uid":"2302171","ctime":1610864699,"ip_address":"","comment_id":268411,"utype":1}],"discussion_count":6,"race_medal":0,"score":"1608184580","product_id":100063601,"comment_content":"我用不加密的mqtt发布&#47;订阅连不上broker，总是timeout，试了很多次，也到网上搜了一下，但没有找到解决办法。有其他小伙伴遇到这个问题吗？也想请教一下老师。<br>[2020-12-16 21:50:17,454] :: WARNING - MQTT connection failed: TimeoutError(60, &quot;Connect call failed (&#39;198.41.30.194&#39;, 1883)&quot;)<br>[2020-12-16 21:50:17,455] :: INFO - Finished processing state new exit callbacks.<br>[2020-12-16 21:50:17,456] :: INFO - Finished processing state disconnected enter callbacks.<br>[2020-12-16 21:50:17,456] :: WARNING - Connection failed: ConnectException(TimeoutError(60, &quot;Connect call failed (&#39;198.41.30.194&#39;, 1883)&quot;))<br>[2020-12-16 21:50:17,456] :: CRITICAL - connection to &#39;mqtt:&#47;&#47;mqtt.eclipse.org:1883&#39; failed: ConnectException(TimeoutError(60, &quot;Connect call failed (&#39;198.41.30.194&#39;, 1883)&quot;))","like_count":0,"discussions":[{"author":{"id":2302171,"avatar":"https://static001.geekbang.org/account/avatar/00/23/20/db/b04f43dc.jpg","nickname":"郭朝斌","note":"","ucode":"2969986E1B3851","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":511937,"discussion_content":"尝试一下mosquitto的URL","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610864699,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1020356,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/91/c4/40609b81.jpg","nickname":"莹","note":"","ucode":"395C6C4191B091","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":335679,"discussion_content":"又尝试了一下似乎是这个url有问题，mqtt.eclipse.org我怎么也连不上；但是换成它页面上给的mqtt.eclipseprojects.io就没有问题。我把这个重新发个评论。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608270417,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1020356,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/91/c4/40609b81.jpg","nickname":"莹","note":"","ucode":"395C6C4191B091","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":335678,"discussion_content":"尝试了好久，为了保险把Python换成了3.8。不过我还是死活运行不了老师的代码：\nhbmqtt_sub --url mqtt://mqtt.eclipse.org:1883 -t /geektime/iot，总是timeout。看了一下hbmqtt的文档https://hbmqtt.readthedocs.io/en/latest/quickstart.html，用它给的这句hbmqtt_pub --url mqtt://test.mosquitto.org -t /test -m some_data就可以，我看他用的mosquitto也没有用端口，实在是不知道为什么会有这种情况","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608270057,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1020356,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/91/c4/40609b81.jpg","nickname":"莹","note":"","ucode":"395C6C4191B091","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":335409,"discussion_content":"又研究半天，看到这个github issue: Python 3.9 Breaks HBMQTT: &#39;Lock&#39; object is not iterable https://github.com/beerfactory/hbmqtt/issues/223，感觉可能和我的问题有点关系，晚些时候我再研究一下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608187946,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":2674368,"avatar":"https://static001.geekbang.org/account/avatar/00/28/ce/c0/cf67c443.jpg","nickname":"林圣斌","note":"","ucode":"B7510F7BB89EC5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1020356,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/91/c4/40609b81.jpg","nickname":"莹","note":"","ucode":"395C6C4191B091","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394287,"discussion_content":"您好，研究了如何了？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631808248,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":335409,"ip_address":""},"score":394287,"extra":""},{"author":{"id":1020356,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/91/c4/40609b81.jpg","nickname":"莹","note":"","ucode":"395C6C4191B091","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2674368,"avatar":"https://static001.geekbang.org/account/avatar/00/28/ce/c0/cf67c443.jpg","nickname":"林圣斌","note":"","ucode":"B7510F7BB89EC5","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394831,"discussion_content":"我另外留了个评论，确实是版本问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632094793,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":394287,"ip_address":""},"score":394831,"extra":""}]}]},{"had_liked":false,"id":266854,"user_name":"怀草诗","can_delete":false,"product_type":"c1","uid":1152145,"ip_address":"","ucode":"78F8B9B4628F15","user_header":"https://static001.geekbang.org/account/avatar/00/11/94/91/6d6ca42f.jpg","comment_is_top":false,"comment_ctime":1607506594,"is_pvip":true,"replies":[{"id":"97091","content":"是broker给订阅者推送消息。broker在中间的位置。","user_name":"作者回复","user_name_real":"郭朝斌","uid":"2302171","ctime":1607756810,"ip_address":"","comment_id":266854,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1607506594","product_id":100063601,"comment_content":"老师，我知道MQTT协议5.0版本实现了请求应答模式。但是我想请教下，在MQTT协议中，订阅者如何主动拉取消费信息？<br>麻烦您看见还能回答下，谢谢","like_count":0,"discussions":[{"author":{"id":2302171,"avatar":"https://static001.geekbang.org/account/avatar/00/23/20/db/b04f43dc.jpg","nickname":"郭朝斌","note":"","ucode":"2969986E1B3851","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":511412,"discussion_content":"是broker给订阅者推送消息。broker在中间的位置。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607756810,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1256330,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEIRm3kWsgiaEXjO0rr0Aiav7o89StFTFSXbLTkEmiaibmnw8EQTejibrtzKla0emibePT0R0KXjFRIpfXrQ/132","nickname":"zhang","note":"","ucode":"BFA19BED5A5322","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":338040,"discussion_content":"不能。但可以使用shadow。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609159764,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1152145,"avatar":"https://static001.geekbang.org/account/avatar/00/11/94/91/6d6ca42f.jpg","nickname":"怀草诗","note":"","ucode":"78F8B9B4628F15","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":336203,"discussion_content":"这个我清楚，哈哈。我其实是想请教订阅者可以主动拉取消费信息么？\n还是谢谢老师回答","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608527503,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":266806,"user_name":"大王叫我来巡山","can_delete":false,"product_type":"c1","uid":1323223,"ip_address":"","ucode":"DC23F4F0444F4F","user_header":"https://static001.geekbang.org/account/avatar/00/14/30/d7/4999e677.jpg","comment_is_top":false,"comment_ctime":1607493229,"is_pvip":false,"replies":[{"id":"97099","content":"hivemq是Java的。<br>从架构看，broker和springboot之间最好有消息队列，没有太直接的关系","user_name":"作者回复","user_name_real":"郭朝斌","uid":"2302171","ctime":1607757519,"ip_address":"","comment_id":266806,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1607493229","product_id":100063601,"comment_content":"有java版本的 mqtt broker 么 最好是springboot开箱即用，且可开发的那种","like_count":0,"discussions":[{"author":{"id":2302171,"avatar":"https://static001.geekbang.org/account/avatar/00/23/20/db/b04f43dc.jpg","nickname":"郭朝斌","note":"","ucode":"2969986E1B3851","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":511394,"discussion_content":"hivemq是Java的。\n从架构看，broker和springboot之间最好有消息队列，没有太直接的关系","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607757519,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":265508,"user_name":"Felix","can_delete":false,"product_type":"c1","uid":1018291,"ip_address":"","ucode":"5B3613FADC2E25","user_header":"https://static001.geekbang.org/account/avatar/00/0f/89/b3/446b877d.jpg","comment_is_top":false,"comment_ctime":1606918267,"is_pvip":false,"replies":[{"id":"96551","content":"实际抓包试一下，不复杂，掌握的更深","user_name":"作者回复","user_name_real":"郭朝斌","uid":"2302171","ctime":1606966615,"ip_address":"","comment_id":265508,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1606918267","product_id":100063601,"comment_content":"发布着选择忽略PUBACK?<br>如果反过来，发布者选择QoS等级是2，订阅者选择QoS等级是1呢？发布者就会重复发布同样的消息？<br>————————<br>如果 Client 发布消息时选择的 QoS 等级是 1 ，而订阅者在订阅这个主题消息时选择的 QoS 等级是 2 ，这种情况下 Broker 会怎么处理呢？<br><br>","like_count":0,"discussions":[{"author":{"id":2302171,"avatar":"https://static001.geekbang.org/account/avatar/00/23/20/db/b04f43dc.jpg","nickname":"郭朝斌","note":"","ucode":"2969986E1B3851","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":510957,"discussion_content":"实际抓包试一下，不复杂，掌握的更深","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606966615,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":263929,"user_name":"il李li","can_delete":false,"product_type":"c1","uid":1338637,"ip_address":"","ucode":"2193A7E41DEC68","user_header":"https://static001.geekbang.org/account/avatar/00/14/6d/0d/71053329.jpg","comment_is_top":false,"comment_ctime":1606296193,"is_pvip":false,"replies":[{"id":"95945","content":"broker只是中间人，如何保证订阅者可以QoS2呢？<br>","user_name":"作者回复","user_name_real":"郭朝斌","uid":"2302171","ctime":1606570233,"ip_address":"","comment_id":263929,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1606296193","product_id":100063601,"comment_content":"MQTT Broker 根据客户端建立连接时选择的QoS级别与客户端交互，也即是与发布消息的Client按照QoS=1 （至少一次）处理，broker将消息推送给订阅这个主题的Clien时选择 QoS=2（只有一次）来处理","like_count":0,"discussions":[{"author":{"id":2302171,"avatar":"https://static001.geekbang.org/account/avatar/00/23/20/db/b04f43dc.jpg","nickname":"郭朝斌","note":"","ucode":"2969986E1B3851","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":510352,"discussion_content":"broker只是中间人，如何保证订阅者可以QoS2呢？\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606570233,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}