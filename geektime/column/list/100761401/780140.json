{"id":780140,"title":"14ï½œåˆ—è¡¨ï¼ˆä¸‹ï¼‰ï¼šåˆ—è¡¨æ‰€æ”¯æŒçš„åŸºæœ¬æ“ä½œ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯æµ·çº³ã€‚</p><p>ä¸ŠèŠ‚è¯¾æˆ‘ä»¬ä»‹ç»äº†åˆ—è¡¨çš„åŸºæœ¬å®ç°ï¼Œåˆæ­¥å®ç°äº†å¾€åˆ—è¡¨ä¸­å¢åŠ æ–°å…ƒç´ ã€ä¿®æ”¹åˆ—è¡¨ä¸­çš„å…ƒç´ ç­‰åŠŸèƒ½ã€‚è¿™èŠ‚è¯¾æˆ‘ä»¬ä¼šç»§ç»­å®ç°åˆ—è¡¨æ”¯æŒçš„å…¶ä»–åŸºæœ¬æ“ä½œï¼Œä¸»è¦åŒ…æ‹¬åˆ é™¤å…ƒç´ ã€å¯¹å…ƒç´ è¿›è¡Œæ’åºï¼Œä»¥åŠè¿­ä»£è®¿é—®åˆ—è¡¨å…ƒç´ ç­‰åŠŸèƒ½ã€‚</p><h2>åˆ é™¤å…ƒç´ </h2><p>ä»åˆ—è¡¨ä¸­åˆ é™¤å…ƒç´ ï¼Œå¦‚æœæ˜¯åˆ é™¤æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ list çš„ pop æ–¹æ³•ã€‚pop æ–¹æ³•ä¸ append æ–¹æ³•åˆšå¥½æ˜¯ä¸€å¯¹é€†æ“ä½œã€‚append ç”¨æ¥åœ¨åˆ—è¡¨çš„æœ«å°¾æ·»åŠ å…ƒç´ ï¼Œè€Œ pop åˆ™æ˜¯åˆ é™¤åˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ ã€‚</p><p>è€Œåˆ é™¤æŒ‡å®šä½ç½®çš„å…ƒç´ æœ‰ä¸¤ç§æ–¹æ³•ï¼Œä¸€ç§æ˜¯ä½¿ç”¨ del å…³é”®å­—ï¼Œå¦ä¸€ç§æ˜¯ä½¿ç”¨åˆ—è¡¨çš„ remove æ–¹æ³•ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€ä¸ªå®ç°å®ƒä»¬ã€‚å…ˆä» pop æ–¹æ³•å¼€å§‹ã€‚</p><h3>å®ç° pop æ–¹æ³•</h3><p>å…ˆä½¿ç”¨ C++ å®ç° list_pop å‡½æ•°ï¼Œç”¨äºå°†åˆ—è¡¨æœ«å°¾çš„å…ƒç´ åˆ é™¤ã€‚list_pop åªéœ€è¦ç®€å•åœ°è°ƒç”¨åˆ—è¡¨å¯¹è±¡ä¸Šçš„ pop æ–¹æ³•å³å¯ã€‚è€Œ pop æ–¹æ³•åœ¨<a href=\"https://time.geekbang.org/column/article/772694\">ç¬¬ 4 èŠ‚è¯¾</a>ä¸­å®šä¹‰ list çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å·²ç»å®ç°äº†ã€‚</p><pre><code class=\"language-c++\">HiObject* list_pop(ObjList args) {\n&nbsp; &nbsp; HiList* list = (HiList*)(args-&gt;get(0));\n&nbsp; &nbsp; assert(list &amp;&amp; list-&gt;klass() == ListKlass::get_instance());\n&nbsp; &nbsp; return list-&gt;pop();\n}\n</code></pre><!-- [[[read_end]]] --><p>ç¬¬äºŒæ­¥ï¼Œåœ¨ ListKlass çš„æ„é€ æ–¹æ³•é‡Œï¼ŒæŠŠå­—ç¬¦ä¸² <code>â€œpopâ€</code> ä¸è¿™ä¸ª native æ–¹æ³•å…³è”åœ¨ä¸€èµ·ã€‚</p><pre><code class=\"language-c++\">ListKlass::ListKlass() {\n&nbsp; &nbsp; HiDict * klass_dict = new HiDict();\n&nbsp; &nbsp; klass_dict-&gt;put(new HiString(\"append\"),&nbsp;\n&nbsp; &nbsp; &nbsp; &nbsp; new FunctionObject(list_append));\n&nbsp; &nbsp; klass_dict-&gt;put(new HiString(\"pop\"),&nbsp;\n&nbsp; &nbsp; &nbsp; &nbsp; new FunctionObject(list_pop));\n&nbsp; &nbsp; set_klass_dict(klass_dict);\n}\n</code></pre><p>ä»ä»£ç é‡Œï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ·»åŠ  pop æ–¹æ³•ä¸æ·»åŠ  append æ–¹æ³•è¦åšçš„äº‹æƒ…å‡ ä¹æ˜¯ä¸€æ ·çš„ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†çœ‹ä¸€ä¸‹ä½¿ç”¨ del å…³é”®å­—åˆ é™¤æŒ‡å®šçš„åˆ—è¡¨å…ƒç´ ã€‚</p><h3>å®ç° del å…³é”®å­—</h3><p>å…³é”®å­— del ä¸åŒäºæ–¹æ³•ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œé‡åˆ°å…³é”®å­—éƒ½ä¼šå¼•å…¥æ–°çš„å­—èŠ‚ç ã€‚æ‰€ä»¥æˆ‘ä»¬è¿˜æ˜¯åˆ›å»ºä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œç„¶åè§‚å¯Ÿå®ƒçš„å­—èŠ‚ç ã€‚</p><pre><code class=\"language-plain\">l = [4, 1, 2, 3]\ndel l[0]\n&nbsp;17&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 56 LOAD_NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 (l)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;59 LOAD_CONST&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4 (0)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;62 DELETE_SUBSCR&nbsp; &nbsp; &nbsp; &nbsp;\n</code></pre><p>ä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹ï¼Œæˆ‘æŠŠ Python æºä»£ç å’Œå­—èŠ‚ç æ”¾åœ¨ä¸€èµ·äº†ã€‚æ³¨æ„ä¸Šè¿°ä»£ç çš„æœ€åä¸€è¡Œï¼Œå‡ºç°äº†æ–°çš„å­—èŠ‚ç ï¼š<strong>DELETE_SUBSCR</strong> ã€‚è¿™ä¸ªå­—èŠ‚ç æ˜¯ä¸å¸¦å‚æ•°çš„ï¼Œå®ƒçš„å‚æ•°éƒ½åœ¨æ“ä½œæ•°æ ˆä¸Šã€‚</p><p>æ ˆé¡¶ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯æ•´æ•° 0ï¼Œä¹Ÿå°±æ˜¯åºå·ï¼Œæ ˆé¡¶ç¬¬äºŒä¸ªå…ƒç´ æ˜¯åˆ—è¡¨å¯¹è±¡ã€‚è€Œä¸”è¿™ä¸ªå­—èŠ‚ç æ²¡æœ‰è¿”å›å€¼ï¼Œæ‰€ä»¥ä¹Ÿå°±ä¸ç”¨å†æŠŠä»»ä½•å€¼é€å›åˆ°æ ˆä¸Šäº†ã€‚æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå®ç°è¿™ä¸ªå­—èŠ‚ç ï¼š</p><pre><code class=\"language-c++\">void Interpreter::run(CodeObject* codes) {\n&nbsp; &nbsp; _frame = new FrameObject(codes);\n\tHiObject *v, *w, *u;\n\t...\n&nbsp; &nbsp; while (_frame-&gt;has_more_codes()) {\n\t&nbsp; &nbsp; unsigned char op_code = _frame-&gt;get_op_code();\n&nbsp; &nbsp; &nbsp; &nbsp; ...\n&nbsp; &nbsp; &nbsp; &nbsp; switch (op_code) {\n\t\t...\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case ByteCode::DELETE_SUBSCR:\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; w = POP();\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; v = POP();\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; v-&gt;del_subscr(w);\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;\n&nbsp; &nbsp; &nbsp; &nbsp; ...\n&nbsp; &nbsp; &nbsp; &nbsp; }\n&nbsp; &nbsp; }\n}\n</code></pre><p>ä»ä»£ç é‡Œå¯ä»¥çœ‹åˆ°ï¼Œvã€w éƒ½æ˜¯æŒ‡å‘ HiObject çš„æŒ‡é’ˆï¼Œè¿™å°±è¦æ±‚æˆ‘ä»¬è¦åœ¨ HiObject é‡Œæ·»åŠ  del_subscr æ–¹æ³•ã€‚è¿™ä¸ªé€»è¾‘æ¨æ¼”å’Œä¸Šä¸€èŠ‚è¯¾ä¸­çš„ store_subscr æ–¹æ³•æ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚ä¸‹é¢æˆ‘ç»™å‡ºäº† del_subscr æ–¹æ³•çš„å…·ä½“ä»£ç å®ç°ï¼Œä½ å¯ä»¥å‚è€ƒã€‚</p><pre><code class=\"language-c++\">// object/hiObject.cpp\nvoid HiObject::del_subscr(HiObject* x) {\n&nbsp; &nbsp; klass()-&gt;del_subscr(this, x);\n}\n\n// object/klass.hpp\nclass Klass {\nprivate:\n&nbsp; &nbsp; Klass*&nbsp; &nbsp; &nbsp; &nbsp; _super;\n&nbsp; &nbsp; HiString*&nbsp; &nbsp; &nbsp;_name;\n&nbsp; &nbsp; HiDict*&nbsp; &nbsp; &nbsp; &nbsp;_klass_dict;\n\npublic:\n&nbsp; &nbsp; ...\n&nbsp; &nbsp; virtual void del_subscr&nbsp; &nbsp; (HiObject* x, HiObject* y) { return; }\n};\n</code></pre><p>ç„¶åï¼Œæˆ‘ä»¬åœ¨ ListKlass ä¸­å®ç°è¿™ä¸ªè™šå‡½æ•°ã€‚</p><pre><code class=\"language-c++\">// object/hiList.hpp\nclass ListKlass : public Klass {\npublic:\n&nbsp; &nbsp; ...\n&nbsp; &nbsp; virtual void del_subscr (HiObject* x, HiObject* y);\n};\n\n// object/hiList.cpp\nvoid ListKlass::del_subscr(HiObject* x, HiObject* y) {\n&nbsp; &nbsp; assert(x &amp;&amp; x-&gt;klass() == (Klass*) this);\n&nbsp; &nbsp; assert(y &amp;&amp; y-&gt;klass() == IntegerKlass::get_instance());\n\n&nbsp; &nbsp; HiList * lx = (HiList*)x;\n&nbsp; &nbsp; HiInteger* iy = (HiInteger*)y;\n&nbsp; &nbsp;&nbsp;\n&nbsp; &nbsp; lx-&gt;inner_list()-&gt;delete_index(iy-&gt;value());\n}\n\n// util/arrayList.cpp\ntemplate &lt;typename T&gt;\nvoid ArrayList&lt;T&gt;::delete_index(int index) {\n&nbsp; &nbsp; for (int i = index; i + 1 &lt; _length; i++) {\n&nbsp; &nbsp; &nbsp; &nbsp; _array[i] = _array[i+1];\n&nbsp; &nbsp; }\n&nbsp; &nbsp; _length--;\n}\n</code></pre><p>delete_index çš„ä½œç”¨æ˜¯ä» ArrayList ä¸­åˆ é™¤æŒ‡å®šä½ç½®çš„å…ƒç´ ï¼ˆç¬¬ 20 è‡³ 26 è¡Œï¼‰ã€‚ç”±äºå…¶å†…éƒ¨çš„æ•°æ®ç»“æ„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œåœ¨åˆ é™¤çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¿…é¡»æŠŠåé¢çš„å…ƒç´ å‘å‰ç§»ï¼Œè¦†ç›–æ‰è¢«åˆ é™¤çš„é‚£ä¸ªå…ƒç´ ã€‚åœ¨å®Œæˆè¿™ä¸ªæ“ä½œä»¥åï¼Œå†æŠŠ _length å‡ 1ã€‚è¿™æ ·ï¼Œdel å…³é”®å­—åˆ é™¤å…ƒç´ çš„åŠŸèƒ½å°±å…¨éƒ¨å®Œæˆäº†ã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬å…³æ³¨ remove æ–¹æ³•çš„å®ç°ã€‚è¿™ä¸ªæ–¹æ³•æ¥å—ä¸€ä¸ªå‚æ•°ï¼ŒæŠŠåˆ—è¡¨é‡Œå’Œè¿™ä¸ªå‚æ•°ç›¸ç­‰çš„å€¼åˆ é™¤æ‰ã€‚ä¾‹å¦‚ï¼š</p><pre><code class=\"language-python\">l = [\"hello\", \"world\", \"hello\"]\nl.remove(\"hello\")\nprint(l) # [\"world\"]\n</code></pre><p>åœ¨åˆ—è¡¨ä¸­æ·»åŠ ä¸€ä¸ª native æ–¹æ³•æˆ‘ä»¬å·²ç»åšè¿‡å¾ˆå¤šæ¬¡äº†ã€‚å¯¹ ListKlass æ„é€ å‡½æ•°çš„ä¿®æ”¹ï¼Œè¿™é‡Œå°±ä¸å†åˆ—å‡ºäº†ï¼Œä¸ºäº†ç»ƒæ‰‹ï¼Œä½ å¯ä»¥è‡ªå·±å®ç°ã€‚</p><p>è¿™é‡Œé‡ç‚¹å…³æ³¨ä¸€ä¸‹ list_remove æ–¹æ³•çš„å®ç°ã€‚</p><pre><code class=\"language-bash\">HiObject* list_remove(ObjList args) {\n&nbsp; &nbsp; HiList* list = (HiList*)(args-&gt;get(0));\n&nbsp; &nbsp; HiObject* target = (HiObject*)(args-&gt;get(1));\n\n&nbsp; &nbsp; assert(list &amp;&amp; list-&gt;klass() == ListKlass::get_instance());\n\n&nbsp; &nbsp; for (int i = 0; i &lt; list-&gt;inner_list()-&gt;size(); i++) {\n&nbsp; &nbsp; &nbsp; &nbsp; if (list-&gt;get(i)-&gt;equal(target) == (HiObject*)Universe::HiTrue) {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; list-&gt;inner_list()-&gt;delete_index(i);\n&nbsp; &nbsp; &nbsp; &nbsp; }\n&nbsp; &nbsp; }\n\n&nbsp; &nbsp; return Universe::HiNone;\n}\n</code></pre><p>ä¸Šè¿°ä»£ç ä½¿ç”¨ equal æ¯”è¾ƒåˆ—è¡¨ä¸­çš„å…ƒç´ ä¸è¾“å…¥å‚æ•° target æ˜¯å¦ç›¸ç­‰ï¼ˆç¬¬ 8 è¡Œï¼‰ã€‚å¦‚æœç›¸ç­‰ï¼Œequal æ–¹æ³•çš„è¿”å›å€¼å°±æ˜¯ HiTrueï¼Œå¦åˆ™å°±æ˜¯ HiFalseã€‚å½“å…ƒç´ ä¸å‚æ•°ç›¸ç­‰æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç›´æ¥è°ƒç”¨ delete_index æ–¹æ³•å°†å…ƒç´ åˆ é™¤ã€‚</p><p>åˆ°è¿™é‡Œï¼Œåˆ é™¤å…ƒç´ çš„æ‰€æœ‰æ–¹æ³•æˆ‘ä»¬å°±å…¨éƒ¨å®ç°äº†ã€‚æœ€åæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹çš„æµ‹è¯•ç”¨ä¾‹è¿›è¡Œç»¼åˆæµ‹è¯•ï¼š</p><pre><code class=\"language-python\">l = [4, 1, 2, 3]\nl.remove(2)\nprint(l)&nbsp; &nbsp; &nbsp; &nbsp;# [4, 1, 3]\nl[0] = 3\nprint(l)&nbsp; &nbsp; &nbsp; &nbsp;# [3, 1, 3]\ndel l[0]\nprint(l)&nbsp; &nbsp; &nbsp; &nbsp;# [1, 3]\nprint(l.pop()) # 3\nprint(l)&nbsp; &nbsp; &nbsp; &nbsp;# [1]\n</code></pre><p>ä½ è‡ªå·±è¿è¡Œä¸€ä¸‹è¿™ä¸ªä¾‹å­ï¼Œçœ‹çœ‹è‡ªå·±çš„æµ‹è¯•ç»“æœæ˜¯å¦ä¸é¢„æœŸç›¸ç¬¦ã€‚</p><h2>å¯¹åˆ—è¡¨å…ƒç´ è¿›è¡Œæ’åº</h2><p>åˆ—è¡¨ä¸­æœ‰ä¸¤ä¸ªæ–¹æ³•ä¸åˆ—è¡¨å…ƒç´ çš„åºåˆ—æœ‰å…³ï¼Œä¸€ä¸ªæ˜¯ reverseï¼Œä¸€ä¸ªæ˜¯ sortã€‚reverse æ–¹æ³•ç”¨æ¥æŠŠåˆ—è¡¨ä¸­çš„æ‰€æœ‰å…ƒç´ å€’åºã€‚sort ç”¨æ¥æŠŠåˆ—è¡¨ä¸­çš„å…ƒç´ æŒ‰ä»å°åˆ°å¤§çš„é¡ºåºæ’åˆ—ï¼Œä¹Ÿå°±æ˜¯å‡åºã€‚</p><p>reverse æ˜¯åˆ—è¡¨çš„ä¸€ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹æ·»åŠ  reverse æ–¹æ³•çš„è¿‡ç¨‹ã€‚</p><pre><code class=\"language-c++\">ListKlass::ListKlass() {\n&nbsp; &nbsp; HiDict * klass_dict = new HiDict();\n&nbsp; &nbsp; ...\n&nbsp; &nbsp; klass_dict-&gt;put(new HiString(\"reverse\"),&nbsp;\n&nbsp; &nbsp; &nbsp; &nbsp; new FunctionObject(list_reverse));\n&nbsp; &nbsp; set_klass_dict(klass_dict);\n}\n\nHiObject* list_reverse(ObjList args) {\n&nbsp; &nbsp; HiList* list = (HiList*)(args-&gt;get(0));\n\n&nbsp; &nbsp; int i = 0;\n&nbsp; &nbsp; int j = list-&gt;size() - 1;\n&nbsp; &nbsp; while (i &lt; j) {\n&nbsp; &nbsp; &nbsp; &nbsp; HiObject* t = list-&gt;get(i);\n&nbsp; &nbsp; &nbsp; &nbsp; list-&gt;set(i, list-&gt;get(j));\n&nbsp; &nbsp; &nbsp; &nbsp; list-&gt;set(j, t);\n\n&nbsp; &nbsp; &nbsp; &nbsp; i++;\n&nbsp; &nbsp; &nbsp; &nbsp; j--;\n&nbsp; &nbsp; }\n\n&nbsp; &nbsp; return Universe::HiNone;\n}\n</code></pre><p>è¿™æ®µä»£ç çš„é€»è¾‘æ˜¯è¿™æ ·çš„ï¼Œi æŒ‡å‘åˆ—è¡¨å¤´ï¼Œj æŒ‡å‘åˆ—è¡¨å°¾ï¼Œä¸åœåœ°äº¤æ¢å‰åŠéƒ¨åˆ†å…ƒç´ å’ŒååŠéƒ¨åˆ†å…ƒç´ ï¼Œç›´åˆ° i ä¸å†æŒ‡å‘å‰åŠéƒ¨åˆ†ï¼ˆç¬¬ 14 è‡³ç¬¬ 21 è¡Œï¼‰ã€‚ä»£ç çš„å…¶ä»–éƒ¨åˆ†æ¯”è¾ƒç®€å•ï¼Œè¿™é‡Œæˆ‘å°±ä¸è¿‡å¤šè§£é‡Šäº†ã€‚</p><p>æ¥ä¸‹æ¥æ˜¯ sort æ–¹æ³•ã€‚ç»å¤§å¤šæ•°çš„æ’åºç®—æ³•éƒ½æ˜¯åŸºäºæ¯”è¾ƒçš„ï¼Œå°±æ˜¯è¯´ï¼Œå¦‚æœè¦æŠŠæ‰€æœ‰å…ƒç´ æŒ‰ç…§ä»å°åˆ°å¤§å‡åºæ’åˆ—ï¼Œå¾—å…ˆå®šä¹‰å¤§å’Œå°ã€‚ä¸¤ä¸ªå…ƒç´ èƒ½æ¯”è¾ƒå¤§å°äº†ï¼Œå®ƒä»¬çš„å…ˆåé¡ºåºä¹Ÿå°±å†³å®šäº†ã€‚æ‰€ä»¥ï¼Œ<strong>æˆ‘ä»¬è¦è§£å†³çš„ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯åˆ—è¡¨çš„å…ƒç´ å¯ä»¥æ¯”è¾ƒå¤§å°</strong>ã€‚</p><p>åœ¨ HiObject ä¸­ï¼Œæˆ‘ä»¬å·²ç»å®šä¹‰å¥½äº† lessã€greater ç­‰æ–¹æ³•ç”¨æ¥æ¯”è¾ƒå¯¹è±¡å¤§å°ã€‚å¹¶ä¸”åœ¨ IntegerKlass ä¸­å®ç°äº†ç›¸åº”çš„æ–¹æ³•ã€‚</p><p>Python 2.7 æ”¯æŒä¸åŒç±»å‹çš„å¯¹è±¡ç›¸äº’æ¯”è¾ƒå¤§å°ã€‚å®ƒçš„è§„åˆ™æ˜¯ï¼Œæ•´æ•°ç±»å‹æ¯”å…¶ä»–æ‰€æœ‰ç±»å‹éƒ½å°ã€‚å…¶ä»–ç±»å‹ä¹‹é—´ç›¸äº’æ¯”è¾ƒçš„æ—¶å€™æŒ‰ç…§ç±»å‹åç§°çš„å­—ç¬¦ä¸²æ¯”è¾ƒè§„åˆ™è¿›è¡Œæ¯”è¾ƒã€‚ä¾‹å¦‚ï¼Œåˆ—è¡¨çš„ç±»å‹åç§°æ˜¯listï¼Œå­—ç¬¦ä¸²ç±»çš„ç±»å‹åç§°æ˜¯strã€‚è¿™ä¸¤ä¸ªç±»åç§°çš„å­—ç¬¦ä¸²è¿›è¡Œæ¯”è¾ƒæ—¶ï¼Œlistå°äºstrï¼Œè¿™å°±æ„å‘³ç€æ‰€æœ‰çš„åˆ—è¡¨å¯¹è±¡éƒ½æ¯”å­—ç¬¦ä¸²å¯¹è±¡å°ã€‚</p><p>ä½†åœ¨ Python 3.8 ä¸­ï¼Œè¿™ä¸ªè§„åˆ™è¢«ä¼˜åŒ–äº†ï¼Œä¸å†æ”¯æŒä¸åŒç±»å‹çš„å¯¹è±¡ä¹‹é—´è¿›è¡Œæ¯”è¾ƒå’Œæ’åºã€‚ä¹Ÿå°±æ˜¯è¯´åªæœ‰æ¯”è¾ƒæ“ä½œç¬¦ä¸¤è¾¹çš„æ“ä½œæ•°ç±»å‹æ˜¯ç›¸åŒçš„ï¼Œæ‰å¯ä»¥ç›¸äº’æ¯”è¾ƒï¼Œå¦‚æœæ¯”è¾ƒçš„å¯¹è±¡æ˜¯ä¸åŒç±»å‹çš„ï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ä½†æˆ‘ä»¬ç°åœ¨è¿˜æ²¡æœ‰å®ç°å¼‚å¸¸ï¼Œæ‰€ä»¥å°±ç›´æ¥ assert å¤±è´¥é€€å‡ºç¨‹åºäº†ã€‚</p><p>åœ¨ææ¸…æ¥šè¿™äº›è§„åˆ™ä»¥åï¼Œæˆ‘ä»¬å†æ¥å®ç° sort æ–¹æ³•ã€‚</p><pre><code class=\"language-c++\">ListKlass::ListKlass() {\n&nbsp; &nbsp; HiDict * klass_dict = new HiDict();\n&nbsp; &nbsp; ...\n&nbsp; &nbsp; klass_dict-&gt;put(new HiString(\"sort\"),&nbsp;\n&nbsp; &nbsp; &nbsp; &nbsp; new FunctionObject(list_sort));\n&nbsp; &nbsp; set_klass_dict(klass_dict);\n\n&nbsp; &nbsp; set_name(new HiString(\"list\"));\n}\n\nHiObject* list_sort(ObjList args) {\n&nbsp; &nbsp; HiList* list = (HiList*)(args-&gt;get(0));\n&nbsp; &nbsp; assert(list &amp;&amp; list-&gt;klass() == ListKlass::get_instance());\n\n&nbsp; &nbsp; // bubble sort\n&nbsp; &nbsp; for (int i = 0; i &lt; list-&gt;size(); i++) {\n&nbsp; &nbsp; &nbsp; &nbsp; for (int j = list-&gt;size() - 1; j &gt; i; j--) {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (list-&gt;get(j)-&gt;less(list-&gt;get(j-1)) == Universe::HiTrue) {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HiObject* t = list-&gt;get(j);\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; list-&gt;set(j, list-&gt;get(j-1));\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; list-&gt;set(j-1, t);\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }\n&nbsp; &nbsp; &nbsp; &nbsp; }\n&nbsp; &nbsp; }\n\n&nbsp; &nbsp; return Universe::HiNone;\n}\n</code></pre><p>list_sort æ˜¯åˆ—è¡¨çš„ sort æ–¹æ³•çš„çœŸæ­£å®ç°ã€‚åœ¨ list_sort ä¸­ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†<strong>å†’æ³¡æ’åºç®—æ³•</strong>ï¼Œè¿™æ˜¯ä¸€ç§æœ€ç®€å•çš„æ’åºç®—æ³•ã€‚å®ƒé‡å¤åœ°è®¿é—®è¦æ’åºçš„å…ƒç´ åºåˆ—ï¼Œä¾æ¬¡æ¯”è¾ƒä¸¤ä¸ªç›¸é‚»çš„å…ƒç´ ï¼Œå¦‚æœä»–ä»¬çš„é¡ºåºé”™è¯¯ï¼Œå¦‚ä»å°åˆ°å¤§æ’åºæ—¶ï¼Œæ›´å¤§çš„æ•°åœ¨å‰è¾¹ï¼Œå°±æŠŠå®ƒä»¬äº¤æ¢è¿‡æ¥ã€‚</p><p>è®¿é—®å…ƒç´ çš„å·¥ä½œä¼šé‡å¤è¿›è¡Œï¼Œç›´åˆ°æ²¡æœ‰ç›¸é‚»å…ƒç´ éœ€è¦äº¤æ¢ã€‚è¿™ä¸ªç®—æ³•åå­—çš„ç”±æ¥æ˜¯å› ä¸ºè¶Šå°çš„å…ƒç´ ä¼šç»è¿‡äº¤æ¢æ…¢æ…¢â€œæµ®â€åˆ°æ•°åˆ—çš„é¡¶ç«¯ï¼Œå°±å¦‚åŒæ°´ä¸­çš„æ°”æ³¡æœ€ç»ˆä¼šä¸Šæµ®åˆ°é¡¶ç«¯ä¸€æ ·ï¼Œæ‰€ä»¥å«ä½œâ€œå†’æ³¡æ’åºâ€ã€‚</p><p>è¿™é‡Œä½ å¯ä»¥å°è¯•ç€ä½¿ç”¨<strong>å¿«æ’æˆ–è€…å †æ’åº</strong>æ¥æ›¿æ¢å†’æ³¡æ’åºç®—æ³•ï¼Œä»è€Œä½¿ list çš„æ’åºæ•ˆç‡æ›´é«˜ã€‚</p><p>ä¸ºäº†è®©åˆ—è¡¨å¯¹è±¡ç›¸äº’ä¹‹é—´èƒ½å¤Ÿæ¯”è¾ƒï¼Œæˆ‘ä»¬è¿˜è¦ä¸ºåˆ—è¡¨å¢åŠ æ¯”è¾ƒçš„æ–¹æ³•ã€‚</p><pre><code class=\"language-c++\">HiObject* ListKlass::less(HiObject* x, HiObject* y) {\n&nbsp; &nbsp; HiList * lx = (HiList*)x;\n&nbsp; &nbsp; HiList * ly = (HiList*)y;\n\n&nbsp; &nbsp; assert(lx &amp;&amp; lx-&gt;klass() == (Klass*) this);\n&nbsp; &nbsp; assert(ly &amp;&amp; ly-&gt;klass() == (Klass*) this);\n\n&nbsp; &nbsp; int len = lx-&gt;size() &lt; ly-&gt;size() ?\n&nbsp; &nbsp; &nbsp; &nbsp; lx-&gt;size() : ly-&gt;size();\n\n&nbsp; &nbsp; for (int i = 0; i &lt; len; i++) {\n&nbsp; &nbsp; &nbsp; &nbsp; if (lx-&gt;get(i)-&gt;less(ly-&gt;get(i)) == Universe::HiTrue) {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return Universe::HiTrue;\n&nbsp; &nbsp; &nbsp; &nbsp; }\n&nbsp; &nbsp; &nbsp; &nbsp; else if (lx-&gt;get(i)-&gt;equal(ly-&gt;get(i)) != Universe::HiTrue) {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return Universe::HiFalse;\n&nbsp; &nbsp; &nbsp; &nbsp; }\n&nbsp; &nbsp; }\n\n&nbsp; &nbsp; if (lx-&gt;size() &lt; ly-&gt;size())\n&nbsp; &nbsp; &nbsp; &nbsp; return Universe::HiTrue;\n\n&nbsp; &nbsp; return Universe::HiFalse;\n}\n</code></pre><p>åˆ—è¡¨æ¯”è¾ƒçš„é€»è¾‘ä¸å­—ç¬¦ä¸²æ¯”è¾ƒçš„é€»è¾‘ååˆ†ç›¸ä¼¼ã€‚é¦–å…ˆæ£€æŸ¥ä¸¤ä¸ªå¯¹è±¡çš„ç±»å‹æ˜¯å¦ç›¸åŒï¼Œå¦‚æœä¸ç›¸åŒï¼Œå°±å…ˆæ¯”è¾ƒç±»å‹çš„å¤§å°ã€‚å¦‚æœç±»å‹ç›¸åŒï¼Œå°±é€ä¸ªå…ƒç´ è¿›è¡Œæ¯”è¾ƒã€‚</p><p>æ¯”è¾ƒçš„è§„åˆ™æ˜¯ï¼Œåœ¨ x æŸä½ç½®ä¸Šçš„å…ƒç´ å¦‚æœå°äº y ç›¸åŒä½ç½®ä¸Šçš„å…ƒç´ ï¼Œå°±å¯ä»¥ç›´æ¥è¿”å› Trueã€‚x æŸä½ç½®ä¸Šçš„å…ƒç´ å¦‚æœå¤§äº y ç›¸åŒä½ç½®ä¸Šçš„å…ƒç´ ï¼Œå°±è¿”å› Falseã€‚å¦‚æœåœ¨ç›¸åŒä½ç½®ä¸Šçš„å…ƒç´ ç›¸ç­‰ï¼Œé‚£å°±ç»§ç»­æ¯”è¾ƒä¸‹ä¸€ä½ã€‚å¦‚æœæ‰€æœ‰ä½ç½®ä¸Šçš„å…ƒç´ éƒ½ç›¸ç­‰ï¼Œä½†æ˜¯ x å’Œ y çš„é•¿åº¦ä¸åŒï¼Œé‚£ä¹ˆæ›´çŸ­çš„é‚£ä¸ªåˆ—è¡¨æ›´å°ã€‚</p><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æµ‹è¯•ç”¨ä¾‹æ¥æ£€æŸ¥æˆ‘ä»¬çš„å®ç°æ˜¯å¦æ­£ç¡®ã€‚</p><pre><code class=\"language-python\">a = [1, 3, 2, 5, 4]\nc = [1, 3]\nb = [\"a\", \"z\", \"hello\", \"world\"]\n\na.sort()\nprint(a)\nb.sort()\nprint(b)\nprint(a &lt; c)\n</code></pre><h2>éå†åˆ—è¡¨å…ƒç´ </h2><p>åˆ—è¡¨è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„æœºåˆ¶ï¼Œåœ¨ Python ç¼–ç¨‹å®è·µä¸­ä½¿ç”¨é¢‘ç‡éå¸¸é«˜çš„<strong>éå†</strong>ã€‚åœ¨è®²è§£æ§åˆ¶æµçš„æ—¶å€™ï¼Œæˆ‘ä»¬åªè®²è§£äº† while å¾ªç¯ï¼Œæ²¡æœ‰ä½¿ç”¨ for å…³é”®å­—ï¼Œè¿™æ˜¯å› ä¸º for å…³é”®å­—è¦ä¾èµ–æ›´å¤šçš„æ•°æ®ç»“æ„ã€‚</p><p>æˆ‘ä»¬ç”¨ä¸€ä¸ªä¾‹å­æ¥æŸ¥çœ‹ for å¾ªç¯ä½¿ç”¨çš„å­—èŠ‚ç ã€‚</p><pre><code class=\"language-python\">l = [1, 2, 3]\nfor i in l:\n    print(i)\n</code></pre><p>æˆ‘ä»¬å°†è¿™ä¸ªæµ‹è¯•ç”¨ä¾‹ç¼–è¯‘ä»¥åï¼Œå†ä½¿ç”¨ show_file å·¥å…·æŸ¥çœ‹å®ƒçš„å­—èŠ‚ç ã€‚</p><pre><code class=\"language-plain\">&nbsp; 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 LOAD_CONST&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 (1)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 LOAD_CONST&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 (2)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4 LOAD_CONST&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2 (3)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 6 BUILD_LIST&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 8 STORE_NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 (l)\n\n&nbsp; 2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 10 LOAD_NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 (l)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;12 GET_ITER\n&nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt;&nbsp; &nbsp;14 FOR_ITER&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 12 (to 28)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;16 STORE_NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 (i)\n\n&nbsp; 3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 18 LOAD_NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 (print)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;20 LOAD_NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1 (i)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;22 CALL_FUNCTION&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;24 POP_TOP\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;26 JUMP_ABSOLUTE&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;14\n&nbsp; &nbsp; &nbsp; &nbsp; &gt;&gt;&nbsp; &nbsp;28 LOAD_CONST&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3 (None)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;30 RETURN_VALUE\n</code></pre><p>ä¸Šè¿°å­—èŠ‚ç çš„ç¬¬ä¸€ä¸ªåŠŸèƒ½æ˜¯åˆ›å»ºåˆ—è¡¨ï¼ˆç¬¬ 1 è¡Œè‡³ç¬¬ 5 è¡Œï¼‰ã€‚ç¬¬äºŒéƒ¨åˆ†å¯¹åº”æºç æ–‡ä»¶çš„ç¬¬ 2 è¡Œï¼Œä¹Ÿå°±æ˜¯é‚£æ¡ for è¯­å¥ï¼ˆç¬¬ 7 è¡Œè‡³ç¬¬ 10 è¡Œï¼‰ã€‚è¿™ 4 æ¡å­—èŠ‚ç ä¸­ï¼Œæœ‰ä¸¤ä¸ªæ˜¯æˆ‘ä»¬è¿˜æ²¡æœ‰å®ç°çš„ï¼Œåˆ†åˆ«æ˜¯ GET_ITER å’Œ FOR_ITERã€‚ç¬¬ä¸‰éƒ¨åˆ†å°±æ˜¯æ‰“å°ï¼Œè¿™éƒ¨åˆ†ä¸å†èµ˜è¿°ã€‚</p><p>ç¬¬äºŒéƒ¨åˆ†å‡ºç°äº†ä¸€ä¸ªå…¨æ–°çš„æ¦‚å¿µï¼š<strong>è¿­ä»£å™¨ï¼ˆiteratorï¼‰</strong>ã€‚è¿­ä»£å™¨åœ¨ C++ STL ä¸­å’Œ Java å®¹å™¨é‡Œè¢«å¹¿æ³›ä½¿ç”¨ï¼Œæ˜¯ä¸€ç§éå¸¸å¸¸è§çš„è½¯ä»¶è®¾è®¡æ¨¡å¼ã€‚</p><p>è¿­ä»£å™¨æ˜¯ä¸€ç§å¯¹è±¡ï¼Œå®ƒèƒ½å¤Ÿéå†å®¹å™¨ä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚è¿­ä»£å™¨å¹¶ä¸ä»…ä»…æ˜¯åˆ—è¡¨ä¸“ç”¨çš„ï¼Œå®ƒç”¨åœ¨å¾ˆå¤šåœ°æ–¹ï¼Œä¾‹å¦‚å­—å…¸ã€æ–‡ä»¶ç­‰ï¼Œç¨‹åºå‘˜ç”šè‡³å¯ä»¥è‡ªå·±å®šä¹‰è¿­ä»£å™¨ã€‚<strong>å®ƒçš„ä½œç”¨å°±æ˜¯å±è”½åº•å±‚çš„æ•°æ®ç»“æ„ï¼Œè®©ç¨‹åºå¯ä»¥ä½¿ç”¨ç»Ÿä¸€çš„æ¥å£æ¥å¯¹ä¸åŒçš„æ•°æ®ç»“æ„è¿›è¡Œéå†æ“ä½œã€‚</strong></p><p>GET_ITER å¯ä»¥è·å¾—æ ˆé¡¶å¯¹è±¡çš„è¿­ä»£å™¨ï¼Œå¹¶æŠŠè¿­ä»£å™¨é€åˆ°æ ˆé¡¶ã€‚FOR_ITER å¯ä»¥å°†è¿­ä»£å™¨å¾€å‰æ¨è¿›ã€‚æ¯”å¦‚ï¼Œè¿­ä»£å™¨åœ¨åˆšè¢«åˆ›å»ºçš„æ—¶å€™ï¼Œæ€»æ˜¯æŒ‡å‘ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œè€Œæ‰§è¡Œä¸€æ¬¡ FOR_ITER ä»¥åï¼Œå°±ä¼šæŠŠç¬¬ä¸€ä¸ªå…ƒç´ é€åˆ°æ ˆé¡¶ï¼ŒåŒæ—¶å°†è¿­ä»£å™¨æ¨è¿›ä¸€æ¬¡ï¼ŒæŒ‡å‘ç¬¬äºŒä¸ªå…ƒç´ ã€‚</p><p>çŸ¥é“äº†è¿­ä»£å™¨çš„ä½œç”¨ä»¥åï¼Œæˆ‘ä»¬å°±æ¥è®¾è®¡åˆ—è¡¨çš„è¿­ä»£å™¨ã€‚Python æä¾›äº†ä¸€ä¸ªå‡½æ•°ï¼Œåä¸º iterï¼Œå¯ä»¥è·å–å¯¹è±¡ä¸Šçš„è¿­ä»£å™¨ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆæ¢ç©¶ä¸€ä¸‹ã€‚</p><pre><code class=\"language-plain\">&gt;&gt;&gt; l = []\n&gt;&gt;&gt; it = iter(l)\n&gt;&gt;&gt; print(it)\n&lt;list_iterator object at 0x7fee725ccb20&gt;\n&gt;&gt;&gt; dir(it)\n[..., '__next__', ...]\n</code></pre><p>åœ¨ Python çš„ REPL ç¯å¢ƒé‡Œï¼ˆåœ¨å‘½ä»¤è¡Œä¸‹æ‰‹åŠ¨è¾“å…¥ Python å¹¶å›è½¦å³å¯è¿›å…¥ï¼‰ï¼Œé€šè¿‡è°ƒç”¨ iter å‡½æ•°ï¼Œè·å¾—ä¸€ä¸ªç©ºåˆ—è¡¨å¯¹è±¡çš„è¿­ä»£å™¨ï¼Œå¹¶æŠŠå®ƒæ‰“å°äº†å‡ºæ¥ã€‚å¯ä»¥çœ‹åˆ°ï¼Œè¿­ä»£å™¨å¯¹è±¡æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªæ™®é€šçš„ Python å¯¹è±¡ï¼Œå¹¶ä¸”å®ƒçš„ç±»å‹æ˜¯ <strong>list_iterator</strong>ã€‚</p><p>é€šè¿‡ dir æŸ¥çœ‹å®ƒçš„å±æ€§ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œlist_iterator ç±»å‹ä¸Šå®šä¹‰äº† <strong>next</strong> æ–¹æ³•ã€‚è¿™å°±ä¸ºæˆ‘ä»¬å®ç°è¿­ä»£å™¨æŒ‡æ˜äº†æ–¹å‘ã€‚é¦–å…ˆï¼Œè¿­ä»£å™¨ä¹Ÿæ˜¯ä¸€ä¸ª HiObject å¯¹è±¡ï¼Œå®ƒçš„ klass åç§°æ˜¯list_iteratorã€‚æˆ‘ä»¬æŠŠè¿™äº›åˆ†æè½¬æ¢æˆä»£ç ã€‚</p><pre><code class=\"language-c++\">// object/hiList.hpp\nclass ListIteratorKlass : public Klass {\nprivate:\n&nbsp; &nbsp; static ListIteratorKlass* instance;\n&nbsp; &nbsp; ListIteratorKlass();\n\npublic:\n&nbsp; &nbsp; static ListIteratorKlass* get_instance();\n};\n\nclass ListIterator : public HiObject {\nprivate:\n&nbsp; &nbsp; HiList*&nbsp; &nbsp;_owner;\n&nbsp; &nbsp; int&nbsp; &nbsp; &nbsp; &nbsp;_iter_cnt;\npublic:\n&nbsp; &nbsp; ListIterator(HiList* owner);\n\n&nbsp; &nbsp; HiList* owner()&nbsp; &nbsp; &nbsp; &nbsp; { return _owner; }\n&nbsp; &nbsp; int iter_cnt()&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{ return _iter_cnt; }&nbsp;&nbsp;\n&nbsp; &nbsp; void inc_cnt()&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{ _iter_cnt++; }\n};\n</code></pre><p>ListIteratorKlass å’Œä¹‹å‰å®ç°çš„ ListKlass ç­‰å…¶ä»– Klass ç›¸åŒï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå•ä¾‹å¯¹è±¡ã€‚ListIterator æ‰æ˜¯çœŸæ­£çš„è¿­ä»£å™¨ï¼Œå®ƒç»§æ‰¿è‡ª HiObjectã€‚ä¸ºäº†éå†åˆ—è¡¨ï¼Œè¿­ä»£å™¨ä¸Šè¦è®°å½•ç›®æ ‡åˆ—è¡¨ï¼ˆ_ownerï¼‰ï¼Œè¿˜è¦è®°å½•å½“å‰å·²ç»éå†åˆ°ä»€ä¹ˆä½ç½®ï¼ˆ_iter_cntï¼‰ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œå°±è¦åœ¨ä»£è¡¨è¿­ä»£å™¨ç±»å‹çš„ ListIteratorKlass ä¸­æ·»åŠ  <strong>next</strong> æ–¹æ³•ã€‚è¿™ä¸ªå·¥ä½œå¯ä»¥åœ¨æ„é€ å‡½æ•°é‡Œå®Œæˆã€‚</p><pre><code class=\"language-c++\">// object/hiList.hpp\nHiObject* listiterator_next(ObjList args);\n\n// object/hiList.cpp\nListIteratorKlass::ListIteratorKlass() {\n&nbsp; &nbsp; HiDict* klass_dict = new HiDict();\n&nbsp; &nbsp; klass_dict-&gt;put(new HiString(\"next\"),&nbsp;\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; new FunctionObject(listiterator_next));\n&nbsp; &nbsp; set_klass_dict(klass_dict);\n\n&nbsp; &nbsp; set_name(new HiString(\"listiterator\"));\n}\n\nListIterator::ListIterator(HiList* list) {\n&nbsp; &nbsp; _owner = list;\n&nbsp; &nbsp; _iter_cnt = 0;\n&nbsp; &nbsp; set_klass(ListIteratorKlass::get_instance());\n}\n\nHiObject* listiterator_next(ObjList args) {\n&nbsp; &nbsp; ListIterator* iter = (ListIterator*)(args-&gt;get(0));\n\n&nbsp; &nbsp; HiList* alist = iter-&gt;owner();\n&nbsp; &nbsp; int iter_cnt = iter-&gt;iter_cnt();\n&nbsp; &nbsp; if (iter_cnt &lt; alist-&gt;inner_list()-&gt;size()) {\n&nbsp; &nbsp; &nbsp; &nbsp; HiObject* obj = alist-&gt;get(iter_cnt);\n&nbsp; &nbsp; &nbsp; &nbsp; iter-&gt;inc_cnt();\n&nbsp; &nbsp; &nbsp; &nbsp; return obj;\n&nbsp; &nbsp; }\n&nbsp; &nbsp; else // TODO : we need StopIteration here to mark iteration end\n&nbsp; &nbsp; &nbsp; &nbsp; return NULL;\n}\n</code></pre><p>listiterator_next æ–¹æ³•çš„é€»è¾‘æ˜¯å–å‡ºå½“å‰ iter_cnt æ‰€å¯¹åº”çš„å¯¹è±¡ï¼ŒæŠŠå®ƒä½œä¸ºè¿”å›å€¼è¿”å›ç»™è°ƒç”¨è€…ï¼Œå¹¶ä¸”æŠŠ iter_cnt åŠ  1ã€‚</p><p>å¦‚æœéå†ç»“æŸï¼Œiter_cnt çš„å€¼å°±ä¼šç­‰äºåˆ—è¡¨çš„é•¿åº¦ï¼Œæˆ‘ä»¬é€šè¿‡è¿”å› NULL æ¥è¡¨ç¤ºç»“æŸäº†ï¼ˆç¬¬ 30 è¡Œï¼‰ã€‚å®é™…ä¸Šï¼ŒæŒ‰ç…§ Python æ ‡å‡†çš„è¦æ±‚ï¼Œè¿™é‡Œåº”è¯¥æŠ›å‡ºä¸€ä¸ª StopIteration å¼‚å¸¸ã€‚ä½†ç”±äºæˆ‘ä»¬ç°åœ¨è¿˜æ²¡æœ‰å®ç°å¼‚å¸¸æœºåˆ¶ï¼Œæ‰€ä»¥è¿™é‡Œå°±å…ˆä½¿ç”¨ NULL æ¥ä»£è¡¨è¿­ä»£å™¨éå†ç»“æŸã€‚</p><p>å®ç°å®Œåˆ—è¡¨çš„è¿­ä»£å™¨ä»¥åï¼Œå°±å¯ä»¥å®ç°è¿­ä»£å™¨ç›¸å…³çš„ä¸¤ä¸ªå­—èŠ‚ç äº†ã€‚</p><pre><code class=\"language-c++\">void Interpreter::run(CodeObject* codes) {\n&nbsp; &nbsp; _frame = new FrameObject(codes);\n\tHiObject *v, *w, *u;\n\t...\n&nbsp; &nbsp; while (_frame-&gt;has_more_codes()) {\n\t&nbsp; &nbsp; unsigned char op_code = _frame-&gt;get_op_code();\n&nbsp; &nbsp; &nbsp; &nbsp; ...\n&nbsp; &nbsp; &nbsp; &nbsp; switch (op_code) {\n\t\t...\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case ByteCode::GET_ITER:\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; v = POP();\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PUSH(v-&gt;iter());\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;\n\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case ByteCode::FOR_ITER:\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; v = TOP();\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; w = v-&gt;getattr(new HiString(\"next\"));\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; build_frame(w, NULL);\n\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (TOP() == NULL) {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _frame-&gt;_pc += op_arg;\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; POP();\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;\n&nbsp; &nbsp; &nbsp; &nbsp; ...\n&nbsp; &nbsp; &nbsp; &nbsp; }\n&nbsp; &nbsp; }\n}\n</code></pre><p>GET_ITER çš„å®ç°ä¸­è°ƒç”¨äº† v çš„ iter æ–¹æ³•ï¼ˆç¬¬ 10 è‡³ 13 è¡Œï¼‰ï¼Œv çš„ç±»å‹è™½ç„¶æ˜¯æŒ‡å‘ HiObject çš„æŒ‡é’ˆï¼Œä½†å®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåˆ—è¡¨å¯¹è±¡ã€‚</p><p>iter æ–¹æ³•çš„ä½œç”¨æ˜¯ç”Ÿæˆä¸ v ç›¸è”ç³»çš„ ListIteratorã€‚åœ¨ HiObject åŠ Klass ç±»é‡Œæ·»åŠ  iter æ–¹æ³•çš„åŸå‹çš„ä»£ç ï¼Œå®ƒçš„é€»è¾‘æ¯”è¾ƒç®€å•ï¼Œå°±ä¸å†åˆ—å‡ºäº†ã€‚è¿™é‡Œæˆ‘åªåˆ—å‡º ListKlass ä¸­ iter çš„å…·ä½“å®ç°ï¼Œä¾›ä½ å‚è€ƒã€‚</p><pre><code class=\"language-c++\">HiObject* ListKlass::iter(HiObject* x) {\n&nbsp; &nbsp; assert(x &amp;&amp; x-&gt;klass() == this);\n&nbsp; &nbsp; return new ListIterator((HiList*)x);\n}\n</code></pre><p>æ‰§è¡Œå®Œ GET_ITER å­—èŠ‚ç ä»¥åï¼Œåˆ—è¡¨çš„è¿­ä»£å™¨å¯¹è±¡å°±å·²ç»åœ¨æ“ä½œæ•°æ ˆé¡¶äº†ã€‚æ¥ä¸‹æ¥è§£é‡Šå™¨å°±ä¼šå¾ªç¯åœ°æ‰§è¡Œ FOR_ITERã€‚</p><p>å¦‚æœè¿­ä»£çš„è¿‡ç¨‹æ­£å¸¸ï¼Œä¹Ÿå°±æ˜¯è¿”å›å€¼ä¸ä¸º NULLï¼Œé‚£ä¹ˆå°±ç»§ç»­æ‰§è¡Œä¸‹ä¸€æ¡å­—èŠ‚ç ã€‚å¦‚æœè¿­ä»£çš„è¿‡ç¨‹ç»“æŸäº†ï¼Œå°±è·³è½¬åˆ°ç›®æ ‡å­—èŠ‚ç ç»§ç»­æ‰§è¡Œã€‚</p><p>è¿™ä¸ªç›®æ ‡å­—èŠ‚ç ç”± FOR_ITER çš„å‚æ•°æè¿°ï¼Œ FOR_ITER çš„å‚æ•°ä»£è¡¨äº†è¿­ä»£ç»“æŸçš„ç›®æ ‡æŒ‡ä»¤ä¸å½“å‰æŒ‡ä»¤çš„åç§»é‡ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨è¿­ä»£ç»“æŸä»¥åï¼Œå°† _frame çš„ _pc å€¼åŠ ä¸Šè¿™ä¸ªå‚æ•°ï¼Œå°±å¾—åˆ°äº†è¦è·³è½¬çš„ç›®æ ‡æŒ‡ä»¤åœ°å€ã€‚</p><p>ä»åˆ—è¡¨ä¸­è¿­ä»£å–å‡ºå…ƒç´ çš„è¿‡ç¨‹ï¼Œå°±æ˜¯ä¸æ–­åœ°é€šè¿‡ build_frame è°ƒç”¨ ListIterator çš„ <strong>next</strong> æ–¹æ³•çš„è¿‡ç¨‹ã€‚è¿™ä¸ªè°ƒç”¨æœ€ç»ˆä¼šæ‰§è¡Œåˆ° listiterator_next å‡½æ•°ä¸­å»ã€‚åœ¨è¿™ä¸ªå‡½æ•°é‡Œï¼Œæˆ‘ä»¬ä¸æ–­åœ°ä»åˆ—è¡¨ä¸­å–å‡ºå®ƒçš„å…ƒç´ ã€‚</p><p>åˆ°è¿™é‡Œï¼Œè¿­ä»£å™¨å°±å…¨éƒ¨å®ç°å®Œäº†ã€‚ç¼–è¯‘è¿è¡Œï¼Œå°±å¯ä»¥æ‰§è¡Œè¿™éƒ¨åˆ†çš„æµ‹è¯•ç”¨ä¾‹äº†ã€‚</p><p>æœ€åï¼Œå†æ·»åŠ ä¸€ç‚¹ä¼˜åŒ–ã€‚æˆ‘ä»¬æ³¨æ„åˆ° FOR_ITER çš„æ¯ä¸€æ¬¡æ‰§è¡Œéƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œè¿™ç§åšæ³•ä¸ä»…ä¼šä½¿æ€§èƒ½å˜å·®ï¼Œåœ¨æ²¡æœ‰æ­£ç¡®åœ°å®ç°è‡ªåŠ¨å†…å­˜ç®¡ç†ä¹‹å‰ï¼Œè¿˜ä¼šå¸¦æ¥æ›´å¤šçš„å†…å­˜æ³„æ¼ã€‚</p><p>è¿™ä¸ªæ–°ç”Ÿæˆçš„å­—ç¬¦ä¸²å€¼ä¸º nextï¼Œæ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œæ²¡æœ‰å¿…è¦æ¯æ¬¡éƒ½é‡æ–°ç”Ÿæˆã€‚æ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥ä»¥é™æ€å˜é‡çš„å½¢å¼æŠŠå®ƒè®°å½•ä¸‹æ¥ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸º StringTable çš„ç±»ï¼ŒæŠŠæ‰€æœ‰è™šæ‹Ÿæœºçš„å­—ç¬¦ä¸²å¸¸é‡éƒ½è®°å½•åœ¨è¿™ä¸ªç±»é‡Œã€‚</p><pre><code class=\"language-c++\">class StringTable {\nprivate:\n&nbsp; &nbsp; static StringTable* instance;\n&nbsp; &nbsp; StringTable();\n\npublic:\n&nbsp; &nbsp; static StringTable* get_instance();\n&nbsp; &nbsp;&nbsp;\n&nbsp; &nbsp; HiString* next_str;\n};\n</code></pre><p>å› ä¸º StringTable åœ¨æ•´ä¸ªè™šæ‹Ÿæœºé‡Œåªéœ€è¦ä¸€ä»½å³å¯ï¼Œæ‰€ä»¥æˆ‘ä»¬é‡‡ç”¨å•ä¾‹æ¨¡å¼å®ç°å®ƒã€‚åœ¨æ„é€ å‡½æ•°é‡Œï¼Œæˆ‘ä»¬åˆå§‹åŒ– next_strã€‚è¿™æ ·ï¼Œåœ¨ FOR_ITER é‡Œå°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªå­—ç¬¦ä¸²å¸¸é‡äº†ï¼Œé¿å…æ¯æ¬¡æ‰§è¡Œéƒ½éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚</p><pre><code class=\"language-c++\">StringTable::StringTable() {\n&nbsp; &nbsp; next_str = new HiString(\"next\");\n}\n\nvoid Interpreter::run(CodeObject* codes) {\n&nbsp; &nbsp; ...\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case ByteCode::FOR_ITER:\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; v = TOP();\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; w = v-&gt;getattr(StringTable::get_instance()-&gt;next_str);\n&nbsp; &nbsp; ...\n}\n</code></pre><p>å¥½äº†ï¼Œå…³äºè¿­ä»£å™¨æˆ‘ä»¬å…ˆä»‹ç»åˆ°è¿™é‡Œï¼ŒPython çš„è¿­ä»£å™¨æ˜¯ä¸€ä¸ªå¾ˆå¤æ‚çš„æœºåˆ¶ï¼Œè¿™é‡Œåªæ˜¯å¼€äº†ä¸ªå¤´ï¼Œåé¢æˆ‘ä¼šæ…¢æ…¢è¡¥å……ã€‚</p><h2>åˆ—è¡¨çš„åŠ æ³•ä¹˜æ³•æ“ä½œ</h2><p>åˆ—è¡¨ä¸Šå®šä¹‰çš„å„ç§æ“ä½œï¼Œæˆ‘ä»¬å·²ç»ä»‹ç»å¾—å·®ä¸å¤šäº†ã€‚æœ€åè¿˜æœ‰ä¸‰ç§ç®€å•çš„æ“ä½œï¼Œå€¼å¾—å†ä»‹ç»ä¸€ä¸‹ã€‚ç¬¬ä¸€ä¸ªå°±æ˜¯<strong>åŠ æ³•</strong>ï¼Œä¸¤ä¸ªåˆ—è¡¨ç›¸åŠ çš„ç»“æœæ˜¯ä¸€ä¸ªæ–°çš„åˆ—è¡¨ï¼Œå®ƒåŒ…å«äº†ä¸¤ä¸ªåˆ—è¡¨çš„æ‰€æœ‰å†…å®¹ã€‚ä¾‹å¦‚ï¼š</p><pre><code class=\"language-python\">a = [1, 2]\nb = [\"hello\", \"world\"]\nc = a + b&nbsp;\n#&nbsp; &nbsp; &nbsp;24 LOAD_NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 (a)\n#&nbsp; &nbsp; &nbsp;27 LOAD_NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1 (b)\n#&nbsp; &nbsp; &nbsp;30 BINARY_ADD&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;\n#&nbsp; &nbsp; &nbsp;31 STORE_NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2 (c)\nprint(a)&nbsp; # [1, 2]\nprint(b)&nbsp; # [\"hello\", \"world\"]\nprint(c)&nbsp; # [1, 2, \"hello\", \"world\"]\n</code></pre><p>ä½¿ç”¨ Python è¿è¡Œè¿™ä¸ªæµ‹è¯•ï¼Œå°±ä¼šå‘ç°ï¼Œa å’Œ b æ‰€æŒ‡å‘çš„åˆ—è¡¨å¹¶æ²¡æœ‰å‘ç”Ÿæ”¹å˜ã€‚è€Œ c æ˜¯ä¸€ä¸ªæ–°çš„åˆ—è¡¨ï¼Œå®ƒåŒ…å«äº† a å’Œ b çš„å†…å®¹ã€‚</p><p>ä¸ºäº†æ–¹ä¾¿ä½ è§‚å¯Ÿï¼Œæˆ‘åœ¨æµ‹è¯•ç”¨ä¾‹ä¸­ä»¥æ³¨é‡Šçš„å½¢å¼æŠŠå­—èŠ‚ç åˆ—å‡ºæ¥äº†ã€‚å¯ä»¥çœ‹åˆ°ï¼Œåˆ—è¡¨çš„åŠ æ³•æ“ä½œå¹¶æ²¡æœ‰å¼•å…¥æ–°çš„å­—èŠ‚ç ï¼Œä¸æ•´æ•°ä¸€æ ·ï¼Œä½¿ç”¨äº† BINARY_ADD æ¥è¿›è¡Œåˆ—è¡¨çš„ç›¸åŠ æ“ä½œã€‚æˆ‘ä»¬çŸ¥é“ï¼ŒBINARY_ADD çš„å®ç°ä¾èµ–äºå¯¹è±¡çš„ add æ–¹æ³•ã€‚ä¸ºäº†æ”¯æŒåˆ—è¡¨ç±»å‹çš„åŠ æ³•æ“ä½œï¼Œå°±éœ€è¦åœ¨ListKlass ä¸­å¢åŠ åŠ æ³•æ“ä½œçš„å®ç°ã€‚è¿™æ˜¯æ¯”è¾ƒå®¹æ˜“çš„ã€‚</p><pre><code class=\"language-python\">HiObject* ListKlass::add(HiObject* x, HiObject* y) {\n&nbsp; &nbsp; HiList* lx = (HiList*)x;\n&nbsp; &nbsp; assert(lx &amp;&amp; lx-&gt;klass() == (Klass*) this);\n&nbsp; &nbsp; HiList* ly = (HiList*)y;\n&nbsp; &nbsp; assert(ly &amp;&amp; ly-&gt;klass() == (Klass*) this);\n\n&nbsp; &nbsp; HiList* z = new HiList();\n&nbsp; &nbsp; for (int i = 0; i &lt; lx-&gt;size(); i++) {\n&nbsp; &nbsp; &nbsp; &nbsp; z-&gt;inner_list()-&gt;set(i, lx-&gt;inner_list()-&gt;get(i));\n&nbsp; &nbsp; }\n\n&nbsp; &nbsp; for (int i = 0; i &lt; ly-&gt;size(); i++) {\n&nbsp; &nbsp; &nbsp; &nbsp; z-&gt;inner_list()-&gt;set(i + lx-&gt;size(),\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ly-&gt;inner_list()-&gt;get(i));\n&nbsp; &nbsp; }\n\n&nbsp; &nbsp; return z;\n}\n</code></pre><p>åœ¨ add æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªæ–°çš„ç©ºåˆ—è¡¨ zï¼Œç„¶åæŠŠ x é‡Œçš„æ‰€æœ‰å…ƒç´ éƒ½æ‹·è´åˆ° z ä¸­å»ï¼Œå†æŠŠ y ä¸­çš„æ‰€æœ‰å…ƒç´ éƒ½æ‹·è´åˆ° z ä¸­å»ï¼Œæœ€åæŠŠ z è¿”å›ç»™è°ƒç”¨è€…å°±å¯ä»¥äº†ã€‚</p><p>å’ŒåŠ æ³•å·®ä¸å¤šï¼Œåˆ—è¡¨è¿˜æ”¯æŒ<strong>ä¹˜æ³•</strong>ã€‚åˆ—è¡¨åªèƒ½ä¸æ•´æ•°ç›¸ä¹˜ï¼Œè®°æ•´æ•°ä¸º nï¼Œé‚£ä¹ˆåˆ—è¡¨ lst ä¹˜ä»¥ n çš„ç»“æœä¸ n ä¸ª lst ç›¸åŠ çš„ç»“æœç›¸åŒã€‚</p><p>ä¹˜æ³•å¯¹åº”çš„å­—èŠ‚ç æ˜¯ BINARY_MULTIPLYï¼Œè¿™ä¸ªå­—èŠ‚ç çš„å®ç°ä¾èµ–äºå¯¹è±¡çš„ mul æ–¹æ³•ã€‚åœ¨ ListKlass ä¸­å¢åŠ  mul çš„å®ç°å°±å¯ä»¥äº†ã€‚</p><pre><code class=\"language-python\">HiObject* ListKlass::mul(HiObject* x, HiObject* y) {\n&nbsp; &nbsp; HiList * lx = (HiList*)x;\n&nbsp; &nbsp; assert(lx &amp;&amp; lx-&gt;klass() == (Klass*) this);\n&nbsp; &nbsp; HiInteger* iy = (HiInteger*)y;\n&nbsp; &nbsp; assert(iy &amp;&amp; iy-&gt;klass() == IntegerKlass::get_instance());\n\n&nbsp; &nbsp; HiList* z = new HiList();\n&nbsp; &nbsp; for (int i = 0; i &lt; iy-&gt;value(); i++) {\n&nbsp; &nbsp; &nbsp; &nbsp; for (int j = 0; j &lt; lx-&gt;size(); j++) {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; z-&gt;inner_list()-&gt;set(i * lx-&gt;size() + j,\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lx-&gt;inner_list()-&gt;get(j));\n&nbsp; &nbsp; &nbsp; &nbsp; }\n&nbsp; &nbsp; }\n\n&nbsp; &nbsp; return z;\n}\n</code></pre><p>ä¹˜æ³•çš„é€»è¾‘ä¹Ÿå¾ˆç›´æ¥ï¼Œä½ å¯ä»¥ä¸åŠ æ³•ç›¸äº’å¯¹ç…§ç€ç ”ç©¶ã€‚<br>\nåˆ°è¿™é‡Œï¼Œåˆ—è¡¨çš„åŸºæœ¬æ“ä½œå°±å…¨éƒ¨å®Œæˆäº†ã€‚</p><h2>æ€»ç»“</h2><p>è¿™èŠ‚è¯¾ä¸»è¦å®ç°äº†å‡ ä¸ªå†…å»ºæ–¹æ³•ï¼Œä¸€æ˜¯ list_popï¼Œåˆ é™¤åˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼›äºŒæ˜¯ list_removeï¼Œä»åˆ—è¡¨ä¸­åˆ é™¤ç”±å‚æ•°æŒ‡å®šçš„é‚£ä¸ªå…ƒç´ ï¼›ä¸‰æ˜¯ list_reverseï¼Œå°†åˆ—è¡¨å…ƒç´ å€’åºæ’åˆ—ï¼›å››æ˜¯ list_sortï¼Œå¯¹åˆ—è¡¨å…ƒç´ è¿›è¡Œå‡åºæ’åˆ—ã€‚</p><p>è¿™èŠ‚è¯¾æˆ‘ä»¬ä¹Ÿå¼•å…¥äº†å‡ ä¸ªæ–°çš„å­—èŠ‚ç æ¥å®ç°åˆ—è¡¨çš„ç›¸å…³æ“ä½œï¼šDELETE_SUBSCR ç”¨æ¥åˆ é™¤åˆ—è¡¨ä¸­æŒ‡å®šä¸‹æ ‡å¯¹åº”çš„å…ƒç´ ï¼›GET_ITER ç”¨æ¥æ„å»ºåˆ—è¡¨è¿­ä»£å™¨ï¼›FOR_ITER å¯ä»¥é€šè¿‡è¿­ä»£å™¨è®¿é—®å…ƒç´ ï¼Œå¦‚æœéå†ç»“æŸå°±è·³è½¬åˆ°ç›®æ ‡ä»£ç æ‰§è¡Œã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬è¿˜ä»‹ç»äº†åˆ—è¡¨çš„åŠ æ³•ï¼Œä¹˜æ³•ç­‰æ“ä½œã€‚</p><p>é€šè¿‡ç¬¬ 13 èŠ‚è¯¾å’Œç¬¬ 14 èŠ‚è¯¾ï¼Œæˆ‘ä»¬å®ç°äº†åˆ—è¡¨çš„å‡ ä¸ªæœ€é‡è¦çš„åŸºæœ¬æ“ä½œï¼ŒåŒ…æ‹¬åˆ—è¡¨çš„æ„å»ºï¼Œå¯¹åˆ—è¡¨å…ƒç´ çš„å¢ã€åˆ ã€æŸ¥ã€æ”¹ã€éå†åˆ—è¡¨å…ƒç´ ã€å¯¹åˆ—è¡¨å…ƒç´ è¿›è¡Œæ’åºç­‰ç­‰ã€‚åˆ—è¡¨çš„åŠŸèƒ½å·²ç»åŸºæœ¬å®Œå¤‡ï¼Œä»ä¸‹èŠ‚è¯¾å¼€å§‹ï¼Œæˆ‘ä»¬å°†é‡ç‚¹å®ç°å¦å¤–ä¸€ä¸ªåŸºæœ¬çš„æ•°æ®ç»“æ„ï¼šå­—å…¸ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>è¯·ä½ æŸ¥çœ‹ä¸€ä¸‹ï¼ŒPython 3.8ä¸­åˆ—è¡¨è¿˜æœ‰å“ªäº›å†…å»ºæ–¹æ³•æˆ‘ä»¬å°šæœªå®ç°ï¼Ÿæ¬¢è¿ä½ æŠŠä½ æŸ¥æ‰¾åˆ°çš„ç»“æœåˆ†äº«åˆ°è¯„è®ºåŒºï¼Œæˆ‘ä»¬ä¸€èµ·è®¨è®ºï¼Œå¦‚æœä½ è§‰å¾—è¿™èŠ‚è¯¾çš„å†…å®¹å¯¹ä½ æœ‰å¸®åŠ©çš„è¯ï¼Œä¹Ÿæ¬¢è¿ä½ åˆ†äº«ç»™èº«è¾¹çš„æœ‹å‹ï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾å†è§ï¼</p>","comments":[{"had_liked":false,"id":395311,"user_name":"ifelse","can_delete":false,"product_type":"c1","uid":2550743,"ip_address":"æµ™æ±Ÿ","ucode":"D0565908C99695","user_header":"https://static001.geekbang.org/account/avatar/00/26/eb/d7/90391376.jpg","comment_is_top":false,"comment_ctime":1730181933,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":3,"score":2,"product_id":100761401,"comment_content":"å­¦ä¹ æ‰“å¡","like_count":0},{"had_liked":false,"id":394456,"user_name":"Geek_66a783","can_delete":false,"product_type":"c1","uid":3882146,"ip_address":"æµ™æ±Ÿ","ucode":"26C66C3EACAE16","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/pkjW8zleOmmWAbAMPkshJSFnDcN6d06DrYDeSIibmic2SW05Flv3ic5kLhzcHukia1Y1Ktm4OXdzYsicCnINiaCOeqQQ/132","comment_is_top":false,"comment_ctime":1726838875,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100761401,"comment_content":"FOR_ITERä¸­ç›´æ¥è°ƒbuild_frameå‡½æ•°ï¼Œå¯¹äºç”¨æˆ·ä½¿ç”¨pythonä»£ç å®ç°çš„è‡ªå®šä¹‰è¿­ä»£å™¨ï¼Œæ˜¯ä¸æ˜¯ä¼šå‡ºé—®é¢˜å‘€","like_count":0},{"had_liked":false,"id":394455,"user_name":"Geek_66a783","can_delete":false,"product_type":"c1","uid":3882146,"ip_address":"æµ™æ±Ÿ","ucode":"26C66C3EACAE16","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/pkjW8zleOmmWAbAMPkshJSFnDcN6d06DrYDeSIibmic2SW05Flv3ic5kLhzcHukia1Y1Ktm4OXdzYsicCnINiaCOeqQQ/132","comment_is_top":false,"comment_ctime":1726837559,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100761401,"comment_content":"HiObject* list_remove(ObjList args)çš„å®ç°ä¼¼ä¹æœ‰ç‚¹é—®é¢˜ï¼Œå…¶ä¸­åˆ é™¤é‚£è¡Œçš„ä»£ç åº”è¯¥æ˜¯list-&gt;inner_list()-&gt;delete_index(i--);æ‰å¯¹ï¼Œå› ä¸ºå½“æ¬¡ç¬¬iä¸ªå…ƒç´ å·²ç»è¢«åˆ æ‰äº†ï¼Œä¸‹ä¸€æ¬¡å¾ªç¯çš„æ—¶å€™è¿™ä¸ªä½ç½®å·²ç»è¢«åé¢çš„å…ƒç´ æ›¿è¡¥ä¸Šæ¥äº†ï¼Œæ‰€ä»¥è¿˜è¦å†æ¬¡æ£€æµ‹ä¸€ä¸‹ç¬¬iä¸ªä½ç½®çš„å…ƒç´ æ˜¯ä¸æ˜¯è¦è¢«åˆ é™¤çš„ç›®æ ‡","like_count":0},{"had_liked":false,"id":391181,"user_name":"Se7en","can_delete":false,"product_type":"c1","uid":1225368,"ip_address":"åŒ—äº¬","ucode":"93EFAE37AFB12D","user_header":"https://static001.geekbang.org/account/avatar/00/12/b2/98/82b76c88.jpg","comment_is_top":false,"comment_ctime":1717568434,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100761401,"comment_content":"åŠ æ²¹ğŸ‘","like_count":0}]}