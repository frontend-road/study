{"id":521319,"title":"33ï½œDI Containerï¼ˆ21ï¼‰ï¼šå¦‚ä½•å¤„ç†Singletonç”Ÿå‘½å‘¨æœŸéƒ¨åˆ†çš„åŠŸèƒ½ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å¾æ˜Šã€‚ä»Šå¤©æˆ‘ä»¬ç»§ç»­ä½¿ç”¨TDDçš„æ–¹å¼å®ç°æ³¨å…¥ä¾èµ–å®¹å™¨ã€‚</p><h2>å›é¡¾ä»£ç ä¸ä»»åŠ¡åˆ—è¡¨</h2><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„ä»£ç æ˜¯è¿™æ ·çš„ï¼š</p><pre><code>Component.java\n\npackage geektime.tdd.di;\nimport java.lang.annotation.Annotation;\npublic record Component(Class&lt;?&gt; type, Annotation qualifiers) {\n}\n\nComponentRef.java\n\npackage geektime.tdd.di;\nimport java.lang.annotation.Annotation;\nimport java.lang.reflect.ParameterizedType;\nimport java.lang.reflect.Type;\nimport java.util.Objects;\npublic class ComponentRef&lt;ComponentType&gt; {\n    public static &lt;ComponentType&gt; ComponentRef&lt;ComponentType&gt; of(Class&lt;ComponentType&gt; component) {\n        return new ComponentRef(component, null);\n    }\n    public static &lt;ComponentType&gt; ComponentRef&lt;ComponentType&gt; of(Class&lt;ComponentType&gt; component, Annotation qualifier) {\n        return new ComponentRef(component, qualifier);\n    }\n    public static ComponentRef of(Type type) {\n        return new ComponentRef(type, null);\n    }\n    public static ComponentRef of(Type type, Annotation qualifier) {\n        return new ComponentRef(type, qualifier);\n    }\n\n    private Type container;\n    private Component component;\n    ComponentRef(Type type, Annotation qualifier) {\n        init(type, qualifier);\n    }\n    protected ComponentRef() {\n        this(null);\n    }\n    protected ComponentRef(Annotation qualifier) {\n        Type type = ((ParameterizedType) getClass().getGenericSuperclass()).getActualTypeArguments()[0];\n        init(type, qualifier);\n    }\n    private void init(Type type, Annotation qualifier) {\n        if (type instanceof ParameterizedType container) {\n            this.container = container.getRawType();\n            this.component = new Component((Class&lt;ComponentType&gt;) container.getActualTypeArguments()[0], qualifier);\n        } else\n            this.component = new Component((Class&lt;ComponentType&gt;) type, qualifier);\n    }\n    public Type getContainer() {\n        return container;\n    }\n    public Class&lt;?&gt; getComponentType() {\n        return component.type();\n    }\n    public boolean isContainer() {\n        return container != null;\n    }\n    public Component component() {\n        return component;\n    }\n    @Override\n    public boolean equals(Object o) {\n        if (this == o) return true;\n        if (o == null || getClass() != o.getClass()) return false;\n        ComponentRef&lt;?&gt; that = (ComponentRef&lt;?&gt;) o;\n        return Objects.equals(container, that.container) &amp;&amp; component.equals(that.component);\n    }\n    @Override\n    public int hashCode() {\n        return Objects.hash(container, component);\n    }\n}\n\nContext.java\n\npackage geektime.tdd.di;\nimport java.util.Optional;\npublic interface Context {\n    &lt;ComponentType&gt; Optional&lt;ComponentType&gt; get(ComponentRef&lt;ComponentType&gt; ref);\n}\n\nContextConfig.java\n\npackage geektime.tdd.di;\nimport jakarta.inject.Provider;\nimport jakarta.inject.Qualifier;\nimport java.lang.annotation.Annotation;\nimport java.util.*;\npublic class ContextConfig {\n    private Map&lt;Component, ComponentProvider&lt;?&gt;&gt; components = new HashMap&lt;&gt;();\n    public &lt;Type&gt; void bind(Class&lt;Type&gt; type, Type instance) {\n        components.put(new Component(type, null), (ComponentProvider&lt;Type&gt;) context -&gt; instance);\n    }\n    public &lt;Type&gt; void bind(Class&lt;Type&gt; type, Type instance, Annotation... qualifiers) {\n        if (Arrays.stream(qualifiers).anyMatch(q -&gt; !q.annotationType().isAnnotationPresent(Qualifier.class)))\n            throw new IllegalComponentException();\n        for (Annotation qualifier : qualifiers)\n            components.put(new Component(type, qualifier), context -&gt; instance);\n    }\n    public &lt;Type, Implementation extends Type&gt;\n    void bind(Class&lt;Type&gt; type, Class&lt;Implementation&gt; implementation) {\n        components.put(new Component(type, null), new InjectionProvider&lt;&gt;(implementation));\n    }\n    public &lt;Type, Implementation extends Type&gt;\n    void bind(Class&lt;Type&gt; type, Class&lt;Implementation&gt; implementation, Annotation... qualifiers) {\n        if (Arrays.stream(qualifiers).anyMatch(q -&gt; !q.annotationType().isAnnotationPresent(Qualifier.class)))\n            throw new IllegalComponentException();\n        for (Annotation qualifier : qualifiers)\n            components.put(new Component(type, qualifier), new InjectionProvider&lt;&gt;(implementation));\n    }\n    public Context getContext() {\n        components.keySet().forEach(component -&gt; checkDependencies(component, new Stack&lt;&gt;()));\n        return new Context() {\n            @Override\n            public &lt;ComponentType&gt; Optional&lt;ComponentType&gt; get(ComponentRef&lt;ComponentType&gt; ref) {\n                if (ref.isContainer()) {\n                    if (ref.getContainer() != Provider.class) return Optional.empty();\n                    return (Optional&lt;ComponentType&gt;) Optional.ofNullable(getProvider(ref))\n                            .map(provider -&gt; (Provider&lt;Object&gt;) () -&gt; provider.get(this));\n                }\n                return Optional.ofNullable(getProvider(ref)).map(provider -&gt; (ComponentType) provider.get(this));\n            }\n        };\n    }\n    private &lt;ComponentType&gt; ComponentProvider&lt;?&gt; getProvider(ComponentRef&lt;ComponentType&gt; ref) {\n        return components.get(ref.component());\n    }\n    private void checkDependencies(Component component, Stack&lt;Component&gt; visiting) {\n        for (ComponentRef&lt;?&gt; dependency : components.get(component).getDependencies()) {\n            if (!components.containsKey(dependency.component()))\n                throw new DependencyNotFoundException(component, dependency.component());\n            if (!dependency.isContainer()) {\n                if (visiting.contains(dependency.component())) throw new CyclicDependenciesFoundException(visiting);\n                visiting.push(dependency.component());\n                checkDependencies(dependency.component(), visiting);\n                visiting.pop();\n            }\n        }\n    }\n    interface ComponentProvider&lt;T&gt; {\n        T get(Context context);\n        default List&lt;ComponentRef&lt;?&gt;&gt; getDependencies() {\n            return List.of();\n        }\n    }\n}\n\nInjectionProvider.java\n\npackage geektime.tdd.di;\nimport jakarta.inject.Inject;\nimport jakarta.inject.Qualifier;\nimport java.lang.annotation.Annotation;\nimport java.lang.reflect.*;\nimport java.util.*;\nimport java.util.function.BiFunction;\nimport java.util.stream.Stream;\nimport static java.util.Arrays.stream;\nimport static java.util.stream.Stream.concat;\nclass InjectionProvider&lt;T&gt; implements ContextConfig.ComponentProvider&lt;T&gt; {\n    private Injectable&lt;Constructor&lt;T&gt;&gt; injectConstructor;\n    private List&lt;Injectable&lt;Method&gt;&gt; injectMethods;\n    private List&lt;Injectable&lt;Field&gt;&gt; injectFields;\n    public InjectionProvider(Class&lt;T&gt; component) {\n        if (Modifier.isAbstract(component.getModifiers())) throw new IllegalComponentException();\n        this.injectConstructor = getInjectConstructor(component);\n        this.injectMethods = getInjectMethods(component);\n        this.injectFields = getInjectFields(component);\n        if (injectFields.stream().anyMatch(f -&gt; Modifier.isFinal(f.element().getModifiers())))\n            throw new IllegalComponentException();\n        if (injectMethods.stream().anyMatch(m -&gt; m.element().getTypeParameters().length != 0))\n            throw new IllegalComponentException();\n    }\n    @Override\n    public T get(Context context) {\n        try {\n            T instance = injectConstructor.element().newInstance(injectConstructor.toDependencies(context));\n            for (Injectable&lt;Field&gt; field : injectFields)\n                field.element().set(instance, field.toDependencies(context)[0]);\n            for (Injectable&lt;Method&gt; method : injectMethods)\n                method.element().invoke(instance, method.toDependencies(context));\n            return instance;\n        } catch (InvocationTargetException | InstantiationException | IllegalAccessException e) {\n            throw new RuntimeException(e);\n        }\n    }\n    @Override\n    public List&lt;ComponentRef&lt;?&gt;&gt; getDependencies() {\n        return concat(concat(Stream.of(injectConstructor), injectFields.stream()), injectMethods.stream())\n                .map(Injectable::required).flatMap(Arrays::stream).toList();\n    }\n    record Injectable&lt;Element extends AccessibleObject&gt;(Element element, ComponentRef&lt;?&gt;[] required) {\n        Object[] toDependencies(Context context) {\n            return stream(required).map(context::get).map(Optional::get).toArray();\n        }\n        static &lt;Element extends Executable&gt; Injectable&lt;Element&gt; of(Element element) {\n            return new Injectable&lt;&gt;(element, stream(element.getParameters()).map(Injectable::toComponentRef).toArray(ComponentRef&lt;?&gt;[]::new));\n        }\n        static Injectable&lt;Field&gt; of(Field field) {\n            return new Injectable&lt;&gt;(field, new ComponentRef&lt;?&gt;[]{toComponentRef(field)});\n        }\n        private static ComponentRef&lt;?&gt; toComponentRef(Field field) {\n            return ComponentRef.of(field.getGenericType(), getQualifier(field));\n        }\n        private static ComponentRef&lt;?&gt; toComponentRef(Parameter parameter) {\n            return ComponentRef.of(parameter.getParameterizedType(), getQualifier(parameter));\n        }\n        private static Annotation getQualifier(AnnotatedElement element) {\n            List&lt;Annotation&gt; qualifiers = stream(element.getAnnotations())\n                    .filter(a -&gt; a.annotationType().isAnnotationPresent(Qualifier.class)).toList();\n            if (qualifiers.size() &gt; 1) throw new IllegalComponentException();\n            return qualifiers.stream().findFirst().orElse(null);\n        }\n    }\n    private static &lt;T&gt; List&lt;Injectable&lt;Method&gt;&gt; getInjectMethods(Class&lt;T&gt; component) {\n        List&lt;Method&gt; injectMethods = traverse(component, (methods, current) -&gt; injectable(current.getDeclaredMethods())\n                .filter(m -&gt; isOverrideByInjectMethod(methods, m))\n                .filter(m -&gt; isOverrideByNoInjectMethod(component, m)).toList());\n        Collections.reverse(injectMethods);\n        return injectMethods.stream().map(Injectable::of).toList();\n    }\n    private static &lt;T&gt; List&lt;Injectable&lt;Field&gt;&gt; getInjectFields(Class&lt;T&gt; component) {\n        return InjectionProvider.&lt;Field&gt;traverse(component, (fields, current) -&gt; injectable(current.getDeclaredFields()).toList())\n                .stream().map(Injectable::of).toList();\n    }\n    private static &lt;Type&gt; Injectable&lt;Constructor&lt;Type&gt;&gt; getInjectConstructor(Class&lt;Type&gt; implementation) {\n        List&lt;Constructor&lt;?&gt;&gt; injectConstructors = injectable(implementation.getConstructors()).toList();\n        if (injectConstructors.size() &gt; 1) throw new IllegalComponentException();\n        return Injectable.of((Constructor&lt;Type&gt;) injectConstructors.stream().findFirst().orElseGet(() -&gt; defaultConstructor(implementation)));\n    }\n    private static &lt;Type&gt; Constructor&lt;Type&gt; defaultConstructor(Class&lt;Type&gt; implementation) {\n        try {\n            return implementation.getDeclaredConstructor();\n        } catch (NoSuchMethodException e) {\n            throw new IllegalComponentException();\n        }\n    }\n    private static &lt;T&gt; List&lt;T&gt; traverse(Class&lt;?&gt; component, BiFunction&lt;List&lt;T&gt;, Class&lt;?&gt;, List&lt;T&gt;&gt; finder) {\n        List&lt;T&gt; members = new ArrayList&lt;&gt;();\n        Class&lt;?&gt; current = component;\n        while (current != Object.class) {\n            members.addAll(finder.apply(members, current));\n            current = current.getSuperclass();\n        }\n        return members;\n    }\n    private static &lt;T extends AnnotatedElement&gt; Stream&lt;T&gt; injectable(T[] declaredFields) {\n        return stream(declaredFields).filter(f -&gt; f.isAnnotationPresent(Inject.class));\n    }\n    private static boolean isOverride(Method m, Method o) {\n        return o.getName().equals(m.getName()) &amp;&amp; Arrays.equals(o.getParameterTypes(), m.getParameterTypes());\n    }\n    private static &lt;T&gt; boolean isOverrideByNoInjectMethod(Class&lt;T&gt; component, Method m) {\n        return stream(component.getDeclaredMethods()).filter(m1 -&gt; !m1.isAnnotationPresent(Inject.class)).noneMatch(o -&gt; isOverride(m, o));\n    }\n    private static boolean isOverrideByInjectMethod(List&lt;Method&gt; injectMethods, Method m) {\n        return injectMethods.stream().noneMatch(o -&gt; isOverride(m, o));\n    }\n}\n</code></pre><p>ä»»åŠ¡åˆ—è¡¨çš„çŠ¶æ€ä¸ºï¼š</p><ul>\n<li>\n<p><s>æ— éœ€æ„é€ çš„ç»„ä»¶â€”â€”ç»„ä»¶å®ä¾‹</s></p>\n</li>\n<li>\n<p><s>å¦‚æœæ³¨å†Œçš„ç»„ä»¶ä¸å¯å®ä¾‹åŒ–ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸</s></p>\n<ul>\n<li><s>æŠ½è±¡ç±»</s></li>\n<li><s>æ¥å£</s></li>\n</ul>\n</li>\n<li>\n<p><s>æ„é€ å‡½æ•°æ³¨å…¥</s></p>\n<ul>\n<li><s>æ— ä¾èµ–çš„ç»„ä»¶åº”è¯¥é€šè¿‡é»˜è®¤æ„é€ å‡½æ•°ç”Ÿæˆç»„ä»¶å®ä¾‹</s></li>\n<li><s>æœ‰ä¾èµ–çš„ç»„ä»¶ï¼Œé€šè¿‡Injectæ ‡æ³¨çš„æ„é€ å‡½æ•°ç”Ÿæˆç»„ä»¶å®ä¾‹</s></li>\n<li><s>å¦‚æœæ‰€ä¾èµ–çš„ç»„ä»¶ä¹Ÿå­˜åœ¨ä¾èµ–ï¼Œé‚£ä¹ˆéœ€è¦å¯¹æ‰€ä¾èµ–çš„ç»„ä»¶ä¹Ÿå®Œæˆä¾èµ–æ³¨å…¥</s></li>\n<li><s>å¦‚æœç»„ä»¶æœ‰å¤šäºä¸€ä¸ªInjectæ ‡æ³¨çš„æ„é€ å‡½æ•°ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸</s></li>\n<li><s>å¦‚æœç»„ä»¶æ²¡æœ‰Injectæ ‡æ³¨çš„æ„é€ å‡½æ•°ï¼Œä¹Ÿæ²¡æœ‰é»˜è®¤æ„é€ å‡½æ•°ï¼ˆæ–°å¢ä»»åŠ¡ï¼‰</s></li>\n<li><s>å¦‚æœç»„ä»¶éœ€è¦çš„ä¾èµ–ä¸å­˜åœ¨ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸</s></li>\n<li><s>å¦‚æœç»„ä»¶é—´å­˜åœ¨å¾ªç¯ä¾èµ–ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸</s></li>\n</ul>\n</li>\n<li>\n<p><s>å­—æ®µæ³¨å…¥</s></p>\n<ul>\n<li><s>é€šè¿‡Injectæ ‡æ³¨å°†å­—æ®µå£°æ˜ä¸ºä¾èµ–ç»„ä»¶</s></li>\n<li><s>å¦‚æœå­—æ®µä¸ºfinalåˆ™æŠ›å‡ºå¼‚å¸¸</s></li>\n<li><s>ä¾èµ–ä¸­åº”åŒ…å«Inject Fieldå£°æ˜çš„ä¾èµ–</s></li>\n</ul>\n</li>\n<li>\n<p><s>æ–¹æ³•æ³¨å…¥</s></p>\n<ul>\n<li><s>é€šè¿‡Injectæ ‡æ³¨çš„æ–¹æ³•ï¼Œå…¶å‚æ•°ä¸ºä¾èµ–ç»„ä»¶</s></li>\n<li><s>é€šè¿‡Injectæ ‡æ³¨çš„æ— å‚æ•°æ–¹æ³•ï¼Œä¼šè¢«è°ƒç”¨</s></li>\n<li><s>æŒ‰ç…§å­ç±»ä¸­çš„è§„åˆ™ï¼Œè¦†ç›–çˆ¶ç±»ä¸­çš„Injectæ–¹æ³•</s></li>\n<li><s>å¦‚æœæ–¹æ³•å®šä¹‰ç±»å‹å‚æ•°ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸</s></li>\n<li><s>ä¾èµ–ä¸­åº”åŒ…å«Inject Methodå£°æ˜çš„ä¾èµ–</s></li>\n</ul>\n</li>\n<li>\n<p><s>å¯¹Providerç±»å‹çš„ä¾èµ–</s></p>\n<ul>\n<li><s>ä»å®¹å™¨ä¸­å–å¾—ç»„ä»¶çš„Providerï¼ˆæ–°å¢ä»»åŠ¡ï¼‰</s></li>\n<li><s>æ³¨å…¥æ„é€ å‡½æ•°ä¸­å¯ä»¥å£°æ˜å¯¹äºProviderçš„ä¾èµ–</s></li>\n<li><s>æ³¨å…¥å­—æ®µä¸­å¯ä»¥å£°æ˜å¯¹äºProviderçš„ä¾èµ–</s></li>\n<li><s>æ³¨å…¥æ–¹æ³•ä¸­å¯å£°æ˜å¯¹äºProviderçš„ä¾èµ–</s></li>\n<li><s>å°†æ„é€ å‡½æ•°ä¸­çš„ProvideråŠ å…¥ä¾èµ–ï¼ˆæ–°å¢ä»»åŠ¡ï¼‰</s></li>\n<li><s>å°†å­—æ®µä¸­çš„ProvideråŠ å…¥ä¾èµ–ï¼ˆæ–°å¢ä»»åŠ¡ï¼‰</s></li>\n<li><s>å°†æ–¹æ³•ä¸­çš„ProvideråŠ å…¥ä¾èµ–ï¼ˆæ–°å¢ä»»åŠ¡ï¼‰</s></li>\n</ul>\n</li>\n<li>\n<p><s>è‡ªå®šä¹‰Qualifierçš„ä¾èµ–</s></p>\n<ul>\n<li>\n<p><s>æ³¨å†Œç»„ä»¶æ—¶ï¼Œå¯é¢å¤–æŒ‡å®šQualifier</s></p>\n<ul>\n<li><s>é’ˆå¯¹instanceæŒ‡å®šä¸€ä¸ªQualifieriï¼ˆæ–°å¢ä»»åŠ¡ï¼‰</s></li>\n<li><s>é’ˆå¯¹ç»„ä»¶æŒ‡å®šä¸€ä¸ªQualiiferï¼ˆæ–°å¢ä»»åŠ¡ï¼‰</s></li>\n<li><s>é’ˆå¯¹instanceæŒ‡å®šå¤šä¸ªQualifieriï¼ˆæ–°å¢ä»»åŠ¡ï¼‰</s></li>\n<li><s>é’ˆå¯¹ç»„ä»¶æŒ‡å®šå¤šä¸ªQualiiferï¼ˆæ–°å¢ä»»åŠ¡ï¼‰</s></li>\n</ul>\n</li>\n<li>\n<p><s>æ³¨å†Œç»„ä»¶æ—¶ï¼Œå¦‚æœä¸æ˜¯åˆæ³•çš„Qualifierï¼Œåˆ™ä¸æ¥å—ç»„ä»¶æ³¨å†Œï¼ˆæ–°å¢ä»»åŠ¡ï¼‰</s></p>\n</li>\n<li>\n<p><s>å¯»æ‰¾ä¾èµ–æ—¶ï¼Œéœ€åŒæ—¶æ»¡è¶³ç±»å‹ä¸è‡ªå®šä¹‰Qualifieræ ‡æ³¨</s></p>\n<ul>\n<li>\n<p><s>åœ¨æ£€æŸ¥ä¾èµ–æ—¶ä½¿ç”¨Qualifierï¼ˆæ–°å¢ä»»åŠ¡ï¼‰</s></p>\n</li>\n<li>\n<p><s>åœ¨æ£€æŸ¥å¾ªç¯ä¾èµ–æ—¶ä½¿ç”¨Qualifierï¼ˆæ–°å¢ä»»åŠ¡ï¼‰</s></p>\n</li>\n<li>\n<p><s>æ„é€ å‡½æ•°æ³¨å…¥å¯ä»¥ä½¿ç”¨Qualifierå£°æ˜ä¾èµ–ï¼ˆæ–°å¢ä»»åŠ¡ï¼‰</s></p>\n<ul>\n<li><s>ä¾èµ–ä¸­åŒ…å«Qualifierï¼ˆæ–°å¢ä»»åŠ¡ï¼‰</s></li>\n<li><s>å¦‚æœä¸æ˜¯åˆæ³•çš„Qualifierï¼Œåˆ™ç»„ä»¶éæ³•</s></li>\n</ul>\n</li>\n<li>\n<p><s>å­—æ®µæ³¨å…¥å¯ä»¥ä½¿ç”¨Qualifierå£°æ˜ä¾èµ–ï¼ˆæ–°å¢ä»»åŠ¡ï¼‰</s></p>\n<ul>\n<li><s>ä¾èµ–ä¸­åŒ…å«Qualifierï¼ˆæ–°å¢ä»»åŠ¡ï¼‰</s></li>\n<li><s>å¦‚æœä¸æ˜¯åˆæ³•çš„Qualifierï¼Œåˆ™ç»„ä»¶éæ³•</s></li>\n</ul>\n</li>\n<li>\n<p><s>å‡½æ•°æ³¨å…¥å¯ä»¥ä½¿ç”¨Qualifierå£°æ˜ä¾èµ–ï¼ˆæ–°å¢ä»»åŠ¡ï¼‰</s></p>\n<ul>\n<li><s>ä¾èµ–ä¸­åŒ…å«Qualifierï¼ˆæ–°å¢ä»»åŠ¡ï¼‰</s></li>\n<li><s>å¦‚æœä¸æ˜¯åˆæ³•çš„Qualifierï¼Œåˆ™ç»„ä»¶éæ³•</s></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><s>æ”¯æŒé»˜è®¤Qualifierâ€”â€”Namedï¼ˆä¸éœ€è¦ï¼‰</s></p>\n</li>\n<li>\n<p><s>æ³¨å†Œç»„ä»¶æ—¶ï¼Œå¯ä»ç±»å¯¹è±¡ä¸Šæå–Qualifierï¼ˆä¸éœ€è¦ï¼‰</s></p>\n</li>\n</ul>\n</li>\n<li>\n<p>Singletonç”Ÿå‘½å‘¨æœŸ</p>\n<ul>\n<li>æ³¨å†Œç»„ä»¶æ—¶ï¼Œå¯é¢å¤–æŒ‡å®šæ˜¯å¦ä¸ºSingleton</li>\n<li>æ³¨å†Œç»„ä»¶æ—¶ï¼Œå¯ä»ç±»å¯¹è±¡ä¸Šæå–Singletonæ ‡æ³¨</li>\n<li>å¯¹äºåŒ…å«Singletonæ ‡æ³¨çš„ç»„ä»¶ï¼Œåœ¨å®¹å™¨èŒƒå›´å†…æä¾›å”¯ä¸€å®ä¾‹</li>\n<li>å®¹å™¨ç»„ä»¶é»˜è®¤ä¸æ˜¯Singleç”Ÿå‘½å‘¨æœŸ</li>\n</ul>\n</li>\n<li>\n<p>è‡ªå®šä¹‰Scopeæ ‡æ³¨</p>\n<ul>\n<li>å¯å‘å®¹å™¨æ³¨å†Œè‡ªå®šä¹‰Scopeæ ‡æ³¨çš„å›è°ƒ</li>\n</ul>\n</li>\n</ul><!-- [[[read_end]]] --><h2>è§†é¢‘æ¼”ç¤º</h2><p>è®©æˆ‘ä»¬è¿›å…¥ä»Šå¤©çš„éƒ¨åˆ†ï¼š</p><p><video poster=\"https://media001.geekbang.org/7c316b9a996247188281e42792bba331/snapshots/c557516fd9a143a49f93b5ab494256fd-00005.jpg\" preload=\"none\" controls=\"\"><source src=\"https://media001.geekbang.org/customerTrans/7e27d07d27d407ebcc195a0e78395f55/1b122108-180ef02f2f9-0000-0000-01d-dbacd.mp4\" type=\"video/mp4\"><source src=\" https://media001.geekbang.org/116413030792408f96ea7b8777311757/cd0775a160f346dca41337461e00c48d-0c0f04b2da26f48aff21d9b1d119f8ca-sd.m3u8\" type=\"application/x-mpegURL\"></video></p><h2>æ€è€ƒé¢˜</h2><p>åœ¨è¿›å…¥ä¸‹èŠ‚è¯¾ä¹‹å‰ï¼Œå¸Œæœ›ä½ èƒ½è®¤çœŸæ€è€ƒå¦‚ä¸‹ä¸¤ä¸ªé—®é¢˜ï¼Œå¹¶é€‰æ‹©æœ€æœ‰æ„Ÿè§¦çš„ä¸€é“è¿›è¡Œå›ç­”ã€‚</p><ol>\n<li>å¯¹äºBindçš„é€»è¾‘è¦è¿›è¡Œä»€ä¹ˆæ ·çš„é‡æ„ï¼Ÿ</li>\n<li>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å·²ç»è¿›è¡Œäº†å¾ˆå¤šæ¬¡çš„é‡æ„ã€‚ç°åœ¨ä½ å¯¹é‡æ„çš„ä½¿ç”¨æ˜¯ä»€ä¹ˆçœ‹æ³•å‘¢ï¼Ÿ</li>\n</ol><p><strong>ç¼–è¾‘æ¥ä¿¡</strong>ï¼š</p><blockquote>\n<p>ç¬¬äºŒæœŸâ€œTDDÂ·ä»£ç è¯„ç‚¹â€æ´»åŠ¨æ­£å¼å¯åŠ¨å•¦ï¼ä¸ºäº†å¸®åŠ©ä½ æ›´å¹³æ»‘åœ°è¿‡æ¸¡åˆ°ç¬¬ä¸‰ä¸ªå®æˆ˜é¡¹ç›®ï¼Œå¾è€å¸ˆå‘èµ·äº†ä»£ç è¯„ç‚¹æ´»åŠ¨ã€‚<br>\n<strong>ã€€</strong><br>\nä½ å¯ä»¥å¡«å†™<a href=\"https://jinshuju.net/f/fnh84B\">å­¦ä¹ é—®å·</a>æäº¤é¡¹ç›®ä»£ç ï¼Œè€Œåï¼Œå¾è€å¸ˆä¼šä¸€ä¸€æŸ¥çœ‹ï¼Œå¹¶è¿›è¡Œè¯„ç‚¹ä¸ç­”ç–‘ã€‚å…³äºè¯„ç‚¹çš„è¯¦ç»†å†…å®¹ï¼Œæˆ‘ä»¬ä¹Ÿå°†åˆ¶æˆåŠ é¤å±•ç¤ºåœ¨ä¸“æ é‡Œï¼Œä¾›å…¶ä»–åŒå­¦å­¦ä¹ ä¸å‚è€ƒã€‚<br>\n<strong>ã€€</strong><br>\nè¯·æ³¨æ„ï¼Œæ­¤æ¬¡æ”¶é›†æ—¶é—´æˆªè‡³5æœˆ27æ—¥æ™šä¸Š12ç‚¹ã€‚æ­¤å¤–ï¼Œæˆ‘ä¹Ÿä¼šä»ä¸­é€‰å‡º1-2ä½åŒå­¦ï¼Œé€å‡ºã€Šé‡æ„ä¸æ¨¡å¼ã€‹ä¸€ä¹¦ã€‚è¯·æŠ“ç´§ä¸Šè½¦ï¼Œå…¥è‚¡ä¸äºå“¦ï¼</p>\n</blockquote><p>æ¬¢è¿æŠŠä½ çš„æƒ³æ³•åˆ†äº«åœ¨ç•™è¨€åŒºï¼Œä¹Ÿæ¬¢è¿æŠŠä½ çš„é¡¹ç›®ä»£ç çš„é“¾æ¥åˆ†äº«å‡ºæ¥ã€‚ç›¸ä¿¡ç»è¿‡ä½ çš„æ€è€ƒä¸å®æ“ï¼Œå­¦ä¹ æ•ˆæœä¼šæ›´å¥½ï¼</p>","neighbors":{"left":{"article_title":"32ï½œDI Containerï¼ˆ20ï¼‰ï¼šå¦‚ä½•å¯¹ä»£ç å’Œæµ‹è¯•è¿›è¡Œé‡æ„ï¼Ÿ","id":521309},"right":{"article_title":"34ï½œDI Containerï¼ˆ22ï¼‰ï¼šå¦‚ä½•å¯¹Bindçš„é€»è¾‘è¿›è¡Œé‡æ„ï¼Ÿ","id":521323}},"comments":[{"had_liked":false,"id":347671,"user_name":"å¼ é“æ—","can_delete":false,"product_type":"c1","uid":1108258,"ip_address":"","ucode":"4AB8BC6CDAC0A3","user_header":"https://static001.geekbang.org/account/avatar/00/10/e9/22/7606c6ba.jpg","comment_is_top":false,"comment_ctime":1654279485,"is_pvip":false,"replies":[{"id":"126744","content":"ä¸é”™ğŸ‘","user_name":"ç¼–è¾‘å›å¤","user_name_real":"ç¼–è¾‘","uid":"2189689","ctime":1654307681,"ip_address":"","comment_id":347671,"utype":2}],"discussion_count":1,"race_medal":0,"score":"1654279485","product_id":100109401,"comment_content":"ä»£ç å·²ç»è·Ÿç€ç å®Œäº†","like_count":0,"discussions":[{"author":{"id":2189689,"avatar":"https://static001.geekbang.org/account/avatar/00/21/69/79/b4132042.jpg","nickname":"ğŸ‘","note":"","ucode":"DE34B3B14287D1","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":574730,"discussion_content":"ä¸é”™ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1654307681,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":4}","child_discussion_number":0,"child_discussions":[]}]}]}