{"id":213295,"title":"06 | 20%çš„ä¸šåŠ¡ä»£ç çš„Springå£°æ˜å¼äº‹åŠ¡ï¼Œå¯èƒ½éƒ½æ²¡å¤„ç†æ­£ç¡®","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯æœ±æ™”ã€‚ä»Šå¤©ï¼Œæˆ‘æ¥å’Œä½ èŠèŠä¸šåŠ¡ä»£ç ä¸­ä¸æ•°æ®åº“äº‹åŠ¡ç›¸å…³çš„å‘ã€‚</p><p>Springé’ˆå¯¹Java Transaction API (JTA)ã€JDBCã€Hibernateå’ŒJava Persistence API (JPA)ç­‰äº‹åŠ¡APIï¼Œå®ç°äº†ä¸€è‡´çš„ç¼–ç¨‹æ¨¡å‹ï¼Œè€ŒSpringçš„å£°æ˜å¼äº‹åŠ¡åŠŸèƒ½æ›´æ˜¯æä¾›äº†æå…¶æ–¹ä¾¿çš„äº‹åŠ¡é…ç½®æ–¹å¼ï¼Œé…åˆSpring Bootçš„è‡ªåŠ¨é…ç½®ï¼Œå¤§å¤šæ•°Spring Booté¡¹ç›®åªéœ€è¦åœ¨æ–¹æ³•ä¸Šæ ‡è®°@Transactionalæ³¨è§£ï¼Œå³å¯ä¸€é”®å¼€å¯æ–¹æ³•çš„äº‹åŠ¡æ€§é…ç½®ã€‚</p><p>æ®æˆ‘è§‚å¯Ÿï¼Œå¤§å¤šæ•°ä¸šåŠ¡å¼€å‘åŒå­¦éƒ½æœ‰äº‹åŠ¡çš„æ¦‚å¿µï¼Œä¹ŸçŸ¥é“å¦‚æœæ•´ä½“è€ƒè™‘å¤šä¸ªæ•°æ®åº“æ“ä½œè¦ä¹ˆæˆåŠŸè¦ä¹ˆå¤±è´¥æ—¶ï¼Œéœ€è¦é€šè¿‡æ•°æ®åº“äº‹åŠ¡æ¥å®ç°å¤šä¸ªæ“ä½œçš„ä¸€è‡´æ€§å’ŒåŸå­æ€§ã€‚ä½†ï¼Œåœ¨ä½¿ç”¨ä¸Šå¤§å¤šä»…é™äºä¸ºæ–¹æ³•æ ‡è®°@Transactionalï¼Œä¸ä¼šå»å…³æ³¨äº‹åŠ¡æ˜¯å¦æœ‰æ•ˆã€å‡ºé”™åäº‹åŠ¡æ˜¯å¦æ­£ç¡®å›æ»šï¼Œä¹Ÿä¸ä¼šè€ƒè™‘å¤æ‚çš„ä¸šåŠ¡ä»£ç ä¸­æ¶‰åŠå¤šä¸ªå­ä¸šåŠ¡é€»è¾‘æ—¶ï¼Œæ€ä¹ˆæ­£ç¡®å¤„ç†äº‹åŠ¡ã€‚</p><p>äº‹åŠ¡æ²¡æœ‰è¢«æ­£ç¡®å¤„ç†ï¼Œä¸€èˆ¬æ¥è¯´ä¸ä¼šè¿‡äºå½±å“æ­£å¸¸æµç¨‹ï¼Œä¹Ÿä¸å®¹æ˜“åœ¨æµ‹è¯•é˜¶æ®µè¢«å‘ç°ã€‚ä½†å½“ç³»ç»Ÿè¶Šæ¥è¶Šå¤æ‚ã€å‹åŠ›è¶Šæ¥è¶Šå¤§ä¹‹åï¼Œå°±ä¼šå¸¦æ¥å¤§é‡çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜ï¼Œéšåå°±æ˜¯å¤§é‡çš„äººå·¥ä»‹å…¥æŸ¥çœ‹å’Œä¿®å¤æ•°æ®ã€‚</p><p>æ‰€ä»¥è¯´ï¼Œä¸€ä¸ªæˆç†Ÿçš„ä¸šåŠ¡ç³»ç»Ÿå’Œä¸€ä¸ªåŸºæœ¬å¯ç”¨èƒ½å®ŒæˆåŠŸèƒ½çš„ä¸šåŠ¡ç³»ç»Ÿï¼Œåœ¨äº‹åŠ¡å¤„ç†ç»†èŠ‚ä¸Šçš„å·®å¼‚éå¸¸å¤§ã€‚è¦ç¡®ä¿äº‹åŠ¡çš„é…ç½®ç¬¦åˆä¸šåŠ¡åŠŸèƒ½çš„éœ€æ±‚ï¼Œå¾€å¾€ä¸ä»…ä»…æ˜¯æŠ€æœ¯é—®é¢˜ï¼Œè¿˜æ¶‰åŠäº§å“æµç¨‹å’Œæ¶æ„è®¾è®¡çš„é—®é¢˜ã€‚ä»Šå¤©è¿™ä¸€è®²çš„æ ‡é¢˜â€œ20%çš„ä¸šåŠ¡ä»£ç çš„Springå£°æ˜å¼äº‹åŠ¡ï¼Œå¯èƒ½éƒ½æ²¡å¤„ç†æ­£ç¡®â€ä¸­ï¼Œ20%è¿™ä¸ªæ•°å­—åœ¨æˆ‘çœ‹æ¥è¿˜æ˜¯æ¯”è¾ƒä¿å®ˆçš„ã€‚</p><!-- [[[read_end]]] --><p>æˆ‘ä»Šå¤©è¦åˆ†äº«çš„å†…å®¹ï¼Œå°±æ˜¯å¸®åŠ©ä½ åœ¨æŠ€æœ¯é—®é¢˜ä¸Šç†æ¸…æ€è·¯ï¼Œé¿å…å› ä¸ºäº‹åŠ¡å¤„ç†ä¸å½“è®©ä¸šåŠ¡é€»è¾‘çš„å®ç°äº§ç”Ÿå¤§é‡å¶å‘Bugã€‚</p><h2>å°å¿ƒSpringçš„äº‹åŠ¡å¯èƒ½æ²¡æœ‰ç”Ÿæ•ˆ</h2><p>åœ¨ä½¿ç”¨@Transactionalæ³¨è§£å¼€å¯å£°æ˜å¼äº‹åŠ¡æ—¶ï¼Œ ç¬¬ä¸€ä¸ªæœ€å®¹æ˜“å¿½ç•¥çš„é—®é¢˜æ˜¯ï¼Œå¾ˆå¯èƒ½äº‹åŠ¡å¹¶æ²¡æœ‰ç”Ÿæ•ˆã€‚</p><p>å®ç°ä¸‹é¢çš„Demoéœ€è¦ä¸€äº›åŸºç¡€ç±»ï¼Œé¦–å…ˆå®šä¹‰ä¸€ä¸ªå…·æœ‰IDå’Œå§“åå±æ€§çš„UserEntityï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªå­—æ®µçš„ç”¨æˆ·è¡¨ï¼š</p><pre><code>@Entity\n@Data\npublic class UserEntity {\n    @Id\n    @GeneratedValue(strategy = AUTO)\n    private Long id;\n    private String name;\n\n    public UserEntity() { }\n\n    public UserEntity(String name) {\n        this.name = name;\n    }\n}\n</code></pre><p>ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œæˆ‘ä½¿ç”¨Spring JPAåšæ•°æ®åº“è®¿é—®ï¼Œå®ç°è¿™æ ·ä¸€ä¸ªRepositoryï¼Œæ–°å¢ä¸€ä¸ªæ ¹æ®ç”¨æˆ·åæŸ¥è¯¢æ‰€æœ‰æ•°æ®çš„æ–¹æ³•ï¼š</p><pre><code>@Repository\npublic interface UserRepository extends JpaRepository&lt;UserEntity, Long&gt; {\n    List&lt;UserEntity&gt; findByName(String name);\n}\n</code></pre><p>å®šä¹‰ä¸€ä¸ªUserServiceç±»ï¼Œè´Ÿè´£ä¸šåŠ¡é€»è¾‘å¤„ç†ã€‚å¦‚æœä¸æ¸…æ¥š@Transactionalçš„å®ç°æ–¹å¼ï¼Œåªè€ƒè™‘ä»£ç é€»è¾‘çš„è¯ï¼Œè¿™æ®µä»£ç çœ‹èµ·æ¥æ²¡æœ‰é—®é¢˜ã€‚</p><p>å®šä¹‰ä¸€ä¸ªå…¥å£æ–¹æ³•createUserWrong1æ¥è°ƒç”¨å¦ä¸€ä¸ªç§æœ‰æ–¹æ³•createUserPrivateï¼Œç§æœ‰æ–¹æ³•ä¸Šæ ‡è®°äº†@Transactionalæ³¨è§£ã€‚å½“ä¼ å…¥çš„ç”¨æˆ·ååŒ…å«testå…³é”®å­—æ—¶åˆ¤æ–­ä¸ºç”¨æˆ·åä¸åˆæ³•ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼Œè®©ç”¨æˆ·åˆ›å»ºæ“ä½œå¤±è´¥ï¼ŒæœŸæœ›äº‹åŠ¡å¯ä»¥å›æ»šï¼š</p><pre><code>@Service\n@Slf4j\npublic class UserService {\n    @Autowired\n    private UserRepository userRepository;\n\n    //ä¸€ä¸ªå…¬å…±æ–¹æ³•ä¾›Controllerè°ƒç”¨ï¼Œå†…éƒ¨è°ƒç”¨äº‹åŠ¡æ€§çš„ç§æœ‰æ–¹æ³•\n    public int createUserWrong1(String name) {\n        try {\n            this.createUserPrivate(new UserEntity(name));\n        } catch (Exception ex) {\n            log.error(&quot;create user failed because {}&quot;, ex.getMessage());\n        }\n        return userRepository.findByName(name).size();\n    }\n\n    //æ ‡è®°äº†@Transactionalçš„privateæ–¹æ³•\n    @Transactional\n    private void createUserPrivate(UserEntity entity) {\n        userRepository.save(entity);\n        if (entity.getName().contains(&quot;test&quot;))\n            throw new RuntimeException(&quot;invalid username!&quot;);\n    }\n\n    //æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·æ•°\n    public int getUserCount(String name) {\n        return userRepository.findByName(name).size();\n    }\n}\n</code></pre><p>ä¸‹é¢æ˜¯Controllerçš„å®ç°ï¼Œåªæ˜¯è°ƒç”¨ä¸€ä¸‹åˆšæ‰å®šä¹‰çš„UserServiceä¸­çš„å…¥å£æ–¹æ³•createUserWrong1ã€‚</p><pre><code>@Autowired\nprivate UserService userService;\n\n\n@GetMapping(&quot;wrong1&quot;)\npublic int wrong1(@RequestParam(&quot;name&quot;) String name) {\n    return userService.createUserWrong1(name);\n}\n</code></pre><p>è°ƒç”¨æ¥å£åå‘ç°ï¼Œå³ä¾¿ç”¨æˆ·åä¸åˆæ³•ï¼Œç”¨æˆ·ä¹Ÿèƒ½åˆ›å»ºæˆåŠŸã€‚åˆ·æ–°æµè§ˆå™¨ï¼Œå¤šæ¬¡å‘ç°æœ‰åå‡ ä¸ªçš„éæ³•ç”¨æˆ·æ³¨å†Œã€‚</p><p>è¿™é‡Œç»™å‡º@Transactionalç”Ÿæ•ˆåŸåˆ™1ï¼Œ<strong>é™¤éç‰¹æ®Šé…ç½®ï¼ˆæ¯”å¦‚ä½¿ç”¨AspectJé™æ€ç»‡å…¥å®ç°AOPï¼‰ï¼Œå¦åˆ™åªæœ‰å®šä¹‰åœ¨publicæ–¹æ³•ä¸Šçš„@Transactionalæ‰èƒ½ç”Ÿæ•ˆ</strong>ã€‚åŸå› æ˜¯ï¼ŒSpringé»˜è®¤é€šè¿‡åŠ¨æ€ä»£ç†çš„æ–¹å¼å®ç°AOPï¼Œå¯¹ç›®æ ‡æ–¹æ³•è¿›è¡Œå¢å¼ºï¼Œprivateæ–¹æ³•æ— æ³•ä»£ç†åˆ°ï¼ŒSpringè‡ªç„¶ä¹Ÿæ— æ³•åŠ¨æ€å¢å¼ºäº‹åŠ¡å¤„ç†é€»è¾‘ã€‚</p><p>ä½ å¯èƒ½ä¼šè¯´ï¼Œä¿®å¤æ–¹å¼å¾ˆç®€å•ï¼ŒæŠŠæ ‡è®°äº†äº‹åŠ¡æ³¨è§£çš„createUserPrivateæ–¹æ³•æ”¹ä¸ºpublicå³å¯ã€‚åœ¨UserServiceä¸­å†å»ºä¸€ä¸ªå…¥å£æ–¹æ³•createUserWrong2ï¼Œæ¥è°ƒç”¨è¿™ä¸ªpublicæ–¹æ³•å†æ¬¡å°è¯•ï¼š</p><pre><code>public int createUserWrong2(String name) {\n    try {\n        this.createUserPublic(new UserEntity(name));\n    } catch (Exception ex) {\n        log.error(&quot;create user failed because {}&quot;, ex.getMessage());\n    }\n\treturn userRepository.findByName(name).size();\n}\n\n//æ ‡è®°äº†@Transactionalçš„publicæ–¹æ³•\n@Transactional\npublic void createUserPublic(UserEntity entity) {\n    userRepository.save(entity);\n    if (entity.getName().contains(&quot;test&quot;))\n        throw new RuntimeException(&quot;invalid username!&quot;);\n}\n</code></pre><p>æµ‹è¯•å‘ç°ï¼Œè°ƒç”¨æ–°çš„createUserWrong2æ–¹æ³•äº‹åŠ¡åŒæ ·ä¸ç”Ÿæ•ˆã€‚è¿™é‡Œï¼Œæˆ‘ç»™å‡º@Transactionalç”Ÿæ•ˆåŸåˆ™2ï¼Œ<strong>å¿…é¡»é€šè¿‡ä»£ç†è¿‡çš„ç±»ä»å¤–éƒ¨è°ƒç”¨ç›®æ ‡æ–¹æ³•æ‰èƒ½ç”Ÿæ•ˆ</strong>ã€‚</p><p>Springé€šè¿‡AOPæŠ€æœ¯å¯¹æ–¹æ³•è¿›è¡Œå¢å¼ºï¼Œè¦è°ƒç”¨å¢å¼ºè¿‡çš„æ–¹æ³•å¿…ç„¶æ˜¯è°ƒç”¨ä»£ç†åçš„å¯¹è±¡ã€‚æˆ‘ä»¬å°è¯•ä¿®æ”¹ä¸‹UserServiceçš„ä»£ç ï¼Œæ³¨å…¥ä¸€ä¸ªselfï¼Œç„¶åå†é€šè¿‡selfå®ä¾‹è°ƒç”¨æ ‡è®°æœ‰@Transactionalæ³¨è§£çš„createUserPublicæ–¹æ³•ã€‚è®¾ç½®æ–­ç‚¹å¯ä»¥çœ‹åˆ°ï¼Œselfæ˜¯ç”±Springé€šè¿‡CGLIBæ–¹å¼å¢å¼ºè¿‡çš„ç±»ï¼š</p><ul>\n<li>CGLIBé€šè¿‡ç»§æ‰¿æ–¹å¼å®ç°ä»£ç†ç±»ï¼Œprivateæ–¹æ³•åœ¨å­ç±»ä¸å¯è§ï¼Œè‡ªç„¶ä¹Ÿå°±æ— æ³•è¿›è¡Œäº‹åŠ¡å¢å¼ºï¼›</li>\n<li>thisæŒ‡é’ˆä»£è¡¨å¯¹è±¡è‡ªå·±ï¼ŒSpringä¸å¯èƒ½æ³¨å…¥thisï¼Œæ‰€ä»¥é€šè¿‡thisè®¿é—®æ–¹æ³•å¿…ç„¶ä¸æ˜¯ä»£ç†ã€‚</li>\n</ul><p><img src=\"https://static001.geekbang.org/resource/image/b0/6c/b077c033fa394353309fbb4f8368e46c.png?wh=2146*1248\" alt=\"\"></p><p>æŠŠthisæ”¹ä¸ºselfåæµ‹è¯•å‘ç°ï¼Œåœ¨Controllerä¸­è°ƒç”¨createUserRightæ–¹æ³•å¯ä»¥éªŒè¯äº‹åŠ¡æ˜¯ç”Ÿæ•ˆçš„ï¼Œéæ³•çš„ç”¨æˆ·æ³¨å†Œæ“ä½œå¯ä»¥å›æ»šã€‚</p><p>è™½ç„¶åœ¨UserServiceå†…éƒ¨æ³¨å…¥è‡ªå·±è°ƒç”¨è‡ªå·±çš„createUserPublicå¯ä»¥æ­£ç¡®å®ç°äº‹åŠ¡ï¼Œä½†æ›´åˆç†çš„å®ç°æ–¹å¼æ˜¯ï¼Œè®©Controllerç›´æ¥è°ƒç”¨ä¹‹å‰å®šä¹‰çš„UserServiceçš„createUserPublicæ–¹æ³•ï¼Œå› ä¸ºæ³¨å…¥è‡ªå·±è°ƒç”¨è‡ªå·±å¾ˆå¥‡æ€ªï¼Œä¹Ÿä¸ç¬¦åˆåˆ†å±‚å®ç°çš„è§„èŒƒï¼š</p><pre><code>@GetMapping(&quot;right2&quot;)\npublic int right2(@RequestParam(&quot;name&quot;) String name) {\n    try {\n        userService.createUserPublic(new UserEntity(name));\n    } catch (Exception ex) {\n        log.error(&quot;create user failed because {}&quot;, ex.getMessage());\n    }\n    return userService.getUserCount(name);\n}\n</code></pre><p>æˆ‘ä»¬å†é€šè¿‡ä¸€å¼ å›¾æ¥å›é¡¾ä¸‹thisè‡ªè°ƒç”¨ã€é€šè¿‡selfè°ƒç”¨ï¼Œä»¥åŠåœ¨Controllerä¸­è°ƒç”¨UserServiceä¸‰ç§å®ç°çš„åŒºåˆ«ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/c4/70/c43ea620b0b611ae194f8438506d7570.png?wh=1860*866\" alt=\"\"></p><p>é€šè¿‡thisè‡ªè°ƒç”¨ï¼Œæ²¡æœ‰æœºä¼šèµ°åˆ°Springçš„ä»£ç†ç±»ï¼›åä¸¤ç§æ”¹è¿›æ–¹æ¡ˆè°ƒç”¨çš„æ˜¯Springæ³¨å…¥çš„UserServiceï¼Œé€šè¿‡ä»£ç†è°ƒç”¨æ‰æœ‰æœºä¼šå¯¹createUserPublicæ–¹æ³•è¿›è¡ŒåŠ¨æ€å¢å¼ºã€‚</p><p>è¿™é‡Œï¼Œæˆ‘è¿˜æœ‰ä¸€ä¸ªå°æŠ€å·§ï¼Œ<strong>å¼ºçƒˆå»ºè®®ä½ åœ¨å¼€å‘æ—¶æ‰“å¼€ç›¸å…³çš„Debugæ—¥å¿—ï¼Œä»¥æ–¹ä¾¿äº†è§£Springäº‹åŠ¡å®ç°çš„ç»†èŠ‚ï¼Œå¹¶åŠæ—¶åˆ¤æ–­äº‹åŠ¡çš„æ‰§è¡Œæƒ…å†µ</strong>ã€‚</p><p>æˆ‘ä»¬çš„Demoä»£ç ä½¿ç”¨JPAè¿›è¡Œæ•°æ®åº“è®¿é—®ï¼Œå¯ä»¥è¿™ä¹ˆå¼€å¯Debugæ—¥å¿—ï¼š</p><pre><code>logging.level.org.springframework.orm.jpa=DEBUG\n</code></pre><p>å¼€å¯æ—¥å¿—åï¼Œæˆ‘ä»¬å†æ¯”è¾ƒä¸‹åœ¨UserServiceä¸­é€šè¿‡thisè°ƒç”¨å’Œåœ¨Controllerä¸­é€šè¿‡æ³¨å…¥çš„UserService Beanè°ƒç”¨createUserPublicåŒºåˆ«ã€‚å¾ˆæ˜æ˜¾ï¼Œthisè°ƒç”¨å› ä¸ºæ²¡æœ‰èµ°ä»£ç†ï¼Œäº‹åŠ¡æ²¡æœ‰åœ¨createUserPublicæ–¹æ³•ä¸Šç”Ÿæ•ˆï¼Œåªåœ¨Repositoryçš„saveæ–¹æ³•å±‚é¢ç”Ÿæ•ˆï¼š</p><pre><code>//åœ¨UserServiceä¸­é€šè¿‡thisè°ƒç”¨publicçš„createUserPublic\n[10:10:19.913] [http-nio-45678-exec-1] [DEBUG] [o.s.orm.jpa.JpaTransactionManager       :370 ] - Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT\n//åœ¨Controllerä¸­é€šè¿‡æ³¨å…¥çš„UserService Beanè°ƒç”¨createUserPublic\n[10:10:47.750] [http-nio-45678-exec-6] [DEBUG] [o.s.orm.jpa.JpaTransactionManager       :370 ] - Creating new transaction with name [org.geekbang.time.commonmistakes.transaction.demo1.UserService.createUserPublic]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT\n</code></pre><p>ä½ å¯èƒ½è¿˜ä¼šè€ƒè™‘ä¸€ä¸ªé—®é¢˜ï¼Œè¿™ç§å®ç°åœ¨Controlleré‡Œå¤„ç†äº†å¼‚å¸¸æ˜¾å¾—æœ‰ç‚¹ç¹çï¼Œè¿˜ä¸å¦‚ç›´æ¥æŠŠcreateUserWrong2æ–¹æ³•åŠ ä¸Š@Transactionalæ³¨è§£ï¼Œç„¶ååœ¨Controllerä¸­ç›´æ¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚è¿™æ ·ä¸€æ¥ï¼Œæ—¢èƒ½ä»å¤–éƒ¨ï¼ˆControllerä¸­ï¼‰è°ƒç”¨UserServiceä¸­çš„æ–¹æ³•ï¼Œæ–¹æ³•åˆæ˜¯publicçš„èƒ½å¤Ÿè¢«åŠ¨æ€ä»£ç†AOPå¢å¼ºã€‚</p><p>ä½ å¯ä»¥è¯•ä¸€ä¸‹è¿™ç§æ–¹æ³•ï¼Œä½†å¾ˆå®¹æ˜“å°±ä¼šè¸©ç¬¬äºŒä¸ªå‘ï¼Œå³å› ä¸ºæ²¡æœ‰æ­£ç¡®å¤„ç†å¼‚å¸¸ï¼Œå¯¼è‡´äº‹åŠ¡å³ä¾¿ç”Ÿæ•ˆä¹Ÿä¸ä¸€å®šèƒ½å›æ»šã€‚</p><h2>äº‹åŠ¡å³ä¾¿ç”Ÿæ•ˆä¹Ÿä¸ä¸€å®šèƒ½å›æ»š</h2><p>é€šè¿‡AOPå®ç°äº‹åŠ¡å¤„ç†å¯ä»¥ç†è§£ä¸ºï¼Œä½¿ç”¨tryâ€¦catchâ€¦æ¥åŒ…è£¹æ ‡è®°äº†@Transactionalæ³¨è§£çš„æ–¹æ³•ï¼Œ<strong>å½“æ–¹æ³•å‡ºç°äº†å¼‚å¸¸å¹¶ä¸”æ»¡è¶³ä¸€å®šæ¡ä»¶çš„æ—¶å€™</strong>ï¼Œåœ¨catché‡Œé¢æˆ‘ä»¬å¯ä»¥è®¾ç½®äº‹åŠ¡å›æ»šï¼Œæ²¡æœ‰å¼‚å¸¸åˆ™ç›´æ¥æäº¤äº‹åŠ¡ã€‚</p><p>è¿™é‡Œçš„â€œä¸€å®šæ¡ä»¶â€ï¼Œä¸»è¦åŒ…æ‹¬ä¸¤ç‚¹ã€‚</p><p>ç¬¬ä¸€ï¼Œ<strong>åªæœ‰å¼‚å¸¸ä¼ æ’­å‡ºäº†æ ‡è®°äº†@Transactionalæ³¨è§£çš„æ–¹æ³•ï¼Œäº‹åŠ¡æ‰èƒ½å›æ»š</strong>ã€‚åœ¨Springçš„TransactionAspectSupporté‡Œæœ‰ä¸ª invokeWithinTransactionæ–¹æ³•ï¼Œé‡Œé¢å°±æ˜¯å¤„ç†äº‹åŠ¡çš„é€»è¾‘ã€‚å¯ä»¥çœ‹åˆ°ï¼Œåªæœ‰æ•è·åˆ°å¼‚å¸¸æ‰èƒ½è¿›è¡Œåç»­äº‹åŠ¡å¤„ç†ï¼š</p><pre><code>try {\n   // This is an around advice: Invoke the next interceptor in the chain.\n   // This will normally result in a target object being invoked.\n   retVal = invocation.proceedWithInvocation();\n}\ncatch (Throwable ex) {\n   // target invocation exception\n   completeTransactionAfterThrowing(txInfo, ex);\n   throw ex;\n}\nfinally {\n   cleanupTransactionInfo(txInfo);\n}\n</code></pre><p>ç¬¬äºŒï¼Œ<strong>é»˜è®¤æƒ…å†µä¸‹ï¼Œå‡ºç°RuntimeExceptionï¼ˆéå—æ£€å¼‚å¸¸ï¼‰æˆ–Errorçš„æ—¶å€™ï¼ŒSpringæ‰ä¼šå›æ»šäº‹åŠ¡</strong>ã€‚</p><p>æ‰“å¼€Springçš„DefaultTransactionAttributeç±»èƒ½çœ‹åˆ°å¦‚ä¸‹ä»£ç å—ï¼Œå¯ä»¥å‘ç°ç›¸å…³è¯æ®ï¼Œé€šè¿‡æ³¨é‡Šä¹Ÿèƒ½çœ‹åˆ°Springè¿™ä¹ˆåšçš„åŸå› ï¼Œå¤§æ¦‚çš„æ„æ€æ˜¯å—æ£€å¼‚å¸¸ä¸€èˆ¬æ˜¯ä¸šåŠ¡å¼‚å¸¸ï¼Œæˆ–è€…è¯´æ˜¯ç±»ä¼¼å¦ä¸€ç§æ–¹æ³•çš„è¿”å›å€¼ï¼Œå‡ºç°è¿™æ ·çš„å¼‚å¸¸å¯èƒ½ä¸šåŠ¡è¿˜èƒ½å®Œæˆï¼Œæ‰€ä»¥ä¸ä¼šä¸»åŠ¨å›æ»šï¼›è€ŒErroræˆ–RuntimeExceptionä»£è¡¨äº†éé¢„æœŸçš„ç»“æœï¼Œåº”è¯¥å›æ»šï¼š</p><pre><code>/**\n * The default behavior is as with EJB: rollback on unchecked exception\n * ({@link RuntimeException}), assuming an unexpected outcome outside of any\n * business rules. Additionally, we also attempt to rollback on {@link Error} which\n * is clearly an unexpected outcome as well. By contrast, a checked exception is\n * considered a business exception and therefore a regular expected outcome of the\n * transactional business method, i.e. a kind of alternative return value which\n * still allows for regular completion of resource operations.\n * &lt;p&gt;This is largely consistent with TransactionTemplate's default behavior,\n * except that TransactionTemplate also rolls back on undeclared checked exceptions\n * (a corner case). For declarative transactions, we expect checked exceptions to be\n * intentionally declared as business exceptions, leading to a commit by default.\n * @see org.springframework.transaction.support.TransactionTemplate#execute\n */\n@Override\npublic boolean rollbackOn(Throwable ex) {\n   return (ex instanceof RuntimeException || ex instanceof Error);\n}\n</code></pre><p>æ¥ä¸‹æ¥ï¼Œæˆ‘å’Œä½ åˆ†äº«2ä¸ªåä¾‹ã€‚</p><p>é‡æ–°å®ç°ä¸€ä¸‹UserServiceä¸­çš„æ³¨å†Œç”¨æˆ·æ“ä½œï¼š</p><ul>\n<li>åœ¨createUserWrong1æ–¹æ³•ä¸­ä¼šæŠ›å‡ºä¸€ä¸ªRuntimeExceptionï¼Œä½†ç”±äºæ–¹æ³•å†…catchäº†æ‰€æœ‰å¼‚å¸¸ï¼Œå¼‚å¸¸æ— æ³•ä»æ–¹æ³•ä¼ æ’­å‡ºå»ï¼Œäº‹åŠ¡è‡ªç„¶æ— æ³•å›æ»šã€‚</li>\n<li>åœ¨createUserWrong2æ–¹æ³•ä¸­ï¼Œæ³¨å†Œç”¨æˆ·çš„åŒæ—¶ä¼šæœ‰ä¸€æ¬¡otherTaskæ–‡ä»¶è¯»å–æ“ä½œï¼Œå¦‚æœæ–‡ä»¶è¯»å–å¤±è´¥ï¼Œæˆ‘ä»¬å¸Œæœ›ç”¨æˆ·æ³¨å†Œçš„æ•°æ®åº“æ“ä½œå›æ»šã€‚è™½ç„¶è¿™é‡Œæ²¡æœ‰æ•è·å¼‚å¸¸ï¼Œä½†å› ä¸ºotherTaskæ–¹æ³•æŠ›å‡ºçš„æ˜¯å—æ£€å¼‚å¸¸ï¼ŒcreateUserWrong2ä¼ æ’­å‡ºå»çš„ä¹Ÿæ˜¯å—æ£€å¼‚å¸¸ï¼Œäº‹åŠ¡åŒæ ·ä¸ä¼šå›æ»šã€‚</li>\n</ul><pre><code>@Service\n@Slf4j\npublic class UserService {\n    @Autowired\n    private UserRepository userRepository;\n    \n    //å¼‚å¸¸æ— æ³•ä¼ æ’­å‡ºæ–¹æ³•ï¼Œå¯¼è‡´äº‹åŠ¡æ— æ³•å›æ»š\n    @Transactional\n    public void createUserWrong1(String name) {\n        try {\n            userRepository.save(new UserEntity(name));\n            throw new RuntimeException(&quot;error&quot;);\n        } catch (Exception ex) {\n            log.error(&quot;create user failed&quot;, ex);\n        }\n    }\n\n    //å³ä½¿å‡ºäº†å—æ£€å¼‚å¸¸ä¹Ÿæ— æ³•è®©äº‹åŠ¡å›æ»š\n    @Transactional\n    public void createUserWrong2(String name) throws IOException {\n        userRepository.save(new UserEntity(name));\n        otherTask();\n    }\n\n    //å› ä¸ºæ–‡ä»¶ä¸å­˜åœ¨ï¼Œä¸€å®šä¼šæŠ›å‡ºä¸€ä¸ªIOException\n    private void otherTask() throws IOException {\n        Files.readAllLines(Paths.get(&quot;file-that-not-exist&quot;));\n    }\n}\n</code></pre><p>Controllerä¸­çš„å®ç°ï¼Œä»…ä»…æ˜¯è°ƒç”¨UserServiceçš„createUserWrong1å’ŒcreateUserWrong2æ–¹æ³•ï¼Œè¿™é‡Œå°±è´´å‡ºå®ç°äº†ã€‚è¿™2ä¸ªæ–¹æ³•çš„å®ç°å’Œè°ƒç”¨ï¼Œè™½ç„¶å®Œå…¨é¿å¼€äº†äº‹åŠ¡ä¸ç”Ÿæ•ˆçš„å‘ï¼Œä½†å› ä¸ºå¼‚å¸¸å¤„ç†ä¸å½“ï¼Œå¯¼è‡´ç¨‹åºæ²¡æœ‰å¦‚æˆ‘ä»¬æœŸæœ›çš„æ–‡ä»¶æ“ä½œå‡ºç°å¼‚å¸¸æ—¶å›æ»šäº‹åŠ¡ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ä¿®å¤æ–¹å¼ï¼Œä»¥åŠå¦‚ä½•é€šè¿‡æ—¥å¿—æ¥éªŒè¯æ˜¯å¦ä¿®å¤æˆåŠŸã€‚é’ˆå¯¹è¿™2ç§æƒ…å†µï¼Œå¯¹åº”çš„ä¿®å¤æ–¹æ³•å¦‚ä¸‹ã€‚</p><p>ç¬¬ä¸€ï¼Œå¦‚æœä½ å¸Œæœ›è‡ªå·±æ•è·å¼‚å¸¸è¿›è¡Œå¤„ç†çš„è¯ï¼Œä¹Ÿæ²¡å…³ç³»ï¼Œå¯ä»¥æ‰‹åŠ¨è®¾ç½®è®©å½“å‰äº‹åŠ¡å¤„äºå›æ»šçŠ¶æ€ï¼š</p><pre><code>@Transactional\npublic void createUserRight1(String name) {\n    try {\n        userRepository.save(new UserEntity(name));\n        throw new RuntimeException(&quot;error&quot;);\n    } catch (Exception ex) {\n        log.error(&quot;create user failed&quot;, ex);\n        TransactionAspectSupport.currentTransactionStatus().setRollbackOnly();\n    }\n}\n</code></pre><p>è¿è¡Œåå¯ä»¥åœ¨æ—¥å¿—ä¸­çœ‹åˆ°Rolling backå­—æ ·ï¼Œç¡®è®¤äº‹åŠ¡å›æ»šäº†ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜æ³¨æ„åˆ°â€œTransactional code has requested rollbackâ€çš„æç¤ºï¼Œè¡¨æ˜æ‰‹åŠ¨è¯·æ±‚å›æ»šï¼š</p><pre><code>[22:14:49.352] [http-nio-45678-exec-4] [DEBUG] [o.s.orm.jpa.JpaTransactionManager       :698 ] - Transactional code has requested rollback\n[22:14:49.353] [http-nio-45678-exec-4] [DEBUG] [o.s.orm.jpa.JpaTransactionManager       :834 ] - Initiating transaction rollback\n[22:14:49.353] [http-nio-45678-exec-4] [DEBUG] [o.s.orm.jpa.JpaTransactionManager       :555 ] - Rolling back JPA transaction on EntityManager [SessionImpl(1906719643&lt;open&gt;)]\n</code></pre><p>ç¬¬äºŒï¼Œåœ¨æ³¨è§£ä¸­å£°æ˜ï¼ŒæœŸæœ›é‡åˆ°æ‰€æœ‰çš„Exceptionéƒ½å›æ»šäº‹åŠ¡ï¼ˆæ¥çªç ´é»˜è®¤ä¸å›æ»šå—æ£€å¼‚å¸¸çš„é™åˆ¶ï¼‰ï¼š</p><pre><code>@Transactional(rollbackFor = Exception.class)\npublic void createUserRight2(String name) throws IOException {\n    userRepository.save(new UserEntity(name));\n    otherTask();\n}\n</code></pre><p>è¿è¡Œåï¼ŒåŒæ ·å¯ä»¥åœ¨æ—¥å¿—ä¸­çœ‹åˆ°å›æ»šçš„æç¤ºï¼š</p><pre><code>[22:10:47.980] [http-nio-45678-exec-4] [DEBUG] [o.s.orm.jpa.JpaTransactionManager       :834 ] - Initiating transaction rollback\n[22:10:47.981] [http-nio-45678-exec-4] [DEBUG] [o.s.orm.jpa.JpaTransactionManager       :555 ] - Rolling back JPA transaction on EntityManager [SessionImpl(1419329213&lt;open&gt;)]\n</code></pre><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å±•ç°çš„æ˜¯ä¸€ä¸ªå¤æ‚çš„ä¸šåŠ¡é€»è¾‘ï¼Œå…¶ä¸­æœ‰æ•°æ®åº“æ“ä½œã€IOæ“ä½œï¼Œåœ¨IOæ“ä½œå‡ºç°é—®é¢˜æ—¶å¸Œæœ›è®©æ•°æ®åº“äº‹åŠ¡ä¹Ÿå›æ»šï¼Œä»¥ç¡®ä¿é€»è¾‘çš„ä¸€è‡´æ€§ã€‚åœ¨æœ‰äº›ä¸šåŠ¡é€»è¾‘ä¸­ï¼Œå¯èƒ½ä¼šåŒ…å«å¤šæ¬¡æ•°æ®åº“æ“ä½œï¼Œæˆ‘ä»¬ä¸ä¸€å®šå¸Œæœ›å°†ä¸¤æ¬¡æ“ä½œä½œä¸ºä¸€ä¸ªäº‹åŠ¡æ¥å¤„ç†ï¼Œè¿™æ—¶å€™å°±éœ€è¦ä»”ç»†è€ƒè™‘äº‹åŠ¡ä¼ æ’­çš„é…ç½®äº†ï¼Œå¦åˆ™ä¹Ÿå¯èƒ½è¸©å‘ã€‚</p><h2>è¯·ç¡®è®¤äº‹åŠ¡ä¼ æ’­é…ç½®æ˜¯å¦ç¬¦åˆè‡ªå·±çš„ä¸šåŠ¡é€»è¾‘</h2><p>æœ‰è¿™ä¹ˆä¸€ä¸ªåœºæ™¯ï¼šä¸€ä¸ªç”¨æˆ·æ³¨å†Œçš„æ“ä½œï¼Œä¼šæ’å…¥ä¸€ä¸ªä¸»ç”¨æˆ·åˆ°ç”¨æˆ·è¡¨ï¼Œè¿˜ä¼šæ³¨å†Œä¸€ä¸ªå…³è”çš„å­ç”¨æˆ·ã€‚æˆ‘ä»¬å¸Œæœ›å°†å­ç”¨æˆ·æ³¨å†Œçš„æ•°æ®åº“æ“ä½œä½œä¸ºä¸€ä¸ªç‹¬ç«‹äº‹åŠ¡æ¥å¤„ç†ï¼Œå³ä½¿å¤±è´¥ä¹Ÿä¸ä¼šå½±å“ä¸»æµç¨‹ï¼Œå³ä¸å½±å“ä¸»ç”¨æˆ·çš„æ³¨å†Œã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¨¡æ‹Ÿä¸€ä¸ªå®ç°ç±»ä¼¼ä¸šåŠ¡é€»è¾‘çš„UserServiceï¼š</p><pre><code>@Autowired\nprivate UserRepository userRepository;\n\n@Autowired\nprivate SubUserService subUserService;\n\n@Transactional\npublic void createUserWrong(UserEntity entity) {\n    createMainUser(entity);\n    subUserService.createSubUserWithExceptionWrong(entity);\n}\n\nprivate void createMainUser(UserEntity entity) {\n    userRepository.save(entity);\n    log.info(&quot;createMainUser finish&quot;);\n}\n</code></pre><p>SubUserServiceçš„createSubUserWithExceptionWrongå®ç°æ­£å¦‚å…¶åï¼Œå› ä¸ºæœ€åæˆ‘ä»¬æŠ›å‡ºäº†ä¸€ä¸ªè¿è¡Œæ—¶å¼‚å¸¸ï¼Œé”™è¯¯åŸå› æ˜¯ç”¨æˆ·çŠ¶æ€æ— æ•ˆï¼Œæ‰€ä»¥å­ç”¨æˆ·çš„æ³¨å†Œè‚¯å®šæ˜¯å¤±è´¥çš„ã€‚æˆ‘ä»¬æœŸæœ›å­ç”¨æˆ·çš„æ³¨å†Œä½œä¸ºä¸€ä¸ªäº‹åŠ¡å•ç‹¬å›æ»šï¼Œä¸å½±å“ä¸»ç”¨æˆ·çš„æ³¨å†Œï¼Œè¿™æ ·çš„é€»è¾‘å¯ä»¥å®ç°å—ï¼Ÿ</p><pre><code>@Service\n@Slf4j\npublic class SubUserService {\n\n    @Autowired\n    private UserRepository userRepository;\n\n    @Transactional\n    public void createSubUserWithExceptionWrong(UserEntity entity) {\n        log.info(&quot;createSubUserWithExceptionWrong start&quot;);\n        userRepository.save(entity);\n        throw new RuntimeException(&quot;invalid status&quot;);\n    }\n}\n</code></pre><p>æˆ‘ä»¬åœ¨Controlleré‡Œå®ç°ä¸€æ®µæµ‹è¯•ä»£ç ï¼Œè°ƒç”¨UserServiceï¼š</p><pre><code>@GetMapping(&quot;wrong&quot;)\npublic int wrong(@RequestParam(&quot;name&quot;) String name) {\n    try {\n        userService.createUserWrong(new UserEntity(name));\n    } catch (Exception ex) {\n        log.error(&quot;createUserWrong failed, reason:{}&quot;, ex.getMessage());\n    }\n    return userService.getUserCount(name);\n}\n</code></pre><p>è°ƒç”¨åå¯ä»¥åœ¨æ—¥å¿—ä¸­å‘ç°å¦‚ä¸‹ä¿¡æ¯ï¼Œå¾ˆæ˜æ˜¾äº‹åŠ¡å›æ»šäº†ï¼Œæœ€åControlleræ‰“å‡ºäº†åˆ›å»ºå­ç”¨æˆ·æŠ›å‡ºçš„è¿è¡Œæ—¶å¼‚å¸¸ï¼š</p><pre><code>[22:50:42.866] [http-nio-45678-exec-8] [DEBUG] [o.s.orm.jpa.JpaTransactionManager       :555 ] - Rolling back JPA transaction on EntityManager [SessionImpl(103972212&lt;open&gt;)]\n[22:50:42.869] [http-nio-45678-exec-8] [DEBUG] [o.s.orm.jpa.JpaTransactionManager       :620 ] - Closing JPA EntityManager [SessionImpl(103972212&lt;open&gt;)] after transaction\n[22:50:42.869] [http-nio-45678-exec-8] [ERROR] [t.d.TransactionPropagationController:23  ] - createUserWrong failed, reason:invalid status\n</code></pre><p>ä½ é©¬ä¸Šå°±ä¼šæ„è¯†åˆ°ï¼Œä¸å¯¹å‘€ï¼Œå› ä¸ºè¿è¡Œæ—¶å¼‚å¸¸é€ƒå‡ºäº†@Transactionalæ³¨è§£æ ‡è®°çš„createUserWrongæ–¹æ³•ï¼ŒSpringå½“ç„¶ä¼šå›æ»šäº‹åŠ¡äº†ã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ›ä¸»æ–¹æ³•ä¸å›æ»šï¼Œåº”è¯¥æŠŠå­æ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸æ•è·äº†ã€‚</p><p>ä¹Ÿå°±æ˜¯è¿™ä¹ˆæ”¹ï¼ŒæŠŠsubUserService.createSubUserWithExceptionWrongåŒ…è£¹ä¸Šcatchï¼Œè¿™æ ·å¤–å±‚ä¸»æ–¹æ³•å°±ä¸ä¼šå‡ºç°å¼‚å¸¸äº†ï¼š</p><pre><code>@Transactional\npublic void createUserWrong2(UserEntity entity) {\n    createMainUser(entity);\n    try{\n        subUserService.createSubUserWithExceptionWrong(entity);\n    } catch (Exception ex) {\n        // è™½ç„¶æ•è·äº†å¼‚å¸¸ï¼Œä½†æ˜¯å› ä¸ºæ²¡æœ‰å¼€å¯æ–°äº‹åŠ¡ï¼Œè€Œå½“å‰äº‹åŠ¡å› ä¸ºå¼‚å¸¸å·²ç»è¢«æ ‡è®°ä¸ºrollbackäº†ï¼Œæ‰€ä»¥æœ€ç»ˆè¿˜æ˜¯ä¼šå›æ»šã€‚\n        log.error(&quot;create sub user error:{}&quot;, ex.getMessage());\n    }\n}\n</code></pre><p>è¿è¡Œç¨‹åºåå¯ä»¥çœ‹åˆ°å¦‚ä¸‹æ—¥å¿—ï¼š</p><pre><code>[22:57:21.722] [http-nio-45678-exec-3] [DEBUG] [o.s.orm.jpa.JpaTransactionManager       :370 ] - Creating new transaction with name [org.geekbang.time.commonmistakes.transaction.demo3.UserService.createUserWrong2]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT\n[22:57:21.739] [http-nio-45678-exec-3] [INFO ] [t.c.transaction.demo3.SubUserService:19  ] - createSubUserWithExceptionWrong start\n[22:57:21.739] [http-nio-45678-exec-3] [DEBUG] [o.s.orm.jpa.JpaTransactionManager       :356 ] - Found thread-bound EntityManager [SessionImpl(1794007607&lt;open&gt;)] for JPA transaction\n[22:57:21.739] [http-nio-45678-exec-3] [DEBUG] [o.s.orm.jpa.JpaTransactionManager       :471 ] - Participating in existing transaction\n[22:57:21.740] [http-nio-45678-exec-3] [DEBUG] [o.s.orm.jpa.JpaTransactionManager       :843 ] - Participating transaction failed - marking existing transaction as rollback-only\n[22:57:21.740] [http-nio-45678-exec-3] [DEBUG] [o.s.orm.jpa.JpaTransactionManager       :580 ] - Setting JPA transaction on EntityManager [SessionImpl(1794007607&lt;open&gt;)] rollback-only\n[22:57:21.740] [http-nio-45678-exec-3] [ERROR] [.g.t.c.transaction.demo3.UserService:37  ] - create sub user error:invalid status\n[22:57:21.740] [http-nio-45678-exec-3] [DEBUG] [o.s.orm.jpa.JpaTransactionManager       :741 ] - Initiating transaction commit\n[22:57:21.740] [http-nio-45678-exec-3] [DEBUG] [o.s.orm.jpa.JpaTransactionManager       :529 ] - Committing JPA transaction on EntityManager [SessionImpl(1794007607&lt;open&gt;)]\n[22:57:21.743] [http-nio-45678-exec-3] [DEBUG] [o.s.orm.jpa.JpaTransactionManager       :620 ] - Closing JPA EntityManager [SessionImpl(1794007607&lt;open&gt;)] after transaction\n[22:57:21.743] [http-nio-45678-exec-3] [ERROR] [t.d.TransactionPropagationController:33  ] - createUserWrong2 failed, reason:Transaction silently rolled back because it has been marked as rollback-only\norg.springframework.transaction.UnexpectedRollbackException: Transaction silently rolled back because it has been marked as rollback-only\n...\n</code></pre><p>éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul>\n<li>å¦‚ç¬¬1è¡Œæ‰€ç¤ºï¼Œå¯¹createUserWrong2æ–¹æ³•å¼€å¯äº†å¼‚å¸¸å¤„ç†ï¼›</li>\n<li>å¦‚ç¬¬5è¡Œæ‰€ç¤ºï¼Œå­æ–¹æ³•å› ä¸ºå‡ºç°äº†è¿è¡Œæ—¶å¼‚å¸¸ï¼Œæ ‡è®°å½“å‰äº‹åŠ¡ä¸ºå›æ»šï¼›</li>\n<li>å¦‚ç¬¬7è¡Œæ‰€ç¤ºï¼Œä¸»æ–¹æ³•çš„ç¡®æ•è·äº†å¼‚å¸¸æ‰“å°å‡ºäº†create sub user errorå­—æ ·ï¼›</li>\n<li>å¦‚ç¬¬9è¡Œæ‰€ç¤ºï¼Œä¸»æ–¹æ³•æäº¤äº†äº‹åŠ¡ï¼›</li>\n<li>å¥‡æ€ªçš„æ˜¯ï¼Œå¦‚ç¬¬11è¡Œå’Œ12è¡Œæ‰€ç¤ºï¼Œ<strong>Controlleré‡Œå‡ºç°äº†ä¸€ä¸ªUnexpectedRollbackExceptionï¼Œå¼‚å¸¸æè¿°æç¤ºæœ€ç»ˆè¿™ä¸ªäº‹åŠ¡å›æ»šäº†ï¼Œè€Œä¸”æ˜¯é™é»˜å›æ»šçš„</strong>ã€‚ä¹‹æ‰€ä»¥è¯´æ˜¯é™é»˜ï¼Œæ˜¯å› ä¸ºcreateUserWrong2æ–¹æ³•æœ¬èº«å¹¶æ²¡æœ‰å‡ºå¼‚å¸¸ï¼Œåªä¸è¿‡æäº¤åå‘ç°å­æ–¹æ³•å·²ç»æŠŠå½“å‰äº‹åŠ¡è®¾ç½®ä¸ºäº†å›æ»šï¼Œæ— æ³•å®Œæˆæäº¤ã€‚</li>\n</ul><p>è¿™æŒºåç›´è§‰çš„ã€‚<strong>æˆ‘ä»¬ä¹‹å‰è¯´ï¼Œå‡ºäº†å¼‚å¸¸äº‹åŠ¡ä¸ä¸€å®šå›æ»šï¼Œè¿™é‡Œè¯´çš„å´æ˜¯ä¸å‡ºå¼‚å¸¸ï¼Œäº‹åŠ¡ä¹Ÿä¸ä¸€å®šå¯ä»¥æäº¤</strong>ã€‚åŸå› æ˜¯ï¼Œä¸»æ–¹æ³•æ³¨å†Œä¸»ç”¨æˆ·çš„é€»è¾‘å’Œå­æ–¹æ³•æ³¨å†Œå­ç”¨æˆ·çš„é€»è¾‘æ˜¯åŒä¸€ä¸ªäº‹åŠ¡ï¼Œå­é€»è¾‘æ ‡è®°äº†äº‹åŠ¡éœ€è¦å›æ»šï¼Œä¸»é€»è¾‘è‡ªç„¶ä¹Ÿä¸èƒ½æäº¤äº†ã€‚</p><p>çœ‹åˆ°è¿™é‡Œï¼Œä¿®å¤æ–¹å¼å°±å¾ˆæ˜ç¡®äº†ï¼Œæƒ³åŠæ³•è®©å­é€»è¾‘åœ¨ç‹¬ç«‹äº‹åŠ¡ä¸­è¿è¡Œï¼Œä¹Ÿå°±æ˜¯æ”¹ä¸€ä¸‹SubUserServiceæ³¨å†Œå­ç”¨æˆ·çš„æ–¹æ³•ï¼Œä¸ºæ³¨è§£åŠ ä¸Špropagation = Propagation.REQUIRES_NEWæ¥è®¾ç½®REQUIRES_NEWæ–¹å¼çš„äº‹åŠ¡ä¼ æ’­ç­–ç•¥ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œåˆ°è¿™ä¸ªæ–¹æ³•æ—¶éœ€è¦å¼€å¯æ–°çš„äº‹åŠ¡ï¼Œå¹¶æŒ‚èµ·å½“å‰äº‹åŠ¡ï¼š</p><pre><code>@Transactional(propagation = Propagation.REQUIRES_NEW)\npublic void createSubUserWithExceptionRight(UserEntity entity) {\n    log.info(&quot;createSubUserWithExceptionRight start&quot;);\n    userRepository.save(entity);\n    throw new RuntimeException(&quot;invalid status&quot;);\n}\n</code></pre><p>ä¸»æ–¹æ³•æ²¡ä»€ä¹ˆå˜åŒ–ï¼ŒåŒæ ·éœ€è¦æ•è·å¼‚å¸¸ï¼Œé˜²æ­¢å¼‚å¸¸æ¼å‡ºå»å¯¼è‡´ä¸»äº‹åŠ¡å›æ»šï¼Œé‡æ–°å‘½åä¸ºcreateUserRightï¼š</p><pre><code>@Transactional\npublic void createUserRight(UserEntity entity) {\n    createMainUser(entity);\n    try{\n        subUserService.createSubUserWithExceptionRight(entity);\n    } catch (Exception ex) {\n        // æ•è·å¼‚å¸¸ï¼Œé˜²æ­¢ä¸»æ–¹æ³•å›æ»š\n        log.error(&quot;create sub user error:{}&quot;, ex.getMessage());\n    }\n}\n</code></pre><p>æ”¹é€ åï¼Œé‡æ–°è¿è¡Œç¨‹åºå¯ä»¥çœ‹åˆ°å¦‚ä¸‹çš„å…³é”®æ—¥å¿—ï¼š</p><ul>\n<li>ç¬¬1è¡Œæ—¥å¿—æç¤ºæˆ‘ä»¬é’ˆå¯¹createUserRightæ–¹æ³•å¼€å¯äº†ä¸»æ–¹æ³•çš„äº‹åŠ¡ï¼›</li>\n<li>ç¬¬2è¡Œæ—¥å¿—æç¤ºåˆ›å»ºä¸»ç”¨æˆ·å®Œæˆï¼›</li>\n<li>ç¬¬3è¡Œæ—¥å¿—å¯ä»¥çœ‹åˆ°ä¸»äº‹åŠ¡æŒ‚èµ·äº†ï¼Œå¼€å¯äº†ä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œé’ˆå¯¹createSubUserWithExceptionRightæ–¹æ¡ˆï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„åˆ›å»ºå­ç”¨æˆ·çš„é€»è¾‘ï¼›</li>\n<li>ç¬¬4è¡Œæ—¥å¿—æç¤ºå­æ–¹æ³•äº‹åŠ¡å›æ»šï¼›</li>\n<li>ç¬¬5è¡Œæ—¥å¿—æç¤ºå­æ–¹æ³•äº‹åŠ¡å®Œæˆï¼Œç»§ç»­ä¸»æ–¹æ³•ä¹‹å‰æŒ‚èµ·çš„äº‹åŠ¡ï¼›</li>\n<li>ç¬¬6è¡Œæ—¥å¿—æç¤ºä¸»æ–¹æ³•æ•è·åˆ°äº†å­æ–¹æ³•çš„å¼‚å¸¸ï¼›</li>\n<li>ç¬¬8è¡Œæ—¥å¿—æç¤ºä¸»æ–¹æ³•çš„äº‹åŠ¡æäº¤äº†ï¼Œéšåæˆ‘ä»¬åœ¨Controlleré‡Œæ²¡çœ‹åˆ°é™é»˜å›æ»šçš„å¼‚å¸¸ã€‚</li>\n</ul><pre><code>[23:17:20.935] [http-nio-45678-exec-1] [DEBUG] [o.s.orm.jpa.JpaTransactionManager       :370 ] - Creating new transaction with name [org.geekbang.time.commonmistakes.transaction.demo3.UserService.createUserRight]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT\n[23:17:21.079] [http-nio-45678-exec-1] [INFO ] [.g.t.c.transaction.demo3.UserService:55  ] - createMainUser finish\n[23:17:21.082] [http-nio-45678-exec-1] [DEBUG] [o.s.orm.jpa.JpaTransactionManager       :420 ] - Suspending current transaction, creating new transaction with name [org.geekbang.time.commonmistakes.transaction.demo3.SubUserService.createSubUserWithExceptionRight]\n[23:17:21.153] [http-nio-45678-exec-1] [DEBUG] [o.s.orm.jpa.JpaTransactionManager       :834 ] - Initiating transaction rollback\n[23:17:21.160] [http-nio-45678-exec-1] [DEBUG] [o.s.orm.jpa.JpaTransactionManager       :1009] - Resuming suspended transaction after completion of inner transaction\n[23:17:21.161] [http-nio-45678-exec-1] [ERROR] [.g.t.c.transaction.demo3.UserService:49  ] - create sub user error:invalid status\n[23:17:21.161] [http-nio-45678-exec-1] [DEBUG] [o.s.orm.jpa.JpaTransactionManager       :741 ] - Initiating transaction commit\n[23:17:21.161] [http-nio-45678-exec-1] [DEBUG] [o.s.orm.jpa.JpaTransactionManager       :529 ] - Committing JPA transaction on EntityManager [SessionImpl(396441411&lt;open&gt;)]\n</code></pre><p>è¿è¡Œæµ‹è¯•ç¨‹åºçœ‹åˆ°å¦‚ä¸‹ç»“æœï¼ŒgetUserCountå¾—åˆ°çš„ç”¨æˆ·æ•°é‡ä¸º1ï¼Œä»£è¡¨åªæœ‰ä¸€ä¸ªç”¨æˆ·ä¹Ÿå°±æ˜¯ä¸»ç”¨æˆ·æ³¨å†Œå®Œæˆäº†ï¼Œç¬¦åˆé¢„æœŸï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/3b/f8/3bd9c32b5144025f1a2de5b4ec436ff8.png?wh=1188*216\" alt=\"\"></p><h2>é‡ç‚¹å›é¡¾</h2><p>ä»Šå¤©ï¼Œæˆ‘é’ˆå¯¹ä¸šåŠ¡ä»£ç ä¸­æœ€å¸¸è§çš„ä½¿ç”¨æ•°æ®åº“äº‹åŠ¡çš„æ–¹å¼ï¼Œå³Springå£°æ˜å¼äº‹åŠ¡ï¼Œä¸ä½ æ€»ç»“äº†ä½¿ç”¨ä¸Šå¯èƒ½é‡åˆ°çš„ä¸‰ç±»å‘ï¼ŒåŒ…æ‹¬ï¼š</p><p>ç¬¬ä¸€ï¼Œå› ä¸ºé…ç½®ä¸æ­£ç¡®ï¼Œå¯¼è‡´æ–¹æ³•ä¸Šçš„äº‹åŠ¡æ²¡ç”Ÿæ•ˆã€‚æˆ‘ä»¬åŠ¡å¿…ç¡®è®¤è°ƒç”¨@Transactionalæ³¨è§£æ ‡è®°çš„æ–¹æ³•æ˜¯publicçš„ï¼Œå¹¶ä¸”æ˜¯é€šè¿‡Springæ³¨å…¥çš„Beanè¿›è¡Œè°ƒç”¨çš„ã€‚</p><p>ç¬¬äºŒï¼Œå› ä¸ºå¼‚å¸¸å¤„ç†ä¸æ­£ç¡®ï¼Œå¯¼è‡´äº‹åŠ¡è™½ç„¶ç”Ÿæ•ˆä½†å‡ºç°å¼‚å¸¸æ—¶æ²¡å›æ»šã€‚Springé»˜è®¤åªä¼šå¯¹æ ‡è®°@Transactionalæ³¨è§£çš„æ–¹æ³•å‡ºç°äº†RuntimeExceptionå’ŒErrorçš„æ—¶å€™å›æ»šï¼Œå¦‚æœæˆ‘ä»¬çš„æ–¹æ³•æ•è·äº†å¼‚å¸¸ï¼Œé‚£ä¹ˆéœ€è¦é€šè¿‡æ‰‹åŠ¨ç¼–ç å¤„ç†äº‹åŠ¡å›æ»šã€‚å¦‚æœå¸Œæœ›Springé’ˆå¯¹å…¶ä»–å¼‚å¸¸ä¹Ÿå¯ä»¥å›æ»šï¼Œé‚£ä¹ˆå¯ä»¥ç›¸åº”é…ç½®@Transactionalæ³¨è§£çš„rollbackForå’ŒnoRollbackForå±æ€§æ¥è¦†ç›–å…¶é»˜è®¤è®¾ç½®ã€‚</p><p>ç¬¬ä¸‰ï¼Œå¦‚æœæ–¹æ³•æ¶‰åŠå¤šæ¬¡æ•°æ®åº“æ“ä½œï¼Œå¹¶å¸Œæœ›å°†å®ƒä»¬ä½œä¸ºç‹¬ç«‹çš„äº‹åŠ¡è¿›è¡Œæäº¤æˆ–å›æ»šï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦è€ƒè™‘è¿›ä¸€æ­¥ç»†åŒ–é…ç½®äº‹åŠ¡ä¼ æ’­æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯@Transactionalæ³¨è§£çš„Propagationå±æ€§ã€‚</p><p>å¯è§ï¼Œæ­£ç¡®é…ç½®äº‹åŠ¡å¯ä»¥æé«˜ä¸šåŠ¡é¡¹ç›®çš„å¥å£®æ€§ã€‚ä½†ï¼Œåˆå› ä¸ºå¥å£®æ€§é—®é¢˜å¾€å¾€ä½“ç°åœ¨å¼‚å¸¸æƒ…å†µæˆ–ä¸€äº›ç»†èŠ‚å¤„ç†ä¸Šï¼Œå¾ˆéš¾åœ¨ä¸»æµç¨‹çš„è¿è¡Œå’Œæµ‹è¯•ä¸­å‘ç°ï¼Œå¯¼è‡´ä¸šåŠ¡ä»£ç çš„äº‹åŠ¡å¤„ç†é€»è¾‘å¾€å¾€å®¹æ˜“è¢«å¿½ç•¥ï¼Œå› æ­¤<strong>æˆ‘åœ¨ä»£ç å®¡æŸ¥ç¯èŠ‚ä¸€ç›´å¾ˆå…³æ³¨äº‹åŠ¡æ˜¯å¦æ­£ç¡®å¤„ç†</strong>ã€‚</p><p>å¦‚æœä½ æ— æ³•ç¡®è®¤äº‹åŠ¡æ˜¯å¦çœŸæ­£ç”Ÿæ•ˆï¼Œæ˜¯å¦æŒ‰ç…§é¢„æœŸçš„é€»è¾‘è¿›è¡Œï¼Œå¯ä»¥å°è¯•æ‰“å¼€Springçš„éƒ¨åˆ†Debugæ—¥å¿—ï¼Œé€šè¿‡äº‹åŠ¡çš„è¿ä½œç»†èŠ‚æ¥éªŒè¯ã€‚ä¹Ÿå»ºè®®ä½ åœ¨å•å…ƒæµ‹è¯•æ—¶å°½é‡è¦†ç›–å¤šçš„å¼‚å¸¸åœºæ™¯ï¼Œè¿™æ ·åœ¨é‡æ„æ—¶ï¼Œä¹Ÿèƒ½åŠæ—¶å‘ç°å› ä¸ºæ–¹æ³•çš„è°ƒç”¨æ–¹å¼ã€å¼‚å¸¸å¤„ç†é€»è¾‘çš„è°ƒæ•´ï¼Œå¯¼è‡´çš„äº‹åŠ¡å¤±æ•ˆé—®é¢˜ã€‚</p><p>ä»Šå¤©ç”¨åˆ°çš„ä»£ç ï¼Œæˆ‘éƒ½æ”¾åœ¨äº†GitHubä¸Šï¼Œä½ å¯ä»¥ç‚¹å‡»<a href=\"https://github.com/JosephZhu1983/java-common-mistakes\">è¿™ä¸ªé“¾æ¥</a>æŸ¥çœ‹ã€‚</p><h2>æ€è€ƒä¸è®¨è®º</h2><ol>\n<li>è€ƒè™‘åˆ°Demoçš„ç®€æ´ï¼Œæ–‡ä¸­æ‰€æœ‰æ•°æ®è®¿é—®ä½¿ç”¨çš„éƒ½æ˜¯Spring Data JPAã€‚å›½å†…å¤§å¤šæ•°äº’è”ç½‘ä¸šåŠ¡é¡¹ç›®æ˜¯ä½¿ç”¨MyBatisè¿›è¡Œæ•°æ®è®¿é—®çš„ï¼Œä½¿ç”¨MyBatisé…åˆSpringçš„å£°æ˜å¼äº‹åŠ¡ä¹ŸåŒæ ·éœ€è¦æ³¨æ„æ–‡ä¸­æåˆ°çš„è¿™äº›ç‚¹ã€‚ä½ å¯ä»¥å°è¯•æŠŠä»Šå¤©çš„Demoæ”¹ä¸ºMyBatisåšæ•°æ®è®¿é—®å®ç°ï¼Œçœ‹çœ‹æ—¥å¿—ä¸­æ˜¯å¦å¯ä»¥ä½“ç°å‡ºè¿™äº›å‘ã€‚</li>\n<li>åœ¨ç¬¬ä¸€èŠ‚ä¸­æˆ‘ä»¬æåˆ°ï¼Œå¦‚æœè¦é’ˆå¯¹privateæ–¹æ³•å¯ç”¨äº‹åŠ¡ï¼ŒåŠ¨æ€ä»£ç†æ–¹å¼çš„AOPä¸å¯è¡Œï¼Œéœ€è¦ä½¿ç”¨é™æ€ç»‡å…¥æ–¹å¼çš„AOPï¼Œä¹Ÿå°±æ˜¯åœ¨ç¼–è¯‘æœŸé—´ç»‡å…¥äº‹åŠ¡å¢å¼ºä»£ç ï¼Œå¯ä»¥é…ç½®Springæ¡†æ¶ä½¿ç”¨AspectJæ¥å®ç°AOPã€‚ä½ èƒ½å¦å‚é˜…Springçš„æ–‡æ¡£â€œ<a href=\"https://docs.spring.io/spring/docs/current/spring-framework-reference/data-access.html#transaction-declarative-aspectj\">Using @Transactional with AspectJ</a>â€è¯•è¯•å‘¢ï¼Ÿæ³¨æ„ï¼šAspectJé…åˆlombokä½¿ç”¨ï¼Œè¿˜å¯èƒ½ä¼šè¸©ä¸€äº›å‘ã€‚</li>\n</ol><p>æœ‰å…³æ•°æ®åº“äº‹åŠ¡ï¼Œä½ è¿˜é‡åˆ°è¿‡å…¶ä»–å‘å—ï¼Ÿæˆ‘æ˜¯æœ±æ™”ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºä¸æˆ‘ç•™è¨€åˆ†äº«ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™ä½ çš„æœ‹å‹æˆ–åŒäº‹ï¼Œä¸€èµ·äº¤æµã€‚</p>","neighbors":{"left":{"article_title":"05 | HTTPè°ƒç”¨ï¼šä½ è€ƒè™‘åˆ°è¶…æ—¶ã€é‡è¯•ã€å¹¶å‘äº†å—ï¼Ÿ","id":213273},"right":{"article_title":"ç­”ç–‘ç¯‡ï¼šä»£ç ç¯‡æ€è€ƒé¢˜é›†é”¦ï¼ˆä¸€ï¼‰","id":260695}},"comments":[{"had_liked":false,"id":193686,"user_name":"Darren","can_delete":false,"product_type":"c1","uid":1254968,"ip_address":"","ucode":"CCD2B2C492BE9A","user_header":"https://static001.geekbang.org/account/avatar/00/13/26/38/ef063dc2.jpg","comment_is_top":false,"comment_ctime":1584948692,"is_pvip":true,"replies":[{"id":"73770","content":"ğŸ‘ğŸ»","user_name":"ä½œè€…å›å¤","comment_id":193686,"uid":"1001470","ip_address":"","utype":1,"ctime":1584953381,"user_name_real":"æœ±æ™”"}],"discussion_count":8,"race_medal":0,"score":"229218215380","product_id":100047701,"comment_content":"AspectJä¸lombokï¼Œéƒ½æ˜¯å­—èŠ‚ç å±‚é¢è¿›è¡Œå¢å¼ºï¼Œåœ¨ä¸€èµ·ä½¿ç”¨æ—¶ä¼šæœ‰é—®é¢˜ï¼Œæ ¹æ®AspectJç»´æŠ¤è€…Andy Clementçš„å½“å‰ç­”æ¡ˆæ˜¯ç”±äºECJï¼ˆEclipse Compiler for Javaï¼‰è½¯ä»¶åŒ…å­˜åœ¨é—®é¢˜åœ¨AspectJç¼–è¯‘å™¨åŸºç¡€ç»“æ„ä¸­åŒ…å«å’Œé‡å‘½åã€‚<br>è§£å†³é—®é¢˜å¯ä»¥å‚è€ƒä¸‹é¢è¿æ¥ï¼š<br>http:&#47;&#47;aspectj.2085585.n4.nabble.com&#47;AspectJ-with-Lombok-td4651540.html<br>https:&#47;&#47;stackoverflow.com&#47;questions&#47;41910007&#47;lombok-and-aspectj<br><br>åˆ†äº«ä¸€ä¸ªä½¿ç”¨lombokçš„å‘ï¼š<br>ä¹‹å‰ä¸ºäº†setèµ‹å€¼æ–¹ä¾¿ï¼Œåœ¨VOæˆ–è€…DTOä¸Šä½¿ç”¨äº†@Accessors(chain=true)ï¼Œè¿™æ ·å°±å¯ä»¥é“¾å¼èµ‹å€¼ï¼Œä½†æ˜¯åœ¨åŠ¨æ€é€šè¿‡å†…çœè·å–setæ–¹æ³•è¿›è¡Œèµ‹å€¼æ—¶ï¼Œæ˜¯è·å–ä¸åˆ°å¯¹åº”çš„setæ–¹æ³•ï¼Œå› ä¸ºé»˜è®¤çš„setæ–¹æ³•è¿”å›å€¼æ˜¯voidï¼Œä½†æ˜¯åŠ äº†@Accessors(chain=true)ä¹‹åï¼Œsetæ–¹æ³•çš„è¿”å›å€¼å˜æˆäº†thisï¼Œè¿™æ ·é€šè¿‡å†…çœå°±è·å–åˆ°å¯¹åº”çš„setæ–¹æ³•äº†ï¼Œé€šè¿‡å»æ‰@Accessors(chain=true)å³å¯å®ç°ï¼Œé€šè¿‡å†…çœåŠ¨æ€ç»™å±æ€§èµ‹å€¼ã€‚","like_count":54,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":488620,"discussion_content":"ğŸ‘ğŸ»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584953381,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1903371,"avatar":"","nickname":"ç®€å•ç‚¹","note":"","ucode":"2750A770D004D9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":282551,"discussion_content":"èœé¸Ÿå¼±å¼±çš„é—®ä¸€ä¸‹å†…çœæ˜¯ä»€ä¹ˆæ„æ€å•Šï¼Ÿæ±‚æ•™","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1592014729,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1254968,"avatar":"https://static001.geekbang.org/account/avatar/00/13/26/38/ef063dc2.jpg","nickname":"Darren","note":"","ucode":"CCD2B2C492BE9A","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1903371,"avatar":"","nickname":"ç®€å•ç‚¹","note":"","ucode":"2750A770D004D9","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":282566,"discussion_content":"å†…çœå°±æ˜¯ä½çº§åˆ«åå°„ï¼Œä½ å¯ä»¥ç½‘ä¸Šæœç´¢ä¸‹ï¼Œè¿™å—çš„å†…å®¹å¾ˆå¤šçš„","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1592017305,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":282551,"ip_address":""},"score":282566,"extra":""},{"author":{"id":1005290,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/56/ea/32608c44.jpg","nickname":"giteebravo","note":"","ucode":"C087E8D6B5A98B","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":1254968,"avatar":"https://static001.geekbang.org/account/avatar/00/13/26/38/ef063dc2.jpg","nickname":"Darren","note":"","ucode":"CCD2B2C492BE9A","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":379040,"discussion_content":"æ­¤å¤„çš„å†…çœå¯¹åº”çš„è‹±æ–‡æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623637740,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":282566,"ip_address":""},"score":379040,"extra":""},{"author":{"id":1968721,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/unkzY52hVDjTmZJGNkrBR75tFs4XTGBoYYcOYkIcPvHlQrLibwc94aBfj1uWiawoKeEMwHbkvgThXZarfoP8Dzag/132","nickname":"å¥¹","note":"","ucode":"FAC6851866C9C7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1005290,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/56/ea/32608c44.jpg","nickname":"giteebravo","note":"","ucode":"C087E8D6B5A98B","race_medal":1,"user_type":1,"is_pvip":false},"discussion":{"id":406080,"discussion_content":"Googleå‘€~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634698038,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":379040,"ip_address":""},"score":406080,"extra":""}]},{"author":{"id":1670763,"avatar":"https://static001.geekbang.org/account/avatar/00/19/7e/6b/36fc4516.jpg","nickname":"FIRE","note":"","ucode":"85861D990FB3AB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":544364,"discussion_content":"ç§’å•Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641483068,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1134861,"avatar":"https://static001.geekbang.org/account/avatar/00/11/51/0d/fc1652fe.jpg","nickname":"James","note":"","ucode":"48B0F2A334D1C1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":294243,"discussion_content":"è¯¾ä»£è¡¨","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595837842,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2039388,"avatar":"","nickname":"ææ¾","note":"","ucode":"28572BCFD696E5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":283692,"discussion_content":"æˆ‘ä¸€èˆ¬é€šè¿‡builderæ¥èµ‹å€¼çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592327068,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":191268,"user_name":"hanazawakana","can_delete":false,"product_type":"c1","uid":1251721,"ip_address":"","ucode":"E0F6FACBFE7D15","user_header":"https://static001.geekbang.org/account/avatar/00/13/19/89/20488013.jpg","comment_is_top":false,"comment_ctime":1584759948,"is_pvip":false,"replies":[{"id":"73372","content":"è¿™ä¸ªé—®é¢˜å¾ˆå¥½ï¼Œé¦–å…ˆJDKåŠ¨æ€ä»£ç†è‚¯å®šæ˜¯ä¸è¡Œçš„åªèƒ½æ˜¯publicï¼Œç†è®ºä¸ŠCGLIBæ–¹å¼çš„ä»£ç†æ˜¯å¯ä»¥ä»£ç†protectedæ–¹æ³•çš„ï¼Œä¸è¿‡å¦‚æœæ”¯æŒï¼Œé‚£ä¹ˆæ„å‘³ç€äº‹åŠ¡å¯èƒ½ä¼šå› ä¸ºåˆ‡æ¢ä»£ç†å®ç°æ–¹å¼è¡¨ç°ä¸åŒï¼Œå¤§å¤§å¢åŠ å‡ºç°Bugçš„å¯èƒ½æ€§ï¼Œæˆ‘è§‰å¾—ä¸ºäº†ä¸€è‡´æ€§æ‰€ä»¥Springè€ƒè™‘åªæ”¯æŒpublicï¼Œè¿™æ˜¯æœ€å¥½çš„ã€‚","user_name":"ä½œè€…å›å¤","comment_id":191268,"uid":"1001470","ip_address":"","utype":1,"ctime":1584764178,"user_name_real":"æœ±æ™”"}],"discussion_count":4,"race_medal":0,"score":"177678419084","product_id":100047701,"comment_content":"å¦åˆ™åªæœ‰å®šä¹‰åœ¨ public æ–¹æ³•ä¸Šçš„ @Transactional æ‰èƒ½ç”Ÿæ•ˆã€‚è¿™é‡Œä¸€å®šè¦ç”¨publicå—ï¼Œç”¨protectedä¸è¡Œå—ï¼Œprotectedåœ¨å­ç±»ä¸­åº”è¯¥ä¹Ÿå¯è§å•Šï¼Œæ˜¯å› ä¸ºåŒ…ä¸åŒå—","like_count":42,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":212867,"discussion_content":"æ˜¯ï¼Œä½†æ˜¯Springç»Ÿä¸€é™åˆ¶äº†ï¼š\n\nAbstractFallbackTransactionAttributeSourceï¼š\n\n@Nullable\n\tprotected TransactionAttribute computeTransactionAttribute(Method method, @Nullable Class<?> targetClass) {\n\t\t// Don&#39;t allow no-public methods as required.\n\t\tif (allowPublicMethodsOnly() &amp;&amp; !Modifier.isPublic(method.getModifiers())) {\n\t\t\treturn null;\n\t\t}\n}","likes_number":7,"is_delete":false,"is_hidden":false,"ctime":1585026054,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1107484,"avatar":"https://static001.geekbang.org/account/avatar/00/10/e6/1c/9d3744ee.jpg","nickname":"å°æè®²æºç ","note":"","ucode":"2573037D7C82C8","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":368099,"discussion_content":"è¿˜æ˜¯æºç å‡ºçœŸçŸ¥å•Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618566423,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":212867,"ip_address":""},"score":368099,"extra":""}]},{"author":{"id":1112651,"avatar":"https://static001.geekbang.org/account/avatar/00/10/fa/4b/c385f755.jpg","nickname":"å‘å‰èµ°","note":"","ucode":"8956E92DCEFB60","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":211756,"discussion_content":"JDKåŠ¨æ€ä»£ç è‚¯å®šä¸è¡Œåªèƒ½æ˜¯publicï¼Œæ˜¯å› ä¸ºJDKåŠ¨æ€ä»£ç†æ˜¯åŸºäºæ¥å£å®ç°,è€Œæ¥å£é»˜è®¤å°±æ˜¯publicçš„,è€å¸ˆ,æ˜¯è¿™ä¸ªæ„æ€ä¹ˆï¼Ÿ","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1584886272,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":488144,"discussion_content":"è¿™ä¸ªé—®é¢˜å¾ˆå¥½ï¼Œé¦–å…ˆJDKåŠ¨æ€ä»£ç†è‚¯å®šæ˜¯ä¸è¡Œçš„åªèƒ½æ˜¯publicï¼Œç†è®ºä¸ŠCGLIBæ–¹å¼çš„ä»£ç†æ˜¯å¯ä»¥ä»£ç†protectedæ–¹æ³•çš„ï¼Œä¸è¿‡å¦‚æœæ”¯æŒï¼Œé‚£ä¹ˆæ„å‘³ç€äº‹åŠ¡å¯èƒ½ä¼šå› ä¸ºåˆ‡æ¢ä»£ç†å®ç°æ–¹å¼è¡¨ç°ä¸åŒï¼Œå¤§å¤§å¢åŠ å‡ºç°Bugçš„å¯èƒ½æ€§ï¼Œæˆ‘è§‰å¾—ä¸ºäº†ä¸€è‡´æ€§æ‰€ä»¥Springè€ƒè™‘åªæ”¯æŒpublicï¼Œè¿™æ˜¯æœ€å¥½çš„ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1584764178,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":192858,"user_name":"Seven.Linæ¾¤è€¿","can_delete":false,"product_type":"c1","uid":1181192,"ip_address":"","ucode":"4CAB732CD6F149","user_header":"https://static001.geekbang.org/account/avatar/00/12/06/08/855abb02.jpg","comment_is_top":false,"comment_ctime":1584876178,"is_pvip":false,"replies":[{"id":"73733","content":"ä½ è¯´çš„éš”ç¦»çº§åˆ«åº”è¯¥æ˜¯æŒ‡READ_UNCOMMITTEDã€‚æˆ‘ä¸è®¤ä¸ºè¿™æ˜¯å¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆï¼Œå­æ–¹æ³•å†…éœ€è¦ä¾èµ–çš„æ•°æ®æ¥è‡ªçˆ¶æ–¹æ³•ï¼Œå¯ä»¥æ–¹æ³•ä¼ å€¼ï¼Œè€Œä¸æ˜¯ç”¨è¿™ç§éš”ç¦»çº§åˆ«ã€‚","user_name":"ä½œè€…å›å¤","comment_id":192858,"uid":"1001470","ip_address":"","utype":1,"ctime":1584931999,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"169088600722","product_id":100047701,"comment_content":"æˆ‘è¿˜é‡åˆ°ä¸€ä¸ªå‘ï¼Œå°±æ˜¯å­æ–¹æ³•ä½¿ç”¨äº†REQUIRES_NEWï¼Œä½†æ˜¯ä¸šåŠ¡é€»è¾‘éœ€è¦çš„æ•°æ®æ˜¯æ¥æºäºçˆ¶æ–¹æ³•çš„ï¼Œä¹Ÿå°±æ˜¯çˆ¶æ–¹æ³•è¿˜æ²¡æäº¤ï¼Œå­æ–¹æ³•è·å–ä¸åˆ°ã€‚å½“æ—¶çš„è§£å†³æ–¹æ³•æ˜¯æŠŠäº‹åŠ¡éš”ç¦»çº§åˆ«æ”¹æˆRCï¼Œç°åœ¨å›æƒ³èµ·æ¥ï¼Œä¸çŸ¥é“è¿™ç§è§£å†³æ–¹æ³•æ˜¯å¦æ­£ç¡®ï¼Ÿ","like_count":39,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":488476,"discussion_content":"ä½ è¯´çš„éš”ç¦»çº§åˆ«åº”è¯¥æ˜¯æŒ‡READ_UNCOMMITTEDã€‚æˆ‘ä¸è®¤ä¸ºè¿™æ˜¯å¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆï¼Œå­æ–¹æ³•å†…éœ€è¦ä¾èµ–çš„æ•°æ®æ¥è‡ªçˆ¶æ–¹æ³•ï¼Œå¯ä»¥æ–¹æ³•ä¼ å€¼ï¼Œè€Œä¸æ˜¯ç”¨è¿™ç§éš”ç¦»çº§åˆ«ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1584931999,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":198735,"user_name":"çœ‹ä¸åˆ°deé¢œè‰²","can_delete":false,"product_type":"c1","uid":1162714,"ip_address":"","ucode":"88348CCAE81931","user_header":"https://static001.geekbang.org/account/avatar/00/11/bd/da/3d76ea74.jpg","comment_is_top":false,"comment_ctime":1585466147,"is_pvip":false,"replies":[{"id":"74730","content":"æ²¡é”™","user_name":"ä½œè€…å›å¤","comment_id":198735,"uid":"1001470","ip_address":"","utype":1,"ctime":1585469612,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"100369713955","product_id":100047701,"comment_content":"Springé»˜è®¤äº‹åŠ¡é‡‡ç”¨åŠ¨æ€ä»£ç†æ–¹å¼å®ç°ã€‚å› æ­¤åªèƒ½å¯¹publicè¿›è¡Œå¢å¼ºï¼ˆè€ƒè™‘åˆ°CGLibå’ŒJDKProxyå…¼å®¹ï¼Œprotectedä¹Ÿä¸æ”¯æŒï¼‰ã€‚åœ¨ä½¿ç”¨åŠ¨æ€ä»£ç†å¢å¼ºæ—¶ï¼Œæ–¹æ³•å†…è°ƒç”¨ä¹Ÿå¯ä»¥è€ƒè™‘é‡‡ç”¨AopContext.currentProxy()è·å–å½“å‰ä»£ç†ç±»ã€‚","like_count":24,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489746,"discussion_content":"æ²¡é”™","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585469612,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":192854,"user_name":"Seven.Linæ¾¤è€¿","can_delete":false,"product_type":"c1","uid":1181192,"ip_address":"","ucode":"4CAB732CD6F149","user_header":"https://static001.geekbang.org/account/avatar/00/12/06/08/855abb02.jpg","comment_is_top":false,"comment_ctime":1584875896,"is_pvip":false,"replies":[{"id":"73594","content":"1ã€å®¹æ˜“ä¸Šæ‰‹ç®€å•<br>2ã€å›½å†…BATå¤§å‚å¯¹äºMybatisçš„ä½¿ç”¨é‡å¤§ï¼Œå½±å“åŠ›å¤§<br>3ã€å›½å†…å¤§éƒ¨åˆ†é¡¹ç›®è¿˜æ˜¯é¢å‘è¡¨ç»“æ„çš„ç¼–ç¨‹ï¼Œä»ä¸‹åˆ°ä¸Šçš„æ€è€ƒæ–¹å¼è€ŒéOOPçš„æ€è€ƒæ–¹å¼","user_name":"ä½œè€…å›å¤","comment_id":192854,"uid":"1001470","ip_address":"","utype":1,"ctime":1584879982,"user_name_real":"æœ±æ™”"}],"discussion_count":8,"race_medal":0,"score":"100369123704","product_id":100047701,"comment_content":"è€å¸ˆï¼Œå¯ä»¥é—®ä¸€ä¸‹ä¸ºå•¥å›½å†…å¤§å¤šæ•°å…¬å¸ä½¿ç”¨MyBatiså‘¢ï¼Ÿæ˜¯ä¸ºäº†æ›´åŠ æ¥è¿‘SQLå—ï¼Ÿéš¾å€’å›½å¤–ä¸šåŠ¡ä¸ä¼šé‡åˆ°å¤æ‚çš„åœºæ™¯å—ï¼Ÿ","like_count":24,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":488475,"discussion_content":"1ã€å®¹æ˜“ä¸Šæ‰‹ç®€å•\n2ã€å›½å†…BATå¤§å‚å¯¹äºMybatisçš„ä½¿ç”¨é‡å¤§ï¼Œå½±å“åŠ›å¤§\n3ã€å›½å†…å¤§éƒ¨åˆ†é¡¹ç›®è¿˜æ˜¯é¢å‘è¡¨ç»“æ„çš„ç¼–ç¨‹ï¼Œä»ä¸‹åˆ°ä¸Šçš„æ€è€ƒæ–¹å¼è€ŒéOOPçš„æ€è€ƒæ–¹å¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584879982,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1657925,"avatar":"https://static001.geekbang.org/account/avatar/00/19/4c/45/1042c1fd.jpg","nickname":"æ·¡å¿˜å¦‚é£","note":"","ucode":"464DBE34300A6B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":302289,"discussion_content":"éœ€æ±‚æ”¹åŠ¨è¾ƒå¤§ï¼Œsqlå¥½æ”¹ã€‚ã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1598868853,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1364873,"avatar":"https://static001.geekbang.org/account/avatar/00/14/d3/89/6f5c09bc.jpg","nickname":"å§šä¿Š","note":"","ucode":"2ABE42AC97B528","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":257747,"discussion_content":"jpaåå‘dddçš„æ€ç»´æ–¹å¼ï¼Œå…¶å®é…åˆcqrsæ¨¡å¼ä¸ªäººè®¤ä¸ºæ˜¯å¾ˆå¥½çš„ç»„åˆï¼Œåªæ˜¯å›½å†…ç”¨çš„äººä¸å¤š","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1588602755,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1080812,"avatar":"https://static001.geekbang.org/account/avatar/00/10/7d/ec/ccd30c1d.jpg","nickname":"WangBo","note":"","ucode":"8BFCC4E2639175","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":319819,"discussion_content":"æˆ‘ç†è§£ç”¨MyBatiså’Œæ˜¯å¦é¢å‘OOPå…³ç³»ä¸å¤§ï¼ŒJPAæœ‰å…¶å­¦ä¹ ç†è§£é—¨æ§›å’Œå±€é™æ€§ã€‚æˆ‘ä»¬ç”¨JdbcTemplateï¼Œä½†æˆ‘ä»¬æ˜¯å…ˆè®¾è®¡APIï¼Œç„¶åæ‰è®¾è®¡DB Schemaã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1604128366,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1103187,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d5/53/a95eb9b0.jpg","nickname":"kanon","note":"","ucode":"50A5FBF318EC28","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":215200,"discussion_content":"å›½å¤–äººå°‘ç”¨æˆ·å°‘ï¼Œç”¨jpaéš¾ä¼˜åŒ–","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1585300648,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1062848,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ersGSic8ib7OguJv6CJiaXY0s4n9C7Z51sWxTTljklFpq3ZAIWXoFTPV5oLo0GMTkqW5sYJRRnibNqOJQ/132","nickname":"walleæ–Œ","note":"","ucode":"0DB3243004951F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":381341,"discussion_content":"å¹¶ä¸æ˜¯ ä¸€ä¸ªç®€å•è¿”åˆ©ï¼Œå¤æ‚sqlçš„æ€§èƒ½é—®é¢˜ï¼Œã€‚ã€‚jpa æ²¡æœ‰mybatisç›´æ¥ã€‚ã€‚ã€‚ç›®å‰ æœ‰å“ªä¸ªto Cçš„ç³»ç»Ÿ åº•å±‚å…¨éƒ½æ˜¯jpaæçš„ã€‚ã€‚æåˆ°ä¸€åŠ åŸºæœ¬è¦é‡å†™äº†ã€‚ã€‚è¿™ç©æ„åº•å±‚hibernateã€‚13å¹´é‚£ä¼šhibernateå°±æ´»äº†ä¸€é˜µå­ä¸åˆ°1å¹´å¤šå°±æ²‰åº•ç†„ç­äº†ã€‚ã€‚è¿™ä¼šåˆæ­»ç°å¤ç‡ƒäº†ã€‚ä¸€å¥è¯ï¼Œå¦‚æœå•çº¯å†…éƒ¨ç³»ç»Ÿï¼ŒOKï¼Œå¯ä»¥ï¼Œä½†æ˜¯åè¿‡æ¥ä¸€å¥è¯ï¼Œ å¦‚æœä¸æ¶‰åŠåˆ°äº‹ç‰©ç›´æ¥mongoå¥½ä¸å¥½ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625018432,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1016860,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/84/1c/7997352e.jpg","nickname":"gogogo","note":"","ucode":"EB19D75BB7100E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":270233,"discussion_content":"ç†è®ºçŸ¥è¯†è·Ÿä¸ä¸Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589986540,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1549364,"avatar":"","nickname":"Geek_3b1096","note":"","ucode":"A6BD92B79B3632","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":217171,"discussion_content":"å¯¹æˆ‘ä¹Ÿæƒ³çŸ¥é“","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585523824,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":191415,"user_name":"ä¹æ—¶å››","can_delete":false,"product_type":"c1","uid":1670963,"ip_address":"","ucode":"92DCC2DF3DD15C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/zGUSFibP0OGFW9a3QSic1DZLr5B4kPoNmt3RibzLNYSOxN3mUZibBMkGHpwcYPFYWJ7v61wsMvyIKzpBuQJWD2hVOg/132","comment_is_top":false,"comment_ctime":1584771768,"is_pvip":false,"replies":[{"id":"73379","content":"å¦‚æœè¦é€šè¿‡æ•°æ®åº“æ¥å®ç°é”ï¼Œé‚£ä¹ˆåŠ é”è§£é”ï¼Œéœ€è¦æ˜¯å•ç‹¬çš„äº‹åŠ¡ï¼Œä¸èƒ½è·Ÿä¸šåŠ¡çš„sqläº‹åŠ¡æ··åˆåœ¨ä¸€èµ·ï¼ŒåŠ é”å’Œä¸šåŠ¡åœ¨ä¸€ä¸ªäº‹åŠ¡é‡Œäº†ï¼Œé”å°±æ²¡ç”¨äº†ï¼Œå› ä¸ºæ¯ä¸ªäº‹åŠ¡é‡Œï¼Œéƒ½è®¤ä¸ºè‡ªå·±æ‹¿åˆ°äº†é”ã€‚","user_name":"ä½œè€…å›å¤","comment_id":191415,"uid":"1001470","ip_address":"","utype":1,"ctime":1584778220,"user_name_real":"æœ±æ™”"}],"discussion_count":8,"race_medal":0,"score":"83189150392","product_id":100047701,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œæœ‰ä¸ªæ•°æ®åº“äº‹åŠ¡å’Œspringäº‹åŠ¡çš„é—®é¢˜æƒ³è¯·æ•™ä¸‹ï¼ˆæˆ‘æ˜¯ä¸€ä¸ªå…¥èŒåŠå¹´çš„èœé¸Ÿï¼‰ã€‚<br>ä¸šåŠ¡åœºæ™¯ï¼šä¸ºäº†å®ç°åŒä¸€ä¸ªæ—¶é—´çš„å¤šä¸ªè¯·æ±‚ï¼Œåªæœ‰ä¸€ä¸ªè¯·æ±‚ç”Ÿæ•ˆï¼Œåœ¨æ•°æ®åº“å­—æ®µä¸ŠåŠ äº†ä¸€ä¸ªå­—æ®µï¼ˆsignature_lockï¼‰æ ‡è¯†é”çŠ¶æ€ã€‚ï¼ˆæ²¡æœ‰ä½¿ç”¨redisé”ä¹‹ç±»çš„ä¸­é—´ä»¶ï¼Œåªè®¨è®ºæ•°æ®åº“äº‹åŠ¡å’ŒSpringçš„äº‹åŠ¡ï¼Œä»¥ä¸‹çš„è¯·æ±‚ç†è§£ä¸ºåŒæ—¶è¯·æ±‚ï¼‰<br><br>1.åœ¨æ•°æ®åº“å±‚é¢ï¼Œé€šè¿‡sqlè¯­å¥ç›´æ¥æ“ä½œæ•°æ®åº“ï¼Œæ•°æ®åº“äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸ºå¯é‡å¤è¯»ï¼š<br><br>-- è¯·æ±‚1<br>show VARIABLES like &#39;tx_isolation&#39;;<br>START TRANSACTION;<br>select * from subscribe_info where id = 29;<br>-- updateè¯­å¥åªæœ‰ä¸€ä¸ªè¯·æ±‚å¯ä»¥æ‰§è¡Œï¼Œå¦ä¸€ä¸ªè¯·æ±‚åœ¨ç­‰å¾…<br>update trade_deal_subscribe_info set signature_lock =1 where id = 1 and signature_lock = 0;<br>commit;<br><br>-- è¯·æ±‚2<br>show VARIABLES like &#39;tx_isolation&#39;;<br>START TRANSACTION;<br>select * from trade_deal_subscribe_info where id = 29;<br>-- updateè¯­å¥åªæœ‰ä¸€ä¸ªè¯·æ±‚å¯ä»¥æ‰§è¡Œï¼Œå¦ä¸€ä¸ªè¯·æ±‚åœ¨ç­‰å¾…<br>update subscribe_info set signature_lock =1 where id = 1 and signature_lock = 0;<br>commit;<br><br>ä¸¤ä¸ªè¯·æ±‚ä¸­åªæœ‰ä¸€ä¸ªå¯ä»¥æ‰§è¡ŒæˆåŠŸupdateè¯­å¥ï¼Œå°†signature_lockæ›´æ–°ä¸º1ã€‚<br><br><br><br>2.åœ¨ä»£ç å±‚é¢æŒ‰ç…§åœ¨æ•°æ®åº“å±‚é¢çš„é€»è¾‘ï¼Œserviceå±‚çš„ä¼ªä»£ç å¦‚ä¸‹ï¼š<br>public void test(ParamDto paramDto) {<br> &#47;&#47;å–æ•°æ®<br> Data data = getByParamDto(paramDto);<br> &#47;&#47; å°è¯•åŠ é”,è¿”å›1è¡¨ç¤ºåŠ é”æˆåŠŸ<br> Integer lockStatus = lockData(paramDto);<br> &#47;&#47; åŠ é”å¤±è´¥ç›´æ¥è¿”å›<br> if(!Objects.equals(1,lockStatus)){<br>  return;<br> }<br> try{<br>   &#47;&#47; å¤„ç†ä¸šåŠ¡ä»£ç ï¼Œå¤§æ¦‚2åˆ°3ç§’ <br>   handle();<br> }catch(Exception e){<br> <br> } finally{<br>   &#47;&#47; é‡Šæ”¾é”<br>   releaseLock(paramDto);<br> }<br>}<br><br><br>æŒ‰ç…§è¿™æ ·çš„æ–¹å¼ï¼Œåœ¨æ–¹æ³•ä¸Šé¢ä¸åŠ æ³¨è§£çš„æƒ…å†µä¸‹ï¼Œæ‰§è¡Œç»“æœä¸åœ¨å†™sqlçš„ç»“æœæ˜¯ä¸€è‡´çš„ï¼Œä¸¤ä¸ªè¯·æ±‚åªæœ‰ä¸€ä¸ªå¯ä»¥æ‰§è¡ŒæˆåŠŸï¼›åŠ ä¸Š@Transactional(rollbackFor = Exception.class, propagation = Propagation.REQUIRED)ä¹‹åï¼Œä¸¤ä¸ªè¯·æ±‚éƒ½å¯ä»¥æ‹¿åˆ°é”ã€‚<br><br>ç–‘é—®æ˜¯ï¼ŒSpringçš„äº‹åŠ¡å’Œæ•°æ®åº“çš„äº‹åŠ¡æœ‰ä»€ä¹ˆå…³ç³»ï¼ŒåŠ ä¸Šäº‹åŠ¡æ³¨è§£åï¼Œä¸ºä»€ä¹ˆå’Œæ•°æ®åº“çš„ç»“æœä¸ä¸€è‡´ã€‚","like_count":19,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":488168,"discussion_content":"å¦‚æœè¦é€šè¿‡æ•°æ®åº“æ¥å®ç°é”ï¼Œé‚£ä¹ˆåŠ é”è§£é”ï¼Œéœ€è¦æ˜¯å•ç‹¬çš„äº‹åŠ¡ï¼Œä¸èƒ½è·Ÿä¸šåŠ¡çš„sqläº‹åŠ¡æ··åˆåœ¨ä¸€èµ·ï¼ŒåŠ é”å’Œä¸šåŠ¡åœ¨ä¸€ä¸ªäº‹åŠ¡é‡Œäº†ï¼Œé”å°±æ²¡ç”¨äº†ï¼Œå› ä¸ºæ¯ä¸ªäº‹åŠ¡é‡Œï¼Œéƒ½è®¤ä¸ºè‡ªå·±æ‹¿åˆ°äº†é”ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584778220,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2002210,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/8d/22/0bf540be.jpg","nickname":"tongzi","note":"","ucode":"7349A6E42EDF17","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":270691,"discussion_content":"å› ä¸ºåŠ äº†äº‹åŠ¡æ³¨è§£ï¼Œå½“ç¬¬äºŒæ¬¡è¯·æ±‚è¿‡æ¥æ—¶ï¼Œç¬¬ä¸€æ¬¡è¯·æ±‚çš„äº‹åŠ¡æ˜¯æ²¡æœ‰æäº¤çš„ï¼›åº”è¯¥æ˜¯å’Œéš”ç¦»çº§åˆ«æœ‰å…³ç³»ï¼Œå¯¼è‡´ç¬¬äºŒæ¬¡è¯·æ±‚åŒæ—¶è¿‡æ¥ï¼Œå¯¹ç¬¬ä¸€æ¬¡ä¿®æ”¹çš„æ•°æ®ä¸å¯è§ã€‚æ‰€ä»¥ä¹Ÿæ‹¿åˆ°äº†é”ï¼›ä¸ªäººæ‹™è§","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1590037753,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1220981,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erkQ49YqAySHOlynF8fC7Z65ic0icmWYKVJFicAiam4RFcyzZK5IqWI9KYaicaEqw3B24ibaKSicqTOdwDzQ/132","nickname":"KLOOOP","note":"","ucode":"1BBF897219786F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":325116,"discussion_content":"è¿˜æ˜¯åªæœ‰ä¸€ä¸ªè¯·æ±‚ä¼šæ‹¿åˆ°é”ï¼Œç¬¬ä¸€ä¸ªè¯·æ±‚æ‹¿åˆ°é”ï¼Œç¬¬äºŒä¸ªè¯·æ±‚åŠ é”æ—¶ä¼šè¢«é˜»å¡ç›´åˆ°ç¬¬ä¸€ä¸ªè¯·æ±‚äº‹åŠ¡æäº¤ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1605238359,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1327997,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/YqF3S64vHV7cuGIQLczgj4hgOxZlHEN7X48nIShQIiaN1cU4VsE9ia4VVmTibVKzMfRG7ibgibKOPJfA5S1SrYZNDyA/132","nickname":"InfoQ_aae1c4db19b4","note":"","ucode":"481665EAB720F5","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":588634,"discussion_content":"åŠ äº†äº‹åŠ¡æ³¨è§£ä¸”éš”ç¦»çº§åˆ«æ˜¯rræƒ…å†µä¸‹ï¼Œä¼šæœ‰è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥äº†è§£ä¸‹mvcc","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663919730,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2015438,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/c0/ce/eb1b4ae1.jpg","nickname":"å¯åœˆå¯ä¸¶","note":"","ucode":"EB527E176EDE91","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582661,"discussion_content":"è·Ÿäº‹åŠ¡éš”ç¦»çº§åˆ«ä¸€æ¯›é’±å…³ç³»éƒ½æ²¡æœ‰ï¼Œåœ¨ä½ ä¸šåŠ¡æ–¹æ³•çš„å…¥å£åŠ é”å³å¯ã€‚åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªè¯·æ±‚å¯ä»¥è·å–é”ï¼Œè·å¾—åˆ°é”çš„è¯·æ±‚ä¸€å®šè¦å…ˆæŸ¥è¯¢æ•°æ®åº“åˆ¤æ–­ä½ çš„lockæ˜¯å¦è¢«æ›´æ–°ï¼ˆè¿™ä¸€æ­¥å¾ˆé‡è¦ï¼‰ï¼Œå¦‚æœæ²¡æœ‰è¢«æ›´æ–°åˆ™æ‰§è¡Œæ›´æ–°æ“ä½œï¼Œç„¶åæäº¤äº‹åŠ¡ï¼Œå†é‡Šæ”¾é”ã€‚ï¼ˆä¸€å®šè¦å…ˆæäº¤äº‹åŠ¡å†é‡Šæ”¾é”ï¼Œå¾ˆå¤šäººä¼°è®¡æŠŠé‡Šæ”¾é”çš„ä»£ç å†™åœ¨äº‹åŠ¡é‡Œé¢ã€‚å¦‚æœè¿™æ ·å†™ï¼Œå°±ä¼šé€ æˆ é”è¢«é‡Šæ”¾æ‰ï¼Œä½†æ˜¯äº‹åŠ¡è¿˜æ²¡æäº¤ï¼Œä¸‹ä¸€ä¸ªè¯·æ±‚åˆå¯ä»¥è·å¾—é”ï¼Œè·å¾—é”ä¹‹åæŸ¥è¯¢æ•°æ®åº“çœ‹çœ‹è®°å½•æ˜¯å¦è¢«æ›´æ–°ï¼Œå› ä¸ºä¸Šä¸€ä¸ªè¯·æ±‚é‡Šæ”¾äº†é”ï¼Œä½†æ˜¯äº‹åŠ¡æ²¡æœ‰æäº¤ï¼Œæ‰€ä»¥ä¹‹åçš„è¯·æ±‚éƒ½ä¼šè®¤ä¸ºè®°å½•æ²¡æœ‰è¢«æ›´æ–°ï¼Œè¿™æ ·å°±ä¼šé€ æˆå¤šæ¬¡updateï¼‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659582141,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1972713,"avatar":"","nickname":"Geek_9efcc0","note":"","ucode":"9F0CCD5DEDB1BA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":243367,"discussion_content":"çœ‹æ‡µäº†ï¼Œèƒ½è§£é‡Šä¸‹ï¼Ÿï¼Ÿ? ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587536335,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":2002210,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/8d/22/0bf540be.jpg","nickname":"tongzi","note":"","ucode":"7349A6E42EDF17","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1972713,"avatar":"","nickname":"Geek_9efcc0","note":"","ucode":"9F0CCD5DEDB1BA","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":270690,"discussion_content":"å› ä¸ºåŠ äº†äº‹åŠ¡æ³¨è§£ï¼Œå½“ç¬¬äºŒæ¬¡è¯·æ±‚è¿‡æ¥æ—¶ï¼Œç¬¬ä¸€æ¬¡è¯·æ±‚çš„äº‹åŠ¡æ˜¯æ²¡æœ‰æäº¤çš„ï¼›åº”è¯¥æ˜¯å’Œéš”ç¦»çº§åˆ«æœ‰å…³ç³»ï¼Œå¯¼è‡´ç¬¬äºŒæ¬¡è¯·æ±‚åŒæ—¶è¿‡æ¥ï¼Œå¯¹ç¬¬ä¸€æ¬¡ä¿®æ”¹çš„æ•°æ®ä¸å¯è§ã€‚æ‰€ä»¥ä¹Ÿæ‹¿åˆ°äº†é”ï¼›ä¸ªäººæ‹™è§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590037741,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":243367,"ip_address":""},"score":270690,"extra":""},{"author":{"id":1896790,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYBNJLrkN0msjRcXFBVWw4PRUbpr9v0ZMxbuQxSCB4eT4BjERILIAUZYFlFicAgBz52WK2icT6oJ26WkuvoeUoCg/132","nickname":"Geek_c32feb","note":"","ucode":"CDE5E2B549D12E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2002210,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/8d/22/0bf540be.jpg","nickname":"tongzi","note":"","ucode":"7349A6E42EDF17","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":277078,"discussion_content":"æ˜¯çš„ï¼Œæ²¡åŠ äº‹åŠ¡æ³¨è§£ä¹‹å‰å‘ä¸€æ¡sqlè¯­å¥å°±æ˜¯ä¸€ä¸ªå•ç‹¬çš„äº‹åŠ¡ï¼Œä½ åŠ äº†æ³¨è§£è¿™ä¸ªæ–¹æ³•é‡Œé¢æ‰€æœ‰çš„sqlè¯­å¥éƒ½åœ¨ä¸€ä¸ªäº‹åŠ¡é‡Œé¢ï¼Œä¸€ä¸ªè¯·æ±‚åŠ é”æ›´æ–°äº†ï¼Œå¦ä¸€ä¸ªåŒæ—¶è¿‡æ¥è¢«é”é˜»å¡ã€‚ä½†æ˜¯ä½ æ›´æ–°å®Œåæ•°æ®æ²¡æœ‰commitï¼Œæˆ‘å†æ¥åŠ é”çš„æ—¶å€™è¿˜æ˜¯å¯ä»¥ç”¨æˆåŠŸçš„","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1590995357,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":270690,"ip_address":""},"score":277078,"extra":""}]}]},{"had_liked":false,"id":205083,"user_name":"ç«å¾ˆå¤§å…ˆç”Ÿ","can_delete":false,"product_type":"c1","uid":1242070,"ip_address":"","ucode":"80746AFCEF5FE7","user_header":"https://static001.geekbang.org/account/avatar/00/12/f3/d6/5d55c315.jpg","comment_is_top":false,"comment_ctime":1586523472,"is_pvip":false,"replies":[{"id":"76672","content":"éœ€è¦æ˜ç¡®å‡ ç‚¹ï¼š<br>1ã€æˆ‘è§‰å¾—è¿™ä¸ªäº‹åŠ¡æœ€ç»ˆæ˜¯å›æ»šçš„ï¼Œä½ çœ‹åˆ°çš„è¿™ä¸ªæŸ¥è¯¢æœ‰å€¼ï¼Œå¹¶ä¸ä»£è¡¨æ•°æ®åº“æœ‰å€¼<br>2ã€è¿™ä¸ªæŸ¥è¯¢æœ‰å€¼çš„åŸå› æ˜¯å› ä¸ºåœ¨ä¸€ä¸ªäº‹åŠ¡å†…ï¼Œæ­¤æ—¶äº‹åŠ¡å¹¶æ²¡æœ‰å›æ»šï¼Œäº‹åŠ¡è¦åˆ°ç¦»å¼€äº†è¿™ä¸ªcreateUserRightæ–¹æ³•æ‰ä¼šå›æ»šï¼ˆå›æƒ³ä¸€ä¸‹AOPåŸç†ï¼‰<br>3ã€åœ¨ä¸€ä¸ªäº‹åŠ¡å†…è‚¯å®šå¯ä»¥çœ‹åˆ°äº‹åŠ¡ä¹‹å‰åšçš„ä¿®æ”¹","user_name":"ä½œè€…å›å¤","comment_id":205083,"uid":"1001470","ip_address":"","utype":1,"ctime":1586565097,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"53126131024","product_id":100047701,"comment_content":"    @Transactional<br>    public int createUserRight(String name) throws IOException {<br>        try {<br>            userRepository.save(new UserEntity(name));<br>            throw new RuntimeException(&quot;error&quot;);<br>        } catch (Exception ex) {<br>            log.error(&quot;create user failed because {}&quot;, ex.getMessage());<br>            TransactionAspectSupport.currentTransactionStatus().setRollbackOnly();<br>        }<br>        return userRepository.findByName(name).size();<br>    }<br>è¯·æ•™è€å¸ˆï¼Œæˆ‘è¿™ç§å†™æ³•ï¼Œæ§åˆ¶å°æ‰“å‡ºäº†Initiating transaction rollback ä½†æ˜¯æ•°æ®åº“è¿˜æ˜¯å­˜ä¸Šäº†æ•°æ®ï¼Œæ²¡æœ‰å›æ»šï¼Œæ˜¯å› ä¸ºfindByName è¿™ä¸ªæŸ¥è¯¢è¯­å¥çš„é»˜è®¤commitç»™æäº¤äº†å—","like_count":12,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491383,"discussion_content":"éœ€è¦æ˜ç¡®å‡ ç‚¹ï¼š\n1ã€æˆ‘è§‰å¾—è¿™ä¸ªäº‹åŠ¡æœ€ç»ˆæ˜¯å›æ»šçš„ï¼Œä½ çœ‹åˆ°çš„è¿™ä¸ªæŸ¥è¯¢æœ‰å€¼ï¼Œå¹¶ä¸ä»£è¡¨æ•°æ®åº“æœ‰å€¼\n2ã€è¿™ä¸ªæŸ¥è¯¢æœ‰å€¼çš„åŸå› æ˜¯å› ä¸ºåœ¨ä¸€ä¸ªäº‹åŠ¡å†…ï¼Œæ­¤æ—¶äº‹åŠ¡å¹¶æ²¡æœ‰å›æ»šï¼Œäº‹åŠ¡è¦åˆ°ç¦»å¼€äº†è¿™ä¸ªcreateUserRightæ–¹æ³•æ‰ä¼šå›æ»šï¼ˆå›æƒ³ä¸€ä¸‹AOPåŸç†ï¼‰\n3ã€åœ¨ä¸€ä¸ªäº‹åŠ¡å†…è‚¯å®šå¯ä»¥çœ‹åˆ°äº‹åŠ¡ä¹‹å‰åšçš„ä¿®æ”¹","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1586565097,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":195281,"user_name":"é˜¿é‡Œæ–¯æ‰˜èŠ¬","can_delete":false,"product_type":"c1","uid":1228350,"ip_address":"","ucode":"5FB99020992974","user_header":"https://static001.geekbang.org/account/avatar/00/12/be/3e/1de66fbc.jpg","comment_is_top":false,"comment_ctime":1585153043,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"53124760595","product_id":100047701,"comment_content":"æˆ‘è§‰å¾—è¿™ä¸ªæ–‡ç« é‡Œé¢åº”è¯¥é¡ºå¸¦è®²ä¸€ä¸‹ AopContext.currentProxy()","like_count":12},{"had_liked":false,"id":195696,"user_name":"é›…ç„¶é£æ‡¿","can_delete":false,"product_type":"c1","uid":1007242,"ip_address":"","ucode":"32ED4550305D0F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5e/8a/0c1f9635.jpg","comment_is_top":false,"comment_ctime":1585212517,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"27355016293","product_id":100047701,"comment_content":"å­¦ä¹ äº†ï¼Œæˆ‘å¾—å›å»æ£€æŸ¥æˆ‘çš„äº‹åŠ¡ä»£ç äº†","like_count":6},{"had_liked":false,"id":195655,"user_name":"ç‹åˆš","can_delete":false,"product_type":"c1","uid":1103821,"ip_address":"","ucode":"4763CC9A937C38","user_header":"https://static001.geekbang.org/account/avatar/00/10/d7/cd/6ebfc468.jpg","comment_is_top":false,"comment_ctime":1585209794,"is_pvip":true,"replies":[{"id":"74308","content":"æ˜¯å•Šï¼Œæ‰€ä»¥æˆ‘ä»¬æ‰éœ€è¦è®¾ç½®    @Transactional(rollbackFor = Exception.class)<br>æ¥ä¸ä»…ä»…å›æ»šRuntimeException","user_name":"ä½œè€…å›å¤","comment_id":195655,"uid":"1001470","ip_address":"","utype":1,"ctime":1585213633,"user_name_real":"æœ±æ™”"}],"discussion_count":2,"race_medal":0,"score":"27355013570","product_id":100047701,"comment_content":"è€å¸ˆé—®ä¸ªé—®é¢˜ï¼Œæ‚¨è¯´å¾—@Transactionaläº‹ç‰©å›æ»šï¼Œåªæœ‰æ˜¯RuntimeException æˆ–erroræ—¶ï¼Œæ‰ä¼šå›æ»šï¼›<br>ä½†æ˜¯æˆ‘åœ¨åšæµ‹è¯•æ—¶ï¼Œå‘ç°@Transactionalæœ‰ä¸€ä¸ªrollbackForå±æ€§ï¼Œè¯¥å±æ€§å¯ä»¥æŒ‡å®šä»€ä¹ˆå¼‚å¸¸å›æ»šï¼Œå¦‚æœ@Transactional ä¸æŒ‡å®šrollbackForï¼Œé»˜è®¤å¾—æ˜¯RuntimeExceptionï¼Ÿ","like_count":6,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489139,"discussion_content":"æ˜¯å•Šï¼Œæ‰€ä»¥æˆ‘ä»¬æ‰éœ€è¦è®¾ç½®    @Transactional(rollbackFor = Exception.class)\næ¥ä¸ä»…ä»…å›æ»šRuntimeException","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585213633,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1812970,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/a9/ea/5bfce6c5.jpg","nickname":"mgs2002","note":"","ucode":"F5931108BD509B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":215798,"discussion_content":"é˜¿é‡Œçš„å¼€å‘è§„èŒƒå°±æ˜¯å»ºè®®@Transactional(rollbackFor = Exception.class)ï¼Œè¿™æ ·çš„æŠ›å‡ºä¸šåŠ¡å¼‚å¸¸ä¹Ÿä¼šå›æ»šæ•°æ®","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1585384233,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":194198,"user_name":"æ±æ—å¤–å²","can_delete":false,"product_type":"c1","uid":1188906,"ip_address":"","ucode":"3C66C0F0537A99","user_header":"https://static001.geekbang.org/account/avatar/00/12/24/2a/33441e2b.jpg","comment_is_top":false,"comment_ctime":1585036799,"is_pvip":false,"replies":[{"id":"73979","content":"ç†è®ºä¸ŠNESTEDæ˜¾ç„¶æ˜¯æ¯”ä¸¤ä¸ªç‹¬ç«‹éƒ½äº‹åŠ¡å¥½ï¼ŒNESTEDå› ä¸ºJPA Hibernateä¸æ”¯æŒï¼Œæ‰€ä»¥è¿™é‡Œæ²¡æœ‰é‡‡ç”¨è¿™ç§æ–¹å¼ï¼ˆè€Œä¸”å¯¹äºæœ¬ä¾‹è€Œè¨€ï¼Œä¸»ç”¨æˆ·åˆ›å»ºåœ¨å…ˆï¼Œå¦‚æœå…ˆå‡ºå¼‚å¸¸çš„è¯åé¢ä¹Ÿä¸ä¼šåˆ°å­ç”¨æˆ·çš„é€»è¾‘ï¼Œæ‰€ä»¥é—®é¢˜ä¸å¤§ï¼‰ï¼ŒæŠ½ç©ºæˆ‘å†ä¼ ä¸€ä¸ªä¾‹å­ä¸Šå»ï¼š<br><br>https:&#47;&#47;github.com&#47;JosephZhu1983&#47;java-common-mistakes&#47;tree&#47;master&#47;src&#47;main&#47;java&#47;org&#47;geekbang&#47;time&#47;commonmistakes&#47;transaction&#47;nested","user_name":"ä½œè€…å›å¤","comment_id":194198,"uid":"1001470","ip_address":"","utype":1,"ctime":1585040548,"user_name_real":"æœ±æ™”"}],"discussion_count":4,"race_medal":0,"score":"27354840575","product_id":100047701,"comment_content":"è€å¸ˆï¼Œåˆ›å»ºä¸»å­ç”¨æˆ·é‚£ä¸ªä¸šåŠ¡ï¼Œåº”è¯¥æ˜¯å­ç”¨æˆ·åˆ›å»ºå¤±è´¥ä¸å½±å“ä¸»ç”¨æˆ·ï¼Œä½†æ˜¯ä¸»ç”¨æˆ·å¤±è´¥åº”è¯¥å­ç”¨æˆ·ä¹Ÿè¦å›æ»šå§ï¼Ÿå¦‚æœæ˜¯è¿™æ ·ï¼Œé‚£ä¼ æ’­æœºåˆ¶æ˜¯ä¸æ˜¯åº”è¯¥ç”¨Propagation.NESTED","like_count":6,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":488780,"discussion_content":"ç†è®ºä¸ŠNESTEDæ˜¾ç„¶æ˜¯æ¯”ä¸¤ä¸ªç‹¬ç«‹éƒ½äº‹åŠ¡å¥½ï¼ŒNESTEDå› ä¸ºJPA Hibernateä¸æ”¯æŒï¼Œæ‰€ä»¥è¿™é‡Œæ²¡æœ‰é‡‡ç”¨è¿™ç§æ–¹å¼ï¼ˆè€Œä¸”å¯¹äºæœ¬ä¾‹è€Œè¨€ï¼Œä¸»ç”¨æˆ·åˆ›å»ºåœ¨å…ˆï¼Œå¦‚æœå…ˆå‡ºå¼‚å¸¸çš„è¯åé¢ä¹Ÿä¸ä¼šåˆ°å­ç”¨æˆ·çš„é€»è¾‘ï¼Œæ‰€ä»¥é—®é¢˜ä¸å¤§ï¼‰ï¼ŒæŠ½ç©ºæˆ‘å†ä¼ ä¸€ä¸ªä¾‹å­ä¸Šå»ï¼š\n\nhttps://github.com/JosephZhu1983/java-common-mistakes/tree/master/src/main/java/org/geekbang/time/commonmistakes/transaction/nested","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585040548,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1062451,"avatar":"https://static001.geekbang.org/account/avatar/00/10/36/33/67904e86.jpg","nickname":"James","note":"","ucode":"886D1A102C1588","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":308664,"discussion_content":"æœ€å¥½è¿˜æ˜¯ç”¨ NESTED, å¦‚æœç”¨äº† REQUIRED_NEWï¼Œåœ¨ä¸»å­ç”¨æˆ·æ“ä½œå®Œä¹‹åæœ‰å¼‚å¸¸æ—¶ï¼Œä¸»ä¼šå›æ»šï¼Œä½†å­ä¸ä¼šå›æ»šï¼Œè¿™æ ·å­å°±æˆäº†è„æ•°æ®","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1601024018,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1542987,"avatar":"https://static001.geekbang.org/account/avatar/00/17/8b/4b/fa52d222.jpg","nickname":"è¡Œåˆ™å°†è‡³","note":"","ucode":"DB972F2DF059C4","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":384451,"discussion_content":"ç†è®ºä¸ŠNESTEDæ˜¾ç„¶æ˜¯æ¯”ä¸¤ä¸ªç‹¬ç«‹éƒ½äº‹åŠ¡å¥½ã€‚è€å¸ˆçš„è¿™å¥è¯ï¼Œå“ªä½è€å“¥èƒ½è§£é‡Šä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆNESTEDè¦æ¯”ä¸¤ä¸ªç‹¬ç«‹äº‹åŠ¡å¥½å‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626597832,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1272026,"avatar":"https://static001.geekbang.org/account/avatar/00/13/68/da/5bcb83b1.jpg","nickname":"ç™½æ™¨","note":"","ucode":"6D6171B8ECEDDD","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1542987,"avatar":"https://static001.geekbang.org/account/avatar/00/17/8b/4b/fa52d222.jpg","nickname":"è¡Œåˆ™å°†è‡³","note":"","ucode":"DB972F2DF059C4","race_medal":1,"user_type":1,"is_pvip":false},"discussion":{"id":560067,"discussion_content":"æˆ‘ç†è§£æ˜¯è¿™ä¸¤è€…å…¶å®ç®—æ˜¯ä¸€ä¸ªè¡Œä¸ºæ¥ç€ï¼Œæ‰€ä»¥è‚¯å®šåµŒå¥—åœ¨ä¸€èµ·æ›´å¥½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649153010,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":384451,"ip_address":""},"score":560067,"extra":""}]}]},{"had_liked":false,"id":205011,"user_name":"Yanni","can_delete":false,"product_type":"c1","uid":1904077,"ip_address":"","ucode":"D24219F0AB8EC3","user_header":"https://static001.geekbang.org/account/avatar/00/1d/0d/cd/9264c4aa.jpg","comment_is_top":false,"comment_ctime":1586507558,"is_pvip":false,"replies":[{"id":"76622","content":"èƒ½å¦åˆ†æä¸€ä¸‹åŸå› ç»™å¤§å®¶åˆ†äº«ä¸€ä¸‹ï¼Ÿ","user_name":"ä½œè€…å›å¤","comment_id":205011,"uid":"1001470","ip_address":"","utype":1,"ctime":1586515295,"user_name_real":"æœ±æ™”"}],"discussion_count":5,"race_medal":0,"score":"23061344038","product_id":100047701,"comment_content":"è¦æ³¨æ„ï¼Œ@Transactional ä¸ @Asyncæ³¨è§£ä¸èƒ½åŒæ—¶åœ¨ä¸€ä¸ªæ–¹æ³•ä¸Šä½¿ç”¨, è¿™æ ·ä¼šå¯¼è‡´äº‹ç‰©ä¸ç”Ÿæ•ˆã€‚","like_count":5,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491350,"discussion_content":"èƒ½å¦åˆ†æä¸€ä¸‹åŸå› ç»™å¤§å®¶åˆ†äº«ä¸€ä¸‹ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586515295,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1904077,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/0d/cd/9264c4aa.jpg","nickname":"Yanni","note":"","ucode":"D24219F0AB8EC3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":229675,"discussion_content":"1ã€Spring å®ç°è¿™ä¸¤ä¸ªæ³¨è§£çš„æ–¹å¼éƒ½æ˜¯é€šè¿‡AOPã€‚\n2ã€åœ¨å®ç°æ—¶ï¼ŒAsyncæ³¨è§£å¼ºåˆ¶è¦†ç›–AOPçš„orderä¸ºæœ€å°å€¼ï¼ˆå®ƒè®¤ä¸ºAsyncåº”è¯¥æ˜¯æ‰§è¡Œçš„AOPé“¾ä¸­çš„ç¬¬ä¸€ä¸ªadvisor -- https://jira.spring.io/browse/SPR-7147ï¼‰ï¼Œè€Œä¸”orderä¸å¯é…ç½®ã€‚\n3ã€ä½†æ˜¯åœ¨å®ç°Transactionalæ³¨è§£æ—¶ï¼Œå´æ²¡æœ‰è¦†ç›–orderï¼Œè¿™æ„å‘³ç€å®ƒä»ç„¶ä¸ºé»˜è®¤çš„Integer.MAX_VALUEï¼Œorderå¯é…ç½®ã€‚æ‰€ä»¥å¼‚æ­¥åˆ‡é¢ä¼šå…ˆäºäº‹åŠ¡åˆ‡é¢æ‰§è¡Œã€‚\n4ã€å‡è®¾@Transactionalèƒ½å…ˆäºAsyncåˆ‡é¢æ‰§è¡Œï¼Œä½†ç”±äºspringäº‹åŠ¡ç®¡ç†ä¾èµ–çš„æ˜¯ThreadLocalï¼Œæ‰€ä»¥åœ¨å¼€å¯çš„å¼‚æ­¥çº¿ç¨‹é‡Œé¢æ„ŸçŸ¥ä¸åˆ°äº‹åŠ¡ï¼Œè¯´ç»†ç‚¹å°±æ˜¯åœ¨Springå¼€å¯äº‹åŠ¡ä¹‹åï¼Œä¼šè®¾ç½®ä¸€ä¸ªè¿æ¥åˆ°å½“å‰çº¿ç¨‹ï¼Œä½†è¿™ä¸ªæ—¶å€™åˆå¼€å¯äº†ä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œæ‰§è¡Œå®é™…çš„SQLä»£ç æ—¶ï¼Œé€šè¿‡ThreadLocalè·å–ä¸åˆ°è¿æ¥å°±ä¼šå¼€å¯æ–°è¿æ¥ï¼Œä¹Ÿä¸ä¼šè®¾ç½®autoCommitï¼Œæ‰€ä»¥è¿™ä¸ªå‡½æ•°æ•´ä½“å°†æ²¡æœ‰äº‹åŠ¡ã€‚","likes_number":15,"is_delete":false,"is_hidden":false,"ctime":1586681449,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1062451,"avatar":"https://static001.geekbang.org/account/avatar/00/10/36/33/67904e86.jpg","nickname":"James","note":"","ucode":"886D1A102C1588","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1904077,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/0d/cd/9264c4aa.jpg","nickname":"Yanni","note":"","ucode":"D24219F0AB8EC3","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":308672,"discussion_content":"è¯·é—®æœ‰å‚è€ƒä»£ç å—ï¼Œæˆ‘å°è¯•äº†ä¹‹åå‘ç°äº‹åŠ¡æ˜¯ç”Ÿæ•ˆçš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1601025916,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":229675,"ip_address":""},"score":308672,"extra":""}]},{"author":{"id":1480717,"avatar":"https://static001.geekbang.org/account/avatar/00/16/98/0d/fb77a32c.jpg","nickname":"Tim","note":"","ucode":"3AAA9FD3D8DDDB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":408974,"discussion_content":"https://www.cnblogs.com/jpfss/p/10273129.html","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635347946,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1235986,"avatar":"https://static001.geekbang.org/account/avatar/00/12/dc/12/a35259b1.jpg","nickname":"Robot1030","note":"","ucode":"C58668846AF272","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":301086,"discussion_content":"æˆ‘å°è¯•äº†ä¸‹ï¼Œæ˜¯å¯ä»¥ç”Ÿæ•ˆçš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598404388,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":197268,"user_name":"magic","can_delete":false,"product_type":"c1","uid":1024556,"ip_address":"","ucode":"A1BCF486381749","user_header":"","comment_is_top":false,"comment_ctime":1585366165,"is_pvip":false,"replies":[{"id":"74569","content":"å®ç°æ­¥éª¤è¿™é‡Œå¸–ä¸ä¸‹ï¼Œå¯ä»¥å‚è€ƒ https:&#47;&#47;www.cnblogs.com&#47;lovecindywang&#47;p&#47;9749658.html ã€ä½¿ç”¨AspectJé™æ€ç»‡å…¥è¿›è¡Œæ”¹é€ ã€ä¸€èŠ‚ï¼Œè‡ªå·±åšä¸€ä¸‹æµ‹è¯•","user_name":"ä½œè€…å›å¤","comment_id":197268,"uid":"1001470","ip_address":"","utype":1,"ctime":1585373315,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"23060202645","product_id":100047701,"comment_content":"è€å¸ˆèƒ½è¡¥å……ä¸‹å¯¹ç§æœ‰æ–¹æ³•äº‹åŠ¡çš„ä»£ç ç¤ºä¾‹å—ï¼Ÿ","like_count":5,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489487,"discussion_content":"å®ç°æ­¥éª¤è¿™é‡Œå¸–ä¸ä¸‹ï¼Œå¯ä»¥å‚è€ƒ https://www.cnblogs.com/lovecindywang/p/9749658.html ã€ä½¿ç”¨AspectJé™æ€ç»‡å…¥è¿›è¡Œæ”¹é€ ã€ä¸€èŠ‚ï¼Œè‡ªå·±åšä¸€ä¸‹æµ‹è¯•","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585373315,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":193719,"user_name":"æ±æ—å¤–å²","can_delete":false,"product_type":"c1","uid":1188906,"ip_address":"","ucode":"3C66C0F0537A99","user_header":"https://static001.geekbang.org/account/avatar/00/12/24/2a/33441e2b.jpg","comment_is_top":false,"comment_ctime":1584954008,"is_pvip":false,"replies":[{"id":"73776","content":"ç”Ÿæ•ˆï¼Œä½†æ˜¯å‡ºå¼‚å¸¸çš„å¹¶ä¸æ˜¯saveæœ¬èº«ï¼Œæ‰€ä»¥Springæ— æ³•å›æ»š","user_name":"ä½œè€…å›å¤","comment_id":193719,"uid":"1001470","ip_address":"","utype":1,"ctime":1584959131,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"23059790488","product_id":100047701,"comment_content":"å¾ˆæ˜æ˜¾ï¼Œthis è°ƒç”¨å› ä¸ºæ²¡æœ‰èµ°ä»£ç†ï¼Œäº‹åŠ¡æ²¡æœ‰åœ¨ createUserPublic æ–¹æ³•ä¸Šç”Ÿæ•ˆï¼Œåªåœ¨ Repository çš„ save æ–¹æ³•å±‚é¢ç”Ÿæ•ˆã€‚<br>createUserPublicè¿™ä¸ªæ–¹æ³•ä¸æ˜¯æœ¬æ¥å°±ä¸€ä¸ªsaveæ“ä½œå—ï¼Œæ—¢ç„¶saveå±‚é¢ç”Ÿæ•ˆäº†ï¼Œé‚£è¿™ä¸ªæ–¹æ³•çš„äº‹åŠ¡éš¾é“ä¸ä¹Ÿå°±ç”Ÿæ•ˆäº†å—ï¼Ÿ","like_count":5,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":488635,"discussion_content":"ç”Ÿæ•ˆï¼Œä½†æ˜¯å‡ºå¼‚å¸¸çš„å¹¶ä¸æ˜¯saveæœ¬èº«ï¼Œæ‰€ä»¥Springæ— æ³•å›æ»š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584959131,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":195720,"user_name":"å¼ ç®ç£Šæƒ³é™é™","can_delete":false,"product_type":"c1","uid":1084732,"ip_address":"","ucode":"2E582ED7BB178E","user_header":"https://static001.geekbang.org/account/avatar/00/10/8d/3c/9025c2ca.jpg","comment_is_top":false,"comment_ctime":1585213913,"is_pvip":true,"replies":[{"id":"74309","content":"å¯ä»¥æœç´¢ä¸€ä¸‹åˆ†å¸ƒå¼äº‹åŠ¡çš„è§£å†³æ–¹æ¡ˆ","user_name":"ä½œè€…å›å¤","comment_id":195720,"uid":"1001470","ip_address":"","utype":1,"ctime":1585215069,"user_name_real":"æœ±æ™”"}],"discussion_count":2,"race_medal":0,"score":"18765083097","product_id":100047701,"comment_content":"å¦‚æœä¸€ä¸ªäº‹åŠ¡é‡Œé¢æ“ä½œäº†ä¸åŒçš„æ•°æ®åº“ï¼Œå›æ»šæ“ä½œæ˜¯ä¸æ˜¯å°±å¾—è‡ªå·±å†™è¡¥å¿çš„é‡è¯•äº†ï¼Ÿ","like_count":4,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489152,"discussion_content":"å¯ä»¥æœç´¢ä¸€ä¸‹åˆ†å¸ƒå¼äº‹åŠ¡çš„è§£å†³æ–¹æ¡ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585215069,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1107484,"avatar":"https://static001.geekbang.org/account/avatar/00/10/e6/1c/9d3744ee.jpg","nickname":"å°æè®²æºç ","note":"","ucode":"2573037D7C82C8","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":368101,"discussion_content":"æœç´¢ä¸€ä¸‹MySQL XA åˆ†å¸ƒå¼äº‹åŠ¡ï¼ŒMySQL å®ç°äº† 2PC äº‹åŠ¡çš„æäº¤ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªåº”ç”¨ä¸­æ“ä½œä¸åŒçš„æ•°æ®åº“ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618566824,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":193630,"user_name":"ğŸ‘½","can_delete":false,"product_type":"c1","uid":1274117,"ip_address":"","ucode":"D313AF941B412D","user_header":"https://static001.geekbang.org/account/avatar/00/13/71/05/db554eba.jpg","comment_is_top":false,"comment_ctime":1584936812,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18764805996","product_id":100047701,"comment_content":"Springçš„å‘ï¼Œçœ‹æ¥è¿˜éœ€è¦å¤šè¯»äº›æºç å•Šã€‚","like_count":4},{"had_liked":false,"id":191881,"user_name":"æ¢¦å€šæ æ†","can_delete":false,"product_type":"c1","uid":1095857,"ip_address":"","ucode":"BDEB97F2822445","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/bvj76PmeUvW8kokyu91IZWuRATKmabibDWbzAj2TajeEic7WvKCJOLaOh6jibEmdQ36EO3sBUZ0HibAiapsrZo64U8w/132","comment_is_top":false,"comment_ctime":1584802454,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"18764671638","product_id":100047701,"comment_content":"å¾ˆå¤šæ³¨è§£è²Œä¼¼éƒ½æ˜¯éœ€è¦publicæ‰èƒ½ç”Ÿæ•ˆæ¯”å¦‚ï¼š@cacheable @async","like_count":5,"discussions":[{"author":{"id":1197260,"avatar":"https://static001.geekbang.org/account/avatar/00/12/44/cc/3e62d111.jpg","nickname":"justd","note":"","ucode":"A8857900C9FA18","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":215781,"discussion_content":"å› ä¸ºåŠ¨æ€ä»£ç†çš„åŸå› ä¹ˆ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1585382783,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1095857,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/bvj76PmeUvW8kokyu91IZWuRATKmabibDWbzAj2TajeEic7WvKCJOLaOh6jibEmdQ36EO3sBUZ0HibAiapsrZo64U8w/132","nickname":"æ¢¦å€šæ æ†","note":"","ucode":"BDEB97F2822445","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1197260,"avatar":"https://static001.geekbang.org/account/avatar/00/12/44/cc/3e62d111.jpg","nickname":"justd","note":"","ucode":"A8857900C9FA18","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":215825,"discussion_content":"å¯¹ï¼Œä½ çš„å¤´åƒå¾ˆåˆ«è‡´å‘€","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1585388090,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":215781,"ip_address":""},"score":215825,"extra":""},{"author":{"id":1616166,"avatar":"https://static001.geekbang.org/account/avatar/00/18/a9/26/da3113a3.jpg","nickname":"é£é±¼","note":"","ucode":"0F5F441B173FB4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1095857,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/bvj76PmeUvW8kokyu91IZWuRATKmabibDWbzAj2TajeEic7WvKCJOLaOh6jibEmdQ36EO3sBUZ0HibAiapsrZo64U8w/132","nickname":"æ¢¦å€šæ æ†","note":"","ucode":"BDEB97F2822445","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":220630,"discussion_content":"æ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585909325,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":215825,"ip_address":""},"score":220630,"extra":""}]}]},{"had_liked":false,"id":225710,"user_name":"nimil","can_delete":false,"product_type":"c1","uid":1197925,"ip_address":"","ucode":"19933068972746","user_header":"https://static001.geekbang.org/account/avatar/00/12/47/65/cce8eb34.jpg","comment_is_top":false,"comment_ctime":1591838234,"is_pvip":false,"replies":[{"id":"83172","content":"çš„ç¡®ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ç§å‘","user_name":"ä½œè€…å›å¤","comment_id":225710,"uid":"1001470","ip_address":"","utype":1,"ctime":1591840763,"user_name_real":"æœ±æ™”"}],"discussion_count":2,"race_medal":0,"score":"14476740122","product_id":100047701,"comment_content":"å‰å‡ å¤©è¿˜çœŸå‡ºç°äº†ä¸ªäº‹åŠ¡ä¸ç”Ÿæ•ˆçš„é—®é¢˜ï¼Œäºæ˜¯å¯¹ç€æ–‡ç« ä»”ç»†reviewäº†ä¸€ä¸‹ä»£ç ï¼Œå‘ç°ä¹Ÿæ²¡æ–‡ä¸­è¯´çš„é‚£äº›æ¯›ç—…ï¼Œæœ€åæ’æŸ¥åˆ°æ˜¯äº‹åŠ¡ç®¡ç†å™¨åªé…ç½®äº†ä¸€ä¸ªæ•°æ®åº“ï¼Œè€Œæˆ‘æ˜¯åœ¨å¦ä¸€ä¸ªæ•°æ®åº“è¿›è¡Œçš„æ•°æ®æ“ä½œï¼Œæ‰€ä»¥äº‹åŠ¡ä¸ç”Ÿæ•ˆäº†ï¼Œæœ€åæ·»åŠ å¦ä¸€ä¸ªæ•°æ®åº“çš„äº‹åŠ¡ç®¡ç†å™¨äº‹åŠ¡å°±ç”Ÿæ•ˆäº†","like_count":3,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":497958,"discussion_content":"çš„ç¡®ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ç§å‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591840763,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1488356,"avatar":"https://static001.geekbang.org/account/avatar/00/16/b5/e4/e6faf686.jpg","nickname":"æ¡äº†ä¸ªå¤§èš‚èš±","note":"","ucode":"AD34AD4FA37371","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":341238,"discussion_content":"å“ˆå“ˆå“ˆå“ˆå“ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610358077,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":203682,"user_name":"COLDLY","can_delete":false,"product_type":"c1","uid":1248467,"ip_address":"","ucode":"B16257B2D83CC0","user_header":"https://static001.geekbang.org/account/avatar/00/13/0c/d3/0be6ae81.jpg","comment_is_top":false,"comment_ctime":1586254257,"is_pvip":false,"replies":[{"id":"76111","content":"1ã€ä¸€ä¸ªselectå¯¹äºæ•°æ®åº“æ¥è¯´ä¹Ÿæ˜¯äº‹åŠ¡ï¼Œéšå¼äº‹åŠ¡ä¹Ÿæ˜¯äº‹åŠ¡ï¼Œè¯»ä¹Ÿéœ€è¦è€ƒè™‘äº‹åŠ¡éš”ç¦»æ€§<br>2ã€åŠ äº‹åŠ¡ä½ æ˜¯æŒ‡@Transactionalï¼Ÿå¦‚æœæ–¹æ³•é‡Œé¢æ²¡æœ‰ä»€ä¹ˆå…¶ä»–æ“ä½œä¸å»ºè®®åŠ ï¼Œå°±ä¿æŒautocommitå¥½äº†ï¼ŒåŠ äº†å¯èƒ½è¿˜ä¼šautocommit=0ã€selectã€commitã€autocommit=1ï¼Œå¢åŠ æ— è°“çš„äº¤äº’","user_name":"ä½œè€…å›å¤","comment_id":203682,"uid":"1001470","ip_address":"","utype":1,"ctime":1586256658,"user_name_real":"æœ±æ™”"}],"discussion_count":2,"race_medal":0,"score":"14471156145","product_id":100047701,"comment_content":"è¯·é—®å¦‚æœä»…æ˜¯selectè¯­å¥ï¼Œéœ€è¦åŠ äº‹åŠ¡å—","like_count":4,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490932,"discussion_content":"1ã€ä¸€ä¸ªselectå¯¹äºæ•°æ®åº“æ¥è¯´ä¹Ÿæ˜¯äº‹åŠ¡ï¼Œéšå¼äº‹åŠ¡ä¹Ÿæ˜¯äº‹åŠ¡ï¼Œè¯»ä¹Ÿéœ€è¦è€ƒè™‘äº‹åŠ¡éš”ç¦»æ€§\n2ã€åŠ äº‹åŠ¡ä½ æ˜¯æŒ‡@Transactionalï¼Ÿå¦‚æœæ–¹æ³•é‡Œé¢æ²¡æœ‰ä»€ä¹ˆå…¶ä»–æ“ä½œä¸å»ºè®®åŠ ï¼Œå°±ä¿æŒautocommitå¥½äº†ï¼ŒåŠ äº†å¯èƒ½è¿˜ä¼šautocommit=0ã€selectã€commitã€autocommit=1ï¼Œå¢åŠ æ— è°“çš„äº¤äº’","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586256658,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1107484,"avatar":"https://static001.geekbang.org/account/avatar/00/10/e6/1c/9d3744ee.jpg","nickname":"å°æè®²æºç ","note":"","ucode":"2573037D7C82C8","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":368102,"discussion_content":"MySQLé€šè¿‡MVCCå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶æœºåˆ¶æ¥ä¿è¯å¤šä¸ªäº‹åŠ¡è¯»å†™åŒä¸€è¡Œæ•°æ®çš„å¹¶å‘é—®é¢˜ã€‚åº•å±‚æ˜¯åŸºäºundo logç‰ˆæœ¬é“¾+ReadViewæœºåˆ¶å®ç°çš„ï¼Œå¯ä»¥äº†è§£ä¸€ä¸‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618567040,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":193977,"user_name":"å°æè®²æºç ","can_delete":false,"product_type":"c1","uid":1107484,"ip_address":"","ucode":"2573037D7C82C8","user_header":"https://static001.geekbang.org/account/avatar/00/10/e6/1c/9d3744ee.jpg","comment_is_top":false,"comment_ctime":1585009819,"is_pvip":true,"replies":[{"id":"73864","content":"ğŸ‘ğŸ»","user_name":"ä½œè€…å›å¤","comment_id":193977,"uid":"1001470","ip_address":"","utype":1,"ctime":1585011784,"user_name_real":"æœ±æ™”"}],"discussion_count":2,"race_medal":0,"score":"14469911707","product_id":100047701,"comment_content":"çœ‹å®Œäº†è€å¸ˆè®²çš„è¿™ç¯‡æ–‡ç« ï¼Œå‘ç°è‡ªå·±ç”¨@Transationçš„æ—¶å€™ï¼Œä¹Ÿåªæ˜¯ä¸ºäº†ç”¨è€Œç”¨ï¼Œå¹¶ä¸çœ‹å®ƒçš„çœŸå®æ•ˆæœï¼Œå°±ä¼šå¯¼è‡´ä»¥åçš„æ•°æ®ä¸æ­£ç¡®ï¼Œæœ‰è„æ•°æ®ã€‚ä»Šå¤©æŠŠæ¡ˆä¾‹ä¸­çš„ä»£ç æ•²ä¸€éï¼Œç„¶åå†çœ‹è‡ªå·±é¡¹ç›®ä¸­çš„ç”¨æ³•æ˜¯å¦æ­£ç¡®ã€‚","like_count":3,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":488718,"discussion_content":"ğŸ‘ğŸ»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585011784,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1107484,"avatar":"https://static001.geekbang.org/account/avatar/00/10/e6/1c/9d3744ee.jpg","nickname":"å°æè®²æºç ","note":"","ucode":"2573037D7C82C8","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":368103,"discussion_content":"ä»Šå¤©é‡æ–°æ¢³ç†äº†äº‹åŠ¡ç›¸å…³çš„å†…å®¹ï¼Œå¹¶ä¸”æŠŠ@Transactionalæ³¨è§£ä»åŠ è½½åˆ°ä½¿ç”¨çš„æ•´ä¸ªæºç è¿‡ç¨‹éƒ½åˆ†æäº†ä¸€éï¼Œç„¶åå†ç»“åˆè€å¸ˆçš„æ–‡ç« ï¼Œç°åœ¨çœŸçš„æ˜¯è±ç„¶å¼€æœ—äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618567140,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":275322,"user_name":"å†‰é‡","can_delete":false,"product_type":"c1","uid":1137353,"ip_address":"","ucode":"2CAEA424996876","user_header":"https://static001.geekbang.org/account/avatar/00/11/5a/c9/933ee0a8.jpg","comment_is_top":false,"comment_ctime":1611471360,"is_pvip":false,"replies":[{"id":"99973","content":"Springä¸­ä½¿ç”¨ThreadLocalæ¥è®¾è®¡TransactionSynchronizationManagerç±»ï¼Œå®ç°äº†äº‹åŠ¡ç®¡ç†ä¸æ•°æ®è®¿é—®æœåŠ¡çš„è§£è€¦ï¼ŒåŒæ—¶ä¹Ÿä¿è¯äº†å¤šçº¿ç¨‹ç¯å¢ƒä¸‹connectionçš„çº¿ç¨‹å®‰å…¨é—®é¢˜","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1611557692,"ip_address":"","comment_id":275322,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10201405952","product_id":100047701,"comment_content":"å¯æ˜¯ä¸ºä»€ä¹ˆ åœ¨subUserService.createSubUserWithExceptionRight(entity);æ”¹æˆ new Thread()çº¿ç¨‹æ‰§è¡Œï¼Œäº‹åŠ¡å°±ä¸ä¼šå›æ»šäº†å‘¢ï¼Œè¿˜æç¤º SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@3f669b54] was not registered for synchronization because synchronization is not activeå’Œ<br>JDBC Connection [HikariProxyConnection@1155028039 wrapping com.mysql.jdbc.JDBC4Connection@4f6fcbb3] will not be managed by Spring<br> è¿˜è¯·è€å¸ˆå’ŒåŒå­¦ä»¬å¸®è§£ç­”ä¸€ä¸‹<br>","like_count":2,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":514310,"discussion_content":"Springä¸­ä½¿ç”¨ThreadLocalæ¥è®¾è®¡TransactionSynchronizationManagerç±»ï¼Œå®ç°äº†äº‹åŠ¡ç®¡ç†ä¸æ•°æ®è®¿é—®æœåŠ¡çš„è§£è€¦ï¼ŒåŒæ—¶ä¹Ÿä¿è¯äº†å¤šçº¿ç¨‹ç¯å¢ƒä¸‹connectionçš„çº¿ç¨‹å®‰å…¨é—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611557692,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":252811,"user_name":"Mr wind","can_delete":false,"product_type":"c1","uid":1217874,"ip_address":"","ucode":"484F02D1962239","user_header":"https://static001.geekbang.org/account/avatar/00/12/95/52/ad190682.jpg","comment_is_top":false,"comment_ctime":1602492255,"is_pvip":false,"replies":[{"id":"92399","content":"å¦‚æœæ•´ä½“éœ€è¦ä¸€è‡´æ€§é‚£ä¹ˆå¯ä»¥è€ƒè™‘æ˜¯å¦éƒ¨åˆ†å¯ä»¥æœ€ç»ˆä¸€è‡´æ€§ï¼Œä¹Ÿå°±æ˜¯éƒ¨åˆ†æµç¨‹å¼‚æ­¥åŒ–ï¼Œæœ€ç»ˆä¸€è‡´ï¼Œå½“ç„¶äº†ä½ è¦ç¡®ä¿å¼‚æ­¥åŒ–çš„è¿™ä¸ªæµç¨‹å’Œä¸»æµç¨‹æœ‰äº‹åŠ¡æ€§ï¼Œæ¯”å¦‚å¯ä»¥é‡‡ç”¨äº‹åŠ¡æ¶ˆæ¯æˆ–è€…æœ¬åœ°äº‹åŠ¡è¡¨","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1602503477,"ip_address":"","comment_id":252811,"utype":1}],"discussion_count":2,"race_medal":0,"score":"10192426847","product_id":100047701,"comment_content":"æœŸå¾…è€å¸ˆçš„å›ç­”ï¼Œå‡å¦‚æ˜¯åœ¨ä¸€ä¸ªé•¿æµç¨‹çš„æ“ä½œé‡Œï¼Œæ¯”å¦‚æŸ¥è¯¢è¡¨1ï¼Œæ›´æ–°è¡¨2ï¼ŒæŸ¥è¯¢è¡¨3ï¼Œæ›´æ–°è¡¨3...ç±»ä¼¼è¿™ç§ä¸šåŠ¡é‡Œæ•°æ®é‡åˆå¤§ï¼Œå„ä¸ªè¡¨ä¹‹é—´æœ‰ä¸šåŠ¡å…³è”éƒ½éœ€è¦æ›´æ–°ï¼Œè€—æ—¶å¾ˆé•¿ã€‚è¿™ç§æƒ…å†µåº”è¯¥åŠ äº‹åŠ¡å—ï¼Ÿå¦‚æœåŠ åœ¨æµç¨‹é¡¶éƒ¨è‚¯å®šä¼šæ˜¯é•¿äº‹åŠ¡éå¸¸ä¸å¥½ã€‚æ„Ÿè§‰è¿™ç§æƒ…å†µæ˜¯å¦åªæœ‰ä»ä¸šåŠ¡è§’åº¦æ¥æ”¹å˜ï¼Œä¸çŸ¥é“è€å¸ˆæ€ä¹ˆçœ‹ã€‚","like_count":2,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":506880,"discussion_content":"å¦‚æœæ•´ä½“éœ€è¦ä¸€è‡´æ€§é‚£ä¹ˆå¯ä»¥è€ƒè™‘æ˜¯å¦éƒ¨åˆ†å¯ä»¥æœ€ç»ˆä¸€è‡´æ€§ï¼Œä¹Ÿå°±æ˜¯éƒ¨åˆ†æµç¨‹å¼‚æ­¥åŒ–ï¼Œæœ€ç»ˆä¸€è‡´ï¼Œå½“ç„¶äº†ä½ è¦ç¡®ä¿å¼‚æ­¥åŒ–çš„è¿™ä¸ªæµç¨‹å’Œä¸»æµç¨‹æœ‰äº‹åŠ¡æ€§ï¼Œæ¯”å¦‚å¯ä»¥é‡‡ç”¨äº‹åŠ¡æ¶ˆæ¯æˆ–è€…æœ¬åœ°äº‹åŠ¡è¡¨","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602503477,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1217874,"avatar":"https://static001.geekbang.org/account/avatar/00/12/95/52/ad190682.jpg","nickname":"Mr wind","note":"","ucode":"484F02D1962239","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":311900,"discussion_content":"è€å¸ˆçœŸæ•¬ä¸šå•Šï¼Œè°¢è°¢ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602515616,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":223682,"user_name":"éƒ‘å…ˆç”Ÿ","can_delete":false,"product_type":"c1","uid":1992424,"ip_address":"","ucode":"AA0BA751C4F132","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ep3sqfTQey7eKYgGibLnAvaNj9k8gVvIYKVADicOA3DxmXZcDrAkeM8iaJLruiblmEVUr3q2LOVLvYicTw/132","comment_is_top":false,"comment_ctime":1591155141,"is_pvip":false,"replies":[{"id":"82392","content":"ä¼šå›æ»šï¼Œæºç å‚è€ƒ<br><br>RuleBasedTransactionAttribute.rollbackOn<br><br>@Override<br>\tpublic boolean rollbackOn(Throwable ex) {<br>\t\tif (logger.isTraceEnabled()) {<br>\t\t\tlogger.trace(&quot;Applying rules to determine whether transaction should rollback on &quot; + ex);<br>\t\t}<br><br>\t\tRollbackRuleAttribute winner = null;<br>\t\tint deepest = Integer.MAX_VALUE;<br><br>\t\tif (this.rollbackRules != null) {<br>\t\t\tfor (RollbackRuleAttribute rule : this.rollbackRules) {<br>\t\t\t\tint depth = rule.getDepth(ex);<br>\t\t\t\tif (depth &gt;= 0 &amp;&amp; depth &lt; deepest) {<br>\t\t\t\t\tdeepest = depth;<br>\t\t\t\t\twinner = rule;<br>\t\t\t\t}<br>\t\t\t}<br>\t\t}<br><br>\t\tif (logger.isTraceEnabled()) {<br>\t\t\tlogger.trace(&quot;Winning rollback rule is: &quot; + winner);<br>\t\t}<br><br>\t\t&#47;&#47; User superclass behavior (rollback on unchecked) if no rule matches.<br>\t\tif (winner == null) {<br>\t\t\tlogger.trace(&quot;No relevant rollback rule found: applying default rules&quot;);<br>\t\t\treturn super.rollbackOn(ex);<br>\t\t}<br><br>\t\treturn !(winner instanceof NoRollbackRuleAttribute);<br>\t}","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1591168665,"ip_address":"","comment_id":223682,"utype":1}],"discussion_count":3,"race_medal":0,"score":"10181089733","product_id":100047701,"comment_content":"æœ‰ä¸ªé—®é¢˜ é»˜è®¤åªå›æ»šRuntimeExceptionå’ŒErrorçš„å¼‚å¸¸ï¼ŒæŒ‰ç…§å¼‚å¸¸ç»§æ‰¿å…³ç³»ï¼šErrorå’ŒExceptionéƒ½ç»§æ‰¿è‡ªThrowableï¼Œå¦‚æœæŒ‡å®šrollbackFor=Exception.classï¼Œé‚£ä¸æ˜¯Errorçš„å¼‚å¸¸ä¸ä¼šå›æ»šäº†ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":497212,"discussion_content":"ä¼šå›æ»šï¼Œæºç å‚è€ƒ\n\nRuleBasedTransactionAttribute.rollbackOn\n\n@Override\n\tpublic boolean rollbackOn(Throwable ex) {\n\t\tif (logger.isTraceEnabled()) {\n\t\t\tlogger.trace(&amp;quot;Applying rules to determine whether transaction should rollback on &amp;quot; + ex);\n\t\t}\n\n\t\tRollbackRuleAttribute winner = null;\n\t\tint deepest = Integer.MAX_VALUE;\n\n\t\tif (this.rollbackRules != null) {\n\t\t\tfor (RollbackRuleAttribute rule : this.rollbackRules) {\n\t\t\t\tint depth = rule.getDepth(ex);\n\t\t\t\tif (depth &amp;gt;= 0 &amp;amp;&amp;amp; depth &amp;lt; deepest) {\n\t\t\t\t\tdeepest = depth;\n\t\t\t\t\twinner = rule;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (logger.isTraceEnabled()) {\n\t\t\tlogger.trace(&amp;quot;Winning rollback rule is: &amp;quot; + winner);\n\t\t}\n\n\t\t// User superclass behavior (rollback on unchecked) if no rule matches.\n\t\tif (winner == null) {\n\t\t\tlogger.trace(&amp;quot;No relevant rollback rule found: applying default rules&amp;quot;);\n\t\t\treturn super.rollbackOn(ex);\n\t\t}\n\n\t\treturn !(winner instanceof NoRollbackRuleAttribute);\n\t}","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591168665,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1107484,"avatar":"https://static001.geekbang.org/account/avatar/00/10/e6/1c/9d3744ee.jpg","nickname":"å°æè®²æºç ","note":"","ucode":"2573037D7C82C8","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":368108,"discussion_content":"å°±æ˜¯æˆ‘ä»¬è®¾ç½®äº†åŒ¹é…è§„åˆ™ï¼Œå¦‚æœæ»¡è¶³äº†ï¼Œæ¯”å¦‚æˆ‘ä»¬çš„æŠ›å‡ºçš„å¼‚å¸¸çš„çˆ¶ç±»æ˜¯Exception.classï¼Œé‚£ä¹ˆå°±ä¼šè¿”å›trueã€‚å¦‚æœæ²¡æœ‰åŒ¹é…çš„è¯ï¼Œé‚£ä¹ˆwinnerå°±æ˜¯nullï¼Œå°±ä¼šèµ°é»˜è®¤çš„é€»è¾‘ï¼Œä¹Ÿå°±æ˜¯åˆ¤æ–­æ˜¯å¦æ˜¯RuntimeExceptionè¿˜æ˜¯Errorã€‚\n\næ‰€ä»¥ Error çš„å¼‚å¸¸ä¹Ÿæ˜¯ä¼šæ•è·åˆ°çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618567621,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1107484,"avatar":"https://static001.geekbang.org/account/avatar/00/10/e6/1c/9d3744ee.jpg","nickname":"å°æè®²æºç ","note":"","ucode":"2573037D7C82C8","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":368106,"discussion_content":"å¥½é—®é¢˜ï¼Œå¯ä»¥å¥½å¥½åœ°ç ”ç©¶ä¸€ä¸‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618567423,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":219467,"user_name":"tongzi","can_delete":false,"product_type":"c1","uid":2002210,"ip_address":"","ucode":"7349A6E42EDF17","user_header":"https://static001.geekbang.org/account/avatar/00/1e/8d/22/0bf540be.jpg","comment_is_top":false,"comment_ctime":1590028578,"is_pvip":false,"replies":[{"id":"81082","content":"ä¸ä¼šæœ‰é—®é¢˜ï¼Œä¸è®¾ç½®é»˜è®¤å°±æ˜¯ä½¿ç”¨æ•°æ®åº“è®¾ç½®çš„éš”ç¦»çº§åˆ«ï¼Œå¦‚æœä½ è®¾ç½®äº†å°±ä½¿ç”¨ä½ è®¾ç½®çš„éš”ç¦»çº§åˆ«","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1590046383,"ip_address":"","comment_id":219467,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10179963170","product_id":100047701,"comment_content":"ã€é—®é¢˜ã€‘<br>1ã€å‘˜å·¥å¯¼å…¥ï¼ˆæ–°æ‰‹æœºå·ï¼‰ï¼Œç¬¬ä¸€æ¬¡ä¼šå¯¼å…¥å¤±è´¥ï¼Œå†å¯¼å…¥æ‰ä¼šæˆåŠŸ<br>ã€å…·ä½“åœºæ™¯ã€‘<br>å¯¼å…¥excelï¼Œè§£ææˆå‘˜å·¥æ•°æ®4æ¡ï¼Œå…ˆå»æ³¨å†Œç”Ÿæˆt_userè¡¨ï¼Œç”ŸæˆåŸºæœ¬ä¿¡æ¯<br>ç„¶ååœ¨è°ƒç”¨ï¼ŒbandCorpï¼Œå’Œå…¬å¸ç»‘å®šï¼Œç”Ÿæˆt_corp_userè¡¨<br>ä½†æ˜¯åœ¨è°ƒç”¨bandCorpæ—¶ï¼Œéœ€è¦å…ˆå»æ ¡éªŒè¿™ä¸ªæ‰‹æœºå·ï¼Œæ˜¯å¦åœ¨t_userè¡¨ç”Ÿæˆæ•°æ®<br>ã€è§£å†³ã€‘<br>å‘ç°ç”±äºäº‹åŠ¡æ³¨è§£å¼•èµ·çš„bugï¼ŒimportUserListï¼ˆå¯¼å…¥å‘˜å·¥æ–¹æ³•ï¼‰åŠ äº†äº‹åŠ¡æ³¨è§£ï¼ŒregisterUseræ²¡æœ‰åŠ äº‹åŠ¡æ³¨è§£<br>bandCorpåŠ äº†äº‹åŠ¡æ³¨è§£ï¼ŒbandCorpä¼ æ’­çº§åˆ«ä¸ºPropagation.REQUIRES_NEWï¼Œæ–°å¼€äº†äº‹åŠ¡<br>ç”±äºçº¿ä¸Šæ•°æ®åº“ä¸ºå¯é‡å¤è¯»ï¼Œqaæ•°æ®åº“ä¸ºè¯»å·²æäº¤ï¼Œå¯¼è‡´æ•°æ®çš„ä¸å¯è§ï¼Œæ ¡éªŒå¤±è´¥<br><br>è€å¸ˆæ‚¨å¥½ï¼Œæˆ‘è¿™è¾¹æœ‰ä¸ªé—®é¢˜ï¼Œçœ‹è§springbootçš„äº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯defaultï¼Œé»˜è®¤é‡‡ç”¨æ•°æ®åº“çš„<br>éš”ç¦»çº§åˆ«ï¼Œå¦‚æœè¦æ˜¯springbootçš„äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œå’Œmysqlé‡‡ç”¨ä¸åŒçš„éš”ç¦»çº§åˆ«ï¼Œæ˜¯å¦ä¼šå¯¼è‡´ä»€ä¹ˆé—®é¢˜ï¼Ÿï¼ˆæ¯”å¦‚springbootæ‰‹åŠ¨è®¾ç½®ä¸º  å¯é‡å¤è¯»ï¼Œè€Œæ•°æ®åº“ä¸ºè¯»å·²æäº¤ï¼‰","like_count":3,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":495815,"discussion_content":"ä¸ä¼šæœ‰é—®é¢˜ï¼Œä¸è®¾ç½®é»˜è®¤å°±æ˜¯ä½¿ç”¨æ•°æ®åº“è®¾ç½®çš„éš”ç¦»çº§åˆ«ï¼Œå¦‚æœä½ è®¾ç½®äº†å°±ä½¿ç”¨ä½ è®¾ç½®çš„éš”ç¦»çº§åˆ«","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590046383,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":204175,"user_name":"Michael","can_delete":false,"product_type":"c1","uid":1274787,"ip_address":"","ucode":"C233DF1D224EC1","user_header":"https://static001.geekbang.org/account/avatar/00/13/73/a3/2b077607.jpg","comment_is_top":false,"comment_ctime":1586346758,"is_pvip":true,"replies":[{"id":"76387","content":"æˆ‘ä¸çŸ¥é“ä½ è¿™ä¸¤ä¸ªä»»åŠ¡å“ªä¸ªæ˜¯ä¸»ä»»åŠ¡ï¼Œå‡è®¾å†™å…¥nasæ˜¯ä¸»ä»»åŠ¡ï¼Œå†™å…¥æ•°æ®åº“åªæ˜¯è®°å½•çŠ¶æ€ï¼Œå¹¶ä¸”å‰è€…åˆæ…¢ï¼Œè¿™ç§æœ€åˆç†çš„åšæ³•æ˜¯ï¼š<br>1ã€æ•°æ®åº“æ’å…¥ä»»åŠ¡è®°å½•<br>2ã€å¯ä¸€ä¸ªjobæ¥å¤„ç†ä»»åŠ¡ï¼Œå¼€å§‹å¤„ç†çš„æ—¶å€™æ›´æ–°ä¸ºå¤„ç†ä¸­<br>3ã€å¦‚æœæ˜¯å¤„ç†ä¸­åˆ™æŸ¥nasæ›´æ–°ç»“æœ<br>4ã€å¦‚æœæ²¡æˆåŠŸæˆ–æœªå¤„ç†åˆ™æ¸…ç†nas+å†™æ•°æ®<br>5ã€æˆåŠŸåæ›´æ–°ä»»åŠ¡çŠ¶æ€ä¸ºæˆåŠŸ<br>6ã€å¤±è´¥ç»´æŒå¤„ç†ä¸­å³å¯ï¼Œç­‰å¾…jobä¸‹ä¸€æ¬¡è°ƒåº¦<br>","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1586389223,"ip_address":"","comment_id":204175,"utype":1}],"discussion_count":3,"race_medal":0,"score":"10176281350","product_id":100047701,"comment_content":"è€å¸ˆï¼Œæœ‰ä¸ªé—®é¢˜ï¼Œè¯·æ•™ä¸‹ï¼šä¸€ä¸ªæ“ä½œï¼Œé‡Œé¢æ¶‰åŠå¾€nasç›˜å†™æ•°æ®å’Œæ•°æ®åº“æ›´æ–°æ•°æ®ï¼Œå½“äºŒè€…éƒ½æˆåŠŸæ‰OKï¼Œä½†æ˜¯ä¼šå‡ºç°å†™å…¥nasç›˜æˆåŠŸä½†æ˜¯å†™å…¥æ•°æ®åº“å¤±è´¥çš„æƒ…å†µï¼Œè¿™ç§å¦‚ä½•å›æ»šï¼Œnasç›˜çš„æ•°æ®è¿™æ—¶å€™ä¸æ˜¯æœ‰æ•ˆçš„äº†ï¼Œå¦‚ä½•å›æ»šæ¸…ç†","like_count":2,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491097,"discussion_content":"æˆ‘ä¸çŸ¥é“ä½ è¿™ä¸¤ä¸ªä»»åŠ¡å“ªä¸ªæ˜¯ä¸»ä»»åŠ¡ï¼Œå‡è®¾å†™å…¥nasæ˜¯ä¸»ä»»åŠ¡ï¼Œå†™å…¥æ•°æ®åº“åªæ˜¯è®°å½•çŠ¶æ€ï¼Œå¹¶ä¸”å‰è€…åˆæ…¢ï¼Œè¿™ç§æœ€åˆç†çš„åšæ³•æ˜¯ï¼š\n1ã€æ•°æ®åº“æ’å…¥ä»»åŠ¡è®°å½•\n2ã€å¯ä¸€ä¸ªjobæ¥å¤„ç†ä»»åŠ¡ï¼Œå¼€å§‹å¤„ç†çš„æ—¶å€™æ›´æ–°ä¸ºå¤„ç†ä¸­\n3ã€å¦‚æœæ˜¯å¤„ç†ä¸­åˆ™æŸ¥nasæ›´æ–°ç»“æœ\n4ã€å¦‚æœæ²¡æˆåŠŸæˆ–æœªå¤„ç†åˆ™æ¸…ç†nas+å†™æ•°æ®\n5ã€æˆåŠŸåæ›´æ–°ä»»åŠ¡çŠ¶æ€ä¸ºæˆåŠŸ\n6ã€å¤±è´¥ç»´æŒå¤„ç†ä¸­å³å¯ï¼Œç­‰å¾…jobä¸‹ä¸€æ¬¡è°ƒåº¦\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586389223,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":228670,"discussion_content":"æˆ‘çš„æ–¹æ¡ˆæ˜¯ç”¨äºé‡ä»»åŠ¡çš„ï¼Œä½ è¿™ç§è½»ä»»åŠ¡çš„æ–¹æ¡ˆä¹Ÿæ¯”è¾ƒç®€å•ï¼ŒæŠŠä¸Šä¼ å’Œæ›´æ–°è·¯å¾„éƒ½æ”¾åœ¨ä¸€ä¸ªäº‹åŠ¡é‡Œï¼Œä¼ å¤±è´¥äº†å‡ºå¼‚å¸¸è®©äº‹åŠ¡å›æ»šï¼Œè®©ç”¨æˆ·é‡è¯•å³å¯ï¼Œä¼ å¤±è´¥æ˜¯å°æ¦‚ç‡äº‹ä»¶ï¼Œå¯ä»¥è€ƒè™‘ä¸æ¸…nasï¼Œæˆ–è€…åšä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œä»æ•°æ®åº“æå‡ºæ‰€æœ‰å›¾ç‰‡åœ°å€ï¼Œç„¶åé€ä¸€æ£€æŸ¥naså®šæœŸæ¸…ç†åºŸå›¾","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1586568900,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1274787,"avatar":"https://static001.geekbang.org/account/avatar/00/13/73/a3/2b077607.jpg","nickname":"Michael","note":"","ucode":"C233DF1D224EC1","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":227220,"discussion_content":"è°¢è°¢è€å¸ˆè§£ç­”ï¼Œä½†æ˜¯è¿™ä¸¤ä¸ªæ“ä½œæ˜¯å‘ç”Ÿåœ¨ä¸€ä¸ªæ¥å£å±‚é¢ï¼Œæ¯”å¦‚ä¸Šä¼ å¤´åƒæ¥å£ï¼Œå¤´åƒæ”¾åœ¨nasç›˜ï¼Œdbå­˜å‚¨è·¯å¾„ï¼Œnasç›˜å¤´åƒè®¿é—®èµ°cdnï¼Œå› ä¸ºæˆ‘ä»¬è¿™é‡ŒcdnåŒåä¸åŒæ­¥ï¼Œæ•…å¤´åƒåæ¯æ¬¡æ›´æ–°éƒ½ä¸ä¸€æ ·æ‰èƒ½åŒæ­¥ï¼Œæ¥å£å±‚é¢è¿™ç§æƒ…å†µï¼Œè€å¸ˆæçš„è¿™ç§æ–¹æ¡ˆæ˜¯ä¸æ˜¯ä»£ä»·æœ‰ç‚¹å¤§ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586478907,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":199324,"user_name":"The One","can_delete":false,"product_type":"c1","uid":1319368,"ip_address":"","ucode":"D3438E31543332","user_header":"https://static001.geekbang.org/account/avatar/00/14/21/c8/33828cfc.jpg","comment_is_top":false,"comment_ctime":1585486790,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"10175421382","product_id":100047701,"comment_content":"æˆ‘ç”¨çš„spring boot2.2.3ï¼Œå‘ç°åˆ›å»ºç”¨æˆ·å’Œå­ç”¨æˆ·è¿™ä¸ªé™é»˜å›æ»šä¾‹å­æ²¡æœ‰å¤ç°ï¼Œå³æ²¡æœ‰æ ‡æ³¨éœ€è¦å¼€å¯æ–°äº‹ç‰©è¿™ä¸ªæ³¨è§£ï¼Œä»…ä»…try catchä¹‹åå°±å¯ä»¥äº†ï¼Œæœ‰å…¶ä»–åŒå­¦è¯•äº†å—ï¼Ÿæ±‚å‘ŠçŸ¥","like_count":2},{"had_liked":false,"id":199234,"user_name":"è¿è¾¹","can_delete":false,"product_type":"c1","uid":1391748,"ip_address":"","ucode":"54B5DA38449728","user_header":"https://static001.geekbang.org/account/avatar/00/15/3c/84/608f679b.jpg","comment_is_top":false,"comment_ctime":1585483354,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10175417946","product_id":100047701,"comment_content":"å¼€å‘ä¸­ï¼ŒçœŸçš„ç¢°åˆ°è¿‡ã€‚","like_count":2},{"had_liked":false,"id":198469,"user_name":"Geek_fb74a8","can_delete":false,"product_type":"c1","uid":1926523,"ip_address":"","ucode":"802A47B46697B7","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/mZrw2nVk1Aw8eYh5GPWpI9OHVBhXdFpMZx9mDyAHJuSZlpXCfKcOUxSUTewtibW8KBb0d9ftNl9F0n6ptudxBwQ/132","comment_is_top":false,"comment_ctime":1585452909,"is_pvip":false,"replies":[{"id":"74687","content":"è¿˜æ˜¯æ ¹æ®éœ€æ±‚ å¦‚æœéœ€è¦å‡ºå¼‚å¸¸éƒ½å›æ»š é‚£ä¹ˆserviceå±‚ä¸æ•è·å¼‚å¸¸ å¦‚æœå¸Œæœ›ç²¾ç»†åŒ–å¤„ç†å¼‚å¸¸é‚£ä¹ˆå°±è€ƒè™‘è‡ªå·±æ‰‹åŠ¨æ ¹æ®éœ€æ±‚æäº¤æˆ–å›æ»šäº‹åŠ¡ åœ¨åç»­å¼‚å¸¸ä¸€æ–‡ä¹Ÿä¼šæåˆ°å†™ç‚¹","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1585457036,"ip_address":"","comment_id":198469,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10175387501","product_id":100047701,"comment_content":"è€å¸ˆï¼Œå®é™…å¼€å‘ä¸­æ˜¯ä¸æ˜¯ä¸€èˆ¬éƒ½å°†å¼‚å¸¸äº¤ç»™Controllerå±‚æ¥å¤„ç†æˆ–è€…ç”±æ‹¦æˆªå™¨ç»Ÿä¸€å¤„ç†å¼‚å¸¸ï¼Œä»è€Œä¿è¯éœ€è¦äº‹åŠ¡æ”¯æŒçš„æ–¹æ³•åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸æ—¶èƒ½å¤Ÿä¿è¯å›æ»šï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489710,"discussion_content":"è¿˜æ˜¯æ ¹æ®éœ€æ±‚ å¦‚æœéœ€è¦å‡ºå¼‚å¸¸éƒ½å›æ»š é‚£ä¹ˆserviceå±‚ä¸æ•è·å¼‚å¸¸ å¦‚æœå¸Œæœ›ç²¾ç»†åŒ–å¤„ç†å¼‚å¸¸é‚£ä¹ˆå°±è€ƒè™‘è‡ªå·±æ‰‹åŠ¨æ ¹æ®éœ€æ±‚æäº¤æˆ–å›æ»šäº‹åŠ¡ åœ¨åç»­å¼‚å¸¸ä¸€æ–‡ä¹Ÿä¼šæåˆ°å†™ç‚¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585457036,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":191658,"user_name":"Monday","can_delete":false,"product_type":"c1","uid":1250907,"ip_address":"","ucode":"77B9BACC783598","user_header":"https://static001.geekbang.org/account/avatar/00/13/16/5b/83a35681.jpg","comment_is_top":false,"comment_ctime":1584787396,"is_pvip":false,"replies":[{"id":"73461","content":"springçš„ä»£ç æ˜¯éå¸¸å¤æ‚çš„ï¼Œç†ä¸æ¸…æ€è·¯ä¹Ÿå¾ˆæ­£å¸¸ï¼Œé‡åˆ°ä¸æ˜ç™½çš„åŸç†å¯ä»¥å…ˆç½‘ä¸Šæœç´¢ä¸€ä¸‹ç±»ä¼¼æºç å‰–æçš„æ–‡ç« ï¼Œå†è‡ªå·±å»æºç é‡Œé¢çœ‹","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1584794654,"ip_address":"","comment_id":191658,"utype":1}],"discussion_count":2,"race_medal":0,"score":"10174721988","product_id":100047701,"comment_content":"æœ¬èŠ‚çš„ä¸‰ä¸ªå‘ï¼Œè€å¸ˆæ€»ç»“å¾—å¾ˆåˆ°ä½ï¼Œæˆ‘ä¹Ÿç†è§£åŸç†äº†ã€‚ä½†æ˜¯è®©æˆ‘è‡ªå·±çœ‹æºç ï¼Œå°±ç†ä¸æ¸…æ€ç»ªäº†ã€‚ä¸çŸ¥é“ä»å“ªæ¡çº¿å“ªä¸ªç±»å…¥æ‰‹ã€‚","like_count":2,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":488218,"discussion_content":"springçš„ä»£ç æ˜¯éå¸¸å¤æ‚çš„ï¼Œç†ä¸æ¸…æ€è·¯ä¹Ÿå¾ˆæ­£å¸¸ï¼Œé‡åˆ°ä¸æ˜ç™½çš„åŸç†å¯ä»¥å…ˆç½‘ä¸Šæœç´¢ä¸€ä¸‹ç±»ä¼¼æºç å‰–æçš„æ–‡ç« ï¼Œå†è‡ªå·±å»æºç é‡Œé¢çœ‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584794654,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1107484,"avatar":"https://static001.geekbang.org/account/avatar/00/10/e6/1c/9d3744ee.jpg","nickname":"å°æè®²æºç ","note":"","ucode":"2573037D7C82C8","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":368104,"discussion_content":"ä»TransactionInterceptorçš„invokeæ–¹æ³•å¼€å§‹çœ‹ï¼Œè¿™ä¸ªæ˜¯ä¸€ä¸ªæ–¹æ³•çš„æ‹¦æˆªå™¨ï¼Œå¯¹äºè°ƒç”¨çš„æ–¹æ³•å¸¦æœ‰@Transactionalä¼šè¢«æ‹¦æˆªå™¨æ‹¦æˆªï¼Œè¿›å…¥åˆ°è¿™é‡Œï¼Œç„¶åä½ åœ¨æ‰“æ–­ç‚¹å»åˆ†æå†…éƒ¨çš„åŸç†ã€‚æœ€ç»ˆåº•å±‚å°±æ˜¯åŸºäºJDBCæä¾›çš„APIæ¥å®ç°çš„äº‹åŠ¡çš„æäº¤ã€å›æ»šç­‰æ“ä½œã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618567264,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":191066,"user_name":"Jialin","can_delete":false,"product_type":"c1","uid":1112955,"ip_address":"","ucode":"12583269732A75","user_header":"https://static001.geekbang.org/account/avatar/00/10/fb/7b/2d4b38fb.jpg","comment_is_top":false,"comment_ctime":1584721517,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10174656109","product_id":100047701,"comment_content":"è¿™èŠ‚springäº‹åŠ¡æ“ä½œéå¸¸å®ç”¨ï¼Œå‡å°‘å¼€å‘è¸©å‘ï¼Œå¥½å¥½ç ”ç©¶","like_count":2},{"had_liked":false,"id":240397,"user_name":"å°èƒ¡å­","can_delete":false,"product_type":"c1","uid":1018182,"ip_address":"","ucode":"79FEC6400D25DA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/89/46/0b7828a1.jpg","comment_is_top":false,"comment_ctime":1596887922,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"5891855218","product_id":100047701,"comment_content":" spring aopä¸­æ‰€æœ‰ç±»thisè°ƒç”¨æ–¹æ³•éƒ½å­˜åœ¨è¿™æ ·çš„é—®é¢˜ï¼Œé€šè¿‡æ³¨å…¥è‡ªèº«beanç¡®å®ä¹Ÿèƒ½è§£å†³ï¼Œä½†æ˜¯ç¡®å®ä¹Ÿä¸é›…ï¼Œä»ä¾èµ–è§’åº¦æ¥çœ‹ç¡®å®æŒºæ€ªçš„ï¼Œä½†æ˜¯serviceç±»ä¸­ç¡®å®å­˜åœ¨è°ƒç”¨è‡ªèº«çš„ï¼Œè¯·é—®æ€ä¹ˆæ‰èƒ½ä¼˜é›…çš„è§£å†³æ‰å‘¢","like_count":1,"discussions":[{"author":{"id":1225974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/b4/f6/e39d5af1.jpg","nickname":"é’±ç±³","note":"","ucode":"07AA44C6A40D34","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":389102,"discussion_content":"ä¸èƒ½ç®€å•çš„å°±ç”¨controllerè°ƒç”¨serviceï¼Œä¸ç„¶controllerä¸­æœ‰å¤ªå¤šä¸šåŠ¡é€»è¾‘ã€‚æ¶‰åŠåˆ°å¤šå±‚è°ƒç”¨æ—¶ï¼Œå¯ä»¥è€ƒè™‘èŒè´£åˆ’åˆ†ã€ä»£ç åˆ†å±‚ç»“æ„ï¼Œdddæ€æƒ³è€ƒè™‘ã€‚è€Œä¸æ˜¯ä»£ç å †å ï¼Œé¢å‘è¿‡ç¨‹ç¼–ç¨‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629118759,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1130275,"avatar":"https://static001.geekbang.org/account/avatar/00/11/3f/23/8ff389d2.jpg","nickname":"éƒæ–¹æ—","note":"","ucode":"8ABEAFDA815DDE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":376912,"discussion_content":"1. æŠŠthisæ”¹ä¸ºä¸Šå±‚è°ƒç”¨, æ¯”å¦‚serviceè°ƒç”¨serviceæ”¹æˆcontrollerè°ƒç”¨service, å¿…è¦çš„æƒ…å†µserviceä¹‹é—´åŠ ä¸Šäº‹åŠ¡ä¼ æ’­æœºåˆ¶\n2. AopContext.currentProxy() å¯ä»¥è·å–å½“å‰çš„ä»£ç†å¯¹è±¡åè°ƒç”¨serviceçš„æ–¹æ³•","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622424320,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":238786,"user_name":"ğŸ“Dream-seeker","can_delete":false,"product_type":"c1","uid":2100403,"ip_address":"","ucode":"3C8477DE9DD766","user_header":"https://static001.geekbang.org/account/avatar/00/20/0c/b3/7e13920b.jpg","comment_is_top":false,"comment_ctime":1596296162,"is_pvip":false,"replies":[{"id":"88198","content":"å¯ä»¥å†ç†è§£ä¸€ä¸‹aopåŸç†ï¼Œå¼‚å¸¸è¶…å‡ºæ–¹æ³•è¾¹ç•Œå³å¯","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1596334222,"ip_address":"","comment_id":238786,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5891263458","product_id":100047701,"comment_content":"åœ¨catchä»£ç å—ä¸­å†æŠ›å‡ºå¼‚å¸¸ï¼Œåº”è¯¥ä¹Ÿæ˜¯å¯ä»¥å›æ»šäº‹ç‰©çš„å§","like_count":1,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":502850,"discussion_content":"å¯ä»¥å†ç†è§£ä¸€ä¸‹aopåŸç†ï¼Œå¼‚å¸¸è¶…å‡ºæ–¹æ³•è¾¹ç•Œå³å¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596334222,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":221422,"user_name":"track6688","can_delete":false,"product_type":"c1","uid":1088040,"ip_address":"","ucode":"0A9E893F8FD379","user_header":"https://static001.geekbang.org/account/avatar/00/10/9a/28/03613c22.jpg","comment_is_top":false,"comment_ctime":1590496982,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5885464278","product_id":100047701,"comment_content":"è€å¸ˆéƒ½å¾ˆè®¤çœŸåšå¥½è¿™ä¸ªä¸“æ ï¼Œå­¦åˆ°å¾ˆå¤šä¸œè¥¿","like_count":1},{"had_liked":false,"id":211845,"user_name":"J.Smile","can_delete":false,"product_type":"c1","uid":1336475,"ip_address":"","ucode":"C4D98DFDBF7584","user_header":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","comment_is_top":false,"comment_ctime":1588030759,"is_pvip":false,"replies":[{"id":"78740","content":"ä¸é”™","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1588040726,"ip_address":"","comment_id":211845,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5882998055","product_id":100047701,"comment_content":"æ€»ç»“:<br>â‘  äº‹åŠ¡ä¸ç”Ÿæ•ˆçš„æƒ…å†µï¼Œäº‹åŠ¡æ³¨è§£åŠ åœ¨privateæ–¹æ³•ä¸Šã€äº‹åŠ¡æ–¹æ³•ä¸­è°ƒç”¨çš„æ˜¯å†…éƒ¨thisè°ƒç”¨çš„æ–¹æ³•è€Œä¸æ˜¯self    <br>â‘¡äº‹åŠ¡ç”Ÿæ•ˆå´å‡ºå¼‚å¸¸ä¸å›æ»šçš„æƒ…å†µï¼Œäº‹åŠ¡å¼‚å¸¸æ²¡æœ‰è¢«ä¼ æ’­å‡ºæ³¨è§£æ–¹æ³•è€Œæ˜¯è¢«æ•è·äº†ã€è¢«äº‹åŠ¡æ³¨è§£çš„æ–¹æ³•æŠ›å‡ºçš„æ˜¯å—æ£€å¼‚å¸¸å¯¼è‡´ä¸å›æ»š<br>â‘¢ä¸»æ–¹æ³•æäº¤ï¼Œå­æ–¹æ³•å‡ºé”™ä¸æäº¤çš„åšæ³•:<br>å­æ–¹æ³•ä¸Šæ³¨è§£åŠ ä¸Š propagation = Propagation.REQUIRES_NEW æ¥è®¾ç½® REQUIRES_NEW æ–¹å¼çš„äº‹åŠ¡ä¼ æ’­ç­–ç•¥ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œåˆ°è¿™ä¸ªæ–¹æ³•æ—¶éœ€è¦å¼€å¯æ–°çš„äº‹åŠ¡ï¼Œå¹¶æŒ‚èµ·å½“å‰äº‹åŠ¡","like_count":1,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":493380,"discussion_content":"ä¸é”™","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588040726,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1400896,"avatar":"https://static001.geekbang.org/account/avatar/00/15/60/40/e1139eb1.jpg","nickname":"æ¾æ¾17333870526","note":"","ucode":"93696276C88584","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":271333,"discussion_content":"è¿™ä½å¤§å“¥ï¼Œæ‚¨è¯´çš„ ç¬¬äºŒæ¡æ˜¯è¿™æ ·ä¸ï¼Œç¬¬ä¸€ç§æƒ…å†µï¼šå¼‚å¸¸è¢«try catchæ•è·äº†ï¼Œæ²¡æœ‰ä¼ æ’­å‡ºå»è¢«æ³¨è§£æ–¹æ³•æ•è·åˆ°ï¼Œç¬¬äºŒç§æƒ…å†µï¼šè™½ç„¶æŠ›å‡ºäº†å¼‚å¸¸ï¼Œä½†æ˜¯æŠ›å‡ºçš„æ˜¯å—æ£€çš„ï¼Œäº‹åŠ¡ä¹Ÿä¸ä¼šå›æ»š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590118581,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":205221,"user_name":"f","can_delete":false,"product_type":"c1","uid":1396147,"ip_address":"","ucode":"686BD6C21FE02B","user_header":"https://static001.geekbang.org/account/avatar/00/15/4d/b3/85828cc4.jpg","comment_is_top":false,"comment_ctime":1586573073,"is_pvip":false,"replies":[{"id":"76704","content":"ğŸ‘ğŸ»","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1586588761,"ip_address":"","comment_id":205221,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5881540369","product_id":100047701,"comment_content":"ç¬¬ä¸‰éçœ‹ åˆæœ‰æ”¶è·","like_count":1,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491425,"discussion_content":"ğŸ‘ğŸ»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586588761,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":197529,"user_name":"mgs2002","can_delete":false,"product_type":"c1","uid":1812970,"ip_address":"","ucode":"F5931108BD509B","user_header":"https://static001.geekbang.org/account/avatar/00/1b/a9/ea/5bfce6c5.jpg","comment_is_top":false,"comment_ctime":1585383913,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5880351209","product_id":100047701,"comment_content":"ç¬¬äºŒä¸ªé¢˜ä½¿ç”¨æ‰‹åŠ¨æ§åˆ¶äº‹åŠ¡çš„æ–¹å¼ä¹Ÿå¯ä»¥è®©privateçš„æ–¹æ³•äº‹åŠ¡ç”Ÿæ•ˆ<br>   @Autowired<br>    private PlatformTransactionManager platformTransactionManager;<br>    @Autowired<br>    private TransactionDefinition transactionDefinition;<br><br>public int createUserWrong1(String name)  {<br>        TransactionStatus transactionStatus = platformTransactionManager.getTransaction(transactionDefinition);<br>        try {<br>            this.createUserPrivate(new UserEntity(name));<br>            platformTransactionManager.commit(transactionStatus);<br>        } catch (Exception ex) {<br>            platformTransactionManager.rollback(transactionStatus);<br>            log.error(&quot;create user failed because {}&quot;, ex.getMessage());<br>        }<br>        return userRepository.findByName(name).size();<br>    }","like_count":1},{"had_liked":false,"id":194999,"user_name":"Geek_538da7","can_delete":false,"product_type":"c1","uid":1915071,"ip_address":"","ucode":"6FA9A33BD9914D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/lEHwYUoH248Ca8sdgmB0DHhYZV6HycDyia9BiaF0AK7JAYvhkztwugIBDpm3sKb8BGPicIwWyUHnicFLdbuJ4YtS3g/132","comment_is_top":false,"comment_ctime":1585126316,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5880093612","product_id":100047701,"comment_content":"è‡ªå·±ä½¿ç”¨Transactiomæ—¶åªæ³¨æ„åˆ°aopä»£ç†é—®é¢˜ï¼ŒæŠ›å¼‚å¸¸ä½¿äº‹åŠ¡ç”Ÿæ•ˆã€‚ä»æ²¡æœ‰è€ƒè™‘è¿‡äº‹åŠ¡ä¼ æ’­ï¼Œä»Šå¤©å­¦åˆ°äº†å¾ˆå¤šçŸ¥è¯†","like_count":1},{"had_liked":false,"id":192604,"user_name":"åˆ˜æ¥ ","can_delete":false,"product_type":"c1","uid":1120773,"ip_address":"","ucode":"9F19D44CBEE039","user_header":"https://static001.geekbang.org/account/avatar/00/11/1a/05/f154d134.jpg","comment_is_top":false,"comment_ctime":1584862992,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5879830288","product_id":100047701,"comment_content":"å­¦ä¹ åˆ°äº†ï¼Œè¿™å‡ ä¸ªå‘ï¼Œ","like_count":1},{"had_liked":false,"id":192524,"user_name":"æ¯å¤©æ™’ç™½ç‰™","can_delete":false,"product_type":"c1","uid":1004698,"ip_address":"","ucode":"A1B102CD933DEA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/54/9a/76c0af70.jpg","comment_is_top":false,"comment_ctime":1584857180,"is_pvip":false,"discussion_count":4,"race_medal":1,"score":"5879824476","product_id":100047701,"comment_content":"å·¥ä½œä¸­çš„ä¸šåŠ¡åœºæ™¯æ²¡ç”¨åˆ°äº‹åŠ¡ï¼Œä½†è€å¸ˆè¯´çš„è¿™äº›å‘ï¼Œæˆ‘ä¹Ÿä¸æ¸…æ¥šï¼Œå…ˆå­¦ä¹ äº†","like_count":1,"discussions":[{"author":{"id":1000037,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/42/65/f444ea39.jpg","nickname":"grandcool","note":"","ucode":"7545E76CE3FEFC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":213076,"discussion_content":"è€é“ï¼Œå“ªé‡Œéƒ½èƒ½çœ‹åˆ°ä½ ï¼Œå“ˆå“ˆ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1585048158,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1004698,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/54/9a/76c0af70.jpg","nickname":"æ¯å¤©æ™’ç™½ç‰™","note":"","ucode":"A1B102CD933DEA","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":1000037,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/42/65/f444ea39.jpg","nickname":"grandcool","note":"","ucode":"7545E76CE3FEFC","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":213084,"discussion_content":"å“ˆå“ˆï¼Œä¸“æ ä¹°çš„å¤š","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1585049096,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":213076,"ip_address":""},"score":213084,"extra":""}]},{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":232092,"discussion_content":"++","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586852355,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1549364,"avatar":"","nickname":"Geek_3b1096","note":"","ucode":"A6BD92B79B3632","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":217169,"discussion_content":"+1","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585523564,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":191506,"user_name":"mz","can_delete":false,"product_type":"c1","uid":1003581,"ip_address":"","ucode":"1D714C23F78446","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/MlmSR4YXUfrNlZdMv7bv1ic64HaxxVKcVtaxjzhXCvNC4XByICCmYUTprhOESzIV8p59N6DnSJ7HywfvGr5nicgA/132","comment_is_top":false,"comment_ctime":1584778114,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5879745410","product_id":100047701,"comment_content":"çœ‹å®Œäº†ï¼Œæˆ‘æ»šå»æ£€æŸ¥ä»£ç äº†ã€‚ğŸ˜„","like_count":1},{"had_liked":false,"id":191228,"user_name":"pedro","can_delete":false,"product_type":"c1","uid":1200704,"ip_address":"","ucode":"F40C839DDFD599","user_header":"https://static001.geekbang.org/account/avatar/00/12/52/40/e57a736e.jpg","comment_is_top":false,"comment_ctime":1584756662,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5879723958","product_id":100047701,"comment_content":"AspectJ é…åˆ lombokï¼Œéœ€è¦ä½¿ç”¨ aspectj æ’ä»¶çš„å°±åœ°ç¼–ç»‡åŠŸèƒ½ï¼Œå¤§è‡´ä¼šä¿®æ”¹ pom.xml é…ç½®å¦‚ä¸‹ï¼š<br><br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;showWeaveInfo&#47;&gt;<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;forceAjcCompile&gt;true&lt;&#47;forceAjcCompile&gt;<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;sources&#47;&gt;<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;weaveDirectories&gt;<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;weaveDirectory&gt;${project.build.directory}&#47;classes&lt;&#47;weaveDirectory&gt;<br>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;&#47;weaveDirectories&gt;","like_count":1},{"had_liked":false,"id":191194,"user_name":"å‚²å®‡","can_delete":false,"product_type":"c1","uid":1339446,"ip_address":"","ucode":"92BBE2C6494B26","user_header":"https://static001.geekbang.org/account/avatar/00/14/70/36/197927f5.jpg","comment_is_top":false,"comment_ctime":1584753620,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5879720916","product_id":100047701,"comment_content":"Springäº‹åŠ¡çš„ç”¨æ³•æ„Ÿè§‰å·²ç»æ˜¯springç”¨æˆ·çš„å¸¸è¯†æ€§é—®é¢˜äº†ï¼Œä½†å¥ˆä½•è¿˜æ˜¯æœ‰äººä¼šçŠ¯ã€‚<br>æˆ‘ç»™å‡ºä¸€ä¸ªç¥å¥‡çš„ä¾‹å­ï¼šæˆ‘å…¬å¸æœ‰ä¸€ä¸ªåŒäº‹ï¼Œåœ¨controllerè°ƒç”¨å¤šä¸ªserviceçš„äº‹åŠ¡æ–¹æ³•ï¼Œå½“åé¢çš„ä¸šåŠ¡å¤±è´¥å‰é¢çš„ä¸šåŠ¡æ–¹æ³•è‡ªç„¶å°±äº§ç”Ÿå‡ºä¸å°‘çš„è„æ•°æ®ã€‚","like_count":1},{"had_liked":false,"id":348866,"user_name":"è±†è±†å¤§é­”ç‹","can_delete":false,"product_type":"c1","uid":1594276,"ip_address":"","ucode":"38D40A8AC9766A","user_header":"https://static001.geekbang.org/account/avatar/00/18/53/a4/8b233a80.jpg","comment_is_top":false,"comment_ctime":1655473281,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1655473281","product_id":100047701,"comment_content":"è€å¸ˆï¼ŒåŒæ—¶é…ç½®äº†å£°æ˜å¼äº‹åŠ¡å’Œç¼–ç¨‹å¼äº‹åŠ¡ä¼šåŒæ—¶ç”Ÿæ•ˆå—","like_count":0},{"had_liked":false,"id":346167,"user_name":"otakuhuang","can_delete":false,"product_type":"c1","uid":1541263,"ip_address":"","ucode":"283641975339AD","user_header":"https://static001.geekbang.org/account/avatar/00/17/84/8f/a305cc1e.jpg","comment_is_top":false,"comment_ctime":1652864099,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1652864099","product_id":100047701,"comment_content":"ç¬¬ä¸€ä¸ªæ€è€ƒé¢˜ï¼Œä¸»å­ç”¨æˆ·é‚£æ®µé”™è¯¯ä»£ç æˆ‘æŠŠ Spring Data JPA æ”¹ä¸º MyBatis åï¼Œæ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š<br>```<br>Creating a new SqlSession<br>Registering transaction synchronization for SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@2a2f3033]<br>JDBC Connection [HikariProxyConnection@2142775818 wrapping conn0: url=jdbc:h2:mem:mybatis user=SA] will be managed by Spring<br>Releasing transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@2a2f3033]<br>createMainUser finish<br>createSubUserWithExceptionWrong start<br>Fetched SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@2a2f3033] from current transaction<br>Releasing transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@2a2f3033]<br>Transaction synchronization deregistering SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@2a2f3033]<br>Transaction synchronization closing SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@2a2f3033]<br>createUserWrong failed, reason: invalid status<br>```<br>ç¬¬ 1ã€2 è¡Œï¼ŒMyBatis åœ¨è¿æ¥æ—¶åˆ›å»ºäº†ä¸€ä¸ªå«åš SqlSession çš„ä¸œä¸œï¼Œç„¶åäº‹åŠ¡æ³¨å†Œåˆ°åœ¨è¿™é‡Œé¢ã€‚å€’æ•°å‡ è¡Œçœ‹åˆ°ï¼Œç”±äºå‡ºç°äº†é”™è¯¯ï¼ŒSqlSession æ•´ä¸ªè¢« rollback äº†ï¼Œæ‰€ä»¥æ— è®ºæ˜¯ä¸»è¿˜æ˜¯å­éƒ½æ²¡å­˜åˆ°è¡¨é‡Œã€‚<br>ç„¶åæ­£ç¡®çš„ï¼š<br>```<br>Transaction synchronization suspending SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@28741757]<br>createSubUserWithExceptionRight start<br>Creating a new SqlSession<br>```<br>åœ¨å­æ–¹æ³•ä¸­åˆæ–°å»ºäº†ä¸€ä¸ª SqlSessionï¼Œè·Ÿ JPA çš„æƒ…å†µæ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥è¿™ä¸ª SqlSession è¢« rollback ä¸ä¼šå½±å“åˆ°ä¸»çš„ SqlSessionã€‚<br>ä½† SqlSession æ˜¯å•¥ä¸æ˜¯å¾ˆæ‡‚ï¼Œè¿˜è¦å¤šå­¦å­¦ã€‚","like_count":0},{"had_liked":false,"id":333356,"user_name":"Geek_ac6cf1","can_delete":false,"product_type":"c1","uid":2902172,"ip_address":"","ucode":"C5ADBD4A580A03","user_header":"","comment_is_top":false,"comment_ctime":1644309371,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1644309371","product_id":100047701,"comment_content":"1.Transactionalæ³¨è§£éœ€è¦ä½¿ç”¨åœ¨pulicä¿®é¥°çš„æ–¹æ³•ä¸Šæ‰èƒ½ç”Ÿæ•ˆï¼Œå› ä¸ºæ˜¯é€šè¿‡AOPä»£ç†å®ç°çš„ã€‚<br>2.Transactionaläº‹åŠ¡å­˜åœ¨é»˜è®¤çš„å¼‚å¸¸å›æ»šæƒ…å†µï¼Œå¤„ç†ä¸šåŠ¡æ—¶éœ€è¦è€ƒè™‘é»˜è®¤å›æ»šæƒ…å†µæ˜¯å¦åŒ…å«è‡ªå·±çš„ä¸šåŠ¡éœ€æ±‚ã€‚<br>3.Transactionalå­˜åœ¨äº‹åŠ¡çš„ä¼ æ’­æ€§ï¼Œéœ€è¦æ ¹æ®ä¸šåŠ¡è°ƒæ•´Propagationå±æ€§ã€‚","like_count":0},{"had_liked":false,"id":322707,"user_name":"çºµä¸æœ½","can_delete":false,"product_type":"c1","uid":1877862,"ip_address":"","ucode":"DB2CA2C46B2EF1","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLu3MgZBAyyiavX2CMF2KRib791j3bBGiaQDzuQwBF2k6AKHANV2uTAAss2vVaeC7xcSYYD8vjmibRpTQ/132","comment_is_top":false,"comment_ctime":1637561453,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1637561453","product_id":100047701,"comment_content":"å¦‚æœçˆ¶ç±»FServiceçš„å…¬å…±Aæ–¹æ³•åŠ äº†äº‹åŠ¡æ³¨è§£ï¼Œå­ç±»SonServiceæ²¡æœ‰é‡å†™è¿™ä¸ªæ–¹æ³•ã€‚å®é™…è¿è¡Œæ—¶å…¶ä»–ç±»æŠŠSonServiceæ³¨å…¥è¿›æ¥ï¼Œè°ƒç”¨SonService.A(); è¿™æ ·Aæ–¹æ³•å¤„äºäº‹åŠ¡ä¸­å—","like_count":0},{"had_liked":false,"id":316467,"user_name":"çš‡å®¶æ•‘æ˜Ÿ","can_delete":false,"product_type":"c1","uid":1326106,"ip_address":"","ucode":"89F1274A3835FE","user_header":"https://static001.geekbang.org/account/avatar/00/14/3c/1a/1806ef25.jpg","comment_is_top":false,"comment_ctime":1634320133,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1634320133","product_id":100047701,"comment_content":"å¦‚æœä¸€ä¸ªæ–¹æ³•æ²¡å†™@Transactional æ³¨è§£ï¼ˆç±»ä¸Šä¹Ÿæ²¡å†™ï¼‰ï¼Œè°ƒç”¨æ—¶é»˜è®¤çš„äº‹åŠ¡ä¼ æ’­æ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼ŸåµŒå¥—äº‹åŠ¡ï¼Œè¿˜æ˜¯æ–°å»ºäº‹åŠ¡ï¼Œæˆ–è€…æ— äº‹åŠ¡ï¼Ÿ","like_count":0},{"had_liked":false,"id":313258,"user_name":"å‘åšå£«åè¿›å†›","can_delete":false,"product_type":"c1","uid":1903452,"ip_address":"","ucode":"CFDC3CF31C582D","user_header":"https://static001.geekbang.org/account/avatar/00/1d/0b/5c/9734702d.jpg","comment_is_top":false,"comment_ctime":1632356156,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1632356156","product_id":100047701,"comment_content":"è€å¸ˆï¼Œä¸ºä»€ä¹ˆåœ¨æ–¹æ³•ä¸­try catchåï¼Œæœ‰æ—¶å€™ä¸å›æ»šå‘¢","like_count":0},{"had_liked":false,"id":295790,"user_name":"éº¦å¾·æ¼‚","can_delete":false,"product_type":"c1","uid":2088674,"ip_address":"","ucode":"18CF51FAF94949","user_header":"https://static001.geekbang.org/account/avatar/00/1f/de/e2/b42256d2.jpg","comment_is_top":false,"comment_ctime":1622599730,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1622599730","product_id":100047701,"comment_content":"ä¸»è¦è¿˜æ˜¯æ˜¯å¦è¢«ä»£ç†(æ‹¦æˆªå¤„ç†)çš„é—®é¢˜ï¼Œè¢«ä»£ç†çš„è¯ä¸è¦è‡ªå·±æŠŠå¼‚å¸¸åƒæ‰ï¼Œå†ä¸€ä¸ªå°±æ˜¯ä¼ æ’­æœºåˆ¶çš„ç†è§£ä½¿ç”¨ã€‚","like_count":0},{"had_liked":false,"id":292391,"user_name":"æ–°","can_delete":false,"product_type":"c1","uid":2104236,"ip_address":"","ucode":"A6B569A9A968ED","user_header":"https://static001.geekbang.org/account/avatar/00/20/1b/ac/ba2516f8.jpg","comment_is_top":false,"comment_ctime":1620803829,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1620803829","product_id":100047701,"comment_content":"è€å¸ˆè¯·é—®ï¼Œäº‹åŠ¡æ–¹æ³•é‡Œé¢ç”¨thisè°ƒç”¨å½“å‰Serviceçš„å…¶å®ƒæ–¹æ³•ï¼Œäº‹åŠ¡æ–¹æ³•å’Œå…¶å®ƒæ–¹æ³•é‡Œéƒ½æœ‰Daoçš„æ’å…¥æ–¹æ³•ï¼Œè¿™æ ·äº‹åŠ¡ä¼šç”Ÿæ•ˆä¹ˆï¼Ÿæˆ‘è¯•è¿‡ä¼šç”Ÿæ•ˆï¼Œä½†æ˜¯ä¸å¤ªç†è§£åŸå› ï¼Œthiså¹¶ä¸æ˜¯ä»£ç†å¯¹è±¡ï¼Œä¸ºä»€ä¹ˆä»ç„¶ä¼šç”Ÿæ•ˆå‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1014665,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7b/89/34f2cbcc.jpg","nickname":"æ¨å®‡","note":"","ucode":"EB74DF6E269F03","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377942,"discussion_content":"å¦‚ä½•éªŒè¯äº‹åŠ¡ç”Ÿæ•ˆçš„ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622975156,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":284712,"user_name":"kyl","can_delete":false,"product_type":"c1","uid":1406090,"ip_address":"","ucode":"DBDFD0FEB5A135","user_header":"https://static001.geekbang.org/account/avatar/00/15/74/8a/d5b0cf30.jpg","comment_is_top":false,"comment_ctime":1616425709,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1616425709","product_id":100047701,"comment_content":"äºŒåˆ·åˆæœ‰æ–°æ”¶è·","like_count":0},{"had_liked":false,"id":271050,"user_name":"è¿°ä¸º","can_delete":false,"product_type":"c1","uid":1238965,"ip_address":"","ucode":"E62AEC705AEDC2","user_header":"https://static001.geekbang.org/account/avatar/00/12/e7/b5/c08b71e1.jpg","comment_is_top":false,"comment_ctime":1609382440,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1609382440","product_id":100047701,"comment_content":"é†é†çŒé¡¶ï¼Œæ„Ÿè°¢ä½œè€…ï¼Œå…¥è¡Œè¿‘ä¸‰å¹´ï¼ŒåŸæ¥ä¸€ç›´éƒ½æ˜¯åœ¨å¾—è¿‡ä¸”è¿‡","like_count":0},{"had_liked":false,"id":269340,"user_name":"ç°é£ç°çŒªä¸ä¼šç°é£.çƒŸç­","can_delete":false,"product_type":"c1","uid":1127314,"ip_address":"","ucode":"FF9FB4C902D1F5","user_header":"https://static001.geekbang.org/account/avatar/00/11/33/92/99530cee.jpg","comment_is_top":false,"comment_ctime":1608617191,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1608617191","product_id":100047701,"comment_content":"è€å¸ˆ thisä¸ºå•¥æ˜¯å½“å‰å¯¹è±¡å‘¢ï¼Ÿæˆ‘ç†è§£åº”è¯¥æ˜¯è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¿è¡Œçš„å¯¹è±¡ã€‚æ„Ÿè§‰è¿è¡Œçš„å¯¹è±¡æ˜¯å®¹å™¨ä¸­çš„ä»£ç†å¯¹è±¡å•Š","like_count":0,"discussions":[{"author":{"id":1225974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/b4/f6/e39d5af1.jpg","nickname":"é’±ç±³","note":"","ucode":"07AA44C6A40D34","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":389103,"discussion_content":"thiså†™åœ¨äº†è¢«è°ƒç”¨çš„æ–¹æ³•å†…ï¼Œæ‰€ä»¥è¯´thisæ˜¯è¢«è°ƒç”¨æ–¹æ³•æ‰€åœ¨ç±»çš„è¿™ä¸ªå¯¹è±¡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629118994,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1107484,"avatar":"https://static001.geekbang.org/account/avatar/00/10/e6/1c/9d3744ee.jpg","nickname":"å°æè®²æºç ","note":"","ucode":"2573037D7C82C8","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":368110,"discussion_content":" Aç±»å®ä¾‹aè¢«æ³¨å…¥åï¼Œpublicæ–¹æ³•è¢«ä»£ç†ï¼Œç”¨invokeè°ƒç”¨ï¼Œä½†æ˜¯invokeä¸­ç”¨åˆ°çš„this.methodè°ƒç”¨çš„å…¶å®æ˜¯targetçš„methodæ–¹æ³•ã€‚æ¢è€Œè¨€ä¹‹ï¼ŒåŠ¨æ€ä»£ç†æ°¸è¿œåªèƒ½ä»£ç†ä¸€å±‚æ–¹æ³•ï¼Œå¦‚æœæ–¹æ³•å†…è¿˜æ˜¯thiså¼•å¯¼çš„æ–¹æ³•åˆ™æ— æ³•ä»£ç†ï¼Œä½†æ˜¯å¦‚æœæ˜¯staticçš„æ–¹æ³•å°±ä¸å­˜åœ¨è¿™ä¸ªé—®é¢˜ã€‚\n\nè¿™ä¸ªæ˜¯å¼•ç”¨çš„åˆ«äººè¯´çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618567874,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":268631,"user_name":"ææµ©ç„¶","can_delete":false,"product_type":"c1","uid":2330739,"ip_address":"","ucode":"8467A210DC0B7A","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJfyOHapA4aYyichD5mfPicyX9cxVfYLexuZhYoc7VQOrRFL7SvKxevmb0VorVkcRZVRd8pO5KF5niag/132","comment_is_top":false,"comment_ctime":1608279239,"is_pvip":false,"replies":[{"id":"97618","content":"å¸®å¿™å¤šè½¬å‘ï¼Œå¤§å®¶éƒ½åé¦ˆæ”¶è·ä¸é”™ï¼Œä½†æ˜¯è¯¾ç¨‹é”€é‡ä¸é«˜ï¼Œå¸Œæœ›æ›´å¤šäººçœ‹åˆ°","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1608543477,"ip_address":"","comment_id":268631,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1608279239","product_id":100047701,"comment_content":"å†™çš„å¾ˆå¥½","like_count":0,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":511993,"discussion_content":"å¸®å¿™å¤šè½¬å‘ï¼Œå¤§å®¶éƒ½åé¦ˆæ”¶è·ä¸é”™ï¼Œä½†æ˜¯è¯¾ç¨‹é”€é‡ä¸é«˜ï¼Œå¸Œæœ›æ›´å¤šäººçœ‹åˆ°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608543477,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":268352,"user_name":"ä¸œè°·å¤§è è","can_delete":false,"product_type":"c1","uid":2007690,"ip_address":"","ucode":"057FF5437438D8","user_header":"https://static001.geekbang.org/account/avatar/00/1e/a2/8a/31fcaf13.jpg","comment_is_top":false,"comment_ctime":1608166903,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1608166903","product_id":100047701,"comment_content":"è€å¸ˆï¼Œé‚£ä¸ªå­ç”¨æˆ·çš„æ“ä½œèƒ½ä¸èƒ½æ”¾åœ¨å¼‚æ­¥çº¿ç¨‹é‡Œå‘¢ï¼Ÿ<br><br>1.æ‰§è¡Œä¸»ç”¨æˆ·æ’å…¥<br>2.å¼‚æ­¥æ’å…¥å­ç”¨æˆ·<br><br>å¦‚æœä¸»ç”¨æˆ·æŠ›å¼‚å¸¸é‚£ä¹ˆå­ç”¨æˆ·ä¸æ’å…¥ï¼ˆç¬¦åˆä¸šåŠ¡é€»è¾‘ï¼‰ï¼Œå¦‚æœä¸»ç”¨æˆ·æ’å…¥æˆåŠŸï¼Œå­ç”¨æˆ·åœ¨å¼‚æ­¥çº¿ç¨‹ï¼Œä¸è®ºæˆåŠŸä¸å¦éƒ½å’Œä¸»çº¿ç¨‹æ— å…³ã€‚","like_count":0},{"had_liked":false,"id":266120,"user_name":"æµ…ã€","can_delete":false,"product_type":"c1","uid":2133762,"ip_address":"","ucode":"9D359E82DA35EA","user_header":"https://static001.geekbang.org/account/avatar/00/20/8f/02/77e4c777.jpg","comment_is_top":false,"comment_ctime":1607176618,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1607176618","product_id":100047701,"comment_content":"æ¯•ä¸šè¿‘ä¸€å¹´åŠé‡åˆ°äº‹åŠ¡çš„å‡ ä¸ªé—®é¢˜ï¼š<br>1.thisè°ƒç”¨<br>2.rollback only<br>3.ç‹¬ç«‹å’Œç»§æ‰¿äº‹åŠ¡åµŒå¥—æ—¶å› æäº¤é¡ºåºä¸ä¸€è‡´å¯¼è‡´é¢„æœŸç»“æœå¼‚å¸¸<br>4.é›†ç¾¤ç¯å¢ƒä¸‹è·å–oracleè¡Œé”å¤„ç†ä¸å½“å¯¼è‡´æ­»é”<br>5.äº‹åŠ¡ä¸­ä½¿ç”¨çš„oracleå­˜å‚¨è¿‡ç¨‹ä¸­çš„commitå¯¼è‡´äº‹åŠ¡æå‰è¢«æäº¤ã€‚<br>äº‹åŠ¡çš„é—®é¢˜å¹³å¸¸ä¸é‡è§†ï¼Œç­‰å‡ºäº†é—®é¢˜ï¼Œä»å‡ ä¸ªgçš„æ—¥å¿—é‡Œé¢å®šä½åˆ°é—®é¢˜ç‚¹ï¼Œå°±æ˜¯å¯¹ä¸šåŠ¡å’Œæ¶æ„çš„äº†è§£ç¨‹åº¦çš„è€ƒéªŒäº†ã€‚","like_count":0},{"had_liked":false,"id":259801,"user_name":"Asura","can_delete":false,"product_type":"c1","uid":2004166,"ip_address":"","ucode":"E865D7FAFCF9B1","user_header":"https://static001.geekbang.org/account/avatar/00/1e/94/c6/a7c9f304.jpg","comment_is_top":false,"comment_ctime":1604840853,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1604840853","product_id":100047701,"comment_content":"ç›®å‰æœ‰ä¸ªéœ€æ±‚ é€šè¿‡æŠ¥è¡¨å¯¼å…¥ä¿®æ”¹å•†å“åº“å­˜  æˆ‘æ˜¯ç”¨try catch åŠPropagation.REQUIRES_NEWå®ç°è®°å½•å¤±è´¥å¯¼å…¥è®°å½• å¹¶ä¸”æ‰‹åŠ¨å›æ»šå¤±è´¥å¯¼å…¥ æˆåŠŸçš„ä¸å˜  å¦‚æœå•†å“å¾ˆå¤šè¿™ç§forå¾ªç¯ä¸æ–­å¼€å¯æ–°äº‹åŠ¡ä¼šæœ‰ä»€ä¹ˆé—®é¢˜å‘¢ æœ›è€å¸ˆè§£ç­”","like_count":0},{"had_liked":false,"id":241195,"user_name":"Pluto","can_delete":false,"product_type":"c1","uid":1940113,"ip_address":"","ucode":"D541993BC94A45","user_header":"https://static001.geekbang.org/account/avatar/00/1d/9a/91/3bd41811.jpg","comment_is_top":false,"comment_ctime":1597212947,"is_pvip":true,"replies":[{"id":"89127","content":"cglibä¹Ÿåªèƒ½æ˜¯app publicï¼Œä¿æŒå’ŒåŠ¨æ€ä»£ç†ä¸€è‡´æ€§","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1597220511,"ip_address":"","comment_id":241195,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1597212947","product_id":100047701,"comment_content":"è€å¸ˆï¼Œæ‚¨ä¸¾çš„ç¬¬ä¸€ä¸ªä¾‹å­ï¼Œè¿™ä¸ªç±»æ²¡æœ‰å®ç°æ¥å£ï¼Œ é»˜è®¤ä¸æ˜¯ä½¿ç”¨ cglib æ¥ç”Ÿæˆä»£ç†å—","like_count":0,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":503671,"discussion_content":"cglibä¹Ÿåªèƒ½æ˜¯app publicï¼Œä¿æŒå’ŒåŠ¨æ€ä»£ç†ä¸€è‡´æ€§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597220511,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":237463,"user_name":"James","can_delete":false,"product_type":"c1","uid":1134861,"ip_address":"","ucode":"48B0F2A334D1C1","user_header":"https://static001.geekbang.org/account/avatar/00/11/51/0d/fc1652fe.jpg","comment_is_top":false,"comment_ctime":1595838306,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1595838306","product_id":100047701,"comment_content":"å¤ªå¼ºäº†ã€‚äº‹åŠ¡ä¼ æ’­é‚£é‡Œï¼Œè¿˜æœ‰è¯¾åç¬¬äºŒä¸ªé—®é¢˜è¿˜æ²¡åœ¨å®é™…ä¸­ç”¨åˆ°ã€‚<br>å…¶ä»–çš„åˆšå¥½ä¹‹å‰æœ‰é‡åˆ°è¿‡ã€‚<br>è¿˜æœ‰äº‹åŠ¡æ³¨è§£ä¸­è°ƒç”¨å¼‚æ­¥æ³¨è§£æ–¹æ³•å¥½åƒä¹Ÿä¼šæœ‰é—®é¢˜ï¼Œå¼‚æ­¥æ–¹æ³•å˜ä¸ºåŒæ­¥æ–¹æ³•<br>AopContext.currentProxy()è°ƒç”¨å¼‚æ­¥æ–¹æ³•å°±èƒ½ç”Ÿæ•ˆã€‚","like_count":0},{"had_liked":false,"id":219901,"user_name":"tongzi","can_delete":false,"product_type":"c1","uid":2002210,"ip_address":"","ucode":"7349A6E42EDF17","user_header":"https://static001.geekbang.org/account/avatar/00/1e/8d/22/0bf540be.jpg","comment_is_top":false,"comment_ctime":1590115743,"is_pvip":false,"replies":[{"id":"81170","content":"ä½ çš„æè¿°ä¸­åœºæ™¯æè¿°çš„æ˜¯è¡¨ï¼Œè§£å†³æè¿°çš„æ˜¯æ–¹æ³•ï¼Œè¯´å®è¯æˆ‘çœ‹ä¸å¤ªæ‡‚ä½ è¿™ä¸ªåœºæ™¯ï¼Œè¿™æ ·çš„é—®é¢˜æˆ‘å¾ˆéš¾å›ç­”ï¼Œä½ å¯ä»¥åšä¸€ä¸ªdemoå¸–åˆ°githubï¼Œç»™å‡ºå…·ä½“çš„é—®é¢˜ã€‚å¦‚æœä½ è§‰å¾—è¿™æ˜¯äº‹åŠ¡éš”ç¦»å¯¼è‡´çš„å¯è§æ€§é—®é¢˜ï¼Œé‚£ä¹ˆä¸ºä½•ä¸æŠŠè¿™äº›æ“ä½œéƒ½çº³å…¥ä¸€ä¸ªäº‹åŠ¡å‘¢ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1590119102,"ip_address":"","comment_id":219901,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1590115743","product_id":100047701,"comment_content":"ã€é—®é¢˜ã€‘<br>1ã€å‘˜å·¥å¯¼å…¥ï¼ˆæ–°æ‰‹æœºå·ï¼‰ï¼Œç¬¬ä¸€æ¬¡ä¼šå¯¼å…¥å¤±è´¥ï¼Œå†å¯¼å…¥æ‰ä¼šæˆåŠŸ<br>ã€å…·ä½“åœºæ™¯ã€‘<br>å¯¼å…¥excelï¼Œè§£ææˆå‘˜å·¥æ•°æ®4æ¡ï¼Œå…ˆå»æ³¨å†Œç”Ÿæˆt_userè¡¨ï¼Œç”ŸæˆåŸºæœ¬ä¿¡æ¯<br>ç„¶ååœ¨è°ƒç”¨ï¼ŒbandCorpï¼Œå’Œå…¬å¸ç»‘å®šï¼Œç”Ÿæˆt_corp_userè¡¨<br>ä½†æ˜¯åœ¨è°ƒç”¨bandCorpæ—¶ï¼Œéœ€è¦å…ˆå»æ ¡éªŒè¿™ä¸ªæ‰‹æœºå·ï¼Œæ˜¯å¦åœ¨t_userè¡¨ç”Ÿæˆæ•°æ®<br>ã€è§£å†³ã€‘<br>å‘ç°ç”±äºäº‹åŠ¡æ³¨è§£å¼•èµ·çš„bugï¼ŒimportUserListï¼ˆå¯¼å…¥å‘˜å·¥æ–¹æ³•ï¼‰åŠ äº†äº‹åŠ¡æ³¨è§£ï¼ŒregisterUseræ²¡æœ‰åŠ äº‹åŠ¡æ³¨è§£<br>bandCorpåŠ äº†äº‹åŠ¡æ³¨è§£ï¼ŒbandCorpä¼ æ’­çº§åˆ«ä¸ºPropagation.REQUIRES_NEWï¼Œæ–°å¼€äº†äº‹åŠ¡<br>ç”±äºçº¿ä¸Šæ•°æ®åº“ä¸ºå¯é‡å¤è¯»ï¼Œqaæ•°æ®åº“ä¸ºè¯»å·²æäº¤ï¼Œå¯¼è‡´æ•°æ®çš„ä¸å¯è§ï¼Œæ ¡éªŒå¤±è´¥<br><br>è€å¸ˆä½ å¥½ï¼Œæ„Ÿè°¢å›ç­”è¿™ä¸ªé—®é¢˜ï¼›<br>è¿˜æœ‰ä¸ªç–‘é—®æ˜¯ï¼Œå½“æ—¶ä¸´æ—¶è§£å†³çš„åŠæ³•æ˜¯ï¼Œå°†æœ€å¤–å±‚çš„importUserListï¼ˆå¯¼å…¥å‘˜å·¥æ–¹æ³•äº‹åŠ¡å»é™¤ï¼‰ï¼›<br>æˆ‘ä»¬å¯ä¸å¯ä»¥æ‰‹åŠ¨å°†importUserListæ–¹æ³•çš„@Transactionalï¼Œéš”ç¦»çº§åˆ«è®¾ç½®è¯»å·²æäº¤ï¼Œæ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ<br>è¿™ç§ä¸šåŠ¡åœºæ™¯æ€ä¹ˆè§£å†³æ¯”è¾ƒå¥½ï¼Ÿè°¢è°¢è€å¸ˆ","like_count":0,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":495984,"discussion_content":"ä½ çš„æè¿°ä¸­åœºæ™¯æè¿°çš„æ˜¯è¡¨ï¼Œè§£å†³æè¿°çš„æ˜¯æ–¹æ³•ï¼Œè¯´å®è¯æˆ‘çœ‹ä¸å¤ªæ‡‚ä½ è¿™ä¸ªåœºæ™¯ï¼Œè¿™æ ·çš„é—®é¢˜æˆ‘å¾ˆéš¾å›ç­”ï¼Œä½ å¯ä»¥åšä¸€ä¸ªdemoå¸–åˆ°githubï¼Œç»™å‡ºå…·ä½“çš„é—®é¢˜ã€‚å¦‚æœä½ è§‰å¾—è¿™æ˜¯äº‹åŠ¡éš”ç¦»å¯¼è‡´çš„å¯è§æ€§é—®é¢˜ï¼Œé‚£ä¹ˆä¸ºä½•ä¸æŠŠè¿™äº›æ“ä½œéƒ½çº³å…¥ä¸€ä¸ªäº‹åŠ¡å‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590119102,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":211897,"user_name":"J.Smile","can_delete":false,"product_type":"c1","uid":1336475,"ip_address":"","ucode":"C4D98DFDBF7584","user_header":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","comment_is_top":false,"comment_ctime":1588036683,"is_pvip":false,"replies":[{"id":"78735","content":"å¯ä»¥å…ˆæ ¹æ®æ—¥å¿—æ’æŸ¥ä¸€ä¸‹ï¼Œæœ‰é—®é¢˜çš„è¯å¸–ä¸€ä¸‹å®Œæ•´çš„æ—¥å¿—","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1588040316,"ip_address":"","comment_id":211897,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1588036683","product_id":100047701,"comment_content":"    @Autowired(required=false)<br>    private UserMapper userMapper;<br><br>    @Autowired<br>    private UserService self;<br><br><br>    public int createUserWrong1(String name) {<br>        try {<br>            self.createUserPrivate(new User(name));<br>        } catch (Exception ex) {<br>            logger.error(&quot;create user failed because {}&quot;, ex.getMessage());<br>        }<br>        return userMapper.getByName(name).size();<br>    }<br><br>    @Transactional<br>    public void createUserPrivate(User user) {<br>        userMapper.addUser(user);<br>        if (user.getName().contains(&quot;test&quot;))<br>            throw new RuntimeException(&quot;invalid username!&quot;);<br>    }<br>----------------------------------------------<br>å°†thisæ¢ä½selfäº†ï¼Œä½†æ˜¯äº‹åŠ¡ä¾ç„¶æ²¡æœ‰ç”Ÿæ•ˆï¼Œhttp:&#47;&#47;localhost:8080&#47;user&#47;wrong1?name=testè®¿é—®åï¼Œæ•°æ®åº“è¿˜æ˜¯æ’å…¥äº†testè¿™æ¡è®°å½•å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":493392,"discussion_content":"å¯ä»¥å…ˆæ ¹æ®æ—¥å¿—æ’æŸ¥ä¸€ä¸‹ï¼Œæœ‰é—®é¢˜çš„è¯å¸–ä¸€ä¸‹å®Œæ•´çš„æ—¥å¿—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588040316,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":250928,"discussion_content":"OK","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588050416,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1336475,"avatar":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","nickname":"J.Smile","note":"","ucode":"C4D98DFDBF7584","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":250771,"discussion_content":"æå®šäº†ï¼Œæ˜¯ç‰¹ä¹ˆideaçš„ç¼“å­˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588039250,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":208222,"user_name":"ç››å¤æµå¹´","can_delete":false,"product_type":"c1","uid":1492295,"ip_address":"","ucode":"8D08F56BF95485","user_header":"https://static001.geekbang.org/account/avatar/00/16/c5/47/094ed41b.jpg","comment_is_top":false,"comment_ctime":1587304006,"is_pvip":true,"replies":[{"id":"77821","content":"å¦‚æœå¯¹ä½ æœ‰å¸®åŠ©æ¬¢è¿ç‚¹èµè½¬å‘","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1587347060,"ip_address":"","comment_id":208222,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1587304006","product_id":100047701,"comment_content":"å¦‚æœæ—©ä¸€ç‚¹çœ‹åˆ°è¿™ç¯‡æ–‡ç« ï¼Œå°±ä¸ä¼šåœ¨ä¸€ä¸ªé¡¹ç›®é‡Œé¢è¿è¸©å¤šä¸ªå‘äº†â€¦â€¦ğŸ˜‚","like_count":0,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":492380,"discussion_content":"å¦‚æœå¯¹ä½ æœ‰å¸®åŠ©æ¬¢è¿ç‚¹èµè½¬å‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587347060,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":207257,"user_name":"æ”»åŸç‹®MK","can_delete":false,"product_type":"c1","uid":1299404,"ip_address":"","ucode":"D418DEF46E0A04","user_header":"https://static001.geekbang.org/account/avatar/00/13/d3/cc/e3a54a6b.jpg","comment_is_top":false,"comment_ctime":1587038497,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587038497","product_id":100047701,"comment_content":"è¡¥å……ä¸€ä¸ªç‚¹ï¼Œå¦‚æœæŸæ–¹æ³•çš„å®šä¹‰ä¸èƒ½ä½¿ç”¨jdkåŠ¨æ€ä»£ç†å’ŒcglibåŠ¨æ€ä»£ç†ï¼Œä¾ç„¶å¯ä»¥ä»å¤–å±‚æ–¹æ³•å¼€å¯äº‹åŠ¡ä¼ æ’­è¿›æ¥è¿›è¡Œäº‹åŠ¡ç®¡ç†ï¼Œæ¯”å¦‚épublic+finalä¿®é¥°çš„æ–¹æ³•ï¼Œè™½ç„¶å¾ˆæç«¯â€¦â€¦","like_count":0},{"had_liked":false,"id":206380,"user_name":"HadesFX","can_delete":false,"product_type":"c1","uid":1052835,"ip_address":"","ucode":"221590B6D85266","user_header":"https://static001.geekbang.org/account/avatar/00/10/10/a3/25e48834.jpg","comment_is_top":false,"comment_ctime":1586850452,"is_pvip":false,"replies":[{"id":"77107","content":"æŠ¥ä»€ä¹ˆé”™","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1586863022,"ip_address":"","comment_id":206380,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1586850452","product_id":100047701,"comment_content":"æ³¨å…¥selfæ—¶ï¼Œå¯åŠ¨é¡¹ç›®ä¼šæŠ¥é”™ï¼Œè€å¸ˆè¿™æ˜¯ä¸ºä»€ä¹ˆé‚£ï¼Œè²Œä¼¼æ˜¯æ— æ³•æ³¨å…¥æœ¬èº«","like_count":0,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491769,"discussion_content":"æŠ¥ä»€ä¹ˆé”™","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586863022,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1336475,"avatar":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","nickname":"J.Smile","note":"","ucode":"C4D98DFDBF7584","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":250710,"discussion_content":"æˆ‘å€’æ˜¯æ²¡æœ‰å‡ºé”™ï¼Œä½†æ˜¯äº‹åŠ¡ä¾ç„¶æ²¡æœ‰ç”Ÿæ•ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588036534,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":203158,"user_name":"Geek_mh","can_delete":false,"product_type":"c1","uid":1904660,"ip_address":"","ucode":"D3D72282535926","user_header":"","comment_is_top":false,"comment_ctime":1586145853,"is_pvip":false,"replies":[{"id":"75960","content":"é»˜è®¤è‚¯å®šæ˜¯æœ¬åœ°äº‹åŠ¡ï¼Œé™¤éä½ ä½¿ç”¨å…¶ä»–åº“","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1586174600,"ip_address":"","comment_id":203158,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1586145853","product_id":100047701,"comment_content":"è€å¸ˆï¼Œæƒ³ç¡®è®¤ä¸‹ï¼Œ@Transactional  è¿™å¯¹äºå¤šæœåŠ¡å™¨é›†ç¾¤æ¨¡å¼çš„æœåŠ¡æ¥è¯´ï¼Œæ˜¯ä¸é€‚ç”¨çš„å§ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490785,"discussion_content":"é»˜è®¤è‚¯å®šæ˜¯æœ¬åœ°äº‹åŠ¡ï¼Œé™¤éä½ ä½¿ç”¨å…¶ä»–åº“","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586174600,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":203157,"user_name":"Geek_mh","can_delete":false,"product_type":"c1","uid":1904660,"ip_address":"","ucode":"D3D72282535926","user_header":"","comment_is_top":false,"comment_ctime":1586145702,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586145702","product_id":100047701,"comment_content":"@Transactionalè¿™ç§Springäº‹åŠ¡å¯¹äºå¤šå°æœåŠ¡å™¨é›†ç¾¤æ¨¡å¼çš„æœåŠ¡æ¥è¯´ï¼Œåº”è¯¥ä¸é€‚ç”¨å§ï¼Ÿ","like_count":0},{"had_liked":false,"id":202724,"user_name":"QQæ€ª","can_delete":false,"product_type":"c1","uid":1211223,"ip_address":"","ucode":"1A39B8433D9208","user_header":"https://static001.geekbang.org/account/avatar/00/12/7b/57/a9b04544.jpg","comment_is_top":false,"comment_ctime":1586058213,"is_pvip":false,"replies":[{"id":"75748","content":"ğŸ‘ğŸ»","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1586065180,"ip_address":"","comment_id":202724,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1586058213","product_id":100047701,"comment_content":"å®æˆ˜ä¸­ä¹‹å‰ä¹Ÿä¸å¤ªæ‡‚ï¼Œç°åœ¨å­¦åˆ°äº†å¾ˆå¤šï¼Œå›å»æ£€æŸ¥ä»£ç äº†","like_count":0,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490662,"discussion_content":"ğŸ‘ğŸ»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586065180,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":201548,"user_name":"å¦è‡³","can_delete":false,"product_type":"c1","uid":1073651,"ip_address":"","ucode":"B2CAC3B17A2FA1","user_header":"https://static001.geekbang.org/account/avatar/00/10/61/f3/584d3b46.jpg","comment_is_top":false,"comment_ctime":1585802627,"is_pvip":false,"replies":[{"id":"75387","content":"å“ˆå“ˆï¼Œä»¥åéœ€è¦æ³¨æ„äº†","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1585807494,"ip_address":"","comment_id":201548,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1585802627","product_id":100047701,"comment_content":"å—ç›ŠåŒªæµ…ï¼Œæˆ‘å°±æ˜¯å†™ä¸ª@Transactionalå°±ä¸‡äº‹å¤§å‰çš„é‚£ä¸ª~","like_count":0,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490362,"discussion_content":"å“ˆå“ˆï¼Œä»¥åéœ€è¦æ³¨æ„äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585807494,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":199420,"user_name":"The One","can_delete":false,"product_type":"c1","uid":1319368,"ip_address":"","ucode":"D3438E31543332","user_header":"https://static001.geekbang.org/account/avatar/00/14/21/c8/33828cfc.jpg","comment_is_top":false,"comment_ctime":1585488717,"is_pvip":true,"replies":[{"id":"74777","content":"å¥½","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1585527509,"ip_address":"","comment_id":199420,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1585488717","product_id":100047701,"comment_content":"æŠ±æ­‰ï¼Œæ‰“æ‰°äº†ï¼Œä¸Šä¸ªç•™è¨€æ²¡æ³¨æ„åˆ°ï¼Œsubserviceéœ€è¦å¼€å¯ä¸€ä¸ªå­äº‹åŠ¡ï¼Œå¤šè¯»äº†ä¸¤è¾¹æ˜ç™½äº†ï¼Œæ‰“æ‰°è€å¸ˆäº†ã€‚","like_count":0,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489831,"discussion_content":"å¥½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585527509,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1134861,"avatar":"https://static001.geekbang.org/account/avatar/00/11/51/0d/fc1652fe.jpg","nickname":"James","note":"","ucode":"48B0F2A334D1C1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":294251,"discussion_content":"å¾ˆç†Ÿæ‚‰çš„åå­—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595840151,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}